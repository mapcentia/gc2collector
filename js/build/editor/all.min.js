function startWfsEdition(a,b,c,d,e){"use strict";var f,g,h,i,j,k,l=!0,m=Ext.getCmp("attrtable"),n=d;layerBeingEditing=a,layerBeingEditingGeomField=b;try{drawControl.deactivate(),layer.removeAllFeatures(),map.removeLayer(layer)}catch(o){}try{m.remove(grid)}catch(o){}$.ajax({url:"/controllers/table/columns/"+a,async:!1,dataType:"json",type:"GET",success:function(a){var b=a,c=!0;f=b.forStore,g=b.forGrid,h=b.type,i=b.multi;for(var d in g)if(g[d].editable=l,void 0!==g[d].typeObj)if(g[d].properties)try{{Ext.decode(g[d].properties)}g[d].editor=new Ext.form.ComboBox({store:Ext.decode(g[d].properties),editable:!0,triggerAction:"all"}),c=!1}catch(e){alert("There is invalid properties on field "+g[d].dataIndex)}else"int"===g[d].typeObj.type?g[d].editor=new Ext.form.NumberField({decimalPrecision:0,decimalSeparator:"Â¤"}):"decimal"===g[d].typeObj.type?g[d].editor=new Ext.form.NumberField({decimalPrecision:g[d].typeObj.scale,decimalSeparator:"."}):"string"===g[d].typeObj.type?g[d].editor=new Ext.form.TextField:"text"===g[d].typeObj.type&&(g[d].editor=new Ext.form.TextArea)}}),"Point"===h?j=OpenLayers.Handler.Point:"Polygon"===h?j=OpenLayers.Handler.Polygon:"Path"===h&&(j=OpenLayers.Handler.Path),m.expand(!0);var p={rules:[new OpenLayers.Rule({filter:new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.NOT_EQUAL_TO,property:"gc2_version_end_date",value:"null"}),symbolizer:{fillColor:"#000000",fillOpacity:0,strokeColor:"#FF0000",strokeWidth:2,strokeDashstyle:"dash",strokeOpacity:.7,graphicZIndex:1}}),new OpenLayers.Rule({filter:new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.EQUAL_TO,property:"gc2_version_end_date",value:null}),symbolizer:{fillColor:"#000000",fillOpacity:0,strokeColor:"#0000FF",strokeWidth:3,strokeOpacity:.7,graphicZIndex:3,strokeDashstyle:"solid"}})]},q=new OpenLayers.StyleMap({"default":new OpenLayers.Style({fillColor:"#000000",fillOpacity:0,pointRadius:5,strokeColor:"#0000FF",strokeWidth:3,strokeOpacity:.7,graphicZIndex:3},p),temporary:new OpenLayers.Style({fillColor:"#FFFFFF",fillOpacity:.7,pointRadius:5,strokeColor:"#0000FF",strokeWidth:1,strokeOpacity:.7,graphicZIndex:1}),select:new OpenLayers.Style({fillColor:"#000000",fillOpacity:.2,pointRadius:8,strokeColor:"#0000FF",strokeWidth:3,strokeOpacity:1,graphicZIndex:3},p)});layer=new OpenLayers.Layer.Vector("vector",{strategies:[new OpenLayers.Strategy.Fixed,saveStrategy],protocol:new OpenLayers.Protocol.WFS.v1_0_0({url:"/wfs/"+(subUser?subUser+"@"+screenName:screenName)+"/"+schema+"/900913"+(e?"/"+e:"")+"?",version:"1.0.0",featureType:a,featureNS:"http://mapcentia.com/"+screenName,featurePrefix:screenName,srsName:"EPSG:900913",geometryName:b,defaultFilter:c}),styleMap:q}),map.addLayers([layer]),layer.events.register("loadend",layer,function(){var a=layer.features.length;window.parent.App.setAlert(App.STATUS_NOTICE,a+" features loaded"),layer.features.length>0&&map.zoomToExtent(layer.getDataExtent()),n&&(setTimeout(function(){map.controls[map.controls.length-1].selectControl.select(layer.features[0])},600),n=!1)}),layer.events.register("loadstart",layer,function(){}),drawControl=new OpenLayers.Control.DrawFeature(layer,j,{featureAdded:onInsert,handlerOptions:{multi:i,handlerOptions:{holeModifier:"altKey"}}}),l?(wfsTools[0].control=drawControl,map.addControl(drawControl),modifyControl=new OpenLayers.Control.ModifyFeature(layer,{vertexRenderIntent:"temporary",displayClass:"olControlModifyFeature"}),map.addControl(modifyControl),modifyControl.activate(),k=new GeoExt.grid.FeatureSelectionModel({selectControl:modifyControl.selectControl,singleSelect:!0,listeners:{rowselect:function(a,b,c){try{attributeForm.form.getForm().loadRecord(c)}catch(d){}}}})):k=new GeoExt.grid.FeatureSelectionModel({singleSelect:!1}),store=new GeoExt.data.FeatureStore({proxy:new GeoExt.data.ProtocolProxy({protocol:layer.protocol}),fields:f,layer:layer,featureFilter:new OpenLayers.Filter({evaluate:function(a){return a.state!==OpenLayers.State.DELETE}})}),grid=new Ext.grid.EditorGridPanel({id:"gridpanel",region:"center",disabled:!1,viewConfig:{forceFit:!0},store:store,listeners:{afteredit:function(a){var b=a.record.get("feature");b.state!==OpenLayers.State.INSERT&&(b.state=OpenLayers.State.UPDATE)}},sm:k,cm:new Ext.grid.ColumnModel({defaults:{sortable:!0,editor:{xtype:"textfield"}},columns:g})}),m.add(grid),gridPanel=Ext.getCmp("gridpanel"),m.doLayout(),attributeForm.win=new Ext.Window({title:"Attributes",modal:!1,layout:"fit",initCenter:!0,border:!1,width:420,height:350,closeAction:"hide",plain:!0,items:[new Ext.Panel({frame:!1,layout:"border",items:[attributeForm.form]})]}),Ext.getCmp("editcreatebutton").toggle(!1),Ext.getCmp("editcreatebutton").setDisabled(!1),Ext.getCmp("editdeletebutton").setDisabled(!1),Ext.getCmp("editsavebutton").setDisabled(!1),Ext.getCmp("editstopbutton").setDisabled(!1),Ext.getCmp("infobutton").setDisabled(!1)}function stopEdit(){"use strict";layerBeingEditing=null;try{filter.win.hide(),filter.win=!1}catch(a){}Ext.getCmp("editcreatebutton").toggle(!1),Ext.getCmp("editcreatebutton").setDisabled(!0),Ext.getCmp("editdeletebutton").setDisabled(!0),Ext.getCmp("editsavebutton").setDisabled(!0),Ext.getCmp("editstopbutton").setDisabled(!0),Ext.getCmp("infobutton").setDisabled(!0);try{drawControl.deactivate(),layer.removeAllFeatures(),map.removeLayer(layer)}catch(a){}Ext.getCmp("attrtable").collapse(!0)}function onInsert(){var a=grid.getStore().getCount()-1;grid.selModel.selectRow(a)}function array_unique(a){var b={},c=[];if(a.length&&"string"!=typeof a)for(var d=0,e=a.length;e>d;d++)b[a[d]+typeof a[d]]||(c.push(a[d]),b[a[d]+typeof a[d]]=!0);return c||a}function getFieldType(a){"use strict";return{"xsd:boolean":"boolean","xsd:int":"int","xsd:integer":"int","xsd:short":"int","xsd:long":"int","xsd:date":"date","xsd:string":"string","xsd:float":"float","xsd:double":"float","xsd:decimal":"float","gml:PointPropertyType":"int"}[a]}function phi4z(a,b,c,d,e,f,g,h,i){var j,k,l,m,n,o,p,q,r;for(i=f,r=1;15>=r;r++)if(j=Math.sin(i),tanphi=Math.tan(i),h=tanphi*Math.sqrt(1-a*j*j),k=Math.sin(2*i),l=b*i-c*k+d*Math.sin(4*i)-e*Math.sin(6*i),m=b-2*c*Math.cos(2*i)+4*d*Math.cos(4*i)-6*e*Math.cos(6*i),n=2*l+h*(l*l+g)-2*f*(h*l+1),o=a*k*(l*l+g-2*f*l)/(2*h),p=2*(f-l)*(h*m-2/k)-2*m,q=n/(o+p),i+=q,Math.abs(q)<=1e-10)return i;return Proj4js.reportError("phi4z: No convergence"),null}function e4fn(a){var b,c;return b=1+a,c=1-a,Math.sqrt(Math.pow(b,b)*Math.pow(c,c))}!function(a,b){function c(a){var b=a.length,c=kb.type(a);return kb.isWindow(a)?!1:1===a.nodeType&&b?!0:"array"===c||"function"!==c&&(0===b||"number"==typeof b&&b>0&&b-1 in a)}function d(a){var b=zb[a]={};return kb.each(a.match(mb)||[],function(a,c){b[c]=!0}),b}function e(a,c,d,e){if(kb.acceptData(a)){var f,g,h=kb.expando,i=a.nodeType,j=i?kb.cache:a,k=i?a[h]:a[h]&&h;if(k&&j[k]&&(e||j[k].data)||d!==b||"string"!=typeof c)return k||(k=i?a[h]=bb.pop()||kb.guid++:h),j[k]||(j[k]=i?{}:{toJSON:kb.noop}),("object"==typeof c||"function"==typeof c)&&(e?j[k]=kb.extend(j[k],c):j[k].data=kb.extend(j[k].data,c)),g=j[k],e||(g.data||(g.data={}),g=g.data),d!==b&&(g[kb.camelCase(c)]=d),"string"==typeof c?(f=g[c],null==f&&(f=g[kb.camelCase(c)])):f=g,f}}function f(a,b,c){if(kb.acceptData(a)){var d,e,f=a.nodeType,g=f?kb.cache:a,i=f?a[kb.expando]:kb.expando;if(g[i]){if(b&&(d=c?g[i]:g[i].data)){kb.isArray(b)?b=b.concat(kb.map(b,kb.camelCase)):b in d?b=[b]:(b=kb.camelCase(b),b=b in d?[b]:b.split(" ")),e=b.length;for(;e--;)delete d[b[e]];if(c?!h(d):!kb.isEmptyObject(d))return}(c||(delete g[i].data,h(g[i])))&&(f?kb.cleanData([a],!0):kb.support.deleteExpando||g!=g.window?delete g[i]:g[i]=null)}}}function g(a,c,d){if(d===b&&1===a.nodeType){var e="data-"+c.replace(Bb,"-$1").toLowerCase();if(d=a.getAttribute(e),"string"==typeof d){try{d="true"===d?!0:"false"===d?!1:"null"===d?null:+d+""===d?+d:Ab.test(d)?kb.parseJSON(d):d}catch(f){}kb.data(a,c,d)}else d=b}return d}function h(a){var b;for(b in a)if(("data"!==b||!kb.isEmptyObject(a[b]))&&"toJSON"!==b)return!1;return!0}function i(){return!0}function j(){return!1}function k(){try{return Y.activeElement}catch(a){}}function l(a,b){do a=a[b];while(a&&1!==a.nodeType);return a}function m(a,b,c){if(kb.isFunction(b))return kb.grep(a,function(a,d){return!!b.call(a,d,a)!==c});if(b.nodeType)return kb.grep(a,function(a){return a===b!==c});if("string"==typeof b){if(Qb.test(b))return kb.filter(b,a,c);b=kb.filter(b,a)}return kb.grep(a,function(a){return kb.inArray(a,b)>=0!==c})}function n(a){var b=Ub.split("|"),c=a.createDocumentFragment();if(c.createElement)for(;b.length;)c.createElement(b.pop());return c}function o(a,b){return kb.nodeName(a,"table")&&kb.nodeName(1===b.nodeType?b:b.firstChild,"tr")?a.getElementsByTagName("tbody")[0]||a.appendChild(a.ownerDocument.createElement("tbody")):a}function p(a){return a.type=(null!==kb.find.attr(a,"type"))+"/"+a.type,a}function q(a){var b=ec.exec(a.type);return b?a.type=b[1]:a.removeAttribute("type"),a}function r(a,b){for(var c,d=0;null!=(c=a[d]);d++)kb._data(c,"globalEval",!b||kb._data(b[d],"globalEval"))}function s(a,b){if(1===b.nodeType&&kb.hasData(a)){var c,d,e,f=kb._data(a),g=kb._data(b,f),h=f.events;if(h){delete g.handle,g.events={};for(c in h)for(d=0,e=h[c].length;e>d;d++)kb.event.add(b,c,h[c][d])}g.data&&(g.data=kb.extend({},g.data))}}function t(a,b){var c,d,e;if(1===b.nodeType){if(c=b.nodeName.toLowerCase(),!kb.support.noCloneEvent&&b[kb.expando]){e=kb._data(b);for(d in e.events)kb.removeEvent(b,d,e.handle);b.removeAttribute(kb.expando)}"script"===c&&b.text!==a.text?(p(b).text=a.text,q(b)):"object"===c?(b.parentNode&&(b.outerHTML=a.outerHTML),kb.support.html5Clone&&a.innerHTML&&!kb.trim(b.innerHTML)&&(b.innerHTML=a.innerHTML)):"input"===c&&bc.test(a.type)?(b.defaultChecked=b.checked=a.checked,b.value!==a.value&&(b.value=a.value)):"option"===c?b.defaultSelected=b.selected=a.defaultSelected:("input"===c||"textarea"===c)&&(b.defaultValue=a.defaultValue)}}function u(a,c){var d,e,f=0,g=typeof a.getElementsByTagName!==W?a.getElementsByTagName(c||"*"):typeof a.querySelectorAll!==W?a.querySelectorAll(c||"*"):b;if(!g)for(g=[],d=a.childNodes||a;null!=(e=d[f]);f++)!c||kb.nodeName(e,c)?g.push(e):kb.merge(g,u(e,c));return c===b||c&&kb.nodeName(a,c)?kb.merge([a],g):g}function v(a){bc.test(a.type)&&(a.defaultChecked=a.checked)}function w(a,b){if(b in a)return b;for(var c=b.charAt(0).toUpperCase()+b.slice(1),d=b,e=yc.length;e--;)if(b=yc[e]+c,b in a)return b;return d}function x(a,b){return a=b||a,"none"===kb.css(a,"display")||!kb.contains(a.ownerDocument,a)}function y(a,b){for(var c,d,e,f=[],g=0,h=a.length;h>g;g++)d=a[g],d.style&&(f[g]=kb._data(d,"olddisplay"),c=d.style.display,b?(f[g]||"none"!==c||(d.style.display=""),""===d.style.display&&x(d)&&(f[g]=kb._data(d,"olddisplay",C(d.nodeName)))):f[g]||(e=x(d),(c&&"none"!==c||!e)&&kb._data(d,"olddisplay",e?c:kb.css(d,"display"))));for(g=0;h>g;g++)d=a[g],d.style&&(b&&"none"!==d.style.display&&""!==d.style.display||(d.style.display=b?f[g]||"":"none"));return a}function z(a,b,c){var d=rc.exec(b);return d?Math.max(0,d[1]-(c||0))+(d[2]||"px"):b}function A(a,b,c,d,e){for(var f=c===(d?"border":"content")?4:"width"===b?1:0,g=0;4>f;f+=2)"margin"===c&&(g+=kb.css(a,c+xc[f],!0,e)),d?("content"===c&&(g-=kb.css(a,"padding"+xc[f],!0,e)),"margin"!==c&&(g-=kb.css(a,"border"+xc[f]+"Width",!0,e))):(g+=kb.css(a,"padding"+xc[f],!0,e),"padding"!==c&&(g+=kb.css(a,"border"+xc[f]+"Width",!0,e)));return g}function B(a,b,c){var d=!0,e="width"===b?a.offsetWidth:a.offsetHeight,f=kc(a),g=kb.support.boxSizing&&"border-box"===kb.css(a,"boxSizing",!1,f);if(0>=e||null==e){if(e=lc(a,b,f),(0>e||null==e)&&(e=a.style[b]),sc.test(e))return e;d=g&&(kb.support.boxSizingReliable||e===a.style[b]),e=parseFloat(e)||0}return e+A(a,b,c||(g?"border":"content"),d,f)+"px"}function C(a){var b=Y,c=uc[a];return c||(c=D(a,b),"none"!==c&&c||(jc=(jc||kb("<iframe frameborder='0' width='0' height='0'/>").css("cssText","display:block !important")).appendTo(b.documentElement),b=(jc[0].contentWindow||jc[0].contentDocument).document,b.write("<!doctype html><html><body>"),b.close(),c=D(a,b),jc.detach()),uc[a]=c),c}function D(a,b){var c=kb(b.createElement(a)).appendTo(b.body),d=kb.css(c[0],"display");return c.remove(),d}function E(a,b,c,d){var e;if(kb.isArray(b))kb.each(b,function(b,e){c||Ac.test(a)?d(a,e):E(a+"["+("object"==typeof e?b:"")+"]",e,c,d)});else if(c||"object"!==kb.type(b))d(a,b);else for(e in b)E(a+"["+e+"]",b[e],c,d)}function F(a){return function(b,c){"string"!=typeof b&&(c=b,b="*");var d,e=0,f=b.toLowerCase().match(mb)||[];if(kb.isFunction(c))for(;d=f[e++];)"+"===d[0]?(d=d.slice(1)||"*",(a[d]=a[d]||[]).unshift(c)):(a[d]=a[d]||[]).push(c)}}function G(a,c,d,e){function f(i){var j;return g[i]=!0,kb.each(a[i]||[],function(a,i){var k=i(c,d,e);return"string"!=typeof k||h||g[k]?h?!(j=k):b:(c.dataTypes.unshift(k),f(k),!1)}),j}var g={},h=a===Rc;return f(c.dataTypes[0])||!g["*"]&&f("*")}function H(a,c){var d,e,f=kb.ajaxSettings.flatOptions||{};for(e in c)c[e]!==b&&((f[e]?a:d||(d={}))[e]=c[e]);return d&&kb.extend(!0,a,d),a}function I(a,c,d){for(var e,f,g,h,i=a.contents,j=a.dataTypes;"*"===j[0];)j.shift(),f===b&&(f=a.mimeType||c.getResponseHeader("Content-Type"));if(f)for(h in i)if(i[h]&&i[h].test(f)){j.unshift(h);break}if(j[0]in d)g=j[0];else{for(h in d){if(!j[0]||a.converters[h+" "+j[0]]){g=h;break}e||(e=h)}g=g||e}return g?(g!==j[0]&&j.unshift(g),d[g]):b}function J(a,b,c,d){var e,f,g,h,i,j={},k=a.dataTypes.slice();if(k[1])for(g in a.converters)j[g.toLowerCase()]=a.converters[g];for(f=k.shift();f;)if(a.responseFields[f]&&(c[a.responseFields[f]]=b),!i&&d&&a.dataFilter&&(b=a.dataFilter(b,a.dataType)),i=f,f=k.shift())if("*"===f)f=i;else if("*"!==i&&i!==f){if(g=j[i+" "+f]||j["* "+f],!g)for(e in j)if(h=e.split(" "),h[1]===f&&(g=j[i+" "+h[0]]||j["* "+h[0]])){g===!0?g=j[e]:j[e]!==!0&&(f=h[0],k.unshift(h[1]));break}if(g!==!0)if(g&&a["throws"])b=g(b);else try{b=g(b)}catch(l){return{state:"parsererror",error:g?l:"No conversion from "+i+" to "+f}}}return{state:"success",data:b}}function K(){try{return new a.XMLHttpRequest}catch(b){}}function L(){try{return new a.ActiveXObject("Microsoft.XMLHTTP")}catch(b){}}function M(){return setTimeout(function(){$c=b}),$c=kb.now()}function N(a,b,c){for(var d,e=(ed[b]||[]).concat(ed["*"]),f=0,g=e.length;g>f;f++)if(d=e[f].call(c,b,a))return d}function O(a,b,c){var d,e,f=0,g=dd.length,h=kb.Deferred().always(function(){delete i.elem}),i=function(){if(e)return!1;for(var b=$c||M(),c=Math.max(0,j.startTime+j.duration-b),d=c/j.duration||0,f=1-d,g=0,i=j.tweens.length;i>g;g++)j.tweens[g].run(f);return h.notifyWith(a,[j,f,c]),1>f&&i?c:(h.resolveWith(a,[j]),!1)},j=h.promise({elem:a,props:kb.extend({},b),opts:kb.extend(!0,{specialEasing:{}},c),originalProperties:b,originalOptions:c,startTime:$c||M(),duration:c.duration,tweens:[],createTween:function(b,c){var d=kb.Tween(a,j.opts,b,c,j.opts.specialEasing[b]||j.opts.easing);return j.tweens.push(d),d},stop:function(b){var c=0,d=b?j.tweens.length:0;if(e)return this;for(e=!0;d>c;c++)j.tweens[c].run(1);return b?h.resolveWith(a,[j,b]):h.rejectWith(a,[j,b]),this}}),k=j.props;for(P(k,j.opts.specialEasing);g>f;f++)if(d=dd[f].call(j,a,k,j.opts))return d;return kb.map(k,N,j),kb.isFunction(j.opts.start)&&j.opts.start.call(a,j),kb.fx.timer(kb.extend(i,{elem:a,anim:j,queue:j.opts.queue})),j.progress(j.opts.progress).done(j.opts.done,j.opts.complete).fail(j.opts.fail).always(j.opts.always)}function P(a,b){var c,d,e,f,g;for(c in a)if(d=kb.camelCase(c),e=b[d],f=a[c],kb.isArray(f)&&(e=f[1],f=a[c]=f[0]),c!==d&&(a[d]=f,delete a[c]),g=kb.cssHooks[d],g&&"expand"in g){f=g.expand(f),delete a[d];for(c in f)c in a||(a[c]=f[c],b[c]=e)}else b[d]=e}function Q(a,b,c){var d,e,f,g,h,i,j=this,k={},l=a.style,m=a.nodeType&&x(a),n=kb._data(a,"fxshow");c.queue||(h=kb._queueHooks(a,"fx"),null==h.unqueued&&(h.unqueued=0,i=h.empty.fire,h.empty.fire=function(){h.unqueued||i()}),h.unqueued++,j.always(function(){j.always(function(){h.unqueued--,kb.queue(a,"fx").length||h.empty.fire()})})),1===a.nodeType&&("height"in b||"width"in b)&&(c.overflow=[l.overflow,l.overflowX,l.overflowY],"inline"===kb.css(a,"display")&&"none"===kb.css(a,"float")&&(kb.support.inlineBlockNeedsLayout&&"inline"!==C(a.nodeName)?l.zoom=1:l.display="inline-block")),c.overflow&&(l.overflow="hidden",kb.support.shrinkWrapBlocks||j.always(function(){l.overflow=c.overflow[0],l.overflowX=c.overflow[1],l.overflowY=c.overflow[2]}));for(d in b)if(e=b[d],ad.exec(e)){if(delete b[d],f=f||"toggle"===e,e===(m?"hide":"show"))continue;k[d]=n&&n[d]||kb.style(a,d)}if(!kb.isEmptyObject(k)){n?"hidden"in n&&(m=n.hidden):n=kb._data(a,"fxshow",{}),f&&(n.hidden=!m),m?kb(a).show():j.done(function(){kb(a).hide()}),j.done(function(){var b;kb._removeData(a,"fxshow");for(b in k)kb.style(a,b,k[b])});for(d in k)g=N(m?n[d]:0,d,j),d in n||(n[d]=g.start,m&&(g.end=g.start,g.start="width"===d||"height"===d?1:0))}}function R(a,b,c,d,e){return new R.prototype.init(a,b,c,d,e)}function S(a,b){var c,d={height:a},e=0;for(b=b?1:0;4>e;e+=2-b)c=xc[e],d["margin"+c]=d["padding"+c]=a;return b&&(d.opacity=d.width=a),d}function T(a){return kb.isWindow(a)?a:9===a.nodeType?a.defaultView||a.parentWindow:!1}var U,V,W=typeof b,X=a.location,Y=a.document,Z=Y.documentElement,$=a.jQuery,_=a.$,ab={},bb=[],cb="1.10.0",db=bb.concat,eb=bb.push,fb=bb.slice,gb=bb.indexOf,hb=ab.toString,ib=ab.hasOwnProperty,jb=cb.trim,kb=function(a,b){return new kb.fn.init(a,b,V)},lb=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,mb=/\S+/g,nb=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,ob=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]*))$/,pb=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,qb=/^[\],:{}\s]*$/,rb=/(?:^|:|,)(?:\s*\[)+/g,sb=/\\(?:["\\\/bfnrt]|u[\da-fA-F]{4})/g,tb=/"[^"\\\r\n]*"|true|false|null|-?(?:\d+\.|)\d+(?:[eE][+-]?\d+|)/g,ub=/^-ms-/,vb=/-([\da-z])/gi,wb=function(a,b){return b.toUpperCase()},xb=function(a){(Y.addEventListener||"load"===a.type||"complete"===Y.readyState)&&(yb(),kb.ready())},yb=function(){Y.addEventListener?(Y.removeEventListener("DOMContentLoaded",xb,!1),a.removeEventListener("load",xb,!1)):(Y.detachEvent("onreadystatechange",xb),a.detachEvent("onload",xb))};kb.fn=kb.prototype={jquery:cb,constructor:kb,init:function(a,c,d){var e,f;if(!a)return this;if("string"==typeof a){if(e="<"===a.charAt(0)&&">"===a.charAt(a.length-1)&&a.length>=3?[null,a,null]:ob.exec(a),!e||!e[1]&&c)return!c||c.jquery?(c||d).find(a):this.constructor(c).find(a);if(e[1]){if(c=c instanceof kb?c[0]:c,kb.merge(this,kb.parseHTML(e[1],c&&c.nodeType?c.ownerDocument||c:Y,!0)),pb.test(e[1])&&kb.isPlainObject(c))for(e in c)kb.isFunction(this[e])?this[e](c[e]):this.attr(e,c[e]);return this}if(f=Y.getElementById(e[2]),f&&f.parentNode){if(f.id!==e[2])return d.find(a);this.length=1,this[0]=f}return this.context=Y,this.selector=a,this}return a.nodeType?(this.context=this[0]=a,this.length=1,this):kb.isFunction(a)?d.ready(a):(a.selector!==b&&(this.selector=a.selector,this.context=a.context),kb.makeArray(a,this))},selector:"",length:0,toArray:function(){return fb.call(this)},get:function(a){return null==a?this.toArray():0>a?this[this.length+a]:this[a]},pushStack:function(a){var b=kb.merge(this.constructor(),a);return b.prevObject=this,b.context=this.context,b},each:function(a,b){return kb.each(this,a,b)},ready:function(a){return kb.ready.promise().done(a),this},slice:function(){return this.pushStack(fb.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(a){var b=this.length,c=+a+(0>a?b:0);return this.pushStack(c>=0&&b>c?[this[c]]:[])},map:function(a){return this.pushStack(kb.map(this,function(b,c){return a.call(b,c,b)}))},end:function(){return this.prevObject||this.constructor(null)},push:eb,sort:[].sort,splice:[].splice},kb.fn.init.prototype=kb.fn,kb.extend=kb.fn.extend=function(){var a,c,d,e,f,g,h=arguments[0]||{},i=1,j=arguments.length,k=!1;for("boolean"==typeof h&&(k=h,h=arguments[1]||{},i=2),"object"==typeof h||kb.isFunction(h)||(h={}),j===i&&(h=this,--i);j>i;i++)if(null!=(f=arguments[i]))for(e in f)a=h[e],d=f[e],h!==d&&(k&&d&&(kb.isPlainObject(d)||(c=kb.isArray(d)))?(c?(c=!1,g=a&&kb.isArray(a)?a:[]):g=a&&kb.isPlainObject(a)?a:{},h[e]=kb.extend(k,g,d)):d!==b&&(h[e]=d));return h},kb.extend({expando:"jQuery"+(cb+Math.random()).replace(/\D/g,""),noConflict:function(b){return a.$===kb&&(a.$=_),b&&a.jQuery===kb&&(a.jQuery=$),kb},isReady:!1,readyWait:1,holdReady:function(a){a?kb.readyWait++:kb.ready(!0)},ready:function(a){if(a===!0?!--kb.readyWait:!kb.isReady){if(!Y.body)return setTimeout(kb.ready);kb.isReady=!0,a!==!0&&--kb.readyWait>0||(U.resolveWith(Y,[kb]),kb.fn.trigger&&kb(Y).trigger("ready").off("ready"))}},isFunction:function(a){return"function"===kb.type(a)},isArray:Array.isArray||function(a){return"array"===kb.type(a)},isWindow:function(a){return null!=a&&a==a.window},isNumeric:function(a){return!isNaN(parseFloat(a))&&isFinite(a)},type:function(a){return null==a?a+"":"object"==typeof a||"function"==typeof a?ab[hb.call(a)]||"object":typeof a},isPlainObject:function(a){var c;if(!a||"object"!==kb.type(a)||a.nodeType||kb.isWindow(a))return!1;try{if(a.constructor&&!ib.call(a,"constructor")&&!ib.call(a.constructor.prototype,"isPrototypeOf"))return!1}catch(d){return!1}if(kb.support.ownLast)for(c in a)return ib.call(a,c);for(c in a);return c===b||ib.call(a,c)},isEmptyObject:function(a){var b;for(b in a)return!1;return!0},error:function(a){throw Error(a)},parseHTML:function(a,b,c){if(!a||"string"!=typeof a)return null;"boolean"==typeof b&&(c=b,b=!1),b=b||Y;var d=pb.exec(a),e=!c&&[];return d?[b.createElement(d[1])]:(d=kb.buildFragment([a],b,e),e&&kb(e).remove(),kb.merge([],d.childNodes))},parseJSON:function(c){return a.JSON&&a.JSON.parse?a.JSON.parse(c):null===c?c:"string"==typeof c&&(c=kb.trim(c),c&&qb.test(c.replace(sb,"@").replace(tb,"]").replace(rb,"")))?Function("return "+c)():(kb.error("Invalid JSON: "+c),b)},parseXML:function(c){var d,e;if(!c||"string"!=typeof c)return null;try{a.DOMParser?(e=new DOMParser,d=e.parseFromString(c,"text/xml")):(d=new ActiveXObject("Microsoft.XMLDOM"),d.async="false",d.loadXML(c))}catch(f){d=b}return d&&d.documentElement&&!d.getElementsByTagName("parsererror").length||kb.error("Invalid XML: "+c),d},noop:function(){},globalEval:function(b){b&&kb.trim(b)&&(a.execScript||function(b){a.eval.call(a,b)})(b)},camelCase:function(a){return a.replace(ub,"ms-").replace(vb,wb)},nodeName:function(a,b){return a.nodeName&&a.nodeName.toLowerCase()===b.toLowerCase()},each:function(a,b,d){var e,f=0,g=a.length,h=c(a);if(d){if(h)for(;g>f&&(e=b.apply(a[f],d),e!==!1);f++);else for(f in a)if(e=b.apply(a[f],d),e===!1)break}else if(h)for(;g>f&&(e=b.call(a[f],f,a[f]),e!==!1);f++);else for(f in a)if(e=b.call(a[f],f,a[f]),e===!1)break;return a},trim:jb&&!jb.call("ï»¿Â ")?function(a){return null==a?"":jb.call(a)}:function(a){return null==a?"":(a+"").replace(nb,"")},makeArray:function(a,b){var d=b||[];return null!=a&&(c(Object(a))?kb.merge(d,"string"==typeof a?[a]:a):eb.call(d,a)),d},inArray:function(a,b,c){var d;if(b){if(gb)return gb.call(b,a,c);for(d=b.length,c=c?0>c?Math.max(0,d+c):c:0;d>c;c++)if(c in b&&b[c]===a)return c}return-1},merge:function(a,c){var d=c.length,e=a.length,f=0;if("number"==typeof d)for(;d>f;f++)a[e++]=c[f];else for(;c[f]!==b;)a[e++]=c[f++];return a.length=e,a},grep:function(a,b,c){var d,e=[],f=0,g=a.length;for(c=!!c;g>f;f++)d=!!b(a[f],f),c!==d&&e.push(a[f]);return e},map:function(a,b,d){var e,f=0,g=a.length,h=c(a),i=[];if(h)for(;g>f;f++)e=b(a[f],f,d),null!=e&&(i[i.length]=e);else for(f in a)e=b(a[f],f,d),null!=e&&(i[i.length]=e);return db.apply([],i)},guid:1,proxy:function(a,c){var d,e,f;return"string"==typeof c&&(f=a[c],c=a,a=f),kb.isFunction(a)?(d=fb.call(arguments,2),e=function(){return a.apply(c||this,d.concat(fb.call(arguments)))},e.guid=a.guid=a.guid||kb.guid++,e):b},access:function(a,c,d,e,f,g,h){var i=0,j=a.length,k=null==d;if("object"===kb.type(d)){f=!0;for(i in d)kb.access(a,c,i,d[i],!0,g,h)}else if(e!==b&&(f=!0,kb.isFunction(e)||(h=!0),k&&(h?(c.call(a,e),c=null):(k=c,c=function(a,b,c){return k.call(kb(a),c)})),c))for(;j>i;i++)c(a[i],d,h?e:e.call(a[i],i,c(a[i],d)));return f?a:k?c.call(a):j?c(a[0],d):g},now:function(){return(new Date).getTime()},swap:function(a,b,c,d){var e,f,g={};for(f in b)g[f]=a.style[f],a.style[f]=b[f];e=c.apply(a,d||[]);for(f in b)a.style[f]=g[f];return e}}),kb.ready.promise=function(b){if(!U)if(U=kb.Deferred(),"complete"===Y.readyState)setTimeout(kb.ready);else if(Y.addEventListener)Y.addEventListener("DOMContentLoaded",xb,!1),a.addEventListener("load",xb,!1);else{Y.attachEvent("onreadystatechange",xb),a.attachEvent("onload",xb);var c=!1;try{c=null==a.frameElement&&Y.documentElement}catch(d){}c&&c.doScroll&&function e(){if(!kb.isReady){try{c.doScroll("left")}catch(a){return setTimeout(e,50)}yb(),kb.ready()}}()}return U.promise(b)},kb.each("Boolean Number String Function Array Date RegExp Object Error".split(" "),function(a,b){ab["[object "+b+"]"]=b.toLowerCase()}),V=kb(Y),function(a,b){function c(a,b,c,d){var e,f,g,h,i,j,k,l,m,n;if((b?b.ownerDocument||b:S)!==K&&J(b),b=b||K,c=c||[],!a||"string"!=typeof a)return c;if(1!==(h=b.nodeType)&&9!==h)return[];if(M&&!d){if(e=xb.exec(a))if(g=e[1]){if(9===h){if(f=b.getElementById(g),!f||!f.parentNode)return c;if(f.id===g)return c.push(f),c}else if(b.ownerDocument&&(f=b.ownerDocument.getElementById(g))&&Q(b,f)&&f.id===g)return c.push(f),c}else{if(e[2])return eb.apply(c,b.getElementsByTagName(a)),c;if((g=e[3])&&B.getElementsByClassName&&b.getElementsByClassName)return eb.apply(c,b.getElementsByClassName(g)),c}if(B.qsa&&(!N||!N.test(a))){if(l=k=R,m=b,n=9===h&&a,1===h&&"object"!==b.nodeName.toLowerCase()){for(j=p(a),(k=b.getAttribute("id"))?l=k.replace(Ab,"\\$&"):b.setAttribute("id",l),l="[id='"+l+"'] ",i=j.length;i--;)j[i]=l+q(j[i]);m=rb.test(a)&&b.parentNode||b,n=j.join(",")}if(n)try{return eb.apply(c,m.querySelectorAll(n)),c}catch(o){}finally{k||b.removeAttribute("id")}}}return y(a.replace(ob,"$1"),b,c,d)}function d(a){return wb.test(a+"")}function e(){function a(c,d){return b.push(c+=" ")>D.cacheLength&&delete a[b.shift()],a[c]=d}var b=[];return a}function f(a){return a[R]=!0,a}function g(a){var b=K.createElement("div");try{return!!a(b)}catch(c){return!1}finally{b.parentNode&&b.parentNode.removeChild(b),b=null}}function h(a,b,c){a=a.split("|");for(var d,e=a.length,f=c?null:b;e--;)(d=D.attrHandle[a[e]])&&d!==b||(D.attrHandle[a[e]]=f)}function i(a,b){var c=a.getAttributeNode(b);return c&&c.specified?c.value:a[b]===!0?b.toLowerCase():null}function j(a,b){return a.getAttribute(b,"type"===b.toLowerCase()?1:2)}function k(a){return"input"===a.nodeName.toLowerCase()?a.defaultValue:b}function l(a,b){var c=b&&a,d=c&&1===a.nodeType&&1===b.nodeType&&(~b.sourceIndex||_)-(~a.sourceIndex||_);if(d)return d;if(c)for(;c=c.nextSibling;)if(c===b)return-1;return a?1:-1}function m(a){return function(b){var c=b.nodeName.toLowerCase();return"input"===c&&b.type===a}}function n(a){return function(b){var c=b.nodeName.toLowerCase();return("input"===c||"button"===c)&&b.type===a}}function o(a){return f(function(b){return b=+b,f(function(c,d){for(var e,f=a([],c.length,b),g=f.length;g--;)c[e=f[g]]&&(c[e]=!(d[e]=c[e]))})})}function p(a,b){var d,e,f,g,h,i,j,k=W[a+" "];if(k)return b?0:k.slice(0);for(h=a,i=[],j=D.preFilter;h;){(!d||(e=pb.exec(h)))&&(e&&(h=h.slice(e[0].length)||h),i.push(f=[])),d=!1,(e=qb.exec(h))&&(d=e.shift(),f.push({value:d,type:e[0].replace(ob," ")}),h=h.slice(d.length));for(g in D.filter)!(e=vb[g].exec(h))||j[g]&&!(e=j[g](e))||(d=e.shift(),f.push({value:d,type:g,matches:e}),h=h.slice(d.length));if(!d)break}return b?h.length:h?c.error(a):W(a,i).slice(0)}function q(a){for(var b=0,c=a.length,d="";c>b;b++)d+=a[b].value;return d}function r(a,b,c){var d=b.dir,e=c&&"parentNode"===d,f=U++;return b.first?function(b,c,f){for(;b=b[d];)if(1===b.nodeType||e)return a(b,c,f)}:function(b,c,g){var h,i,j,k=T+" "+f;if(g){for(;b=b[d];)if((1===b.nodeType||e)&&a(b,c,g))return!0}else for(;b=b[d];)if(1===b.nodeType||e)if(j=b[R]||(b[R]={}),(i=j[d])&&i[0]===k){if((h=i[1])===!0||h===C)return h===!0}else if(i=j[d]=[k],i[1]=a(b,c,g)||C,i[1]===!0)return!0}}function s(a){return a.length>1?function(b,c,d){for(var e=a.length;e--;)if(!a[e](b,c,d))return!1;return!0}:a[0]}function t(a,b,c,d,e){for(var f,g=[],h=0,i=a.length,j=null!=b;i>h;h++)(f=a[h])&&(!c||c(f,d,e))&&(g.push(f),j&&b.push(h));return g}function u(a,b,c,d,e,g){return d&&!d[R]&&(d=u(d)),e&&!e[R]&&(e=u(e,g)),f(function(f,g,h,i){var j,k,l,m=[],n=[],o=g.length,p=f||x(b||"*",h.nodeType?[h]:h,[]),q=!a||!f&&b?p:t(p,m,a,h,i),r=c?e||(f?a:o||d)?[]:g:q;if(c&&c(q,r,h,i),d)for(j=t(r,n),d(j,[],h,i),k=j.length;k--;)(l=j[k])&&(r[n[k]]=!(q[n[k]]=l));if(f){if(e||a){if(e){for(j=[],k=r.length;k--;)(l=r[k])&&j.push(q[k]=l);e(null,r=[],j,i)}for(k=r.length;k--;)(l=r[k])&&(j=e?gb.call(f,l):m[k])>-1&&(f[j]=!(g[j]=l))}}else r=t(r===g?r.splice(o,r.length):r),e?e(null,g,r,i):eb.apply(g,r)})}function v(a){for(var b,c,d,e=a.length,f=D.relative[a[0].type],g=f||D.relative[" "],h=f?1:0,i=r(function(a){return a===b},g,!0),j=r(function(a){return gb.call(b,a)>-1},g,!0),k=[function(a,c,d){return!f&&(d||c!==H)||((b=c).nodeType?i(a,c,d):j(a,c,d))}];e>h;h++)if(c=D.relative[a[h].type])k=[r(s(k),c)];else{if(c=D.filter[a[h].type].apply(null,a[h].matches),c[R]){for(d=++h;e>d&&!D.relative[a[d].type];d++);return u(h>1&&s(k),h>1&&q(a.slice(0,h-1).concat({value:" "===a[h-2].type?"*":""})).replace(ob,"$1"),c,d>h&&v(a.slice(h,d)),e>d&&v(a=a.slice(d)),e>d&&q(a))}k.push(c)}return s(k)}function w(a,b){var d=0,e=b.length>0,g=a.length>0,h=function(f,h,i,j,k){var l,m,n,o=[],p=0,q="0",r=f&&[],s=null!=k,u=H,v=f||g&&D.find.TAG("*",k&&h.parentNode||h),w=T+=null==u?1:Math.random()||.1;for(s&&(H=h!==K&&h,C=d);null!=(l=v[q]);q++){if(g&&l){for(m=0;n=a[m++];)if(n(l,h,i)){j.push(l);break}s&&(T=w,C=++d)}e&&((l=!n&&l)&&p--,f&&r.push(l))}if(p+=q,e&&q!==p){for(m=0;n=b[m++];)n(r,o,h,i);if(f){if(p>0)for(;q--;)r[q]||o[q]||(o[q]=cb.call(j));o=t(o)}eb.apply(j,o),s&&!f&&o.length>0&&p+b.length>1&&c.uniqueSort(j)}return s&&(T=w,H=u),r};return e?f(h):h}function x(a,b,d){for(var e=0,f=b.length;f>e;e++)c(a,b[e],d);return d}function y(a,b,c,d){var e,f,g,h,i,j=p(a);if(!d&&1===j.length){if(f=j[0]=j[0].slice(0),f.length>2&&"ID"===(g=f[0]).type&&B.getById&&9===b.nodeType&&M&&D.relative[f[1].type]){if(b=(D.find.ID(g.matches[0].replace(Bb,Cb),b)||[])[0],!b)return c;a=a.slice(f.shift().value.length)}for(e=vb.needsContext.test(a)?0:f.length;e--&&(g=f[e],!D.relative[h=g.type]);)if((i=D.find[h])&&(d=i(g.matches[0].replace(Bb,Cb),rb.test(f[0].type)&&b.parentNode||b))){if(f.splice(e,1),a=d.length&&q(f),!a)return eb.apply(c,d),c;break}}return G(a,j)(d,b,!M,c,rb.test(a)),c}function z(){}var A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R="sizzle"+-new Date,S=a.document,T=0,U=0,V=e(),W=e(),X=e(),Y=!1,Z=function(){return 0},$=typeof b,_=1<<31,ab={}.hasOwnProperty,bb=[],cb=bb.pop,db=bb.push,eb=bb.push,fb=bb.slice,gb=bb.indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(this[b]===a)return b;return-1},hb="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",ib="[\\x20\\t\\r\\n\\f]",jb="(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+",lb=jb.replace("w","w#"),mb="\\["+ib+"*("+jb+")"+ib+"*(?:([*^$|!~]?=)"+ib+"*(?:(['\"])((?:\\\\.|[^\\\\])*?)\\3|("+lb+")|)|)"+ib+"*\\]",nb=":("+jb+")(?:\\(((['\"])((?:\\\\.|[^\\\\])*?)\\3|((?:\\\\.|[^\\\\()[\\]]|"+mb.replace(3,8)+")*)|.*)\\)|)",ob=RegExp("^"+ib+"+|((?:^|[^\\\\])(?:\\\\.)*)"+ib+"+$","g"),pb=RegExp("^"+ib+"*,"+ib+"*"),qb=RegExp("^"+ib+"*([>+~]|"+ib+")"+ib+"*"),rb=RegExp(ib+"*[+~]"),sb=RegExp("="+ib+"*([^\\]'\"]*)"+ib+"*\\]","g"),tb=RegExp(nb),ub=RegExp("^"+lb+"$"),vb={ID:RegExp("^#("+jb+")"),CLASS:RegExp("^\\.("+jb+")"),TAG:RegExp("^("+jb.replace("w","w*")+")"),ATTR:RegExp("^"+mb),PSEUDO:RegExp("^"+nb),CHILD:RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+ib+"*(even|odd|(([+-]|)(\\d*)n|)"+ib+"*(?:([+-]|)"+ib+"*(\\d+)|))"+ib+"*\\)|)","i"),bool:RegExp("^(?:"+hb+")$","i"),needsContext:RegExp("^"+ib+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+ib+"*((?:-\\d)?\\d*)"+ib+"*\\)|)(?=[^-]|$)","i")},wb=/^[^{]+\{\s*\[native \w/,xb=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,yb=/^(?:input|select|textarea|button)$/i,zb=/^h\d$/i,Ab=/'|\\/g,Bb=RegExp("\\\\([\\da-f]{1,6}"+ib+"?|("+ib+")|.)","ig"),Cb=function(a,b,c){var d="0x"+b-65536;
return d!==d||c?b:0>d?String.fromCharCode(d+65536):String.fromCharCode(55296|d>>10,56320|1023&d)};try{eb.apply(bb=fb.call(S.childNodes),S.childNodes),bb[S.childNodes.length].nodeType}catch(Db){eb={apply:bb.length?function(a,b){db.apply(a,fb.call(b))}:function(a,b){for(var c=a.length,d=0;a[c++]=b[d++];);a.length=c-1}}}F=c.isXML=function(a){var b=a&&(a.ownerDocument||a).documentElement;return b?"HTML"!==b.nodeName:!1},B=c.support={},J=c.setDocument=function(a){var c=a?a.ownerDocument||a:S;return c!==K&&9===c.nodeType&&c.documentElement?(K=c,L=c.documentElement,M=!F(c),B.attributes=g(function(a){return a.innerHTML="<a href='#'></a>",h("type|href|height|width",j,"#"===a.firstChild.getAttribute("href")),h(hb,i,null==a.getAttribute("disabled")),a.className="i",!a.getAttribute("className")}),B.input=g(function(a){return a.innerHTML="<input>",a.firstChild.setAttribute("value",""),""===a.firstChild.getAttribute("value")}),h("value",k,B.attributes&&B.input),B.getElementsByTagName=g(function(a){return a.appendChild(c.createComment("")),!a.getElementsByTagName("*").length}),B.getElementsByClassName=g(function(a){return a.innerHTML="<div class='a'></div><div class='a i'></div>",a.firstChild.className="i",2===a.getElementsByClassName("i").length}),B.getById=g(function(a){return L.appendChild(a).id=R,!c.getElementsByName||!c.getElementsByName(R).length}),B.getById?(D.find.ID=function(a,b){if(typeof b.getElementById!==$&&M){var c=b.getElementById(a);return c&&c.parentNode?[c]:[]}},D.filter.ID=function(a){var b=a.replace(Bb,Cb);return function(a){return a.getAttribute("id")===b}}):(delete D.find.ID,D.filter.ID=function(a){var b=a.replace(Bb,Cb);return function(a){var c=typeof a.getAttributeNode!==$&&a.getAttributeNode("id");return c&&c.value===b}}),D.find.TAG=B.getElementsByTagName?function(a,c){return typeof c.getElementsByTagName!==$?c.getElementsByTagName(a):b}:function(a,b){var c,d=[],e=0,f=b.getElementsByTagName(a);if("*"===a){for(;c=f[e++];)1===c.nodeType&&d.push(c);return d}return f},D.find.CLASS=B.getElementsByClassName&&function(a,c){return typeof c.getElementsByClassName!==$&&M?c.getElementsByClassName(a):b},O=[],N=[],(B.qsa=d(c.querySelectorAll))&&(g(function(a){a.innerHTML="<select><option selected=''></option></select>",a.querySelectorAll("[selected]").length||N.push("\\["+ib+"*(?:value|"+hb+")"),a.querySelectorAll(":checked").length||N.push(":checked")}),g(function(a){var b=c.createElement("input");b.setAttribute("type","hidden"),a.appendChild(b).setAttribute("t",""),a.querySelectorAll("[t^='']").length&&N.push("[*^$]="+ib+"*(?:''|\"\")"),a.querySelectorAll(":enabled").length||N.push(":enabled",":disabled"),a.querySelectorAll("*,:x"),N.push(",.*:")})),(B.matchesSelector=d(P=L.webkitMatchesSelector||L.mozMatchesSelector||L.oMatchesSelector||L.msMatchesSelector))&&g(function(a){B.disconnectedMatch=P.call(a,"div"),P.call(a,"[s!='']:x"),O.push("!=",nb)}),N=N.length&&RegExp(N.join("|")),O=O.length&&RegExp(O.join("|")),Q=d(L.contains)||L.compareDocumentPosition?function(a,b){var c=9===a.nodeType?a.documentElement:a,d=b&&b.parentNode;return a===d||!(!d||1!==d.nodeType||!(c.contains?c.contains(d):a.compareDocumentPosition&&16&a.compareDocumentPosition(d)))}:function(a,b){if(b)for(;b=b.parentNode;)if(b===a)return!0;return!1},B.sortDetached=g(function(a){return 1&a.compareDocumentPosition(c.createElement("div"))}),Z=L.compareDocumentPosition?function(a,b){if(a===b)return Y=!0,0;var d=b.compareDocumentPosition&&a.compareDocumentPosition&&a.compareDocumentPosition(b);return d?1&d||!B.sortDetached&&b.compareDocumentPosition(a)===d?a===c||Q(S,a)?-1:b===c||Q(S,b)?1:I?gb.call(I,a)-gb.call(I,b):0:4&d?-1:1:a.compareDocumentPosition?-1:1}:function(a,b){var d,e=0,f=a.parentNode,g=b.parentNode,h=[a],i=[b];if(a===b)return Y=!0,0;if(!f||!g)return a===c?-1:b===c?1:f?-1:g?1:I?gb.call(I,a)-gb.call(I,b):0;if(f===g)return l(a,b);for(d=a;d=d.parentNode;)h.unshift(d);for(d=b;d=d.parentNode;)i.unshift(d);for(;h[e]===i[e];)e++;return e?l(h[e],i[e]):h[e]===S?-1:i[e]===S?1:0},c):K},c.matches=function(a,b){return c(a,null,null,b)},c.matchesSelector=function(a,b){if((a.ownerDocument||a)!==K&&J(a),b=b.replace(sb,"='$1']"),!(!B.matchesSelector||!M||O&&O.test(b)||N&&N.test(b)))try{var d=P.call(a,b);if(d||B.disconnectedMatch||a.document&&11!==a.document.nodeType)return d}catch(e){}return c(b,K,null,[a]).length>0},c.contains=function(a,b){return(a.ownerDocument||a)!==K&&J(a),Q(a,b)},c.attr=function(a,c){(a.ownerDocument||a)!==K&&J(a);var d=D.attrHandle[c.toLowerCase()],e=d&&ab.call(D.attrHandle,c.toLowerCase())?d(a,c,!M):b;return e===b?B.attributes||!M?a.getAttribute(c):(e=a.getAttributeNode(c))&&e.specified?e.value:null:e},c.error=function(a){throw Error("Syntax error, unrecognized expression: "+a)},c.uniqueSort=function(a){var b,c=[],d=0,e=0;if(Y=!B.detectDuplicates,I=!B.sortStable&&a.slice(0),a.sort(Z),Y){for(;b=a[e++];)b===a[e]&&(d=c.push(e));for(;d--;)a.splice(c[d],1)}return a},E=c.getText=function(a){var b,c="",d=0,e=a.nodeType;if(e){if(1===e||9===e||11===e){if("string"==typeof a.textContent)return a.textContent;for(a=a.firstChild;a;a=a.nextSibling)c+=E(a)}else if(3===e||4===e)return a.nodeValue}else for(;b=a[d];d++)c+=E(b);return c},D=c.selectors={cacheLength:50,createPseudo:f,match:vb,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(a){return a[1]=a[1].replace(Bb,Cb),a[3]=(a[4]||a[5]||"").replace(Bb,Cb),"~="===a[2]&&(a[3]=" "+a[3]+" "),a.slice(0,4)},CHILD:function(a){return a[1]=a[1].toLowerCase(),"nth"===a[1].slice(0,3)?(a[3]||c.error(a[0]),a[4]=+(a[4]?a[5]+(a[6]||1):2*("even"===a[3]||"odd"===a[3])),a[5]=+(a[7]+a[8]||"odd"===a[3])):a[3]&&c.error(a[0]),a},PSEUDO:function(a){var c,d=!a[5]&&a[2];return vb.CHILD.test(a[0])?null:(a[3]&&a[4]!==b?a[2]=a[4]:d&&tb.test(d)&&(c=p(d,!0))&&(c=d.indexOf(")",d.length-c)-d.length)&&(a[0]=a[0].slice(0,c),a[2]=d.slice(0,c)),a.slice(0,3))}},filter:{TAG:function(a){var b=a.replace(Bb,Cb).toLowerCase();return"*"===a?function(){return!0}:function(a){return a.nodeName&&a.nodeName.toLowerCase()===b}},CLASS:function(a){var b=V[a+" "];return b||(b=RegExp("(^|"+ib+")"+a+"("+ib+"|$)"))&&V(a,function(a){return b.test("string"==typeof a.className&&a.className||typeof a.getAttribute!==$&&a.getAttribute("class")||"")})},ATTR:function(a,b,d){return function(e){var f=c.attr(e,a);return null==f?"!="===b:b?(f+="","="===b?f===d:"!="===b?f!==d:"^="===b?d&&0===f.indexOf(d):"*="===b?d&&f.indexOf(d)>-1:"$="===b?d&&f.slice(-d.length)===d:"~="===b?(" "+f+" ").indexOf(d)>-1:"|="===b?f===d||f.slice(0,d.length+1)===d+"-":!1):!0}},CHILD:function(a,b,c,d,e){var f="nth"!==a.slice(0,3),g="last"!==a.slice(-4),h="of-type"===b;return 1===d&&0===e?function(a){return!!a.parentNode}:function(b,c,i){var j,k,l,m,n,o,p=f!==g?"nextSibling":"previousSibling",q=b.parentNode,r=h&&b.nodeName.toLowerCase(),s=!i&&!h;if(q){if(f){for(;p;){for(l=b;l=l[p];)if(h?l.nodeName.toLowerCase()===r:1===l.nodeType)return!1;o=p="only"===a&&!o&&"nextSibling"}return!0}if(o=[g?q.firstChild:q.lastChild],g&&s){for(k=q[R]||(q[R]={}),j=k[a]||[],n=j[0]===T&&j[1],m=j[0]===T&&j[2],l=n&&q.childNodes[n];l=++n&&l&&l[p]||(m=n=0)||o.pop();)if(1===l.nodeType&&++m&&l===b){k[a]=[T,n,m];break}}else if(s&&(j=(b[R]||(b[R]={}))[a])&&j[0]===T)m=j[1];else for(;(l=++n&&l&&l[p]||(m=n=0)||o.pop())&&((h?l.nodeName.toLowerCase()!==r:1!==l.nodeType)||!++m||(s&&((l[R]||(l[R]={}))[a]=[T,m]),l!==b)););return m-=e,m===d||0===m%d&&m/d>=0}}},PSEUDO:function(a,b){var d,e=D.pseudos[a]||D.setFilters[a.toLowerCase()]||c.error("unsupported pseudo: "+a);return e[R]?e(b):e.length>1?(d=[a,a,"",b],D.setFilters.hasOwnProperty(a.toLowerCase())?f(function(a,c){for(var d,f=e(a,b),g=f.length;g--;)d=gb.call(a,f[g]),a[d]=!(c[d]=f[g])}):function(a){return e(a,0,d)}):e}},pseudos:{not:f(function(a){var b=[],c=[],d=G(a.replace(ob,"$1"));return d[R]?f(function(a,b,c,e){for(var f,g=d(a,null,e,[]),h=a.length;h--;)(f=g[h])&&(a[h]=!(b[h]=f))}):function(a,e,f){return b[0]=a,d(b,null,f,c),!c.pop()}}),has:f(function(a){return function(b){return c(a,b).length>0}}),contains:f(function(a){return function(b){return(b.textContent||b.innerText||E(b)).indexOf(a)>-1}}),lang:f(function(a){return ub.test(a||"")||c.error("unsupported lang: "+a),a=a.replace(Bb,Cb).toLowerCase(),function(b){var c;do if(c=M?b.lang:b.getAttribute("xml:lang")||b.getAttribute("lang"))return c=c.toLowerCase(),c===a||0===c.indexOf(a+"-");while((b=b.parentNode)&&1===b.nodeType);return!1}}),target:function(b){var c=a.location&&a.location.hash;return c&&c.slice(1)===b.id},root:function(a){return a===L},focus:function(a){return a===K.activeElement&&(!K.hasFocus||K.hasFocus())&&!!(a.type||a.href||~a.tabIndex)},enabled:function(a){return a.disabled===!1},disabled:function(a){return a.disabled===!0},checked:function(a){var b=a.nodeName.toLowerCase();return"input"===b&&!!a.checked||"option"===b&&!!a.selected},selected:function(a){return a.parentNode&&a.parentNode.selectedIndex,a.selected===!0},empty:function(a){for(a=a.firstChild;a;a=a.nextSibling)if(a.nodeName>"@"||3===a.nodeType||4===a.nodeType)return!1;return!0},parent:function(a){return!D.pseudos.empty(a)},header:function(a){return zb.test(a.nodeName)},input:function(a){return yb.test(a.nodeName)},button:function(a){var b=a.nodeName.toLowerCase();return"input"===b&&"button"===a.type||"button"===b},text:function(a){var b;return"input"===a.nodeName.toLowerCase()&&"text"===a.type&&(null==(b=a.getAttribute("type"))||b.toLowerCase()===a.type)},first:o(function(){return[0]}),last:o(function(a,b){return[b-1]}),eq:o(function(a,b,c){return[0>c?c+b:c]}),even:o(function(a,b){for(var c=0;b>c;c+=2)a.push(c);return a}),odd:o(function(a,b){for(var c=1;b>c;c+=2)a.push(c);return a}),lt:o(function(a,b,c){for(var d=0>c?c+b:c;--d>=0;)a.push(d);return a}),gt:o(function(a,b,c){for(var d=0>c?c+b:c;b>++d;)a.push(d);return a})}};for(A in{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})D.pseudos[A]=m(A);for(A in{submit:!0,reset:!0})D.pseudos[A]=n(A);G=c.compile=function(a,b){var c,d=[],e=[],f=X[a+" "];if(!f){for(b||(b=p(a)),c=b.length;c--;)f=v(b[c]),f[R]?d.push(f):e.push(f);f=X(a,w(e,d))}return f},D.pseudos.nth=D.pseudos.eq,z.prototype=D.filters=D.pseudos,D.setFilters=new z,B.sortStable=R.split("").sort(Z).join("")===R,J(),[0,0].sort(Z),B.detectDuplicates=Y,kb.find=c,kb.expr=c.selectors,kb.expr[":"]=kb.expr.pseudos,kb.unique=c.uniqueSort,kb.text=c.getText,kb.isXMLDoc=c.isXML,kb.contains=c.contains}(a);var zb={};kb.Callbacks=function(a){a="string"==typeof a?zb[a]||d(a):kb.extend({},a);var c,e,f,g,h,i,j=[],k=!a.once&&[],l=function(b){for(e=a.memory&&b,f=!0,h=i||0,i=0,g=j.length,c=!0;j&&g>h;h++)if(j[h].apply(b[0],b[1])===!1&&a.stopOnFalse){e=!1;break}c=!1,j&&(k?k.length&&l(k.shift()):e?j=[]:m.disable())},m={add:function(){if(j){var b=j.length;!function d(b){kb.each(b,function(b,c){var e=kb.type(c);"function"===e?a.unique&&m.has(c)||j.push(c):c&&c.length&&"string"!==e&&d(c)})}(arguments),c?g=j.length:e&&(i=b,l(e))}return this},remove:function(){return j&&kb.each(arguments,function(a,b){for(var d;(d=kb.inArray(b,j,d))>-1;)j.splice(d,1),c&&(g>=d&&g--,h>=d&&h--)}),this},has:function(a){return a?kb.inArray(a,j)>-1:!(!j||!j.length)},empty:function(){return j=[],g=0,this},disable:function(){return j=k=e=b,this},disabled:function(){return!j},lock:function(){return k=b,e||m.disable(),this},locked:function(){return!k},fireWith:function(a,b){return b=b||[],b=[a,b.slice?b.slice():b],!j||f&&!k||(c?k.push(b):l(b)),this},fire:function(){return m.fireWith(this,arguments),this},fired:function(){return!!f}};return m},kb.extend({Deferred:function(a){var b=[["resolve","done",kb.Callbacks("once memory"),"resolved"],["reject","fail",kb.Callbacks("once memory"),"rejected"],["notify","progress",kb.Callbacks("memory")]],c="pending",d={state:function(){return c},always:function(){return e.done(arguments).fail(arguments),this},then:function(){var a=arguments;return kb.Deferred(function(c){kb.each(b,function(b,f){var g=f[0],h=kb.isFunction(a[b])&&a[b];e[f[1]](function(){var a=h&&h.apply(this,arguments);a&&kb.isFunction(a.promise)?a.promise().done(c.resolve).fail(c.reject).progress(c.notify):c[g+"With"](this===d?c.promise():this,h?[a]:arguments)})}),a=null}).promise()},promise:function(a){return null!=a?kb.extend(a,d):d}},e={};return d.pipe=d.then,kb.each(b,function(a,f){var g=f[2],h=f[3];d[f[1]]=g.add,h&&g.add(function(){c=h},b[1^a][2].disable,b[2][2].lock),e[f[0]]=function(){return e[f[0]+"With"](this===e?d:this,arguments),this},e[f[0]+"With"]=g.fireWith}),d.promise(e),a&&a.call(e,e),e},when:function(a){var b,c,d,e=0,f=fb.call(arguments),g=f.length,h=1!==g||a&&kb.isFunction(a.promise)?g:0,i=1===h?a:kb.Deferred(),j=function(a,c,d){return function(e){c[a]=this,d[a]=arguments.length>1?fb.call(arguments):e,d===b?i.notifyWith(c,d):--h||i.resolveWith(c,d)}};if(g>1)for(b=Array(g),c=Array(g),d=Array(g);g>e;e++)f[e]&&kb.isFunction(f[e].promise)?f[e].promise().done(j(e,d,f)).fail(i.reject).progress(j(e,c,b)):--h;return h||i.resolveWith(d,f),i.promise()}}),kb.support=function(b){var c,d,e,f,g,h,i,j,k,l=Y.createElement("div");if(l.setAttribute("className","t"),l.innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>",c=l.getElementsByTagName("*")||[],d=l.getElementsByTagName("a")[0],!d||!d.style||!c.length)return b;f=Y.createElement("select"),h=f.appendChild(Y.createElement("option")),e=l.getElementsByTagName("input")[0],d.style.cssText="top:1px;float:left;opacity:.5",b.getSetAttribute="t"!==l.className,b.leadingWhitespace=3===l.firstChild.nodeType,b.tbody=!l.getElementsByTagName("tbody").length,b.htmlSerialize=!!l.getElementsByTagName("link").length,b.style=/top/.test(d.getAttribute("style")),b.hrefNormalized="/a"===d.getAttribute("href"),b.opacity=/^0.5/.test(d.style.opacity),b.cssFloat=!!d.style.cssFloat,b.checkOn=!!e.value,b.optSelected=h.selected,b.enctype=!!Y.createElement("form").enctype,b.html5Clone="<:nav></:nav>"!==Y.createElement("nav").cloneNode(!0).outerHTML,b.inlineBlockNeedsLayout=!1,b.shrinkWrapBlocks=!1,b.pixelPosition=!1,b.deleteExpando=!0,b.noCloneEvent=!0,b.reliableMarginRight=!0,b.boxSizingReliable=!0,e.checked=!0,b.noCloneChecked=e.cloneNode(!0).checked,f.disabled=!0,b.optDisabled=!h.disabled;try{delete l.test}catch(m){b.deleteExpando=!1}e=Y.createElement("input"),e.setAttribute("value",""),b.input=""===e.getAttribute("value"),e.value="t",e.setAttribute("type","radio"),b.radioValue="t"===e.value,e.setAttribute("checked","t"),e.setAttribute("name","t"),g=Y.createDocumentFragment(),g.appendChild(e),b.appendChecked=e.checked,b.checkClone=g.cloneNode(!0).cloneNode(!0).lastChild.checked,l.attachEvent&&(l.attachEvent("onclick",function(){b.noCloneEvent=!1}),l.cloneNode(!0).click());for(k in{submit:!0,change:!0,focusin:!0})l.setAttribute(i="on"+k,"t"),b[k+"Bubbles"]=i in a||l.attributes[i].expando===!1;l.style.backgroundClip="content-box",l.cloneNode(!0).style.backgroundClip="",b.clearCloneStyle="content-box"===l.style.backgroundClip;for(k in kb(b))break;return b.ownLast="0"!==k,kb(function(){var c,d,e,f="padding:0;margin:0;border:0;display:block;box-sizing:content-box;-moz-box-sizing:content-box;-webkit-box-sizing:content-box;",g=Y.getElementsByTagName("body")[0];g&&(c=Y.createElement("div"),c.style.cssText="border:0;width:0;height:0;position:absolute;top:0;left:-9999px;margin-top:1px",g.appendChild(c).appendChild(l),l.innerHTML="<table><tr><td></td><td>t</td></tr></table>",e=l.getElementsByTagName("td"),e[0].style.cssText="padding:0;margin:0;border:0;display:none",j=0===e[0].offsetHeight,e[0].style.display="",e[1].style.display="none",b.reliableHiddenOffsets=j&&0===e[0].offsetHeight,l.innerHTML="",l.style.cssText="box-sizing:border-box;-moz-box-sizing:border-box;-webkit-box-sizing:border-box;padding:1px;border:1px;display:block;width:4px;margin-top:1%;position:absolute;top:1%;",kb.swap(g,null!=g.style.zoom?{zoom:1}:{},function(){b.boxSizing=4===l.offsetWidth}),a.getComputedStyle&&(b.pixelPosition="1%"!==(a.getComputedStyle(l,null)||{}).top,b.boxSizingReliable="4px"===(a.getComputedStyle(l,null)||{width:"4px"}).width,d=l.appendChild(Y.createElement("div")),d.style.cssText=l.style.cssText=f,d.style.marginRight=d.style.width="0",l.style.width="1px",b.reliableMarginRight=!parseFloat((a.getComputedStyle(d,null)||{}).marginRight)),typeof l.style.zoom!==W&&(l.innerHTML="",l.style.cssText=f+"width:1px;padding:1px;display:inline;zoom:1",b.inlineBlockNeedsLayout=3===l.offsetWidth,l.style.display="block",l.innerHTML="<div></div>",l.firstChild.style.width="5px",b.shrinkWrapBlocks=3!==l.offsetWidth,b.inlineBlockNeedsLayout&&(g.style.zoom=1)),g.removeChild(c),c=l=e=d=null)}),c=f=g=h=d=e=null,b}({});var Ab=/(?:\{[\s\S]*\}|\[[\s\S]*\])$/,Bb=/([A-Z])/g;kb.extend({cache:{},noData:{applet:!0,embed:!0,object:"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"},hasData:function(a){return a=a.nodeType?kb.cache[a[kb.expando]]:a[kb.expando],!!a&&!h(a)},data:function(a,b,c){return e(a,b,c)},removeData:function(a,b){return f(a,b)},_data:function(a,b,c){return e(a,b,c,!0)},_removeData:function(a,b){return f(a,b,!0)},acceptData:function(a){if(a.nodeType&&1!==a.nodeType&&9!==a.nodeType)return!1;var b=a.nodeName&&kb.noData[a.nodeName.toLowerCase()];return!b||b!==!0&&a.getAttribute("classid")===b}}),kb.fn.extend({data:function(a,c){var d,e,f=null,h=0,i=this[0];if(a===b){if(this.length&&(f=kb.data(i),1===i.nodeType&&!kb._data(i,"parsedAttrs"))){for(d=i.attributes;d.length>h;h++)e=d[h].name,0===e.indexOf("data-")&&(e=kb.camelCase(e.slice(5)),g(i,e,f[e]));kb._data(i,"parsedAttrs",!0)}return f}return"object"==typeof a?this.each(function(){kb.data(this,a)}):arguments.length>1?this.each(function(){kb.data(this,a,c)}):i?g(i,a,kb.data(i,a)):null},removeData:function(a){return this.each(function(){kb.removeData(this,a)})}}),kb.extend({queue:function(a,c,d){var e;return a?(c=(c||"fx")+"queue",e=kb._data(a,c),d&&(!e||kb.isArray(d)?e=kb._data(a,c,kb.makeArray(d)):e.push(d)),e||[]):b},dequeue:function(a,b){b=b||"fx";var c=kb.queue(a,b),d=c.length,e=c.shift(),f=kb._queueHooks(a,b),g=function(){kb.dequeue(a,b)};"inprogress"===e&&(e=c.shift(),d--),f.cur=e,e&&("fx"===b&&c.unshift("inprogress"),delete f.stop,e.call(a,g,f)),!d&&f&&f.empty.fire()},_queueHooks:function(a,b){var c=b+"queueHooks";return kb._data(a,c)||kb._data(a,c,{empty:kb.Callbacks("once memory").add(function(){kb._removeData(a,b+"queue"),kb._removeData(a,c)})})}}),kb.fn.extend({queue:function(a,c){var d=2;return"string"!=typeof a&&(c=a,a="fx",d--),d>arguments.length?kb.queue(this[0],a):c===b?this:this.each(function(){var b=kb.queue(this,a,c);kb._queueHooks(this,a),"fx"===a&&"inprogress"!==b[0]&&kb.dequeue(this,a)})},dequeue:function(a){return this.each(function(){kb.dequeue(this,a)})},delay:function(a,b){return a=kb.fx?kb.fx.speeds[a]||a:a,b=b||"fx",this.queue(b,function(b,c){var d=setTimeout(b,a);c.stop=function(){clearTimeout(d)}})},clearQueue:function(a){return this.queue(a||"fx",[])},promise:function(a,c){var d,e=1,f=kb.Deferred(),g=this,h=this.length,i=function(){--e||f.resolveWith(g,[g])};for("string"!=typeof a&&(c=a,a=b),a=a||"fx";h--;)d=kb._data(g[h],a+"queueHooks"),d&&d.empty&&(e++,d.empty.add(i));return i(),f.promise(c)}});var Cb,Db,Eb=/[\t\r\n\f]/g,Fb=/\r/g,Gb=/^(?:input|select|textarea|button|object)$/i,Hb=/^(?:a|area)$/i,Ib=/^(?:checked|selected)$/i,Jb=kb.support.getSetAttribute,Kb=kb.support.input;kb.fn.extend({attr:function(a,b){return kb.access(this,kb.attr,a,b,arguments.length>1)},removeAttr:function(a){return this.each(function(){kb.removeAttr(this,a)})},prop:function(a,b){return kb.access(this,kb.prop,a,b,arguments.length>1)},removeProp:function(a){return a=kb.propFix[a]||a,this.each(function(){try{this[a]=b,delete this[a]}catch(c){}})},addClass:function(a){var b,c,d,e,f,g=0,h=this.length,i="string"==typeof a&&a;if(kb.isFunction(a))return this.each(function(b){kb(this).addClass(a.call(this,b,this.className))});if(i)for(b=(a||"").match(mb)||[];h>g;g++)if(c=this[g],d=1===c.nodeType&&(c.className?(" "+c.className+" ").replace(Eb," "):" ")){for(f=0;e=b[f++];)0>d.indexOf(" "+e+" ")&&(d+=e+" ");c.className=kb.trim(d)}return this},removeClass:function(a){var b,c,d,e,f,g=0,h=this.length,i=0===arguments.length||"string"==typeof a&&a;if(kb.isFunction(a))return this.each(function(b){kb(this).removeClass(a.call(this,b,this.className))});if(i)for(b=(a||"").match(mb)||[];h>g;g++)if(c=this[g],d=1===c.nodeType&&(c.className?(" "+c.className+" ").replace(Eb," "):"")){for(f=0;e=b[f++];)for(;d.indexOf(" "+e+" ")>=0;)d=d.replace(" "+e+" "," ");c.className=a?kb.trim(d):""}return this},toggleClass:function(a,b){var c=typeof a,d="boolean"==typeof b;return this.each(kb.isFunction(a)?function(c){kb(this).toggleClass(a.call(this,c,this.className,b),b)}:function(){if("string"===c)for(var e,f=0,g=kb(this),h=b,i=a.match(mb)||[];e=i[f++];)h=d?h:!g.hasClass(e),g[h?"addClass":"removeClass"](e);else(c===W||"boolean"===c)&&(this.className&&kb._data(this,"__className__",this.className),this.className=this.className||a===!1?"":kb._data(this,"__className__")||"")})},hasClass:function(a){for(var b=" "+a+" ",c=0,d=this.length;d>c;c++)if(1===this[c].nodeType&&(" "+this[c].className+" ").replace(Eb," ").indexOf(b)>=0)return!0;return!1},val:function(a){var c,d,e,f=this[0];return arguments.length?(e=kb.isFunction(a),this.each(function(c){var f;1===this.nodeType&&(f=e?a.call(this,c,kb(this).val()):a,null==f?f="":"number"==typeof f?f+="":kb.isArray(f)&&(f=kb.map(f,function(a){return null==a?"":a+""})),d=kb.valHooks[this.type]||kb.valHooks[this.nodeName.toLowerCase()],d&&"set"in d&&d.set(this,f,"value")!==b||(this.value=f))})):f?(d=kb.valHooks[f.type]||kb.valHooks[f.nodeName.toLowerCase()],d&&"get"in d&&(c=d.get(f,"value"))!==b?c:(c=f.value,"string"==typeof c?c.replace(Fb,""):null==c?"":c)):void 0}}),kb.extend({valHooks:{option:{get:function(a){var b=kb.find.attr(a,"value");return null!=b?b:a.text}},select:{get:function(a){for(var b,c,d=a.options,e=a.selectedIndex,f="select-one"===a.type||0>e,g=f?null:[],h=f?e+1:d.length,i=0>e?h:f?e:0;h>i;i++)if(c=d[i],!(!c.selected&&i!==e||(kb.support.optDisabled?c.disabled:null!==c.getAttribute("disabled"))||c.parentNode.disabled&&kb.nodeName(c.parentNode,"optgroup"))){if(b=kb(c).val(),f)return b;g.push(b)}return g},set:function(a,b){for(var c,d,e=a.options,f=kb.makeArray(b),g=e.length;g--;)d=e[g],(d.selected=kb.inArray(kb(d).val(),f)>=0)&&(c=!0);return c||(a.selectedIndex=-1),f}}},attr:function(a,c,d){var e,f,g=a.nodeType;return a&&3!==g&&8!==g&&2!==g?typeof a.getAttribute===W?kb.prop(a,c,d):(1===g&&kb.isXMLDoc(a)||(c=c.toLowerCase(),e=kb.attrHooks[c]||(kb.expr.match.bool.test(c)?Db:Cb)),d===b?e&&"get"in e&&null!==(f=e.get(a,c))?f:(f=kb.find.attr(a,c),null==f?b:f):null!==d?e&&"set"in e&&(f=e.set(a,d,c))!==b?f:(a.setAttribute(c,d+""),d):(kb.removeAttr(a,c),b)):void 0},removeAttr:function(a,b){var c,d,e=0,f=b&&b.match(mb);if(f&&1===a.nodeType)for(;c=f[e++];)d=kb.propFix[c]||c,kb.expr.match.bool.test(c)?Kb&&Jb||!Ib.test(c)?a[d]=!1:a[kb.camelCase("default-"+c)]=a[d]=!1:kb.attr(a,c,""),a.removeAttribute(Jb?c:d)},attrHooks:{type:{set:function(a,b){if(!kb.support.radioValue&&"radio"===b&&kb.nodeName(a,"input")){var c=a.value;return a.setAttribute("type",b),c&&(a.value=c),b}}}},propFix:{"for":"htmlFor","class":"className"},prop:function(a,c,d){var e,f,g,h=a.nodeType;return a&&3!==h&&8!==h&&2!==h?(g=1!==h||!kb.isXMLDoc(a),g&&(c=kb.propFix[c]||c,f=kb.propHooks[c]),d!==b?f&&"set"in f&&(e=f.set(a,d,c))!==b?e:a[c]=d:f&&"get"in f&&null!==(e=f.get(a,c))?e:a[c]):void 0},propHooks:{tabIndex:{get:function(a){var b=kb.find.attr(a,"tabindex");return b?parseInt(b,10):Gb.test(a.nodeName)||Hb.test(a.nodeName)&&a.href?0:-1}}}}),Db={set:function(a,b,c){return b===!1?kb.removeAttr(a,c):Kb&&Jb||!Ib.test(c)?a.setAttribute(!Jb&&kb.propFix[c]||c,c):a[kb.camelCase("default-"+c)]=a[c]=!0,c}},kb.each(kb.expr.match.bool.source.match(/\w+/g),function(a,c){var d=kb.expr.attrHandle[c]||kb.find.attr;kb.expr.attrHandle[c]=Kb&&Jb||!Ib.test(c)?function(a,c,e){var f=kb.expr.attrHandle[c],g=e?b:(kb.expr.attrHandle[c]=b)!=d(a,c,e)?c.toLowerCase():null;return kb.expr.attrHandle[c]=f,g}:function(a,c,d){return d?b:a[kb.camelCase("default-"+c)]?c.toLowerCase():null}}),Kb&&Jb||(kb.attrHooks.value={set:function(a,c,d){return kb.nodeName(a,"input")?(a.defaultValue=c,b):Cb&&Cb.set(a,c,d)}}),Jb||(Cb={set:function(a,c,d){var e=a.getAttributeNode(d);return e||a.setAttributeNode(e=a.ownerDocument.createAttribute(d)),e.value=c+="","value"===d||c===a.getAttribute(d)?c:b}},kb.expr.attrHandle.id=kb.expr.attrHandle.name=kb.expr.attrHandle.coords=function(a,c,d){var e;return d?b:(e=a.getAttributeNode(c))&&""!==e.value?e.value:null},kb.valHooks.button={get:function(a,c){var d=a.getAttributeNode(c);return d&&d.specified?d.value:b},set:Cb.set},kb.attrHooks.contenteditable={set:function(a,b,c){Cb.set(a,""===b?!1:b,c)}},kb.each(["width","height"],function(a,c){kb.attrHooks[c]={set:function(a,d){return""===d?(a.setAttribute(c,"auto"),d):b}}})),kb.support.hrefNormalized||kb.each(["href","src"],function(a,b){kb.propHooks[b]={get:function(a){return a.getAttribute(b,4)}}}),kb.support.style||(kb.attrHooks.style={get:function(a){return a.style.cssText||b},set:function(a,b){return a.style.cssText=b+""}}),kb.support.optSelected||(kb.propHooks.selected={get:function(a){var b=a.parentNode;return b&&(b.selectedIndex,b.parentNode&&b.parentNode.selectedIndex),null}}),kb.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){kb.propFix[this.toLowerCase()]=this}),kb.support.enctype||(kb.propFix.enctype="encoding"),kb.each(["radio","checkbox"],function(){kb.valHooks[this]={set:function(a,c){return kb.isArray(c)?a.checked=kb.inArray(kb(a).val(),c)>=0:b}},kb.support.checkOn||(kb.valHooks[this].get=function(a){return null===a.getAttribute("value")?"on":a.value})});var Lb=/^(?:input|select|textarea)$/i,Mb=/^key/,Nb=/^(?:mouse|contextmenu)|click/,Ob=/^(?:focusinfocus|focusoutblur)$/,Pb=/^([^.]*)(?:\.(.+)|)$/;kb.event={global:{},add:function(a,c,d,e,f){var g,h,i,j,k,l,m,n,o,p,q,r=kb._data(a);if(r){for(d.handler&&(j=d,d=j.handler,f=j.selector),d.guid||(d.guid=kb.guid++),(h=r.events)||(h=r.events={}),(l=r.handle)||(l=r.handle=function(a){return typeof kb===W||a&&kb.event.triggered===a.type?b:kb.event.dispatch.apply(l.elem,arguments)},l.elem=a),c=(c||"").match(mb)||[""],i=c.length;i--;)g=Pb.exec(c[i])||[],o=q=g[1],p=(g[2]||"").split(".").sort(),o&&(k=kb.event.special[o]||{},o=(f?k.delegateType:k.bindType)||o,k=kb.event.special[o]||{},m=kb.extend({type:o,origType:q,data:e,handler:d,guid:d.guid,selector:f,needsContext:f&&kb.expr.match.needsContext.test(f),namespace:p.join(".")},j),(n=h[o])||(n=h[o]=[],n.delegateCount=0,k.setup&&k.setup.call(a,e,p,l)!==!1||(a.addEventListener?a.addEventListener(o,l,!1):a.attachEvent&&a.attachEvent("on"+o,l))),k.add&&(k.add.call(a,m),m.handler.guid||(m.handler.guid=d.guid)),f?n.splice(n.delegateCount++,0,m):n.push(m),kb.event.global[o]=!0);a=null}},remove:function(a,b,c,d,e){var f,g,h,i,j,k,l,m,n,o,p,q=kb.hasData(a)&&kb._data(a);if(q&&(k=q.events)){for(b=(b||"").match(mb)||[""],j=b.length;j--;)if(h=Pb.exec(b[j])||[],n=p=h[1],o=(h[2]||"").split(".").sort(),n){for(l=kb.event.special[n]||{},n=(d?l.delegateType:l.bindType)||n,m=k[n]||[],h=h[2]&&RegExp("(^|\\.)"+o.join("\\.(?:.*\\.|)")+"(\\.|$)"),i=f=m.length;f--;)g=m[f],!e&&p!==g.origType||c&&c.guid!==g.guid||h&&!h.test(g.namespace)||d&&d!==g.selector&&("**"!==d||!g.selector)||(m.splice(f,1),g.selector&&m.delegateCount--,l.remove&&l.remove.call(a,g));i&&!m.length&&(l.teardown&&l.teardown.call(a,o,q.handle)!==!1||kb.removeEvent(a,n,q.handle),delete k[n])}else for(n in k)kb.event.remove(a,n+b[j],c,d,!0);kb.isEmptyObject(k)&&(delete q.handle,kb._removeData(a,"events"))}},trigger:function(c,d,e,f){var g,h,i,j,k,l,m,n=[e||Y],o=ib.call(c,"type")?c.type:c,p=ib.call(c,"namespace")?c.namespace.split("."):[];if(i=l=e=e||Y,3!==e.nodeType&&8!==e.nodeType&&!Ob.test(o+kb.event.triggered)&&(o.indexOf(".")>=0&&(p=o.split("."),o=p.shift(),p.sort()),h=0>o.indexOf(":")&&"on"+o,c=c[kb.expando]?c:new kb.Event(o,"object"==typeof c&&c),c.isTrigger=f?2:3,c.namespace=p.join("."),c.namespace_re=c.namespace?RegExp("(^|\\.)"+p.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,c.result=b,c.target||(c.target=e),d=null==d?[c]:kb.makeArray(d,[c]),k=kb.event.special[o]||{},f||!k.trigger||k.trigger.apply(e,d)!==!1)){if(!f&&!k.noBubble&&!kb.isWindow(e)){for(j=k.delegateType||o,Ob.test(j+o)||(i=i.parentNode);i;i=i.parentNode)n.push(i),l=i;l===(e.ownerDocument||Y)&&n.push(l.defaultView||l.parentWindow||a)}for(m=0;(i=n[m++])&&!c.isPropagationStopped();)c.type=m>1?j:k.bindType||o,g=(kb._data(i,"events")||{})[c.type]&&kb._data(i,"handle"),g&&g.apply(i,d),g=h&&i[h],g&&kb.acceptData(i)&&g.apply&&g.apply(i,d)===!1&&c.preventDefault();if(c.type=o,!f&&!c.isDefaultPrevented()&&(!k._default||k._default.apply(n.pop(),d)===!1)&&kb.acceptData(e)&&h&&e[o]&&!kb.isWindow(e)){l=e[h],l&&(e[h]=null),kb.event.triggered=o;try{e[o]()}catch(q){}kb.event.triggered=b,l&&(e[h]=l)}return c.result}},dispatch:function(a){a=kb.event.fix(a);var c,d,e,f,g,h=[],i=fb.call(arguments),j=(kb._data(this,"events")||{})[a.type]||[],k=kb.event.special[a.type]||{};if(i[0]=a,a.delegateTarget=this,!k.preDispatch||k.preDispatch.call(this,a)!==!1){for(h=kb.event.handlers.call(this,a,j),c=0;(f=h[c++])&&!a.isPropagationStopped();)for(a.currentTarget=f.elem,g=0;(e=f.handlers[g++])&&!a.isImmediatePropagationStopped();)(!a.namespace_re||a.namespace_re.test(e.namespace))&&(a.handleObj=e,a.data=e.data,d=((kb.event.special[e.origType]||{}).handle||e.handler).apply(f.elem,i),d!==b&&(a.result=d)===!1&&(a.preventDefault(),a.stopPropagation()));return k.postDispatch&&k.postDispatch.call(this,a),a.result}},handlers:function(a,c){var d,e,f,g,h=[],i=c.delegateCount,j=a.target;if(i&&j.nodeType&&(!a.button||"click"!==a.type))for(;j!=this;j=j.parentNode||this)if(1===j.nodeType&&(j.disabled!==!0||"click"!==a.type)){for(f=[],g=0;i>g;g++)e=c[g],d=e.selector+" ",f[d]===b&&(f[d]=e.needsContext?kb(d,this).index(j)>=0:kb.find(d,this,null,[j]).length),f[d]&&f.push(e);f.length&&h.push({elem:j,handlers:f})}return c.length>i&&h.push({elem:this,handlers:c.slice(i)}),h},fix:function(a){if(a[kb.expando])return a;var b,c,d,e=a.type,f=a,g=this.fixHooks[e];for(g||(this.fixHooks[e]=g=Nb.test(e)?this.mouseHooks:Mb.test(e)?this.keyHooks:{}),d=g.props?this.props.concat(g.props):this.props,a=new kb.Event(f),b=d.length;b--;)c=d[b],a[c]=f[c];return a.target||(a.target=f.srcElement||Y),3===a.target.nodeType&&(a.target=a.target.parentNode),a.metaKey=!!a.metaKey,g.filter?g.filter(a,f):a},props:"altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(a,b){return null==a.which&&(a.which=null!=b.charCode?b.charCode:b.keyCode),a}},mouseHooks:{props:"button buttons clientX clientY fromElement offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(a,c){var d,e,f,g=c.button,h=c.fromElement;return null==a.pageX&&null!=c.clientX&&(e=a.target.ownerDocument||Y,f=e.documentElement,d=e.body,a.pageX=c.clientX+(f&&f.scrollLeft||d&&d.scrollLeft||0)-(f&&f.clientLeft||d&&d.clientLeft||0),a.pageY=c.clientY+(f&&f.scrollTop||d&&d.scrollTop||0)-(f&&f.clientTop||d&&d.clientTop||0)),!a.relatedTarget&&h&&(a.relatedTarget=h===a.target?c.toElement:h),a.which||g===b||(a.which=1&g?1:2&g?3:4&g?2:0),a}},special:{load:{noBubble:!0},focus:{trigger:function(){if(this!==k()&&this.focus)try{return this.focus(),!1}catch(a){}},delegateType:"focusin"},blur:{trigger:function(){return this===k()&&this.blur?(this.blur(),!1):b},delegateType:"focusout"},click:{trigger:function(){return kb.nodeName(this,"input")&&"checkbox"===this.type&&this.click?(this.click(),!1):b},_default:function(a){return kb.nodeName(a.target,"a")}},beforeunload:{postDispatch:function(a){a.result!==b&&(a.originalEvent.returnValue=a.result)
}}},simulate:function(a,b,c,d){var e=kb.extend(new kb.Event,c,{type:a,isSimulated:!0,originalEvent:{}});d?kb.event.trigger(e,null,b):kb.event.dispatch.call(b,e),e.isDefaultPrevented()&&c.preventDefault()}},kb.removeEvent=Y.removeEventListener?function(a,b,c){a.removeEventListener&&a.removeEventListener(b,c,!1)}:function(a,b,c){var d="on"+b;a.detachEvent&&(typeof a[d]===W&&(a[d]=null),a.detachEvent(d,c))},kb.Event=function(a,c){return this instanceof kb.Event?(a&&a.type?(this.originalEvent=a,this.type=a.type,this.isDefaultPrevented=a.defaultPrevented||a.returnValue===!1||a.getPreventDefault&&a.getPreventDefault()?i:j):this.type=a,c&&kb.extend(this,c),this.timeStamp=a&&a.timeStamp||kb.now(),this[kb.expando]=!0,b):new kb.Event(a,c)},kb.Event.prototype={isDefaultPrevented:j,isPropagationStopped:j,isImmediatePropagationStopped:j,preventDefault:function(){var a=this.originalEvent;this.isDefaultPrevented=i,a&&(a.preventDefault?a.preventDefault():a.returnValue=!1)},stopPropagation:function(){var a=this.originalEvent;this.isPropagationStopped=i,a&&(a.stopPropagation&&a.stopPropagation(),a.cancelBubble=!0)},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=i,this.stopPropagation()}},kb.each({mouseenter:"mouseover",mouseleave:"mouseout"},function(a,b){kb.event.special[a]={delegateType:b,bindType:b,handle:function(a){var c,d=this,e=a.relatedTarget,f=a.handleObj;return(!e||e!==d&&!kb.contains(d,e))&&(a.type=f.origType,c=f.handler.apply(this,arguments),a.type=b),c}}}),kb.support.submitBubbles||(kb.event.special.submit={setup:function(){return kb.nodeName(this,"form")?!1:(kb.event.add(this,"click._submit keypress._submit",function(a){var c=a.target,d=kb.nodeName(c,"input")||kb.nodeName(c,"button")?c.form:b;d&&!kb._data(d,"submitBubbles")&&(kb.event.add(d,"submit._submit",function(a){a._submit_bubble=!0}),kb._data(d,"submitBubbles",!0))}),b)},postDispatch:function(a){a._submit_bubble&&(delete a._submit_bubble,this.parentNode&&!a.isTrigger&&kb.event.simulate("submit",this.parentNode,a,!0))},teardown:function(){return kb.nodeName(this,"form")?!1:(kb.event.remove(this,"._submit"),b)}}),kb.support.changeBubbles||(kb.event.special.change={setup:function(){return Lb.test(this.nodeName)?(("checkbox"===this.type||"radio"===this.type)&&(kb.event.add(this,"propertychange._change",function(a){"checked"===a.originalEvent.propertyName&&(this._just_changed=!0)}),kb.event.add(this,"click._change",function(a){this._just_changed&&!a.isTrigger&&(this._just_changed=!1),kb.event.simulate("change",this,a,!0)})),!1):(kb.event.add(this,"beforeactivate._change",function(a){var b=a.target;Lb.test(b.nodeName)&&!kb._data(b,"changeBubbles")&&(kb.event.add(b,"change._change",function(a){!this.parentNode||a.isSimulated||a.isTrigger||kb.event.simulate("change",this.parentNode,a,!0)}),kb._data(b,"changeBubbles",!0))}),b)},handle:function(a){var c=a.target;return this!==c||a.isSimulated||a.isTrigger||"radio"!==c.type&&"checkbox"!==c.type?a.handleObj.handler.apply(this,arguments):b},teardown:function(){return kb.event.remove(this,"._change"),!Lb.test(this.nodeName)}}),kb.support.focusinBubbles||kb.each({focus:"focusin",blur:"focusout"},function(a,b){var c=0,d=function(a){kb.event.simulate(b,a.target,kb.event.fix(a),!0)};kb.event.special[b]={setup:function(){0===c++&&Y.addEventListener(a,d,!0)},teardown:function(){0===--c&&Y.removeEventListener(a,d,!0)}}}),kb.fn.extend({on:function(a,c,d,e,f){var g,h;if("object"==typeof a){"string"!=typeof c&&(d=d||c,c=b);for(g in a)this.on(g,c,d,a[g],f);return this}if(null==d&&null==e?(e=c,d=c=b):null==e&&("string"==typeof c?(e=d,d=b):(e=d,d=c,c=b)),e===!1)e=j;else if(!e)return this;return 1===f&&(h=e,e=function(a){return kb().off(a),h.apply(this,arguments)},e.guid=h.guid||(h.guid=kb.guid++)),this.each(function(){kb.event.add(this,a,e,d,c)})},one:function(a,b,c,d){return this.on(a,b,c,d,1)},off:function(a,c,d){var e,f;if(a&&a.preventDefault&&a.handleObj)return e=a.handleObj,kb(a.delegateTarget).off(e.namespace?e.origType+"."+e.namespace:e.origType,e.selector,e.handler),this;if("object"==typeof a){for(f in a)this.off(f,c,a[f]);return this}return(c===!1||"function"==typeof c)&&(d=c,c=b),d===!1&&(d=j),this.each(function(){kb.event.remove(this,a,d,c)})},trigger:function(a,b){return this.each(function(){kb.event.trigger(a,b,this)})},triggerHandler:function(a,c){var d=this[0];return d?kb.event.trigger(a,c,d,!0):b}});var Qb=/^.[^:#\[\.,]*$/,Rb=/^(?:parents|prev(?:Until|All))/,Sb=kb.expr.match.needsContext,Tb={children:!0,contents:!0,next:!0,prev:!0};kb.fn.extend({find:function(a){var b,c=[],d=this,e=d.length;if("string"!=typeof a)return this.pushStack(kb(a).filter(function(){for(b=0;e>b;b++)if(kb.contains(d[b],this))return!0}));for(b=0;e>b;b++)kb.find(a,d[b],c);return c=this.pushStack(e>1?kb.unique(c):c),c.selector=this.selector?this.selector+" "+a:a,c},has:function(a){var b,c=kb(a,this),d=c.length;return this.filter(function(){for(b=0;d>b;b++)if(kb.contains(this,c[b]))return!0})},not:function(a){return this.pushStack(m(this,a||[],!0))},filter:function(a){return this.pushStack(m(this,a||[],!1))},is:function(a){return!!m(this,"string"==typeof a&&Sb.test(a)?kb(a):a||[],!1).length},closest:function(a,b){for(var c,d=0,e=this.length,f=[],g=Sb.test(a)||"string"!=typeof a?kb(a,b||this.context):0;e>d;d++)for(c=this[d];c&&c!==b;c=c.parentNode)if(11>c.nodeType&&(g?g.index(c)>-1:1===c.nodeType&&kb.find.matchesSelector(c,a))){c=f.push(c);break}return this.pushStack(f.length>1?kb.unique(f):f)},index:function(a){return a?"string"==typeof a?kb.inArray(this[0],kb(a)):kb.inArray(a.jquery?a[0]:a,this):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(a,b){var c="string"==typeof a?kb(a,b):kb.makeArray(a&&a.nodeType?[a]:a),d=kb.merge(this.get(),c);return this.pushStack(kb.unique(d))},addBack:function(a){return this.add(null==a?this.prevObject:this.prevObject.filter(a))}}),kb.each({parent:function(a){var b=a.parentNode;return b&&11!==b.nodeType?b:null},parents:function(a){return kb.dir(a,"parentNode")},parentsUntil:function(a,b,c){return kb.dir(a,"parentNode",c)},next:function(a){return l(a,"nextSibling")},prev:function(a){return l(a,"previousSibling")},nextAll:function(a){return kb.dir(a,"nextSibling")},prevAll:function(a){return kb.dir(a,"previousSibling")},nextUntil:function(a,b,c){return kb.dir(a,"nextSibling",c)},prevUntil:function(a,b,c){return kb.dir(a,"previousSibling",c)},siblings:function(a){return kb.sibling((a.parentNode||{}).firstChild,a)},children:function(a){return kb.sibling(a.firstChild)},contents:function(a){return kb.nodeName(a,"iframe")?a.contentDocument||a.contentWindow.document:kb.merge([],a.childNodes)}},function(a,b){kb.fn[a]=function(c,d){var e=kb.map(this,b,c);return"Until"!==a.slice(-5)&&(d=c),d&&"string"==typeof d&&(e=kb.filter(d,e)),this.length>1&&(Tb[a]||(e=kb.unique(e)),Rb.test(a)&&(e=e.reverse())),this.pushStack(e)}}),kb.extend({filter:function(a,b,c){var d=b[0];return c&&(a=":not("+a+")"),1===b.length&&1===d.nodeType?kb.find.matchesSelector(d,a)?[d]:[]:kb.find.matches(a,kb.grep(b,function(a){return 1===a.nodeType}))},dir:function(a,c,d){for(var e=[],f=a[c];f&&9!==f.nodeType&&(d===b||1!==f.nodeType||!kb(f).is(d));)1===f.nodeType&&e.push(f),f=f[c];return e},sibling:function(a,b){for(var c=[];a;a=a.nextSibling)1===a.nodeType&&a!==b&&c.push(a);return c}});var Ub="abbr|article|aside|audio|bdi|canvas|data|datalist|details|figcaption|figure|footer|header|hgroup|mark|meter|nav|output|progress|section|summary|time|video",Vb=/ jQuery\d+="(?:null|\d+)"/g,Wb=RegExp("<(?:"+Ub+")[\\s/>]","i"),Xb=/^\s+/,Yb=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,Zb=/<([\w:]+)/,$b=/<tbody/i,_b=/<|&#?\w+;/,ac=/<(?:script|style|link)/i,bc=/^(?:checkbox|radio)$/i,cc=/checked\s*(?:[^=]|=\s*.checked.)/i,dc=/^$|\/(?:java|ecma)script/i,ec=/^true\/(.*)/,fc=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g,gc={option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],area:[1,"<map>","</map>"],param:[1,"<object>","</object>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:kb.support.htmlSerialize?[0,"",""]:[1,"X<div>","</div>"]},hc=n(Y),ic=hc.appendChild(Y.createElement("div"));gc.optgroup=gc.option,gc.tbody=gc.tfoot=gc.colgroup=gc.caption=gc.thead,gc.th=gc.td,kb.fn.extend({text:function(a){return kb.access(this,function(a){return a===b?kb.text(this):this.empty().append((this[0]&&this[0].ownerDocument||Y).createTextNode(a))},null,a,arguments.length)},append:function(){return this.domManip(arguments,function(a){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var b=o(this,a);b.appendChild(a)}})},prepend:function(){return this.domManip(arguments,function(a){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var b=o(this,a);b.insertBefore(a,b.firstChild)}})},before:function(){return this.domManip(arguments,function(a){this.parentNode&&this.parentNode.insertBefore(a,this)})},after:function(){return this.domManip(arguments,function(a){this.parentNode&&this.parentNode.insertBefore(a,this.nextSibling)})},remove:function(a,b){for(var c,d=a?kb.filter(a,this):this,e=0;null!=(c=d[e]);e++)b||1!==c.nodeType||kb.cleanData(u(c)),c.parentNode&&(b&&kb.contains(c.ownerDocument,c)&&r(u(c,"script")),c.parentNode.removeChild(c));return this},empty:function(){for(var a,b=0;null!=(a=this[b]);b++){for(1===a.nodeType&&kb.cleanData(u(a,!1));a.firstChild;)a.removeChild(a.firstChild);a.options&&kb.nodeName(a,"select")&&(a.options.length=0)}return this},clone:function(a,b){return a=null==a?!1:a,b=null==b?a:b,this.map(function(){return kb.clone(this,a,b)})},html:function(a){return kb.access(this,function(a){var c=this[0]||{},d=0,e=this.length;if(a===b)return 1===c.nodeType?c.innerHTML.replace(Vb,""):b;if(!("string"!=typeof a||ac.test(a)||!kb.support.htmlSerialize&&Wb.test(a)||!kb.support.leadingWhitespace&&Xb.test(a)||gc[(Zb.exec(a)||["",""])[1].toLowerCase()])){a=a.replace(Yb,"<$1></$2>");try{for(;e>d;d++)c=this[d]||{},1===c.nodeType&&(kb.cleanData(u(c,!1)),c.innerHTML=a);c=0}catch(f){}}c&&this.empty().append(a)},null,a,arguments.length)},replaceWith:function(){var a=kb.map(this,function(a){return[a.nextSibling,a.parentNode]}),b=0;return this.domManip(arguments,function(c){var d=a[b++],e=a[b++];e&&(d&&d.parentNode!==e&&(d=this.nextSibling),kb(this).remove(),e.insertBefore(c,d))},!0),b?this:this.remove()},detach:function(a){return this.remove(a,!0)},domManip:function(a,b,c){a=db.apply([],a);var d,e,f,g,h,i,j=0,k=this.length,l=this,m=k-1,n=a[0],o=kb.isFunction(n);if(o||!(1>=k||"string"!=typeof n||kb.support.checkClone)&&cc.test(n))return this.each(function(d){var e=l.eq(d);o&&(a[0]=n.call(this,d,e.html())),e.domManip(a,b,c)});if(k&&(i=kb.buildFragment(a,this[0].ownerDocument,!1,!c&&this),d=i.firstChild,1===i.childNodes.length&&(i=d),d)){for(g=kb.map(u(i,"script"),p),f=g.length;k>j;j++)e=i,j!==m&&(e=kb.clone(e,!0,!0),f&&kb.merge(g,u(e,"script"))),b.call(this[j],e,j);if(f)for(h=g[g.length-1].ownerDocument,kb.map(g,q),j=0;f>j;j++)e=g[j],dc.test(e.type||"")&&!kb._data(e,"globalEval")&&kb.contains(h,e)&&(e.src?kb._evalUrl(e.src):kb.globalEval((e.text||e.textContent||e.innerHTML||"").replace(fc,"")));i=d=null}return this}}),kb.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(a,b){kb.fn[a]=function(a){for(var c,d=0,e=[],f=kb(a),g=f.length-1;g>=d;d++)c=d===g?this:this.clone(!0),kb(f[d])[b](c),eb.apply(e,c.get());return this.pushStack(e)}}),kb.extend({clone:function(a,b,c){var d,e,f,g,h,i=kb.contains(a.ownerDocument,a);if(kb.support.html5Clone||kb.isXMLDoc(a)||!Wb.test("<"+a.nodeName+">")?f=a.cloneNode(!0):(ic.innerHTML=a.outerHTML,ic.removeChild(f=ic.firstChild)),!(kb.support.noCloneEvent&&kb.support.noCloneChecked||1!==a.nodeType&&11!==a.nodeType||kb.isXMLDoc(a)))for(d=u(f),h=u(a),g=0;null!=(e=h[g]);++g)d[g]&&t(e,d[g]);if(b)if(c)for(h=h||u(a),d=d||u(f),g=0;null!=(e=h[g]);g++)s(e,d[g]);else s(a,f);return d=u(f,"script"),d.length>0&&r(d,!i&&u(a,"script")),d=h=e=null,f},buildFragment:function(a,b,c,d){for(var e,f,g,h,i,j,k,l=a.length,m=n(b),o=[],p=0;l>p;p++)if(f=a[p],f||0===f)if("object"===kb.type(f))kb.merge(o,f.nodeType?[f]:f);else if(_b.test(f)){for(h=h||m.appendChild(b.createElement("div")),i=(Zb.exec(f)||["",""])[1].toLowerCase(),k=gc[i]||gc._default,h.innerHTML=k[1]+f.replace(Yb,"<$1></$2>")+k[2],e=k[0];e--;)h=h.lastChild;if(!kb.support.leadingWhitespace&&Xb.test(f)&&o.push(b.createTextNode(Xb.exec(f)[0])),!kb.support.tbody)for(f="table"!==i||$b.test(f)?"<table>"!==k[1]||$b.test(f)?0:h:h.firstChild,e=f&&f.childNodes.length;e--;)kb.nodeName(j=f.childNodes[e],"tbody")&&!j.childNodes.length&&f.removeChild(j);for(kb.merge(o,h.childNodes),h.textContent="";h.firstChild;)h.removeChild(h.firstChild);h=m.lastChild}else o.push(b.createTextNode(f));for(h&&m.removeChild(h),kb.support.appendChecked||kb.grep(u(o,"input"),v),p=0;f=o[p++];)if((!d||-1===kb.inArray(f,d))&&(g=kb.contains(f.ownerDocument,f),h=u(m.appendChild(f),"script"),g&&r(h),c))for(e=0;f=h[e++];)dc.test(f.type||"")&&c.push(f);return h=null,m},cleanData:function(a,b){for(var c,d,e,f,g=0,h=kb.expando,i=kb.cache,j=kb.support.deleteExpando,k=kb.event.special;null!=(c=a[g]);g++)if((b||kb.acceptData(c))&&(e=c[h],f=e&&i[e])){if(f.events)for(d in f.events)k[d]?kb.event.remove(c,d):kb.removeEvent(c,d,f.handle);i[e]&&(delete i[e],j?delete c[h]:typeof c.removeAttribute!==W?c.removeAttribute(h):c[h]=null,bb.push(e))}},_evalUrl:function(a){return kb.ajax({url:a,type:"GET",dataType:"script",async:!1,global:!1,"throws":!0})}}),kb.fn.extend({wrapAll:function(a){if(kb.isFunction(a))return this.each(function(b){kb(this).wrapAll(a.call(this,b))});if(this[0]){var b=kb(a,this[0].ownerDocument).eq(0).clone(!0);this[0].parentNode&&b.insertBefore(this[0]),b.map(function(){for(var a=this;a.firstChild&&1===a.firstChild.nodeType;)a=a.firstChild;return a}).append(this)}return this},wrapInner:function(a){return this.each(kb.isFunction(a)?function(b){kb(this).wrapInner(a.call(this,b))}:function(){var b=kb(this),c=b.contents();c.length?c.wrapAll(a):b.append(a)})},wrap:function(a){var b=kb.isFunction(a);return this.each(function(c){kb(this).wrapAll(b?a.call(this,c):a)})},unwrap:function(){return this.parent().each(function(){kb.nodeName(this,"body")||kb(this).replaceWith(this.childNodes)}).end()}});var jc,kc,lc,mc=/alpha\([^)]*\)/i,nc=/opacity\s*=\s*([^)]*)/,oc=/^(top|right|bottom|left)$/,pc=/^(none|table(?!-c[ea]).+)/,qc=/^margin/,rc=RegExp("^("+lb+")(.*)$","i"),sc=RegExp("^("+lb+")(?!px)[a-z%]+$","i"),tc=RegExp("^([+-])=("+lb+")","i"),uc={BODY:"block"},vc={position:"absolute",visibility:"hidden",display:"block"},wc={letterSpacing:0,fontWeight:400},xc=["Top","Right","Bottom","Left"],yc=["Webkit","O","Moz","ms"];kb.fn.extend({css:function(a,c){return kb.access(this,function(a,c,d){var e,f,g={},h=0;if(kb.isArray(c)){for(f=kc(a),e=c.length;e>h;h++)g[c[h]]=kb.css(a,c[h],!1,f);return g}return d!==b?kb.style(a,c,d):kb.css(a,c)},a,c,arguments.length>1)},show:function(){return y(this,!0)},hide:function(){return y(this)},toggle:function(a){var b="boolean"==typeof a;return this.each(function(){(b?a:x(this))?kb(this).show():kb(this).hide()})}}),kb.extend({cssHooks:{opacity:{get:function(a,b){if(b){var c=lc(a,"opacity");return""===c?"1":c}}}},cssNumber:{columnCount:!0,fillOpacity:!0,fontWeight:!0,lineHeight:!0,opacity:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{"float":kb.support.cssFloat?"cssFloat":"styleFloat"},style:function(a,c,d,e){if(a&&3!==a.nodeType&&8!==a.nodeType&&a.style){var f,g,h,i=kb.camelCase(c),j=a.style;if(c=kb.cssProps[i]||(kb.cssProps[i]=w(j,i)),h=kb.cssHooks[c]||kb.cssHooks[i],d===b)return h&&"get"in h&&(f=h.get(a,!1,e))!==b?f:j[c];if(g=typeof d,"string"===g&&(f=tc.exec(d))&&(d=(f[1]+1)*f[2]+parseFloat(kb.css(a,c)),g="number"),!(null==d||"number"===g&&isNaN(d)||("number"!==g||kb.cssNumber[i]||(d+="px"),kb.support.clearCloneStyle||""!==d||0!==c.indexOf("background")||(j[c]="inherit"),h&&"set"in h&&(d=h.set(a,d,e))===b)))try{j[c]=d}catch(k){}}},css:function(a,c,d,e){var f,g,h,i=kb.camelCase(c);return c=kb.cssProps[i]||(kb.cssProps[i]=w(a.style,i)),h=kb.cssHooks[c]||kb.cssHooks[i],h&&"get"in h&&(g=h.get(a,!0,d)),g===b&&(g=lc(a,c,e)),"normal"===g&&c in wc&&(g=wc[c]),""===d||d?(f=parseFloat(g),d===!0||kb.isNumeric(f)?f||0:g):g}}),a.getComputedStyle?(kc=function(b){return a.getComputedStyle(b,null)},lc=function(a,c,d){var e,f,g,h=d||kc(a),i=h?h.getPropertyValue(c)||h[c]:b,j=a.style;return h&&(""!==i||kb.contains(a.ownerDocument,a)||(i=kb.style(a,c)),sc.test(i)&&qc.test(c)&&(e=j.width,f=j.minWidth,g=j.maxWidth,j.minWidth=j.maxWidth=j.width=i,i=h.width,j.width=e,j.minWidth=f,j.maxWidth=g)),i}):Y.documentElement.currentStyle&&(kc=function(a){return a.currentStyle},lc=function(a,c,d){var e,f,g,h=d||kc(a),i=h?h[c]:b,j=a.style;return null==i&&j&&j[c]&&(i=j[c]),sc.test(i)&&!oc.test(c)&&(e=j.left,f=a.runtimeStyle,g=f&&f.left,g&&(f.left=a.currentStyle.left),j.left="fontSize"===c?"1em":i,i=j.pixelLeft+"px",j.left=e,g&&(f.left=g)),""===i?"auto":i}),kb.each(["height","width"],function(a,c){kb.cssHooks[c]={get:function(a,d,e){return d?0===a.offsetWidth&&pc.test(kb.css(a,"display"))?kb.swap(a,vc,function(){return B(a,c,e)}):B(a,c,e):b},set:function(a,b,d){var e=d&&kc(a);return z(a,b,d?A(a,c,d,kb.support.boxSizing&&"border-box"===kb.css(a,"boxSizing",!1,e),e):0)}}}),kb.support.opacity||(kb.cssHooks.opacity={get:function(a,b){return nc.test((b&&a.currentStyle?a.currentStyle.filter:a.style.filter)||"")?.01*parseFloat(RegExp.$1)+"":b?"1":""},set:function(a,b){var c=a.style,d=a.currentStyle,e=kb.isNumeric(b)?"alpha(opacity="+100*b+")":"",f=d&&d.filter||c.filter||"";c.zoom=1,(b>=1||""===b)&&""===kb.trim(f.replace(mc,""))&&c.removeAttribute&&(c.removeAttribute("filter"),""===b||d&&!d.filter)||(c.filter=mc.test(f)?f.replace(mc,e):f+" "+e)}}),kb(function(){kb.support.reliableMarginRight||(kb.cssHooks.marginRight={get:function(a,c){return c?kb.swap(a,{display:"inline-block"},lc,[a,"marginRight"]):b}}),!kb.support.pixelPosition&&kb.fn.position&&kb.each(["top","left"],function(a,c){kb.cssHooks[c]={get:function(a,d){return d?(d=lc(a,c),sc.test(d)?kb(a).position()[c]+"px":d):b}}})}),kb.expr&&kb.expr.filters&&(kb.expr.filters.hidden=function(a){return 0>=a.offsetWidth&&0>=a.offsetHeight||!kb.support.reliableHiddenOffsets&&"none"===(a.style&&a.style.display||kb.css(a,"display"))},kb.expr.filters.visible=function(a){return!kb.expr.filters.hidden(a)}),kb.each({margin:"",padding:"",border:"Width"},function(a,b){kb.cssHooks[a+b]={expand:function(c){for(var d=0,e={},f="string"==typeof c?c.split(" "):[c];4>d;d++)e[a+xc[d]+b]=f[d]||f[d-2]||f[0];return e}},qc.test(a)||(kb.cssHooks[a+b].set=z)});var zc=/%20/g,Ac=/\[\]$/,Bc=/\r?\n/g,Cc=/^(?:submit|button|image|reset|file)$/i,Dc=/^(?:input|select|textarea|keygen)/i;kb.fn.extend({serialize:function(){return kb.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var a=kb.prop(this,"elements");return a?kb.makeArray(a):this}).filter(function(){var a=this.type;return this.name&&!kb(this).is(":disabled")&&Dc.test(this.nodeName)&&!Cc.test(a)&&(this.checked||!bc.test(a))}).map(function(a,b){var c=kb(this).val();return null==c?null:kb.isArray(c)?kb.map(c,function(a){return{name:b.name,value:a.replace(Bc,"\r\n")}}):{name:b.name,value:c.replace(Bc,"\r\n")}}).get()}}),kb.param=function(a,c){var d,e=[],f=function(a,b){b=kb.isFunction(b)?b():null==b?"":b,e[e.length]=encodeURIComponent(a)+"="+encodeURIComponent(b)};if(c===b&&(c=kb.ajaxSettings&&kb.ajaxSettings.traditional),kb.isArray(a)||a.jquery&&!kb.isPlainObject(a))kb.each(a,function(){f(this.name,this.value)});else for(d in a)E(d,a[d],c,f);return e.join("&").replace(zc,"+")},kb.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),function(a,b){kb.fn[b]=function(a,c){return arguments.length>0?this.on(b,null,a,c):this.trigger(b)}}),kb.fn.extend({hover:function(a,b){return this.mouseenter(a).mouseleave(b||a)},bind:function(a,b,c){return this.on(a,null,b,c)},unbind:function(a,b){return this.off(a,null,b)},delegate:function(a,b,c,d){return this.on(b,a,c,d)},undelegate:function(a,b,c){return 1===arguments.length?this.off(a,"**"):this.off(b,a||"**",c)}});var Ec,Fc,Gc=kb.now(),Hc=/\?/,Ic=/#.*$/,Jc=/([?&])_=[^&]*/,Kc=/^(.*?):[ \t]*([^\r\n]*)\r?$/gm,Lc=/^(?:about|app|app-storage|.+-extension|file|res|widget):$/,Mc=/^(?:GET|HEAD)$/,Nc=/^\/\//,Oc=/^([\w.+-]+:)(?:\/\/([^\/?#:]*)(?::(\d+)|)|)/,Pc=kb.fn.load,Qc={},Rc={},Sc="*/".concat("*");try{Fc=X.href}catch(Tc){Fc=Y.createElement("a"),Fc.href="",Fc=Fc.href}Ec=Oc.exec(Fc.toLowerCase())||[],kb.fn.load=function(a,c,d){if("string"!=typeof a&&Pc)return Pc.apply(this,arguments);var e,f,g,h=this,i=a.indexOf(" ");return i>=0&&(e=a.slice(i,a.length),a=a.slice(0,i)),kb.isFunction(c)?(d=c,c=b):c&&"object"==typeof c&&(g="POST"),h.length>0&&kb.ajax({url:a,type:g,dataType:"html",data:c}).done(function(a){f=arguments,h.html(e?kb("<div>").append(kb.parseHTML(a)).find(e):a)}).complete(d&&function(a,b){h.each(d,f||[a.responseText,b,a])}),this},kb.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(a,b){kb.fn[b]=function(a){return this.on(b,a)}}),kb.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:Fc,type:"GET",isLocal:Lc.test(Ec[1]),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":Sc,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":kb.parseJSON,"text xml":kb.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(a,b){return b?H(H(a,kb.ajaxSettings),b):H(kb.ajaxSettings,a)},ajaxPrefilter:F(Qc),ajaxTransport:F(Rc),ajax:function(a,c){function d(a,c,d,e){var f,l,s,t,v,x=c;2!==u&&(u=2,i&&clearTimeout(i),k=b,h=e||"",w.readyState=a>0?4:0,f=a>=200&&300>a||304===a,d&&(t=I(m,w,d)),t=J(m,t,w,f),f?(m.ifModified&&(v=w.getResponseHeader("Last-Modified"),v&&(kb.lastModified[g]=v),v=w.getResponseHeader("etag"),v&&(kb.etag[g]=v)),204===a||"HEAD"===m.type?x="nocontent":304===a?x="notmodified":(x=t.state,l=t.data,s=t.error,f=!s)):(s=x,(a||!x)&&(x="error",0>a&&(a=0))),w.status=a,w.statusText=(c||x)+"",f?p.resolveWith(n,[l,x,w]):p.rejectWith(n,[w,x,s]),w.statusCode(r),r=b,j&&o.trigger(f?"ajaxSuccess":"ajaxError",[w,m,f?l:s]),q.fireWith(n,[w,x]),j&&(o.trigger("ajaxComplete",[w,m]),--kb.active||kb.event.trigger("ajaxStop")))}"object"==typeof a&&(c=a,a=b),c=c||{};var e,f,g,h,i,j,k,l,m=kb.ajaxSetup({},c),n=m.context||m,o=m.context&&(n.nodeType||n.jquery)?kb(n):kb.event,p=kb.Deferred(),q=kb.Callbacks("once memory"),r=m.statusCode||{},s={},t={},u=0,v="canceled",w={readyState:0,getResponseHeader:function(a){var b;if(2===u){if(!l)for(l={};b=Kc.exec(h);)l[b[1].toLowerCase()]=b[2];b=l[a.toLowerCase()]}return null==b?null:b},getAllResponseHeaders:function(){return 2===u?h:null},setRequestHeader:function(a,b){var c=a.toLowerCase();return u||(a=t[c]=t[c]||a,s[a]=b),this},overrideMimeType:function(a){return u||(m.mimeType=a),this},statusCode:function(a){var b;if(a)if(2>u)for(b in a)r[b]=[r[b],a[b]];else w.always(a[w.status]);return this},abort:function(a){var b=a||v;return k&&k.abort(b),d(0,b),this}};if(p.promise(w).complete=q.add,w.success=w.done,w.error=w.fail,m.url=((a||m.url||Fc)+"").replace(Ic,"").replace(Nc,Ec[1]+"//"),m.type=c.method||c.type||m.method||m.type,m.dataTypes=kb.trim(m.dataType||"*").toLowerCase().match(mb)||[""],null==m.crossDomain&&(e=Oc.exec(m.url.toLowerCase()),m.crossDomain=!(!e||e[1]===Ec[1]&&e[2]===Ec[2]&&(e[3]||("http:"===e[1]?"80":"443"))===(Ec[3]||("http:"===Ec[1]?"80":"443")))),m.data&&m.processData&&"string"!=typeof m.data&&(m.data=kb.param(m.data,m.traditional)),G(Qc,m,c,w),2===u)return w;j=m.global,j&&0===kb.active++&&kb.event.trigger("ajaxStart"),m.type=m.type.toUpperCase(),m.hasContent=!Mc.test(m.type),g=m.url,m.hasContent||(m.data&&(g=m.url+=(Hc.test(g)?"&":"?")+m.data,delete m.data),m.cache===!1&&(m.url=Jc.test(g)?g.replace(Jc,"$1_="+Gc++):g+(Hc.test(g)?"&":"?")+"_="+Gc++)),m.ifModified&&(kb.lastModified[g]&&w.setRequestHeader("If-Modified-Since",kb.lastModified[g]),kb.etag[g]&&w.setRequestHeader("If-None-Match",kb.etag[g])),(m.data&&m.hasContent&&m.contentType!==!1||c.contentType)&&w.setRequestHeader("Content-Type",m.contentType),w.setRequestHeader("Accept",m.dataTypes[0]&&m.accepts[m.dataTypes[0]]?m.accepts[m.dataTypes[0]]+("*"!==m.dataTypes[0]?", "+Sc+"; q=0.01":""):m.accepts["*"]);for(f in m.headers)w.setRequestHeader(f,m.headers[f]);if(m.beforeSend&&(m.beforeSend.call(n,w,m)===!1||2===u))return w.abort();v="abort";for(f in{success:1,error:1,complete:1})w[f](m[f]);if(k=G(Rc,m,c,w)){w.readyState=1,j&&o.trigger("ajaxSend",[w,m]),m.async&&m.timeout>0&&(i=setTimeout(function(){w.abort("timeout")},m.timeout));try{u=1,k.send(s,d)}catch(x){if(!(2>u))throw x;d(-1,x)}}else d(-1,"No Transport");return w},getJSON:function(a,b,c){return kb.get(a,b,c,"json")},getScript:function(a,c){return kb.get(a,b,c,"script")}}),kb.each(["get","post"],function(a,c){kb[c]=function(a,d,e,f){return kb.isFunction(d)&&(f=f||e,e=d,d=b),kb.ajax({url:a,type:c,dataType:f,data:d,success:e})}}),kb.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/(?:java|ecma)script/},converters:{"text script":function(a){return kb.globalEval(a),a}}}),kb.ajaxPrefilter("script",function(a){a.cache===b&&(a.cache=!1),a.crossDomain&&(a.type="GET",a.global=!1)}),kb.ajaxTransport("script",function(a){if(a.crossDomain){var c,d=Y.head||kb("head")[0]||Y.documentElement;return{send:function(b,e){c=Y.createElement("script"),c.async=!0,a.scriptCharset&&(c.charset=a.scriptCharset),c.src=a.url,c.onload=c.onreadystatechange=function(a,b){(b||!c.readyState||/loaded|complete/.test(c.readyState))&&(c.onload=c.onreadystatechange=null,c.parentNode&&c.parentNode.removeChild(c),c=null,b||e(200,"success"))},d.insertBefore(c,d.firstChild)},abort:function(){c&&c.onload(b,!0)}}}});var Uc=[],Vc=/(=)\?(?=&|$)|\?\?/;kb.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var a=Uc.pop()||kb.expando+"_"+Gc++;return this[a]=!0,a}}),kb.ajaxPrefilter("json jsonp",function(c,d,e){var f,g,h,i=c.jsonp!==!1&&(Vc.test(c.url)?"url":"string"==typeof c.data&&!(c.contentType||"").indexOf("application/x-www-form-urlencoded")&&Vc.test(c.data)&&"data");return i||"jsonp"===c.dataTypes[0]?(f=c.jsonpCallback=kb.isFunction(c.jsonpCallback)?c.jsonpCallback():c.jsonpCallback,i?c[i]=c[i].replace(Vc,"$1"+f):c.jsonp!==!1&&(c.url+=(Hc.test(c.url)?"&":"?")+c.jsonp+"="+f),c.converters["script json"]=function(){return h||kb.error(f+" was not called"),h[0]},c.dataTypes[0]="json",g=a[f],a[f]=function(){h=arguments},e.always(function(){a[f]=g,c[f]&&(c.jsonpCallback=d.jsonpCallback,Uc.push(f)),h&&kb.isFunction(g)&&g(h[0]),h=g=b}),"script"):b});var Wc,Xc,Yc=0,Zc=a.ActiveXObject&&function(){var a;for(a in Wc)Wc[a](b,!0)};kb.ajaxSettings.xhr=a.ActiveXObject?function(){return!this.isLocal&&K()||L()}:K,Xc=kb.ajaxSettings.xhr(),kb.support.cors=!!Xc&&"withCredentials"in Xc,Xc=kb.support.ajax=!!Xc,Xc&&kb.ajaxTransport(function(c){if(!c.crossDomain||kb.support.cors){var d;return{send:function(e,f){var g,h,i=c.xhr();if(c.username?i.open(c.type,c.url,c.async,c.username,c.password):i.open(c.type,c.url,c.async),c.xhrFields)for(h in c.xhrFields)i[h]=c.xhrFields[h];c.mimeType&&i.overrideMimeType&&i.overrideMimeType(c.mimeType),c.crossDomain||e["X-Requested-With"]||(e["X-Requested-With"]="XMLHttpRequest");try{for(h in e)i.setRequestHeader(h,e[h])}catch(j){}i.send(c.hasContent&&c.data||null),d=function(a,e){var h,j,k,l;try{if(d&&(e||4===i.readyState))if(d=b,g&&(i.onreadystatechange=kb.noop,Zc&&delete Wc[g]),e)4!==i.readyState&&i.abort();else{l={},h=i.status,j=i.getAllResponseHeaders(),"string"==typeof i.responseText&&(l.text=i.responseText);try{k=i.statusText}catch(m){k=""}h||!c.isLocal||c.crossDomain?1223===h&&(h=204):h=l.text?200:404}}catch(n){e||f(-1,n)}l&&f(h,k,l,j)},c.async?4===i.readyState?setTimeout(d):(g=++Yc,Zc&&(Wc||(Wc={},kb(a).unload(Zc)),Wc[g]=d),i.onreadystatechange=d):d()},abort:function(){d&&d(b,!0)}}}});var $c,_c,ad=/^(?:toggle|show|hide)$/,bd=RegExp("^(?:([+-])=|)("+lb+")([a-z%]*)$","i"),cd=/queueHooks$/,dd=[Q],ed={"*":[function(a,b){var c=this.createTween(a,b),d=c.cur(),e=bd.exec(b),f=e&&e[3]||(kb.cssNumber[a]?"":"px"),g=(kb.cssNumber[a]||"px"!==f&&+d)&&bd.exec(kb.css(c.elem,a)),h=1,i=20;if(g&&g[3]!==f){f=f||g[3],e=e||[],g=+d||1;do h=h||".5",g/=h,kb.style(c.elem,a,g+f);while(h!==(h=c.cur()/d)&&1!==h&&--i)}return e&&(c.unit=f,c.start=+g||+d||0,c.end=e[1]?g+(e[1]+1)*e[2]:+e[2]),c}]};kb.Animation=kb.extend(O,{tweener:function(a,b){kb.isFunction(a)?(b=a,a=["*"]):a=a.split(" ");for(var c,d=0,e=a.length;e>d;d++)c=a[d],ed[c]=ed[c]||[],ed[c].unshift(b)},prefilter:function(a,b){b?dd.unshift(a):dd.push(a)}}),kb.Tween=R,R.prototype={constructor:R,init:function(a,b,c,d,e,f){this.elem=a,this.prop=c,this.easing=e||"swing",this.options=b,this.start=this.now=this.cur(),this.end=d,this.unit=f||(kb.cssNumber[c]?"":"px")},cur:function(){var a=R.propHooks[this.prop];return a&&a.get?a.get(this):R.propHooks._default.get(this)},run:function(a){var b,c=R.propHooks[this.prop];return this.pos=b=this.options.duration?kb.easing[this.easing](a,this.options.duration*a,0,1,this.options.duration):a,this.now=(this.end-this.start)*b+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),c&&c.set?c.set(this):R.propHooks._default.set(this),this}},R.prototype.init.prototype=R.prototype,R.propHooks={_default:{get:function(a){var b;return null==a.elem[a.prop]||a.elem.style&&null!=a.elem.style[a.prop]?(b=kb.css(a.elem,a.prop,""),b&&"auto"!==b?b:0):a.elem[a.prop]},set:function(a){kb.fx.step[a.prop]?kb.fx.step[a.prop](a):a.elem.style&&(null!=a.elem.style[kb.cssProps[a.prop]]||kb.cssHooks[a.prop])?kb.style(a.elem,a.prop,a.now+a.unit):a.elem[a.prop]=a.now}}},R.propHooks.scrollTop=R.propHooks.scrollLeft={set:function(a){a.elem.nodeType&&a.elem.parentNode&&(a.elem[a.prop]=a.now)}},kb.each(["toggle","show","hide"],function(a,b){var c=kb.fn[b];kb.fn[b]=function(a,d,e){return null==a||"boolean"==typeof a?c.apply(this,arguments):this.animate(S(b,!0),a,d,e)}}),kb.fn.extend({fadeTo:function(a,b,c,d){return this.filter(x).css("opacity",0).show().end().animate({opacity:b},a,c,d)},animate:function(a,b,c,d){var e=kb.isEmptyObject(a),f=kb.speed(b,c,d),g=function(){var b=O(this,kb.extend({},a),f);g.finish=function(){b.stop(!0)},(e||kb._data(this,"finish"))&&b.stop(!0)};return g.finish=g,e||f.queue===!1?this.each(g):this.queue(f.queue,g)},stop:function(a,c,d){var e=function(a){var b=a.stop;delete a.stop,b(d)};return"string"!=typeof a&&(d=c,c=a,a=b),c&&a!==!1&&this.queue(a||"fx",[]),this.each(function(){var b=!0,c=null!=a&&a+"queueHooks",f=kb.timers,g=kb._data(this);if(c)g[c]&&g[c].stop&&e(g[c]);else for(c in g)g[c]&&g[c].stop&&cd.test(c)&&e(g[c]);for(c=f.length;c--;)f[c].elem!==this||null!=a&&f[c].queue!==a||(f[c].anim.stop(d),b=!1,f.splice(c,1));(b||!d)&&kb.dequeue(this,a)})},finish:function(a){return a!==!1&&(a=a||"fx"),this.each(function(){var b,c=kb._data(this),d=c[a+"queue"],e=c[a+"queueHooks"],f=kb.timers,g=d?d.length:0;for(c.finish=!0,kb.queue(this,a,[]),e&&e.cur&&e.cur.finish&&e.cur.finish.call(this),b=f.length;b--;)f[b].elem===this&&f[b].queue===a&&(f[b].anim.stop(!0),f.splice(b,1));for(b=0;g>b;b++)d[b]&&d[b].finish&&d[b].finish.call(this);delete c.finish})}}),kb.each({slideDown:S("show"),slideUp:S("hide"),slideToggle:S("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(a,b){kb.fn[a]=function(a,c,d){return this.animate(b,a,c,d)
}}),kb.speed=function(a,b,c){var d=a&&"object"==typeof a?kb.extend({},a):{complete:c||!c&&b||kb.isFunction(a)&&a,duration:a,easing:c&&b||b&&!kb.isFunction(b)&&b};return d.duration=kb.fx.off?0:"number"==typeof d.duration?d.duration:d.duration in kb.fx.speeds?kb.fx.speeds[d.duration]:kb.fx.speeds._default,(null==d.queue||d.queue===!0)&&(d.queue="fx"),d.old=d.complete,d.complete=function(){kb.isFunction(d.old)&&d.old.call(this),d.queue&&kb.dequeue(this,d.queue)},d},kb.easing={linear:function(a){return a},swing:function(a){return.5-Math.cos(a*Math.PI)/2}},kb.timers=[],kb.fx=R.prototype.init,kb.fx.tick=function(){var a,c=kb.timers,d=0;for($c=kb.now();c.length>d;d++)a=c[d],a()||c[d]!==a||c.splice(d--,1);c.length||kb.fx.stop(),$c=b},kb.fx.timer=function(a){a()&&kb.timers.push(a)&&kb.fx.start()},kb.fx.interval=13,kb.fx.start=function(){_c||(_c=setInterval(kb.fx.tick,kb.fx.interval))},kb.fx.stop=function(){clearInterval(_c),_c=null},kb.fx.speeds={slow:600,fast:200,_default:400},kb.fx.step={},kb.expr&&kb.expr.filters&&(kb.expr.filters.animated=function(a){return kb.grep(kb.timers,function(b){return a===b.elem}).length}),kb.fn.offset=function(a){if(arguments.length)return a===b?this:this.each(function(b){kb.offset.setOffset(this,a,b)});var c,d,e={top:0,left:0},f=this[0],g=f&&f.ownerDocument;return g?(c=g.documentElement,kb.contains(c,f)?(typeof f.getBoundingClientRect!==W&&(e=f.getBoundingClientRect()),d=T(g),{top:e.top+(d.pageYOffset||c.scrollTop)-(c.clientTop||0),left:e.left+(d.pageXOffset||c.scrollLeft)-(c.clientLeft||0)}):e):void 0},kb.offset={setOffset:function(a,b,c){var d=kb.css(a,"position");"static"===d&&(a.style.position="relative");var e,f,g=kb(a),h=g.offset(),i=kb.css(a,"top"),j=kb.css(a,"left"),k=("absolute"===d||"fixed"===d)&&kb.inArray("auto",[i,j])>-1,l={},m={};k?(m=g.position(),e=m.top,f=m.left):(e=parseFloat(i)||0,f=parseFloat(j)||0),kb.isFunction(b)&&(b=b.call(a,c,h)),null!=b.top&&(l.top=b.top-h.top+e),null!=b.left&&(l.left=b.left-h.left+f),"using"in b?b.using.call(a,l):g.css(l)}},kb.fn.extend({position:function(){if(this[0]){var a,b,c={top:0,left:0},d=this[0];return"fixed"===kb.css(d,"position")?b=d.getBoundingClientRect():(a=this.offsetParent(),b=this.offset(),kb.nodeName(a[0],"html")||(c=a.offset()),c.top+=kb.css(a[0],"borderTopWidth",!0),c.left+=kb.css(a[0],"borderLeftWidth",!0)),{top:b.top-c.top-kb.css(d,"marginTop",!0),left:b.left-c.left-kb.css(d,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){for(var a=this.offsetParent||Z;a&&!kb.nodeName(a,"html")&&"static"===kb.css(a,"position");)a=a.offsetParent;return a||Z})}}),kb.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(a,c){var d=/Y/.test(c);kb.fn[a]=function(e){return kb.access(this,function(a,e,f){var g=T(a);return f===b?g?c in g?g[c]:g.document.documentElement[e]:a[e]:(g?g.scrollTo(d?kb(g).scrollLeft():f,d?f:kb(g).scrollTop()):a[e]=f,b)},a,e,arguments.length,null)}}),kb.each({Height:"height",Width:"width"},function(a,c){kb.each({padding:"inner"+a,content:c,"":"outer"+a},function(d,e){kb.fn[e]=function(e,f){var g=arguments.length&&(d||"boolean"!=typeof e),h=d||(e===!0||f===!0?"margin":"border");return kb.access(this,function(c,d,e){var f;return kb.isWindow(c)?c.document.documentElement["client"+a]:9===c.nodeType?(f=c.documentElement,Math.max(c.body["scroll"+a],f["scroll"+a],c.body["offset"+a],f["offset"+a],f["client"+a])):e===b?kb.css(c,d,h):kb.style(c,d,e,h)},c,g?e:b,g,null)}})}),kb.fn.size=function(){return this.length},kb.fn.andSelf=kb.fn.addBack,"object"==typeof module&&"object"==typeof module.exports?module.exports=kb:(a.jQuery=a.$=kb,"function"==typeof define&&define.amd&&define("jquery",[],function(){return kb}))}(window),Ext.App=function(a){this.views=[],Ext.apply(this,a),this.api.actions||(this.api.actions={}),Ext.onReady(this.onReady,this),Ext.App.superclass.constructor.apply(this,arguments)},Ext.extend(Ext.App,Ext.util.Observable,{STATUS_EXCEPTION:"exception",STATUS_VALIDATION_ERROR:"validation",STATUS_ERROR:"error",STATUS_NOTICE:"notice",STATUS_OK:"ok",STATUS_HELP:"help",api:{url:null,type:null,actions:{}},msgCt:null,onReady:function(){this.msgCt=Ext.DomHelper.insertFirst(document.body,{id:"msg-div"},!0),this.msgCt.setStyle("position","absolute"),this.msgCt.setStyle("z-index",9999),this.msgCt.setWidth(300)},initStateProvider:function(){var a="";if(a){var b=new Date;b.setTime(b.getTime()+24*a*60*60*1e3);var c="; expires="+b.toGMTString()}else var c=null;Ext.state.Manager.setProvider(new Ext.state.CookieProvider({path:"/",expires:c,domain:null,secure:!1}))},registerView:function(a){this.views.push(a)},getViews:function(){return this.views},registerActions:function(a){Ext.apply(this.api.actions,a)},getAPI:function(){return this.api},setAlert:function(a,b){this.addMessage(a,b)},addMessage:function(a,b){var c=.8;a===!1&&(c=3),c=b.length/13.3,3>c?c=.8:c>9&&(c=3),this.msgCt.alignTo(document,"t-t"),Ext.DomHelper.append(this.msgCt,{html:this.buildMessageBox(a,String.format.apply(String,Array.prototype.slice.call(arguments,1)))},!0).slideIn("t").pause(c).ghost("t",{remove:!0})},buildMessageBox:function(a,b){switch(a){case!0:a=this.STATUS_OK;break;case!1:a=this.STATUS_ERROR}return['<div class="app-msg">','<div class="x-box-tl"><div class="x-box-tr"><div class="x-box-tc"></div></div></div>','<div class="x-box-ml"><div class="x-box-mr"><div class="x-box-mc"><h3>',a,"</h3>",b,"</div></div></div>",'<div class="x-box-bl"><div class="x-box-br"><div class="x-box-bc"></div></div></div>',"</div>"].join("")},decodeStatusIcon:function(a){switch(iconCls="",a){case!0:case this.STATUS_OK:iconCls=this.ICON_OK;break;case this.STATUS_NOTICE:iconCls=this.ICON_NOTICE;break;case!1:case this.STATUS_ERROR:iconCls=this.ICON_ERROR;break;case this.STATUS_HELP:iconCls=this.ICON_HELP}return iconCls},setViewState:function(a,b){Ext.state.Manager.set(a,b)},getViewState:function(a){return Ext.state.Manager.get(a)},t:function(a){return a},handleResponse:function(a){return a.type==this.STATUS_EXCEPTION?this.handleException(a):void(a.message.length>0&&this.setAlert(a.status,a.message))},handleException:function(a){Ext.MessageBox.alert(a.type.toUpperCase(),a.message)}}),Ext.namespace("GeoExt"),GeoExt.LayerLegend=Ext.extend(Ext.Container,{layerRecord:null,showTitle:!0,legendTitle:null,labelCls:null,layerStore:null,initComponent:function(){GeoExt.LayerLegend.superclass.initComponent.call(this),this.autoEl={},this.add({xtype:"label",html:this.getLayerTitle(this.layerRecord),cls:"x-form-item x-form-item-label"+(this.labelCls?" "+this.labelCls:"")}),this.layerRecord&&this.layerRecord.store&&(this.layerStore=this.layerRecord.store,this.layerStore.on("update",this.onStoreUpdate,this),this.layerStore.on("add",this.onStoreAdd,this),this.layerStore.on("remove",this.onStoreRemove,this))},getLabel:function(){var a=this.items.get(0);return a.rendered?a.el.dom.innerHTML:a.html},onStoreRemove:function(){},onStoreAdd:function(){},onStoreUpdate:function(a,b){if(b===this.layerRecord&&this.items.getCount()>0){var c=b.getLayer();this.setVisible(c.getVisibility()&&c.calculateInRange()&&c.displayInLayerSwitcher&&!b.get("hideInLegend")),this.update()}},update:function(){var a=this.getLayerTitle(this.layerRecord),b=this.items.get(0);b instanceof Ext.form.Label&&this.getLabel()!==a&&b.setText(a,!1)},getLayerTitle:function(a){var b=this.legendTitle||"";return this.showTitle&&!b&&a&&!a.get("hideTitle")&&(b=a.getLayer().title||a.get("title")||a.get("name")||a.getLayer().name||""),b},beforeDestroy:function(){this.layerStore&&(this.layerStore.un("update",this.onStoreUpdate,this),this.layerStore.un("remove",this.onStoreRemove,this),this.layerStore.un("add",this.onStoreAdd,this)),GeoExt.LayerLegend.superclass.beforeDestroy.apply(this,arguments)},onDestroy:function(){this.layerRecord=null,this.layerStore=null,GeoExt.LayerLegend.superclass.onDestroy.apply(this,arguments)}}),GeoExt.LayerLegend.getTypes=function(a,b){var c,d,e=(b||[]).concat(),f=[];for(d in GeoExt.LayerLegend.types)c=GeoExt.LayerLegend.types[d].supports(a),c>0?-1==e.indexOf(d)&&f.push({type:d,score:c}):e.remove(d);f.sort(function(a,b){return a.score<b.score?1:a.score==b.score?0:-1});for(var g=f.length,h=new Array(g),i=0;g>i;++i)h[i]=f[i].type;return e.concat(h)},GeoExt.LayerLegend.supports=function(){},GeoExt.LayerLegend.types={},Ext.namespace("GeoExt"),GeoExt.VectorLegend=Ext.extend(GeoExt.LayerLegend,{layerRecord:null,layer:null,rules:null,symbolType:null,untitledPrefix:"Untitled ",clickableSymbol:!1,clickableTitle:!1,selectOnClick:!1,enableDD:!1,bodyBorder:!1,feature:null,selectedRule:null,currentScaleDenominator:null,initComponent:function(){if(GeoExt.VectorLegend.superclass.initComponent.call(this),this.layerRecord&&(this.layer=this.layerRecord.getLayer(),this.layer.map&&(this.map=this.layer.map,this.currentScaleDenominator=this.layer.map.getScale(),this.layer.map.events.on({zoomend:this.onMapZoom,scope:this}))),!this.symbolType)if(this.feature)this.symbolType=this.symbolTypeFromFeature(this.feature);else if(this.layer)if(this.layer.features.length>0){var a=this.layer.features[0].clone();a.attributes={},this.feature=a,this.symbolType=this.symbolTypeFromFeature(this.feature)}else this.layer.events.on({featuresadded:this.onFeaturesAdded,scope:this});this.layer&&this.feature&&!this.rules&&this.setRules(),this.rulesContainer=new Ext.Container({autoEl:{}}),this.add(this.rulesContainer),this.addEvents("titleclick","symbolclick","ruleclick","ruleselected","ruleunselected","rulemoved"),this.update()},onMapZoom:function(){this.setCurrentScaleDenominator(this.layer.map.getScale())},symbolTypeFromFeature:function(a){var b=a.geometry.CLASS_NAME.match(/Point|Line|Polygon/);return b&&b[0]||"Point"},onFeaturesAdded:function(){this.layer.events.un({featuresadded:this.onFeaturesAdded,scope:this});var a=this.layer.features[0].clone();a.attributes={},this.feature=a,this.symbolType=this.symbolTypeFromFeature(this.feature),this.rules||this.setRules(),this.update()},setRules:function(){var a=this.layer.styleMap&&this.layer.styleMap.styles["default"];a||(a=new OpenLayers.Style),this.rules=0===a.rules.length?[new OpenLayers.Rule({title:a.title,symbolizer:a.createSymbolizer(this.feature)})]:a.rules},setCurrentScaleDenominator:function(a){a!==this.currentScaleDenominator&&(this.currentScaleDenominator=a,this.update())},getRuleEntry:function(a){return this.rulesContainer.items.get(this.rules.indexOf(a))},addRuleEntry:function(a,b){this.rulesContainer.add(this.createRuleEntry(a)),b||this.doLayout()},removeRuleEntry:function(a,b){var c=this.getRuleEntry(a);c&&(this.rulesContainer.remove(c),b||this.doLayout())},selectRuleEntry:function(a){var b=a!=this.selectedRule;if(this.selectedRule&&this.unselect(),b){var c=this.getRuleEntry(a);c.body.addClass("x-grid3-row-selected"),this.selectedRule=a,this.fireEvent("ruleselected",this,a)}},unselect:function(){this.rulesContainer.items.each(function(a,b){this.rules[b]==this.selectedRule&&(a.body.removeClass("x-grid3-row-selected"),this.selectedRule=null,this.fireEvent("ruleunselected",this,this.rules[b]))},this)},createRuleEntry:function(a){var b=!0;return null!=this.currentScaleDenominator&&(a.minScaleDenominator&&(b=b&&this.currentScaleDenominator>=a.minScaleDenominator),a.maxScaleDenominator&&(b=b&&this.currentScaleDenominator<a.maxScaleDenominator)),{xtype:"panel",layout:"column",border:!1,hidden:!b,bodyStyle:this.selectOnClick?{cursor:"pointer"}:void 0,defaults:{border:!1},items:[this.createRuleRenderer(a),this.createRuleTitle(a)],listeners:{render:function(b){this.selectOnClick&&b.getEl().on({click:function(){this.selectRuleEntry(a)},scope:this}),1==this.enableDD&&this.addDD(b)},scope:this}}},createRuleRenderer:function(a){var b,c,d=[this.symbolType,"Point","Line","Polygon"],e=a.symbolizers;if(e){var f;a:for(var g=0,h=d.length;h>g;++g)if(b=d[g],f=OpenLayers.Symbolizer[b])for(var i=0,j=e.length;j>i;++i)if(e[i]instanceof f){c=!0;break a}}else{for(var k=a.symbolizer,g=0,l=d.length;l>g;++g)if(b=d[g],k[b]){k=k[b],c=!0;break}e=[k]}return{xtype:"gx_renderer",symbolType:c?b:this.symbolType,symbolizers:e,style:this.clickableSymbol?{cursor:"pointer"}:void 0,listeners:{click:function(){this.clickableSymbol&&(this.fireEvent("symbolclick",this,a),this.fireEvent("ruleclick",this,a))},scope:this}}},createRuleTitle:function(a){return{cls:"x-form-item",style:"padding: 0.2em 0.5em 0;",bodyStyle:Ext.applyIf({background:"transparent"},this.clickableTitle?{cursor:"pointer"}:void 0),html:this.getRuleTitle(a),listeners:{render:function(b){this.clickableTitle&&b.getEl().on({click:function(){this.fireEvent("titleclick",this,a),this.fireEvent("ruleclick",this,a)},scope:this})},scope:this}}},addDD:function(a){var b=a.ownerCt,c=this;new Ext.dd.DragSource(a.getEl(),{ddGroup:b.id,onDragOut:function(a,b){var c=Ext.getCmp(b);return c.removeClass("gx-ruledrag-insert-above"),c.removeClass("gx-ruledrag-insert-below"),Ext.dd.DragZone.prototype.onDragOut.apply(this,arguments)},onDragEnter:function(c,d){var e,f=Ext.getCmp(d),g=b.items.indexOf(a),h=b.items.indexOf(f);return g>h?e="gx-ruledrag-insert-above":h>g&&(e="gx-ruledrag-insert-below"),e&&f.addClass(e),Ext.dd.DragZone.prototype.onDragEnter.apply(this,arguments)},onDragDrop:function(d,e){return c.moveRule(b.items.indexOf(a),b.items.indexOf(Ext.getCmp(e))),Ext.dd.DragZone.prototype.onDragDrop.apply(this,arguments)},getDragData:function(a){var b=a.getTarget(".x-column-inner");if(b){var c=b.cloneNode(!0);return c.id=Ext.id(),{sourceEl:b,repairXY:Ext.fly(b).getXY(),ddel:c}}}}),new Ext.dd.DropTarget(a.getEl(),{ddGroup:b.id,notifyDrop:function(){return!0}})},update:function(){if(GeoExt.VectorLegend.superclass.update.apply(this,arguments),this.symbolType&&this.rules){if(this.rulesContainer.items)for(var a,b=this.rulesContainer.items.length-1;b>=0;--b)a=this.rulesContainer.getComponent(b),this.rulesContainer.remove(a,!0);for(var b=0,c=this.rules.length;c>b;++b)this.addRuleEntry(this.rules[b],!0);this.doLayout(),this.selectedRule&&this.getRuleEntry(this.selectedRule).body.addClass("x-grid3-row-selected")}},updateRuleEntry:function(a){var b=this.getRuleEntry(a);b&&(b.removeAll(),b.add(this.createRuleRenderer(a)),b.add(this.createRuleTitle(a)),b.doLayout())},moveRule:function(a,b){var c=this.rules[a];this.rules.splice(a,1),this.rules.splice(b,0,c),this.update(),this.fireEvent("rulemoved",this,c)},getRuleTitle:function(a){var b=a.title||a.name||"";return!b&&this.untitledPrefix&&(b=this.untitledPrefix+(this.rules.indexOf(a)+1)),b},beforeDestroy:function(){this.layer&&(this.layer.events&&this.layer.events.un({featuresadded:this.onFeaturesAdded,scope:this}),this.layer.map&&this.layer.map.events&&this.layer.map.events.un({zoomend:this.onMapZoom,scope:this})),delete this.layer,delete this.map,delete this.rules,GeoExt.VectorLegend.superclass.beforeDestroy.apply(this,arguments)},onStoreRemove:function(a,b){b.getLayer()===this.layer&&this.map&&this.map.events&&this.map.events.un({zoomend:this.onMapZoom,scope:this})},onStoreAdd:function(a,b){for(var c=0,d=b.length;d>c;c++){var e=b[c];e.getLayer()===this.layer&&this.layer.map&&this.layer.map.events&&this.layer.map.events.on({zoomend:this.onMapZoom,scope:this})}}}),GeoExt.VectorLegend.supports=function(a){return a.getLayer()instanceof OpenLayers.Layer.Vector?1:0},GeoExt.LayerLegend.types.gx_vectorlegend=GeoExt.VectorLegend,Ext.reg("gx_vectorlegend",GeoExt.VectorLegend),Ext.namespace("GeoExt.tree"),GeoExt.tree.LayerContainer=Ext.extend(Ext.tree.AsyncTreeNode,{text:"Layers",constructor:function(a){a=Ext.applyIf(a||{},{text:this.text}),this.loader=a.loader instanceof GeoExt.tree.LayerLoader?a.loader:new GeoExt.tree.LayerLoader(Ext.applyIf(a.loader||{},{store:a.layerStore})),GeoExt.tree.LayerContainer.superclass.constructor.call(this,a)},recordIndexToNodeIndex:function(a){for(var b=this.loader.store,c=b.getCount(),d=this.childNodes.length,e=-1,f=c-1;f>=0&&!(this.loader.filter(b.getAt(f))===!0&&(++e,a===f||e>d-1));--f);return e},destroy:function(){delete this.layerStore,GeoExt.tree.LayerContainer.superclass.destroy.apply(this,arguments)}}),Ext.tree.TreePanel.nodeTypes.gx_layercontainer=GeoExt.tree.LayerContainer,Ext.namespace("GeoExt.tree"),GeoExt.tree.BaseLayerContainer=Ext.extend(GeoExt.tree.LayerContainer,{text:"Base Layer",constructor:function(a){a=Ext.applyIf(a||{},{text:this.text,loader:{}}),a.loader=Ext.applyIf(a.loader,{baseAttrs:Ext.applyIf(a.loader.baseAttrs||{},{iconCls:"gx-tree-baselayer-icon",checkedGroup:"baselayer"}),filter:function(a){var b=a.getLayer();return b.displayInLayerSwitcher===!0&&b.isBaseLayer===!0}}),GeoExt.tree.BaseLayerContainer.superclass.constructor.call(this,a)}}),Ext.tree.TreePanel.nodeTypes.gx_baselayercontainer=GeoExt.tree.BaseLayerContainer,Ext.namespace("GeoExt.plugins"),GeoExt.plugins.PrintExtent=Ext.extend(Ext.util.Observable,{initialConfig:null,printProvider:null,map:null,layer:null,control:null,pages:null,page:null,constructor:function(a){a=a||{},Ext.apply(this,a),this.initialConfig=a,this.printProvider||(this.printProvider=this.pages[0].printProvider),this.pages||(this.pages=[]),this.addEvents("selectpage"),GeoExt.plugins.PrintExtent.superclass.constructor.apply(this,arguments)},print:function(a){this.printProvider.print(this.map,this.pages,a)},init:function(a){this.map=a.map,a.on("destroy",this.onMapPanelDestroy,this),this.layer||(this.layer=new OpenLayers.Layer.Vector(null,{displayInLayerSwitcher:!1})),this.createControl();for(var b=0,c=this.pages.length;c>b;++b)this.addPage(this.pages[b]);this.show()},addPage:function(a){a=a||new GeoExt.data.PrintPage({printProvider:this.printProvider}),-1===this.pages.indexOf(a)&&this.pages.push(a),this.layer.addFeatures([a.feature]),a.on("change",this.onPageChange,this),this.page=a;var b=this.map;return b.getCenter()?this.fitPage():b.events.register("moveend",this,function(){b.events.unregister("moveend",this,arguments.callee),this.fitPage()}),a},removePage:function(a){this.pages.remove(a),a.feature.layer&&this.layer.removeFeatures([a.feature]),a.un("change",this.onPageChange,this)},selectPage:function(a){this.control.active&&this.control.setFeature(a.feature)},show:function(){this.map.addLayer(this.layer),this.map.addControl(this.control),this.control.activate(),this.page&&this.map.getCenter()&&this.updateBox()},hide:function(){var a=this.map,b=this.layer,c=this.control;c&&c.events&&(c.deactivate(),a&&a.events&&c.map&&a.removeControl(c)),a&&a.events&&b&&b.map&&a.removeLayer(b)},onMapPanelDestroy:function(){for(var a=this.map,b=this.pages.length-1,c=b;c>=0;c--)this.removePage(this.pages[c]);this.hide();var d=this.control;a&&a.events&&d&&d.events&&d.destroy();var e=this.layer;!this.initialConfig.layer&&a&&a.events&&e&&e.events&&e.destroy(),delete this.layer,delete this.control,delete this.page,this.map=null},createControl:function(){this.control=new OpenLayers.Control.TransformFeature(this.layer,{preserveAspectRatio:!0,eventListeners:{beforesetfeature:function(a){for(var b=0,c=this.pages.length;c>b;++b)if(this.pages[b].feature===a.feature){this.page=this.pages[b],a.object.rotation=-this.pages[b].rotation;break}},setfeature:function(a){for(var b=0,c=this.pages.length;c>b;++b)if(this.pages[b].feature===a.feature){this.fireEvent("selectpage",this.pages[b]);break}},beforetransform:function(a){this._updating=!0;var b=this.page;if(a.rotation)this.printProvider.layout.get("rotation")?b.setRotation(-a.object.rotation):a.object.setFeature(b.feature);else if(a.center)b.setCenter(OpenLayers.LonLat.fromString(a.center.toShortString()));else{b.fit(a.object.box,{mode:"closest"});var c=this.printProvider.scales.getAt(0),d=this.printProvider.scales.getAt(this.printProvider.scales.getCount()-1),e=a.object.box.geometry.getBounds(),f=b.feature.geometry.getBounds(),g=b.scale===c&&e.containsBounds(f),h=b.scale===d&&f.containsBounds(e);(g===!0||h===!0)&&this.updateBox()}return delete this._updating,!1},transformcomplete:this.updateBox,scope:this}})},fitPage:function(){this.page&&this.page.fit(this.map,{mode:"screen"})},updateBox:function(){var a=this.page;this.control.active&&this.control.setFeature(a.feature,{rotation:-a.rotation})},onPageChange:function(a){this._updating||this.control.active&&this.control.setFeature(a.feature,{rotation:-a.rotation})}}),Ext.preg("gx_printextent",GeoExt.plugins.PrintExtent),Ext.namespace("GeoExt"),GeoExt.SliderTip=Ext.extend(Ext.slider.Tip,{hover:!0,minWidth:10,offsets:[0,-10],dragging:!1,init:function(a){GeoExt.SliderTip.superclass.init.apply(this,arguments),this.hover&&a.on("render",this.registerThumbListeners,this),this.slider=a},registerThumbListeners:function(){for(var a,b,c=0,d=this.slider.thumbs.length;d>c;++c)a=this.slider.thumbs[c],b=a.tracker.el,function(a,b){b.on({mouseover:function(b){this.onSlide(this.slider,b,a),this.dragging=!1},mouseout:function(){this.dragging||this.hide.apply(this,arguments)},scope:this})}.apply(this,[a,b])},onSlide:function(){return this.dragging=!0,GeoExt.SliderTip.superclass.onSlide.apply(this,arguments)}}),Ext.namespace("GeoExt"),GeoExt.Lang=new(Ext.extend(Ext.util.Observable,{locale:navigator.language||navigator.userLanguage,dict:null,constructor:function(){this.addEvents("localize"),this.dict={},Ext.util.Observable.constructor.apply(this,arguments)},add:function(a,b){var c=this.dict[a];if(c)for(var d in b)c[d]=Ext.apply(c[d]||{},b[d]);else this.dict[a]=Ext.apply({},b);a&&a!==this.locale?0===this.locale.indexOf(a+"-")&&this.set(this.locale):this.set(a)},set:function(a){for(var b,c=a?a.split("-"):[],d="",e={},f=0,g=c.length;g>f;++f)if(d+=(d&&"-"||"")+c[f],d in this.dict){b=this.dict[d];for(var h in b)h in e?Ext.apply(e[h],b[h]):e[h]=Ext.apply({},b[h])}for(var h in e){for(var i=window,j=h.split("."),k=!1,f=0,g=j.length;g>f;++f){var l=j[f];if(!(l in i)){k=!0;break}i=i[l]}k||Ext.apply(i,e[h])}this.locale=a,this.fireEvent("localize",a)}})),Ext.namespace("GeoExt"),GeoExt.ZoomSlider=Ext.extend(Ext.slider.SingleSlider,{map:null,baseCls:"gx-zoomslider",aggressive:!1,updating:!1,initComponent:function(){GeoExt.ZoomSlider.superclass.initComponent.call(this),this.map&&(this.map instanceof GeoExt.MapPanel&&(this.map=this.map.map),this.bind(this.map)),this.aggressive===!0?this.on("change",this.changeHandler,this):this.on("changecomplete",this.changeHandler,this),this.on("beforedestroy",this.unbind,this)},onRender:function(){GeoExt.ZoomSlider.superclass.onRender.apply(this,arguments),this.el.addClass(this.baseCls)},afterRender:function(){Ext.slider.SingleSlider.superclass.afterRender.apply(this,arguments),this.update()},addToMapPanel:function(a){this.on({render:function(){var b=this.getEl();b.setStyle({position:"absolute",zIndex:a.map.Z_INDEX_BASE.Control}),b.on({mousedown:this.stopMouseEvents,click:this.stopMouseEvents})},afterrender:function(){this.bind(a.map)},scope:this})},stopMouseEvents:function(a){a.stopEvent()},removeFromMapPanel:function(){var a=this.getEl();a.un("mousedown",this.stopMouseEvents,this),a.un("click",this.stopMouseEvents,this),this.unbind()},bind:function(a){this.map=a,this.map.events.on({zoomend:this.update,changebaselayer:this.initZoomValues,scope:this}),this.map.baseLayer&&(this.initZoomValues(),this.update())},unbind:function(){this.map&&this.map.events&&this.map.events.un({zoomend:this.update,changebaselayer:this.initZoomValues,scope:this})},initZoomValues:function(){var a=this.map.baseLayer;void 0===this.initialConfig.minValue&&(this.minValue=a.minZoomLevel||0),void 0===this.initialConfig.maxValue&&(this.maxValue=null==a.minZoomLevel?a.numZoomLevels-1:a.maxZoomLevel)},getZoom:function(){return this.getValue()},getScale:function(){return OpenLayers.Util.getScaleFromResolution(this.map.getResolutionForZoom(this.getValue()),this.map.getUnits())},getResolution:function(){return this.map.getResolutionForZoom(this.getValue())},changeHandler:function(){this.map&&!this.updating&&this.map.zoomTo(this.getValue())},update:function(){this.rendered&&this.map&&(this.updating=!0,this.setValue(this.map.getZoom()),this.updating=!1)}}),Ext.reg("gx_zoomslider",GeoExt.ZoomSlider),Ext.namespace("GeoExt.tree"),GeoExt.tree.WMSCapabilitiesLoader=function(a){Ext.apply(this,a),GeoExt.tree.WMSCapabilitiesLoader.superclass.constructor.call(this)},Ext.extend(GeoExt.tree.WMSCapabilitiesLoader,Ext.tree.TreeLoader,{url:null,layerOptions:null,layerParams:null,requestMethod:"GET",getParams:function(){return{service:"WMS",request:"GetCapabilities"}},processResponse:function(a,b,c,d){var e=(new OpenLayers.Format.WMSCapabilities).read(a.responseXML||a.responseText);e.capability&&this.processLayer(e.capability,e.capability.request.getmap.href,b),"function"==typeof c&&c.apply(d||b,[b])},createWMSLayer:function(a,b){return a.name?new OpenLayers.Layer.WMS(a.title,b,OpenLayers.Util.extend({formats:a.formats[0],layers:a.name},this.layerParams),OpenLayers.Util.extend({minScale:a.minScale,queryable:a.queryable,maxScale:a.maxScale,metadata:a},this.layerOptions)):null},processLayer:function(a,b,c){Ext.each(a.nestedLayers,function(a){var d=this.createNode({text:a.title||a.name,nodeType:"node",layer:this.createWMSLayer(a,b),leaf:0===a.nestedLayers.length});d&&c.appendChild(d),a.nestedLayers&&this.processLayer(a,b,d)},this)}}),Ext.namespace("GeoExt.data"),GeoExt.data.WMSCapabilitiesReader=function(a,b){a=a||{},a.format||(a.format=new OpenLayers.Format.WMSCapabilities),"function"!=typeof b&&(b=GeoExt.data.LayerRecord.create(b||a.fields||[{name:"name",type:"string"},{name:"title",type:"string"},{name:"abstract",type:"string"},{name:"queryable",type:"boolean"},{name:"opaque",type:"boolean"},{name:"noSubsets",type:"boolean"},{name:"cascaded",type:"int"},{name:"fixedWidth",type:"int"},{name:"fixedHeight",type:"int"},{name:"minScale",type:"float"},{name:"maxScale",type:"float"},{name:"prefix",type:"string"},{name:"formats"},{name:"styles"},{name:"srs"},{name:"dimensions"},{name:"bbox"},{name:"llbbox"},{name:"attribution"},{name:"keywords"},{name:"identifiers"},{name:"authorityURLs"},{name:"metadataURLs"},{name:"infoFormats"}])),GeoExt.data.WMSCapabilitiesReader.superclass.constructor.call(this,a,b)},Ext.extend(GeoExt.data.WMSCapabilitiesReader,Ext.data.DataReader,{attributionCls:"gx-attribution",read:function(a){var b=a.responseXML;return b&&b.documentElement||(b=a.responseText),this.readRecords(b)},serviceExceptionFormat:function(a){return OpenLayers.Util.indexOf(a,"application/vnd.ogc.se_inimage")>-1?"application/vnd.ogc.se_inimage":OpenLayers.Util.indexOf(a,"application/vnd.ogc.se_xml")>-1?"application/vnd.ogc.se_xml":a[0]},imageFormat:function(a){var b=a.formats;return a.opaque&&OpenLayers.Util.indexOf(b,"image/jpeg")>-1?"image/jpeg":OpenLayers.Util.indexOf(b,"image/png")>-1?"image/png":OpenLayers.Util.indexOf(b,"image/png; mode=24bit")>-1?"image/png; mode=24bit":OpenLayers.Util.indexOf(b,"image/gif")>-1?"image/gif":b[0]},imageTransparent:function(a){return void 0==a.opaque||!a.opaque},readRecords:function(a){if(("string"==typeof a||a.nodeType)&&(a=this.meta.format.read(a)),a.error)throw new Ext.data.DataReader.Error("invalid-response",a.error);var b=a.version,c=a.capability||{},d=c.request&&c.request.getmap&&c.request.getmap.href,e=c.layers,f=c.exception?c.exception.formats:[],g=this.serviceExceptionFormat(f),h=[];if(d&&e)for(var i,j,k,l,m,n,o=this.recordType.prototype.fields,p=0,q=e.length;q>p;p++)if(i=e[p],i.name){j={};for(var r=0,s=o.length;s>r;r++)m=o.items[r],n=i[m.mapping||m.name]||m.defaultValue,n=m.convert(n),j[m.name]=n;k={attribution:i.attribution?this.attributionMarkup(i.attribution):void 0,minScale:i.minScale,maxScale:i.maxScale},this.meta.layerOptions&&Ext.apply(k,this.meta.layerOptions),l={layers:i.name,exceptions:g,format:this.imageFormat(i),transparent:this.imageTransparent(i),version:b},this.meta.layerParams&&Ext.apply(l,this.meta.layerParams),j.layer=new OpenLayers.Layer.WMS(i.title||i.name,d,l,k),h.push(new this.recordType(j,j.layer.id))}return{totalRecords:h.length,success:!0,records:h}},attributionMarkup:function(a){var b=[];if(a.logo&&b.push("<img class='"+this.attributionCls+"-image' src='"+a.logo.href+"' />"),a.title&&b.push("<span class='"+this.attributionCls+"-title'>"+a.title+"</span>"),a.href)for(var c=0;c<b.length;c++)b[c]="<a class='"+this.attributionCls+"-link' href="+a.href+">"+b[c]+"</a>";return b.join(" ")}}),Ext.namespace("GeoExt.data"),GeoExt.data.LayerStoreMixin=function(){return{map:null,reader:null,constructor:function(a){a=a||{},a.reader=a.reader||new GeoExt.data.LayerReader({},a.fields),delete a.fields;var b=a.map instanceof GeoExt.MapPanel?a.map.map:a.map;delete a.map,a.layers&&(a.data=a.layers),delete a.layers;var c={initDir:a.initDir};delete a.initDir,arguments.callee.superclass.constructor.call(this,a),this.addEvents("bind"),b&&this.bind(b,c)},bind:function(a,b){if(!this.map){this.map=a,b=b||{};var c=b.initDir;void 0==b.initDir&&(c=GeoExt.data.LayerStore.MAP_TO_STORE|GeoExt.data.LayerStore.STORE_TO_MAP);var d=a.layers.slice(0);c&GeoExt.data.LayerStore.STORE_TO_MAP&&this.each(function(a){this.map.addLayer(a.getLayer())},this),c&GeoExt.data.LayerStore.MAP_TO_STORE&&this.loadData(d,!0),a.events.on({changelayer:this.onChangeLayer,addlayer:this.onAddLayer,removelayer:this.onRemoveLayer,scope:this}),this.on({load:this.onLoad,clear:this.onClear,add:this.onAdd,remove:this.onRemove,update:this.onUpdate,scope:this}),this.data.on({replace:this.onReplace,scope:this}),this.fireEvent("bind",this,a)}},unbind:function(){this.map&&(this.map.events.un({changelayer:this.onChangeLayer,addlayer:this.onAddLayer,removelayer:this.onRemoveLayer,scope:this}),this.un("load",this.onLoad,this),this.un("clear",this.onClear,this),this.un("add",this.onAdd,this),this.un("remove",this.onRemove,this),this.data.un("replace",this.onReplace,this),this.map=null)},onChangeLayer:function(a){var b=a.layer,c=this.findBy(function(a){return a.getLayer()===b});if(c>-1){var d=this.getAt(c);if("order"===a.property){if(!this._adding&&!this._removing){var e=this.map.getLayerIndex(b);e!==c&&(this._removing=!0,this.remove(d),delete this._removing,this._adding=!0,this.insert(e,[d]),delete this._adding)}}else"name"===a.property?d.set("title",b.name):this.fireEvent("update",this,d,Ext.data.Record.EDIT)}},onAddLayer:function(a){if(!this._adding){var b=a.layer;this._adding=!0,this.loadData([b],!0),delete this._adding}},onRemoveLayer:function(a){if(this.map.unloadDestroy){if(!this._removing){var b=a.layer;this._removing=!0,this.remove(this.getById(b.id)),delete this._removing}}else this.unbind()},onLoad:function(a,b,c){if(Ext.isArray(b)||(b=[b]),c&&!c.add){this._removing=!0;for(var d=this.map.layers.length-1;d>=0;d--)this.map.removeLayer(this.map.layers[d]);delete this._removing;var e=b.length;if(e>0){for(var f=new Array(e),g=0;e>g;g++)f[g]=b[g].getLayer();this._adding=!0,this.map.addLayers(f),delete this._adding}}},onClear:function(){this._removing=!0;for(var a=this.map.layers.length-1;a>=0;a--)this.map.removeLayer(this.map.layers[a]);delete this._removing},onAdd:function(a,b,c){if(!this._adding){this._adding=!0;for(var d,e=b.length-1;e>=0;--e)d=b[e].getLayer(),this.map.addLayer(d),c!==this.map.layers.length-1&&this.map.setLayerIndex(d,c);delete this._adding}},onRemove:function(a,b){if(!this._removing){var c=b.getLayer();null!=this.map.getLayer(c.id)&&(this._removing=!0,this.removeMapLayer(b),delete this._removing)}},onUpdate:function(a,b,c){if(c===Ext.data.Record.EDIT&&b.modified&&b.modified.title){var d=b.getLayer(),e=b.get("title");e!==d.name&&d.setName(e)}},removeMapLayer:function(a){this.map.removeLayer(a.getLayer())},onReplace:function(a,b){this.removeMapLayer(b)},getByLayer:function(a){var b=this.findBy(function(b){return b.getLayer()===a});return b>-1?this.getAt(b):void 0},destroy:function(){this.unbind(),GeoExt.data.LayerStore.superclass.destroy.call(this)}}},GeoExt.data.LayerStore=Ext.extend(Ext.data.Store,new GeoExt.data.LayerStoreMixin),GeoExt.data.LayerStore.MAP_TO_STORE=1,GeoExt.data.LayerStore.STORE_TO_MAP=2,Ext.namespace("GeoExt.tree"),GeoExt.tree.LayerLoader=function(a){Ext.apply(this,a),this.addEvents("beforeload","load"),GeoExt.tree.LayerLoader.superclass.constructor.call(this)},Ext.extend(GeoExt.tree.LayerLoader,Ext.util.Observable,{store:null,filter:function(a){return 1==a.getLayer().displayInLayerSwitcher
},baseAttrs:null,uiProviders:null,load:function(a,b){if(this.fireEvent("beforeload",this,a)){for(this.removeStoreHandlers();a.firstChild;)a.removeChild(a.firstChild);this.uiProviders||(this.uiProviders=a.getOwnerTree().getLoader().uiProviders),this.store||(this.store=GeoExt.MapPanel.guess().layers),this.store.each(function(b){this.addLayerNode(a,b)},this),this.addStoreHandlers(a),"function"==typeof b&&b(),this.fireEvent("load",this,a)}},onStoreAdd:function(a,b,c,d){if(!this._reordering)for(var e=d.recordIndexToNodeIndex(c+b.length-1),f=0;f<b.length;++f)this.addLayerNode(d,b[f],e)},onStoreRemove:function(a,b,c,d){this._reordering||this.removeLayerNode(d,b)},addLayerNode:function(a,b,c){if(c=c||0,this.filter(b)===!0){var d=this.createNode({nodeType:"gx_layer",layer:b.getLayer(),layerStore:this.store}),e=a.item(c);e?a.insertBefore(d,e):a.appendChild(d),d.on("move",this.onChildMove,this)}},removeLayerNode:function(a,b){if(this.filter(b)===!0){var c=a.findChildBy(function(a){return a.layer==b.getLayer()});c&&(c.un("move",this.onChildMove,this),c.remove(),a.reload())}},onChildMove:function(a,b,c,d,e){this._reordering=!0;var f=this.store.getByLayer(b.layer);if(d instanceof GeoExt.tree.LayerContainer&&this.store===d.loader.store){d.loader._reordering=!0,this.store.remove(f);var g;if(d.childNodes.length>1){var h=0===e?e+1:e-1;g=this.store.findBy(function(a){return d.childNodes[h].layer===a.getLayer()}),0===e&&g++}else if(c.parentNode===d.parentNode){var i=d;do i=i.previousSibling;while(i&&!(i instanceof GeoExt.tree.LayerContainer&&i.lastChild));if(i)g=this.store.findBy(function(a){return i.lastChild.layer===a.getLayer()});else{var j=d;do j=j.nextSibling;while(j&&!(j instanceof GeoExt.tree.LayerContainer&&j.firstChild));j&&(g=this.store.findBy(function(a){return j.firstChild.layer===a.getLayer()})),g++}}void 0!==g?(this.store.insert(g,[f]),window.setTimeout(function(){d.reload(),c.reload()})):this.store.insert(oldRecordIndex,[f]),delete d.loader._reordering}delete this._reordering},addStoreHandlers:function(a){if(!this._storeHandlers){this._storeHandlers={add:this.onStoreAdd.createDelegate(this,[a],!0),remove:this.onStoreRemove.createDelegate(this,[a],!0)};for(var b in this._storeHandlers)this.store.on(b,this._storeHandlers[b],this)}},removeStoreHandlers:function(){if(this._storeHandlers){for(var a in this._storeHandlers)this.store.un(a,this._storeHandlers[a],this);delete this._storeHandlers}},createNode:function(attr){return this.baseAttrs&&Ext.apply(attr,this.baseAttrs),"string"==typeof attr.uiProvider&&(attr.uiProvider=this.uiProviders[attr.uiProvider]||eval(attr.uiProvider)),attr.nodeType=attr.nodeType||"gx_layer",new Ext.tree.TreePanel.nodeTypes[attr.nodeType](attr)},destroy:function(){this.removeStoreHandlers()}}),Ext.namespace("GeoExt.plugins"),GeoExt.plugins.PrintProviderField=Ext.extend(Ext.util.Observable,{target:null,constructor:function(a){this.initialConfig=a,Ext.apply(this,a),GeoExt.plugins.PrintProviderField.superclass.constructor.apply(this,arguments)},init:function(a){this.target=a;var b={scope:this,render:this.onRender,beforedestroy:this.onBeforeDestroy};b[a instanceof Ext.form.ComboBox?"select":"valid"]=this.onFieldChange,a.on(b)},onRender:function(a){var b=this.printProvider||a.ownerCt.printProvider;a.store===b.layouts?(a.setValue(b.layout.get(a.displayField)),b.on({layoutchange:this.onProviderChange,scope:this})):a.store===b.dpis?(a.setValue(b.dpi.get(a.displayField)),b.on({dpichange:this.onProviderChange,scope:this})):void 0===a.initialConfig.value&&a.setValue(b.customParams[a.name])},onFieldChange:function(a,b){var c=this.printProvider||a.ownerCt.printProvider,d=a.getValue();if(this._updating=!0,b)switch(a.store){case c.layouts:c.setLayout(b);break;case c.dpis:c.setDpi(b)}else c.customParams[a.name]=d;delete this._updating},onProviderChange:function(a,b){this._updating||this.target.setValue(b.get(this.target.displayField))},onBeforeDestroy:function(){var a=this.target;a.un("beforedestroy",this.onBeforeDestroy,this),a.un("render",this.onRender,this),a.un("select",this.onFieldChange,this),a.un("valid",this.onFieldChange,this);var b=this.printProvider||a.ownerCt.printProvider;b.un("layoutchange",this.onProviderChange,this),b.un("dpichange",this.onProviderChange,this)}}),Ext.preg("gx_printproviderfield",GeoExt.plugins.PrintProviderField),Ext.namespace("GeoExt","GeoExt.data"),GeoExt.data.LayerReader=function(a,b){a=a||{},b instanceof Function||(b=GeoExt.data.LayerRecord.create(b||a.fields||{})),GeoExt.data.LayerReader.superclass.constructor.call(this,a,b)},Ext.extend(GeoExt.data.LayerReader,Ext.data.DataReader,{totalRecords:null,readRecords:function(a){var b=[];if(a){var c,d,e,f,g,h,i,j,k=this.recordType,l=k.prototype.fields;for(c=0,d=a.length;d>c;c++){for(g=a[c],h={},e=0,f=l.length;f>e;e++)i=l.items[e],j=g[i.mapping||i.name]||i.defaultValue,j=i.convert(j),h[i.name]=j;h.layer=g,b[b.length]=new k(h,g.id)}}return{records:b,totalRecords:null!=this.totalRecords?this.totalRecords:b.length}}}),Ext.namespace("GeoExt.data"),GeoExt.data.WMSDescribeLayerStore=function(a){a=a||{},GeoExt.data.WMSDescribeLayerStore.superclass.constructor.call(this,Ext.apply(a,{proxy:a.proxy||(a.data?void 0:new Ext.data.HttpProxy({url:a.url,disableCaching:!1,method:"GET"})),reader:new GeoExt.data.WMSDescribeLayerReader(a,a.fields)}))},Ext.extend(GeoExt.data.WMSDescribeLayerStore,Ext.data.Store),Ext.namespace("GeoExt.form"),GeoExt.form.BasicForm=Ext.extend(Ext.form.BasicForm,{protocol:null,prevResponse:null,autoAbort:!0,doAction:function(a,b){return"search"==a&&(b=Ext.applyIf(b||{},{protocol:this.protocol,abortPrevious:this.autoAbort}),a=new GeoExt.form.SearchAction(this,b)),GeoExt.form.BasicForm.superclass.doAction.call(this,a,b)},search:function(a){return this.doAction("search",a)}}),Ext.namespace("GeoExt.plugins"),GeoExt.plugins.TreeNodeRadioButton=Ext.extend(Ext.util.Observable,{constructor:function(a){Ext.apply(this.initialConfig,Ext.apply({},a)),Ext.apply(this,a),this.addEvents("radiochange"),GeoExt.plugins.TreeNodeRadioButton.superclass.constructor.apply(this,arguments)},init:function(a){a.on({rendernode:this.onRenderNode,rawclicknode:this.onRawClickNode,beforedestroy:this.onBeforeDestroy,scope:this})},onRenderNode:function(a){var b=a.attributes;b.radioGroup&&!b.radio&&(b.radio=Ext.DomHelper.insertBefore(a.ui.anchor,['<input type="radio" class="gx-tree-radio" name="',b.radioGroup,'_radio"></input>'].join("")))},onRawClickNode:function(a,b){var c=b.getTarget(".gx-tree-radio",1);return c?(c.defaultChecked=c.checked,this.fireEvent("radiochange",a),!1):void 0},onBeforeDestroy:function(a){a.un("rendernode",this.onRenderNode,this),a.un("rawclicknode",this.onRawClickNode,this),a.un("beforedestroy",this.onBeforeDestroy,this)}}),Ext.preg("gx_treenoderadiobutton",GeoExt.plugins.TreeNodeRadioButton),Ext.namespace("GeoExt.data"),GeoExt.data.StyleReader=Ext.extend(Ext.data.JsonReader,{onMetaChange:function(){GeoExt.data.StyleReader.superclass.onMetaChange.apply(this,arguments),this.recordType.prototype.commit=Ext.createInterceptor(this.recordType.prototype.commit,function(){var a=this.store.reader;a.raw[a.meta.root]=a.meta.storeToData(this.store)})},readRecords:function(a){var b;b=a instanceof OpenLayers.Symbolizer.Raster?"colorMap":"rules",this.raw=a,Ext.applyIf(this.meta,GeoExt.data.StyleReader.metaData[b]);var c={metaData:this.meta};return c[b]=a[b],GeoExt.data.StyleReader.superclass.readRecords.call(this,c)}}),GeoExt.data.StyleReader.metaData={colorMap:{root:"colorMap",idProperty:"filter",fields:[{name:"symbolizers",mapping:function(a){return{fillColor:a.color,fillOpacity:a.opacity,stroke:!1}}},{name:"filter",mapping:"quantity",type:"float"},{name:"label",mapping:function(a){return a.label||a.quantity}}],storeToData:function(a){a.sort("filter","ASC");var b=[];return a.each(function(a){var c=a.get("symbolizers"),d=a.get("label"),e=a.isModified("label"),f=Number(a.get("filter"));a.data.filter=f,(!a.json.label&&!e&&a.isModified("filter")||e&&!d)&&(a.data.label=f),b.push(Ext.apply(a.json,{color:c.fillColor,label:"string"==typeof d?d:void 0,opacity:c.opacity,quantity:f}))}),b}},rules:{root:"rules",fields:["symbolizers","filter",{name:"label",mapping:"title"},"name","description","elseFilter","minScaleDenominator","maxScaleDenominator"],storeToData:function(a){var b=[];return a.each(function(a){var c=a.get("filter");"string"==typeof c&&(c=c?OpenLayers.Format.CQL.prototype.read(c):null),b.push(Ext.apply(a.json,{symbolizers:a.get("symbolizers"),filter:c,title:a.get("label"),name:a.get("name"),description:a.get("description"),elseFilter:a.get("elseFilter"),minScaleDenominator:a.get("minScaleDenominator"),maxScaleDenominator:a.get("maxScaleDenominator")}))}),b}}},Ext.namespace("GeoExt","GeoExt.data"),GeoExt.data.FeatureReader=function(a,b){a=a||{},b instanceof Function||(b=GeoExt.data.FeatureRecord.create(b||a.fields||{})),GeoExt.data.FeatureReader.superclass.constructor.call(this,a,b)},Ext.extend(GeoExt.data.FeatureReader,Ext.data.DataReader,{totalRecords:null,read:function(a){return this.readRecords(a.features)},readRecords:function(a){var b=[];if(a){var c,d,e,f,g,h,i,j,k=this.recordType,l=k.prototype.fields;for(c=0,d=a.length;d>c;c++){if(g=a[c],h={},g.attributes)for(e=0,f=l.length;f>e;e++){if(i=l.items[e],/[\[\.]/.test(i.mapping))try{j=new Function("obj","return obj."+i.mapping)(g.attributes)}catch(m){j=i.defaultValue}else j=g.attributes[i.mapping||i.name]||i.defaultValue;i.convert&&(j=i.convert(j)),h[i.name]=j}h.feature=g,h.state=g.state,h.fid=g.fid;var n=g.state===OpenLayers.State.INSERT?void 0:g.id;b[b.length]=new k(h,n)}}return{records:b,totalRecords:null!=this.totalRecords?this.totalRecords:b.length}}}),Ext.namespace("GeoExt"),GeoExt.WMSLegend=Ext.extend(GeoExt.LayerLegend,{defaultStyleIsFirst:!0,useScaleParameter:!0,baseParams:null,initComponent:function(){GeoExt.WMSLegend.superclass.initComponent.call(this);var a=this.layerRecord.getLayer();this._noMap=!a.map,a.events.register("moveend",this,this.onLayerMoveend),this.update()},onLayerMoveend:function(a){(a.zoomChanged===!0&&this.useScaleParameter===!0||this._noMap)&&(delete this._noMap,this.update())},getLegendUrl:function(a,b){var c,d=this.layerRecord,e=d&&d.get("styles"),f=d.getLayer();b=b||[f.params.LAYERS].join(",").split(",");var g=f.params.STYLES&&[f.params.STYLES].join(",").split(","),h=b.indexOf(a),i=g&&g[h];if(e&&e.length>0&&(i?Ext.each(e,function(a){return c=a.name==i&&a.legend&&a.legend.href,!c}):this.defaultStyleIsFirst!==!0||g||f.params.SLD||f.params.SLD_BODY||(c=e[0].legend&&e[0].legend.href)),c||(c=f.getFullRequestString({REQUEST:"GetLegendGraphic",WIDTH:null,HEIGHT:null,EXCEPTIONS:"application/vnd.ogc.se_xml",LAYER:a,LAYERS:null,STYLE:""!==i?i:null,STYLES:null,SRS:null,FORMAT:null,TIME:null})),-1!=c.toLowerCase().indexOf("request=getlegendgraphic")&&(-1==c.toLowerCase().indexOf("format=")&&(c=Ext.urlAppend(c,"FORMAT=image/gif")),this.useScaleParameter===!0)){var j=f.map.getScale();c=Ext.urlAppend(c,"SCALE="+j)}var k=Ext.apply({},this.baseParams);return f.params._OLSALT&&(k._OLSALT=f.params._OLSALT),c=Ext.urlAppend(c,Ext.urlEncode(k))},update:function(){var a=this.layerRecord.getLayer();if(a&&a.map){GeoExt.WMSLegend.superclass.update.apply(this,arguments);var b,c,d,e;b=[a.params.LAYERS].join(",").split(",");var f=[],g=this.items.get(0);for(this.items.each(function(a){if(d=b.indexOf(a.itemId),0>d&&a!=g)f.push(a);else if(a!==g){c=b[d];var e=this.getLegendUrl(c,b);OpenLayers.Util.isEquivalentUrl(e,a.url)||a.setUrl(e)}},this),d=0,e=f.length;e>d;d++){var h=f[d];this.remove(h),h.destroy()}for(d=0,e=b.length;e>d;d++)c=b[d],this.items&&this.getComponent(c)||this.add({xtype:"gx_legendimage",url:this.getLegendUrl(c,b),itemId:c});this.doLayout()}},beforeDestroy:function(){if(this.useScaleParameter===!0){var a=this.layerRecord.getLayer();a&&a.events&&a.events.unregister("moveend",this,this.onLayerMoveend)}GeoExt.WMSLegend.superclass.beforeDestroy.apply(this,arguments)}}),GeoExt.WMSLegend.supports=function(a){return a.getLayer()instanceof OpenLayers.Layer.WMS?1:0},GeoExt.LayerLegend.types.gx_wmslegend=GeoExt.WMSLegend,Ext.reg("gx_wmslegend",GeoExt.WMSLegend),Ext.namespace("GeoExt.data"),GeoExt.data.WMSDescribeLayerReader=function(a,b){a=a||{},a.format||(a.format=new OpenLayers.Format.WMSDescribeLayer),"function"!=typeof b&&(b=Ext.data.Record.create(b||a.fields||[{name:"owsType",type:"string"},{name:"owsURL",type:"string"},{name:"typeName",type:"string"}])),GeoExt.data.WMSDescribeLayerReader.superclass.constructor.call(this,a,b)},Ext.extend(GeoExt.data.WMSDescribeLayerReader,Ext.data.DataReader,{read:function(a){var b=a.responseXML;return b&&b.documentElement||(b=a.responseText),this.readRecords(b)},readRecords:function(a){("string"==typeof a||a.nodeType)&&(a=this.meta.format.read(a));for(var b,c=[],d=0,e=a.length;e>d;d++)b=a[d],b&&c.push(new this.recordType(b));return{totalRecords:c.length,success:!0,records:c}}}),Ext.namespace("GeoExt.form"),GeoExt.form.SearchAction=Ext.extend(Ext.form.Action,{type:"search",response:null,constructor:function(a,b){GeoExt.form.SearchAction.superclass.constructor.call(this,a,b)},run:function(){var a=this.options,b=GeoExt.form.toFilter(this.form,a.logicalOp,a.wildcard);a.clientValidation===!1||this.form.isValid()?(a.abortPrevious&&this.form.prevResponse&&a.protocol.abort(this.form.prevResponse),this.form.prevResponse=a.protocol.read(Ext.applyIf({filter:b,callback:this.handleResponse,scope:this},a))):a.clientValidation!==!1&&(this.failureType=Ext.form.Action.CLIENT_INVALID,this.form.afterAction(this,!1))},handleResponse:function(a){this.form.prevResponse=null,this.response=a,a.success()?this.form.afterAction(this,!0):this.form.afterAction(this,!1);var b=this.options;b.callback&&b.callback.call(b.scope,a)}}),Ext.namespace("GeoExt.data"),GeoExt.data.FeatureRecord=Ext.data.Record.create([{name:"feature"},{name:"state"},{name:"fid"}]),GeoExt.data.FeatureRecord.prototype.getFeature=function(){return this.get("feature")},GeoExt.data.FeatureRecord.prototype.setFeature=function(a){a!==this.data.feature&&(this.dirty=!0,this.modified||(this.modified={}),void 0===this.modified.feature&&(this.modified.feature=this.data.feature),this.data.feature=a,this.editing||this.afterEdit())},GeoExt.data.FeatureRecord.create=function(a){var b=Ext.extend(GeoExt.data.FeatureRecord,{}),c=b.prototype;if(c.fields=new Ext.util.MixedCollection(!1,function(a){return a.name}),GeoExt.data.FeatureRecord.prototype.fields.each(function(a){c.fields.add(a)}),a)for(var d=0,e=a.length;e>d;d++)c.fields.add(new Ext.data.Field(a[d]));return b.getField=function(a){return c.fields.get(a)},b},Ext.namespace("GeoExt.tree"),GeoExt.tree.LayerParamLoader=function(a){Ext.apply(this,a),this.addEvents("beforeload","load"),GeoExt.tree.LayerParamLoader.superclass.constructor.call(this)},Ext.extend(GeoExt.tree.LayerParamLoader,Ext.util.Observable,{param:null,delimiter:",",load:function(a,b){if(this.fireEvent("beforeload",this,a)){for(;a.firstChild;)a.removeChild(a.firstChild);var c=a.layer instanceof OpenLayers.Layer.HTTPRequest&&a.layer.params[this.param];if(c){var d=c instanceof Array?c.slice():c.split(this.delimiter);Ext.each(d,function(b,c,d){this.addParamNode(b,d,a)},this)}"function"==typeof b&&b(),this.fireEvent("load",this,a)}},addParamNode:function(a,b,c){var d=this.createNode({layer:c.layer,param:this.param,item:a,allItems:b,delimiter:this.delimiter}),e=c.item(0);e?c.insertBefore(d,e):c.appendChild(d)},createNode:function(attr){return this.baseAttrs&&Ext.apply(attr,this.baseAttrs),"string"==typeof attr.uiProvider&&(attr.uiProvider=this.uiProviders[attr.uiProvider]||eval(attr.uiProvider)),attr.nodeType=attr.nodeType||"gx_layerparam",new Ext.tree.TreePanel.nodeTypes[attr.nodeType](attr)}}),Ext.namespace("GeoExt.data"),GeoExt.data.PrintPage=Ext.extend(Ext.util.Observable,{printProvider:null,feature:null,center:null,scale:null,rotation:0,customParams:null,constructor:function(a){this.initialConfig=a,Ext.apply(this,a),this.customParams||(this.customParams={}),this.addEvents("change"),GeoExt.data.PrintPage.superclass.constructor.apply(this,arguments),this.feature=new OpenLayers.Feature.Vector(OpenLayers.Geometry.fromWKT("POLYGON((-1 -1,1 -1,1 1,-1 1,-1 -1))")),this.printProvider.capabilities?this.setScale(this.printProvider.scales.getAt(0)):this.printProvider.on({loadcapabilities:function(){this.setScale(this.printProvider.scales.getAt(0))},scope:this,single:!0}),this.printProvider.on({layoutchange:this.onLayoutChange,scope:this})},getPrintExtent:function(a){return a=a instanceof GeoExt.MapPanel?a.map:a,this.calculatePageBounds(this.scale,a.getUnits())},setScale:function(a,b){var c=this.calculatePageBounds(a,b),d=c.toGeometry(),e=this.rotation;0!=e&&d.rotate(-e,d.getCentroid()),this.updateFeature(d,{scale:a})},setCenter:function(a){var b=this.feature.geometry,c=b.getBounds().getCenterLonLat(),d=a.lon-c.lon,e=a.lat-c.lat;b.move(d,e),this.updateFeature(b,{center:a})},setRotation:function(a,b){if(b||this.printProvider.layout.get("rotation")===!0){var c=this.feature.geometry;c.rotate(this.rotation-a,c.getCentroid()),this.updateFeature(c,{rotation:a})}},fit:function(a,b){b=b||{};var c,d=a;if(a instanceof GeoExt.MapPanel?d=a.map:a instanceof OpenLayers.Feature.Vector&&(d=a.layer.map,c=a.geometry.getBounds()),c||(c=d.getExtent())){this._updating=!0;var e=c.getCenterLonLat();this.setCenter(e);var f=d.getUnits(),g=this.printProvider.scales.getAt(0),h=Number.POSITIVE_INFINITY,i=c.getWidth(),j=c.getHeight();this.printProvider.scales.each(function(a){var d=this.calculatePageBounds(a,f);if("closest"!=b.mode){var e="screen"==b.mode?!c.containsBounds(d):d.containsBounds(c);return(e||"screen"==b.mode&&!e)&&(g=a),e}var k=Math.abs(d.getWidth()-i)+Math.abs(d.getHeight()-j);h>k&&(h=k,g=a)},this),this.setScale(g,f),delete this._updating,this.updateFeature(this.feature.geometry,{center:e,scale:g})}},updateFeature:function(a,b){var c=this.feature,d=c.geometry!==a;if(a.id=c.geometry.id,c.geometry=a,!this._updating){for(var e in b)b[e]===this[e]?delete b[e]:(this[e]=b[e],d=!0);Ext.apply(this,b),c.layer&&c.layer.drawFeature(c),d&&this.fireEvent("change",this,b)}},calculatePageBounds:function(a,b){var c=a.get("value"),d=this.feature,e=this.feature.geometry,f=e.getBounds().getCenterLonLat(),g=this.printProvider.layout.get("size"),b=b||d.layer&&d.layer.map&&d.layer.map.getUnits()||"dd",h=OpenLayers.INCHES_PER_UNIT[b],i=g.width/72/h*c/2,j=g.height/72/h*c/2;return new OpenLayers.Bounds(f.lon-i,f.lat-j,f.lon+i,f.lat+j)},onLayoutChange:function(){this.printProvider.layout.get("rotation")===!1&&this.setRotation(0,!0),this.scale&&this.setScale(this.scale)},destroy:function(){this.printProvider.un("layoutchange",this.onLayoutChange,this)}}),Ext.namespace("GeoExt.data"),GeoExt.data.LayerRecord=Ext.data.Record.create([{name:"layer"},{name:"title",type:"string",mapping:"name"}]),GeoExt.data.LayerRecord.prototype.getLayer=function(){return this.get("layer")},GeoExt.data.LayerRecord.prototype.setLayer=function(a){a!==this.data.layer&&(this.dirty=!0,this.modified||(this.modified={}),void 0===this.modified.layer&&(this.modified.layer=this.data.layer),this.data.layer=a,this.editing||this.afterEdit())},GeoExt.data.LayerRecord.prototype.clone=function(a){var b=this.getLayer()&&this.getLayer().clone();return new this.constructor(Ext.applyIf({layer:b},this.data),a||b.id)},GeoExt.data.LayerRecord.create=function(a){var b=Ext.extend(GeoExt.data.LayerRecord,{}),c=b.prototype;if(c.fields=new Ext.util.MixedCollection(!1,function(a){return a.name}),GeoExt.data.LayerRecord.prototype.fields.each(function(a){c.fields.add(a)}),a)for(var d=0,e=a.length;e>d;d++)c.fields.add(new Ext.data.Field(a[d]));return b.getField=function(a){return c.fields.get(a)},b},Ext.namespace("GeoExt.form"),GeoExt.form.toFilter=function(a,b,c){a instanceof Ext.form.FormPanel&&(a=a.getForm());var d=[],e=a.getValues(!1);for(var f in e){var g,h=f.split("__"),i=e[f];if(h.length>1&&void 0!==(g=GeoExt.form.toFilter.FILTER_MAP[h[1]])?f=h[0]:g=OpenLayers.Filter.Comparison.EQUAL_TO,g===OpenLayers.Filter.Comparison.LIKE)switch(c){case GeoExt.form.ENDS_WITH:i=".*"+i;break;case GeoExt.form.STARTS_WITH:i+=".*";break;case GeoExt.form.CONTAINS:i=".*"+i+".*"}d.push(new OpenLayers.Filter.Comparison({type:g,value:i,property:f}))}return 1==d.length&&b!=OpenLayers.Filter.Logical.NOT?d[0]:new OpenLayers.Filter.Logical({type:b||OpenLayers.Filter.Logical.AND,filters:d})},GeoExt.form.toFilter.FILTER_MAP={eq:OpenLayers.Filter.Comparison.EQUAL_TO,ne:OpenLayers.Filter.Comparison.NOT_EQUAL_TO,lt:OpenLayers.Filter.Comparison.LESS_THAN,le:OpenLayers.Filter.Comparison.LESS_THAN_OR_EQUAL_TO,gt:OpenLayers.Filter.Comparison.GREATER_THAN,ge:OpenLayers.Filter.Comparison.GREATER_THAN_OR_EQUAL_TO,like:OpenLayers.Filter.Comparison.LIKE},GeoExt.form.ENDS_WITH=1,GeoExt.form.STARTS_WITH=2,GeoExt.form.CONTAINS=3,GeoExt.form.recordToField=function(a,b){b=b||{};var c=a.get("type");if("object"==typeof c&&c.xtype)return c;c=c.split(":").pop();var d,e=a.get("name"),f=a.get("restriction")||{},g=a.get("nillable")||!1,h=a.get("label"),i=b.labelTpl,j=null;if("undefined"!=typeof a.data.restriction&&"undefined"!=typeof a.data.restriction.enumeration&&(j=a.data.restriction.enumeration,"string"==typeof j&&(j=[j])),i){var k=i instanceof Ext.Template?i:new Ext.XTemplate(i);h=k.apply(a.data)}else null==h&&(h=e);var l={name:e,labelStyle:g?"":null!=b.mandatoryFieldLabelStyle?b.mandatoryFieldLabelStyle:"font-weight:bold;"},m=GeoExt.form.recordToField.REGEXES;if(c.match(m.text)){var n=void 0!==f.maxLength?parseFloat(f.maxLength):void 0,o=void 0!==f.minLength?parseFloat(f.minLength):void 0;d=j?Ext.apply(new Ext.form.ComboBox({store:j,editable:!1,triggerAction:"all",fieldLabel:h,maxLength:n,minLength:o}),l):n?Ext.apply({xtype:"textfield",fieldLabel:h,maxLength:n,minLength:o},l):Ext.apply({xtype:"textarea",fieldLabel:h,maxLength:n,minLength:o},l)}else if(c.match(m.number)){var p=void 0!==f.maxInclusive?parseFloat(f.maxInclusive):void 0,q=void 0!==f.minInclusive?parseFloat(f.minInclusive):void 0;d=j?Ext.apply(new Ext.form.ComboBox({store:j,editable:!1,triggerAction:"all",fieldLabel:h,maxValue:p,minValue:q}),l):Ext.apply({xtype:"numberfield",fieldLabel:h,maxValue:p,minValue:q},l)}else if(c.match(m.boolean)){d=Ext.apply({xtype:"checkbox"},l);var r=b.checkboxLabelProperty||"boxLabel";d[r]=h}else c.match(m.date)?d=Ext.apply(new Ext.form.DateField({fieldLabel:h,convert:function(a){var b=new Date(a);return Ext.Date.format(b,"m-d-Y g:i A")}}),l):c.match(m.imageType)?d=Ext.apply({xtype:"fileuploadfield",emptyText:"Image byte string",fieldLabel:h,readOnly:!1,buttonText:"",buttonCfg:{iconCls:"upload-icon"},listeners:{fileselected:function(a){var b=new FileReader,c=document.createElement("img"),d=document.querySelector("#"+a.fileInput.id).files[0];b.onload=function(b){c.src=b.target.result;var d=document.createElement("canvas"),e=d.getContext("2d"),f=800,g=800,h=c.width,i=c.height;e.drawImage(c,0,0),h>i?h>f&&(i*=f/h,h=f):i>g&&(h*=g/i,i=g),d.width=h,d.height=i,e.drawImage(c,0,0,h,i),$("#"+a.id).val(btoa(d.toDataURL("image/png")))},b.readAsDataURL(d)}}},l):c.match(m.base64Binary)&&(d=Ext.apply({xtype:"fileuploadfield",emptyText:"File byte string",fieldLabel:h,readOnly:!1,buttonText:"",buttonCfg:{iconCls:"upload-icon"},listeners:{fileselected:function(a){var b=new FileReader;file=document.querySelector("#"+a.fileInput.id).files[0],b.onload=function(){$("#"+a.id).val(btoa(b.result))},b.readAsDataURL(file)}}},l));return d},GeoExt.form.recordToField.REGEXES={text:new RegExp("^(text|string)$","i"),number:new RegExp("^(number|float|decimal|double|int|long|integer|short)$","i"),"boolean":new RegExp("^(boolean)$","i"),date:new RegExp("^(date|dateTime)$","i"),base64Binary:new RegExp("^(base64Binary)$","i"),imageType:new RegExp("^(imageType)$","i")},Ext.namespace("GeoExt"),GeoExt.FeatureRenderer=Ext.extend(Ext.BoxComponent,{feature:void 0,symbolizers:[OpenLayers.Feature.Vector.style["default"]],symbolType:"Polygon",resolution:1,minWidth:20,minHeight:20,renderers:["SVG","VML","Canvas"],rendererOptions:null,pointFeature:void 0,lineFeature:void 0,polygonFeature:void 0,renderer:null,initComponent:function(){GeoExt.FeatureRenderer.superclass.initComponent.apply(this,arguments),Ext.applyIf(this,{pointFeature:new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(0,0)),lineFeature:new OpenLayers.Feature.Vector(new OpenLayers.Geometry.LineString([new OpenLayers.Geometry.Point(-8,-3),new OpenLayers.Geometry.Point(-3,3),new OpenLayers.Geometry.Point(3,-3),new OpenLayers.Geometry.Point(8,3)])),polygonFeature:new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Polygon([new OpenLayers.Geometry.LinearRing([new OpenLayers.Geometry.Point(-8,-4),new OpenLayers.Geometry.Point(-6,-6),new OpenLayers.Geometry.Point(6,-6),new OpenLayers.Geometry.Point(8,-4),new OpenLayers.Geometry.Point(8,4),new OpenLayers.Geometry.Point(6,6),new OpenLayers.Geometry.Point(-6,6),new OpenLayers.Geometry.Point(-8,4)])]))}),this.feature||this.setFeature(null,{draw:!1}),this.addEvents("click")},initCustomEvents:function(){this.clearCustomEvents(),this.el.on("click",this.onClick,this)},clearCustomEvents:function(){this.el&&this.el.removeAllListeners&&this.el.removeAllListeners()},onClick:function(){this.fireEvent("click",this)},onRender:function(){this.el||(this.el=document.createElement("div"),this.el.id=this.getId()),this.renderer&&this.renderer.supported()||this.assignRenderer(),this.renderer.map={getResolution:function(){return this.resolution}.createDelegate(this)},GeoExt.FeatureRenderer.superclass.onRender.apply(this,arguments),this.drawFeature()},afterRender:function(){GeoExt.FeatureRenderer.superclass.afterRender.apply(this,arguments),this.initCustomEvents()},onResize:function(){this.setRendererDimensions(),GeoExt.FeatureRenderer.superclass.onResize.apply(this,arguments)},setRendererDimensions:function(){var a=this.feature.geometry.getBounds(),b=a.getWidth(),c=a.getHeight(),d=this.initialConfig.resolution;d||(d=Math.max(b/this.width||0,c/this.height||0)||1),this.resolution=d;var e=Math.max(this.width||this.minWidth,b/d),f=Math.max(this.height||this.minHeight,c/d),g=a.getCenterPixel(),h=e*d/2,i=f*d/2,j=new OpenLayers.Bounds(g.x-h,g.y-i,g.x+h,g.y+i);this.renderer.setSize(new OpenLayers.Size(Math.round(e),Math.round(f))),this.renderer.setExtent(j,!0)},assignRenderer:function(){for(var a=0,b=this.renderers.length;b>a;++a){var c=OpenLayers.Renderer[this.renderers[a]];if(c&&c.prototype.supported()){this.renderer=new c(this.el,this.rendererOptions);break}}},setSymbolizers:function(a,b){this.symbolizers=a,(!b||b.draw)&&this.drawFeature()},setSymbolType:function(a,b){this.symbolType=a,this.setFeature(null,b)},setFeature:function(a,b){this.feature=a||this[this.symbolType.toLowerCase()+"Feature"],(!b||b.draw)&&this.drawFeature()},drawFeature:function(){this.renderer.clear(),this.setRendererDimensions();for(var a,b,c,d=OpenLayers.Symbolizer,e=d&&d.Text,f=0,g=this.symbolizers.length;g>f;++f)a=this.symbolizers[f],b=this.feature,e&&a instanceof e||(d&&a instanceof d?(a=a.clone(),this.initialConfig.feature||(c=a.CLASS_NAME.split(".").pop().toLowerCase(),b=this[c+"Feature"])):a=Ext.apply({},a),this.renderer.drawFeature(b.clone(),a))},update:function(a){a=a||{},a.feature?this.setFeature(a.feature,{draw:!1}):a.symbolType&&this.setSymbolType(a.symbolType,{draw:!1}),a.symbolizers&&this.setSymbolizers(a.symbolizers,{draw:!1}),this.drawFeature()},beforeDestroy:function(){this.clearCustomEvents(),this.renderer&&this.renderer.destroy()}}),Ext.reg("gx_renderer",GeoExt.FeatureRenderer),Ext.namespace("GeoExt"),GeoExt.Popup=Ext.extend(Ext.Window,{anchored:!0,map:null,panIn:!0,unpinnable:!0,location:null,insideViewport:null,animCollapse:!1,draggable:!1,shadow:!1,popupCls:"gx-popup",ancCls:null,anchorPosition:"auto",initComponent:function(){this.map instanceof GeoExt.MapPanel&&(this.map=this.map.map),!this.map&&this.location instanceof OpenLayers.Feature.Vector&&this.location.layer&&(this.map=this.location.layer.map),this.location instanceof OpenLayers.Feature.Vector&&(this.location=this.location.geometry),this.location instanceof OpenLayers.Geometry?("function"==typeof this.location.getCentroid&&(this.location=this.location.getCentroid()),this.location=this.location.getBounds().getCenterLonLat()):this.location instanceof OpenLayers.Pixel&&(this.location=this.map.getLonLatFromViewPortPx(this.location));var a=this.map.getExtent();a&&this.location&&(this.insideViewport=a.containsLonLat(this.location)),this.anchored&&this.addAnchorEvents(),this.baseCls=this.popupCls+" "+this.baseCls,this.elements+=",anc",GeoExt.Popup.superclass.initComponent.call(this)},onRender:function(a,b){GeoExt.Popup.superclass.onRender.call(this,a,b),this.ancCls=this.popupCls+"-anc",this.createElement("anc",this.el.dom)},initTools:function(){this.unpinnable&&this.addTool({id:"unpin",handler:this.unanchorPopup.createDelegate(this,[])}),GeoExt.Popup.superclass.initTools.call(this)},show:function(){GeoExt.Popup.superclass.show.apply(this,arguments),this.anchored&&(this.position(),this.panIn&&!this._mapMove&&this.panIntoView())},maximize:function(){!this.maximized&&this.anc&&this.unanchorPopup(),GeoExt.Popup.superclass.maximize.apply(this,arguments)},setSize:function(a,b){if(this.anc){var c=this.anc.getSize();"object"==typeof a?(b=a.height-c.height,a=a.width):isNaN(b)||(b-=c.height)}GeoExt.Popup.superclass.setSize.call(this,a,b)},position:function(){if(this._mapMove===!0&&(this.insideViewport=this.map.getExtent().containsLonLat(this.location),this.insideViewport!==this.isVisible()&&this.setVisible(this.insideViewport)),this.isVisible()){var a=this.map.getPixelFromLonLat(this.location),b=Ext.fly(this.map.div).getBox(!0),c=a.y+b.y,d=a.x+b.x,e=this.el.getSize(),f=this.anc.getSize(),g=this.anchorPosition;if(g.indexOf("right")>-1||a.x>b.width/2){this.anc.addClass("right");var h=this.el.getX(!0)+e.width-this.anc.getX(!0)-f.width;d-=e.width-h-f.width/2}else{this.anc.removeClass("right");var i=this.anc.getLeft(!0);d-=i+f.width/2}g.indexOf("bottom")>-1||a.y>b.height/2?(this.anc.removeClass("top"),c-=e.height+f.height):(this.anc.addClass("top"),c+=f.height),this.setPosition(d,c)}},unanchorPopup:function(){this.removeAnchorEvents(),this.draggable=!0,this.header.addClass("x-window-draggable"),this.dd=new Ext.Window.DD(this),this.anc.remove(),this.anc=null,this.tools.unpin.hide()},panIntoView:function(){var a=Ext.fly(this.map.div).getBox(!0),b=this.getPosition(!0);b[0]-=a.x,b[1]-=a.y;var c=[a.width,a.height],d=this.getSize(),e=[b[0],b[1]],f=this.map.paddingForPopups;b[0]<f.left?e[0]=f.left:b[0]+d.width>c[0]-f.right&&(e[0]=c[0]-f.right-d.width),b[1]<f.top?e[1]=f.top:b[1]+d.height>c[1]-f.bottom&&(e[1]=c[1]-f.bottom-d.height);var g=b[0]-e[0],h=b[1]-e[1];this.map.pan(g,h)},onMapMove:function(){this.hidden&&this.insideViewport||(this._mapMove=!0,this.position(),delete this._mapMove)},addAnchorEvents:function(){this.map.events.on({move:this.onMapMove,scope:this}),this.on({resize:this.position,collapse:this.position,expand:this.position,scope:this})},removeAnchorEvents:function(){this.map.events.un({move:this.onMapMove,scope:this}),this.un("resize",this.position,this),this.un("collapse",this.position,this),this.un("expand",this.position,this)},beforeDestroy:function(){this.anchored&&this.removeAnchorEvents(),GeoExt.Popup.superclass.beforeDestroy.call(this)}}),Ext.reg("gx_popup",GeoExt.Popup),Ext.namespace("GeoExt.data"),GeoExt.data.AttributeStoreMixin=function(){return{constructor:function(a){a=a||{},arguments.callee.superclass.constructor.call(this,Ext.apply(a,{proxy:a.proxy||(a.data?void 0:new Ext.data.HttpProxy({url:a.url,disableCaching:!1,method:"GET"})),reader:new GeoExt.data.AttributeReader(a,a.fields||["name","type","restriction",{name:"nillable",type:"boolean"}])})),this.feature&&this.bind()},bind:function(){this.on({update:this.onUpdate,load:this.onLoad,add:this.onAdd,scope:this});var a=[];this.each(function(b){a.push(b)}),this.updateFeature(a)},onUpdate:function(a,b){this.updateFeature([b])},onLoad:function(a,b,c){c&&c.add===!0||this.updateFeature(b)},onAdd:function(a,b){this.updateFeature(b)
},updateFeature:function(a){var b,c,d,e,f,g,h,i=this.feature,j=i.layer;for(b=0,c=a.length;c>b;b++)d=a[b],e=d.get("name"),f=d.get("value"),g=i.attributes[e],g!==f&&(h=!0);if(h&&j&&j.events&&j.events.triggerEvent("beforefeaturemodified",{feature:i})!==!1){for(b=0,c=a.length;c>b;b++)d=a[b],e=d.get("name"),f=d.get("value"),i.attributes[e]=f;j.events.triggerEvent("featuremodified",{feature:i}),j.drawFeature(i)}}}},GeoExt.data.AttributeStore=Ext.extend(Ext.data.Store,GeoExt.data.AttributeStoreMixin()),Ext.namespace("GeoExt.form"),GeoExt.form.FormPanel=Ext.extend(Ext.form.FormPanel,{protocol:null,createForm:function(){return delete this.initialConfig.listeners,new GeoExt.form.BasicForm(null,this.initialConfig)},search:function(a){this.getForm().search(a)}}),Ext.reg("gx_formpanel",GeoExt.form.FormPanel),Ext.namespace("GeoExt.data"),GeoExt.data.WMCReader=function(a,b){a=a||{},a.format||(a.format=new OpenLayers.Format.WMC),"function"!=typeof b&&(b=GeoExt.data.LayerRecord.create(b||a.fields||[{name:"abstract",type:"string"},{name:"metadataURL",type:"string"},{name:"queryable",type:"boolean"},{name:"formats"},{name:"styles"}])),GeoExt.data.WMCReader.superclass.constructor.call(this,a,b)},Ext.extend(GeoExt.data.WMCReader,Ext.data.DataReader,{read:function(a){var b=a.responseXML;return b&&b.documentElement||(b=a.responseText),this.readRecords(b)},readRecords:function(a){var b=this.meta.format;("string"==typeof a||a.nodeType)&&(a=b.read(a));var c=a?a.layersContext:void 0,d=[];if(c){var e,f,g,h,i,j,k,l,m=this.recordType,n=m.prototype.fields;for(e=0,f=c.length;f>e;e++){for(i=c[e],j={},g=0,h=n.length;h>g;g++)k=n.items[g],l=i[k.mapping||k.name]||k.defaultValue,l=k.convert(l),j[k.name]=l;j.layer=b.getLayerFromContext(i),d.push(new this.recordType(j,j.layer.id))}}return{totalRecords:d.length,success:!0,records:d}}}),GeoExt.Lang.add("fr",{"GeoExt.tree.LayerContainer.prototype":{text:"Couches"},"GeoExt.tree.BaseLayerContainer.prototype":{text:"Couches de base"},"GeoExt.tree.OverlayLayerContainer.prototype":{text:"Couches additionnelles"}}),Ext.namespace("GeoExt.tree"),GeoExt.tree.OverlayLayerContainer=Ext.extend(GeoExt.tree.LayerContainer,{text:"Overlays",constructor:function(a){a=Ext.applyIf(a||{},{text:this.text}),a.loader=Ext.applyIf(a.loader||{},{filter:function(a){var b=a.getLayer();return b.displayInLayerSwitcher===!0&&b.isBaseLayer===!1}}),GeoExt.tree.OverlayLayerContainer.superclass.constructor.call(this,a)}}),Ext.tree.TreePanel.nodeTypes.gx_overlaylayercontainer=GeoExt.tree.OverlayLayerContainer,Ext.namespace("GeoExt.data"),GeoExt.data.WFSCapabilitiesReader=function(a,b){a=a||{},a.format||(a.format=new OpenLayers.Format.WFSCapabilities),"function"!=typeof b&&(b=GeoExt.data.LayerRecord.create(b||a.fields||[{name:"name",type:"string"},{name:"title",type:"string"},{name:"namespace",type:"string",mapping:"featureNS"},{name:"abstract",type:"string"}])),GeoExt.data.WFSCapabilitiesReader.superclass.constructor.call(this,a,b)},Ext.extend(GeoExt.data.WFSCapabilitiesReader,Ext.data.DataReader,{read:function(a){var b=a.responseXML;return b&&b.documentElement||(b=a.responseText),this.readRecords(b)},readRecords:function(a){("string"==typeof a||a.nodeType)&&(a=this.meta.format.read(a));for(var b,c,d,e,f,g,h=a.featureTypeList.featureTypes,i=this.recordType.prototype.fields,j={url:a.capability.request.getfeature.href.post},k=[],l=0,m=h.length;m>l;l++)if(b=h[l],b.name){c={};for(var n=0,o=i.length;o>n;n++)d=i.items[n],e=b[d.mapping||d.name]||d.defaultValue,e=d.convert(e),c[d.name]=e;g={featureType:b.name,featureNS:b.featureNS},this.meta.protocolOptions?Ext.apply(g,this.meta.protocolOptions,j):Ext.apply(g,{},j),f={protocol:new OpenLayers.Protocol.WFS(g),strategies:[new OpenLayers.Strategy.Fixed]};var p=this.meta.layerOptions;p&&Ext.apply(f,Ext.isFunction(p)?p():p),c.layer=new OpenLayers.Layer.Vector(b.title||b.name,f),k.push(new this.recordType(c,c.layer.id))}return{totalRecords:k.length,success:!0,records:k}}}),Ext.namespace("GeoExt"),GeoExt.LegendPanel=Ext.extend(Ext.Panel,{dynamic:!0,layerStore:null,preferredTypes:null,filter:function(){return!0},initComponent:function(){GeoExt.LegendPanel.superclass.initComponent.call(this)},onRender:function(){GeoExt.LegendPanel.superclass.onRender.apply(this,arguments),this.layerStore||(this.layerStore=GeoExt.MapPanel.guess().layers),this.layerStore.each(function(a){this.addLegend(a)},this),this.dynamic&&this.layerStore.on({add:this.onStoreAdd,remove:this.onStoreRemove,clear:this.onStoreClear,scope:this})},recordIndexToPanelIndex:function(a){for(var b,c,d=this.layerStore,e=d.getCount(),f=-1,g=this.items?this.items.length:0,h=e-1;h>=0;--h){b=d.getAt(h),c=b.getLayer();var i=GeoExt.LayerLegend.getTypes(b);if(c.displayInLayerSwitcher&&i.length>0&&d.getAt(h).get("hideInLegend")!==!0&&(++f,a===h||f>g-1))break}return f},getIdForLayer:function(a){return this.id+"-"+a.id},onStoreAdd:function(a,b,c){for(var d=this.recordIndexToPanelIndex(c+b.length-1),e=0,f=b.length;f>e;e++)this.addLegend(b[e],d);this.doLayout()},onStoreRemove:function(a,b){this.removeLegend(b)},removeLegend:function(a){if(this.items){var b=this.getComponent(this.getIdForLayer(a.getLayer()));b&&(this.remove(b,!0),this.doLayout())}},onStoreClear:function(){this.removeAllLegends()},removeAllLegends:function(){this.removeAll(!0),this.doLayout()},addLegend:function(a,b){if(this.filter(a)===!0){var c=a.getLayer();b=b||0;var d=GeoExt.LayerLegend.getTypes(a,this.preferredTypes);c.displayInLayerSwitcher&&!a.get("hideInLegend")&&d.length>0&&this.insert(b,{xtype:d[0],id:this.getIdForLayer(c),layerRecord:a,hidden:!(!c.map&&c.visibility||c.getVisibility()&&c.calculateInRange())})}},onDestroy:function(){this.layerStore&&(this.layerStore.un("add",this.onStoreAdd,this),this.layerStore.un("remove",this.onStoreRemove,this),this.layerStore.un("clear",this.onStoreClear,this)),GeoExt.LegendPanel.superclass.onDestroy.apply(this,arguments)}}),Ext.reg("gx_legendpanel",GeoExt.LegendPanel),Ext.namespace("GeoExt.plugins"),GeoExt.plugins.TreeNodeActions=Ext.extend(Ext.util.Observable,{actionsCls:"gx-tree-layer-actions",actionCls:"gx-tree-layer-action",constructor:function(a){Ext.apply(this.initialConfig,Ext.apply({},a)),Ext.apply(this,a),this.addEvents("action"),GeoExt.plugins.TreeNodeActions.superclass.constructor.apply(this,arguments)},init:function(a){a.on({rendernode:this.onRenderNode,rawclicknode:this.onRawClickNode,beforedestroy:this.onBeforeDestroy,scope:this})},onRenderNode:function(a){var b=a.rendered;if(!b){var c=a.attributes,d=c.actions||this.actions;if(d&&d.length>0){for(var e=['<div class="',this.actionsCls,'">'],f=0,g=d.length;g>f;f++){var h=d[f];e=e.concat(['<img id="'+a.id+"_"+h.action,'" ext:qtip="'+h.qtip,'" src="'+Ext.BLANK_IMAGE_URL,'" class="'+this.actionCls+" "+h.action+'" />'])}e.concat(["</div>"]),Ext.DomHelper.insertFirst(a.ui.elNode,e.join(""))}a.layer&&a.layer.map?this.updateActions(a):a.layerStore&&a.layerStore.on({bind:function(){this.updateActions(a)},scope:this})}},updateActions:function(a){var b=a.attributes.actions||this.actions||[];Ext.each(b,function(b){var c=Ext.get(a.id+"_"+b.action);c&&"function"==typeof b.update&&b.update.call(a,c)})},onRawClickNode:function(a,b){if(b.getTarget("."+this.actionCls,1)){var c=b.getTarget("."+this.actionCls,1),d=c.className.replace(this.actionCls+" ","");return this.fireEvent("action",a,d,b),!1}},onBeforeDestroy:function(a){a.un("rendernode",this.onRenderNode,this),a.un("rawclicknode",this.onRawClickNode,this),a.un("beforedestroy",this.onBeforeDestroy,this)}}),Ext.preg("gx_treenodeactions",GeoExt.plugins.TreeNodeActions),GeoExt.Lang.add("nl",{"GeoExt.tree.LayerContainer.prototype":{text:"Kaartlagen"},"GeoExt.tree.BaseLayerContainer.prototype":{text:"Basis kaarten"},"GeoExt.tree.OverlayLayerContainer.prototype":{text:"Kaart overlays"}}),Ext.namespace("GeoExt.plugins"),GeoExt.plugins.PrintPageField=Ext.extend(Ext.util.Observable,{printPage:null,target:null,constructor:function(a){this.initialConfig=a,Ext.apply(this,a),GeoExt.plugins.PrintPageField.superclass.constructor.apply(this,arguments)},init:function(a){this.target=a;var b={beforedestroy:this.onBeforeDestroy,scope:this},c=a instanceof Ext.form.ComboBox?"select":a instanceof Ext.form.Checkbox?"check":"valid";b[c]=this.onFieldChange,a.on(b),this.printPage.on({change:this.onPageChange,scope:this}),this.printPage.printProvider.on({layoutchange:this.onLayoutChange,scope:this}),this.setValue(this.printPage)},onFieldChange:function(a,b){var c=this.printPage.printProvider,d=a.getValue();this._updating=!0,a.store===c.scales||"scale"===a.name?this.printPage.setScale(b):"rotation"==a.name?!isNaN(d)&&this.printPage.setRotation(d):this.printPage.customParams[a.name]=d,delete this._updating},onPageChange:function(a){this._updating||this.setValue(a)},onLayoutChange:function(a,b){var c=this.target;"rotation"==c.name&&c.setDisabled(!b.get("rotation"))},setValue:function(a){var b=this.target;b.suspendEvents(),b.store===a.printProvider.scales||"scale"===b.name?a.scale&&b.setValue(a.scale.get(b.displayField)):"rotation"==b.name&&b.setValue(a.rotation),b.resumeEvents()},onBeforeDestroy:function(){this.target.un("beforedestroy",this.onBeforeDestroy,this),this.target.un("select",this.onFieldChange,this),this.target.un("valid",this.onFieldChange,this),this.printPage.un("change",this.onPageChange,this),this.printPage.printProvider.un("layoutchange",this.onLayoutChange,this)}}),Ext.preg("gx_printpagefield",GeoExt.plugins.PrintPageField),Ext.namespace("GeoExt.tree"),GeoExt.tree.LayerNodeUI=Ext.extend(Ext.tree.TreeNodeUI,{constructor:function(){GeoExt.tree.LayerNodeUI.superclass.constructor.apply(this,arguments)},render:function(){var a=this.node.attributes;void 0===a.checked&&(a.checked=this.node.layer.getVisibility()),GeoExt.tree.LayerNodeUI.superclass.render.apply(this,arguments);var b=this.checkbox;if(a.checkedGroup){var c=Ext.DomHelper.insertAfter(b,['<input type="radio" name="',a.checkedGroup,'_checkbox" class="',b.className,b.checked?'" checked="checked"':"",'"></input>'].join(""));c.defaultChecked=b.defaultChecked,Ext.get(b).remove(),this.checkbox=c}this.enforceOneVisible()},onClick:function(a){a.getTarget(".x-tree-node-cb",1)?this.toggleCheck(this.isChecked()):GeoExt.tree.LayerNodeUI.superclass.onClick.apply(this,arguments)},toggleCheck:function(a){a=void 0===a?!this.isChecked():a,GeoExt.tree.LayerNodeUI.superclass.toggleCheck.call(this,a),this.enforceOneVisible()},enforceOneVisible:function(){var a=this.node.attributes,b=a.checkedGroup;if(b&&"gx_baselayer"!==b){var c=this.node.layer,d=this.node.getOwnerTree().getChecked(),e=0;Ext.each(d,function(d){var f=d.layer;d.hidden||d.attributes.checkedGroup!==b||(e++,f!=c&&a.checked&&f.setVisibility(!1))}),0===e&&0==a.checked&&c.setVisibility(!0)}},appendDDGhost:function(a){var b=this.elNode.cloneNode(!0),c=Ext.DomQuery.select("input[type='radio']",b);Ext.each(c,function(a){a.name=a.name+"_clone"}),a.appendChild(b)}}),GeoExt.tree.LayerNode=Ext.extend(Ext.tree.AsyncTreeNode,{layer:null,layerStore:null,constructor:function(a){a.leaf=a.leaf||!(a.children||a.loader),a.iconCls||a.children||(a.iconCls="gx-tree-layer-icon"),!a.loader||a.loader instanceof Ext.tree.TreeLoader||(a.loader=new GeoExt.tree.LayerParamLoader(a.loader)),this.defaultUI=this.defaultUI||GeoExt.tree.LayerNodeUI,Ext.apply(this,{layer:a.layer,layerStore:a.layerStore}),a.text&&(this.fixedText=!0),GeoExt.tree.LayerNode.superclass.constructor.apply(this,arguments)},render:function(){var a=this.layer instanceof OpenLayers.Layer&&this.layer;if(!a){this.layerStore&&"auto"!=this.layerStore||(this.layerStore=GeoExt.MapPanel.guess().layers);var b=this.layerStore.findBy(function(a){return a.get("title")==this.layer},this);-1!=b&&(a=this.layerStore.getAt(b).getLayer())}if(!this.rendered||!a){var c=this.getUI();a?(this.layer=a,a.isBaseLayer&&(this.draggable=!1,Ext.applyIf(this.attributes,{checkedGroup:"gx_baselayer"})),this.text||(this.text=a.name),c.show(),this.addVisibilityEventHandlers()):c.hide(),this.layerStore instanceof GeoExt.data.LayerStore&&this.addStoreEventHandlers(a)}GeoExt.tree.LayerNode.superclass.render.apply(this,arguments)},addVisibilityEventHandlers:function(){this.layer.events.on({visibilitychanged:this.onLayerVisibilityChanged,scope:this}),this.on({checkchange:this.onCheckChange,scope:this})},onLayerVisibilityChanged:function(){this._visibilityChanging||this.getUI().toggleCheck(this.layer.getVisibility())},onCheckChange:function(a,b){if(b!=this.layer.getVisibility()){this._visibilityChanging=!0;var c=this.layer;b&&c.isBaseLayer&&c.map?c.map.setBaseLayer(c):c.setVisibility(b),delete this._visibilityChanging}},addStoreEventHandlers:function(){this.layerStore.on({add:this.onStoreAdd,remove:this.onStoreRemove,update:this.onStoreUpdate,scope:this})},onStoreAdd:function(a,b){for(var c,d=0;d<b.length;++d){if(c=b[d].getLayer(),this.layer==c){this.getUI().show();break}if(this.layer==c.name){this.render();break}}},onStoreRemove:function(a,b){this.layer==b.getLayer()&&this.getUI().hide()},onStoreUpdate:function(a,b){var c=b.getLayer();this.fixedText||this.layer!=c||this.text===c.name||this.setText(c.name)},destroy:function(){var a=this.layer;a instanceof OpenLayers.Layer&&a.events.un({visibilitychanged:this.onLayerVisibilityChanged,scope:this}),delete this.layer;var b=this.layerStore;b&&(b.un("add",this.onStoreAdd,this),b.un("remove",this.onStoreRemove,this),b.un("update",this.onStoreUpdate,this)),delete this.layerStore,this.un("checkchange",this.onCheckChange,this),GeoExt.tree.LayerNode.superclass.destroy.apply(this,arguments)}}),Ext.tree.TreePanel.nodeTypes.gx_layer=GeoExt.tree.LayerNode,Ext.namespace("GeoExt.tree"),GeoExt.tree.LayerParamNode=Ext.extend(Ext.tree.TreeNode,{layer:null,param:null,item:null,delimiter:null,allItems:null,constructor:function(a){var b=a||{};b.iconCls=b.iconCls||"gx-tree-layerparam-icon",b.text=b.text||b.item,this.param=b.param,this.item=b.item,this.delimiter=b.delimiter||",",this.allItems=b.allItems,GeoExt.tree.LayerParamNode.superclass.constructor.apply(this,arguments),this.getLayer(),this.layer&&(this.allItems||(this.allItems=this.getItemsFromLayer()),null==this.attributes.checked?this.attributes.checked=this.layer.getVisibility()&&this.getItemsFromLayer().indexOf(this.item)>=0:this.onCheckChange(this,this.attributes.checked),this.layer.events.on({visibilitychanged:this.onLayerVisibilityChanged,scope:this}),this.on({checkchange:this.onCheckChange,scope:this}))},getLayer:function(){if(!this.layer){var a=this.attributes.layer;if("string"==typeof a){var b=this.attributes.layerStore||GeoExt.MapPanel.guess().layers,c=b.findBy(function(b){return b.get("title")==a});a=-1!=c?b.getAt(c).getLayer():null}this.layer=a}return this.layer},getItemsFromLayer:function(){var a=this.layer.params[this.param];return a instanceof Array?a:a?a.split(this.delimiter):[]},createParams:function(a){var b={};return b[this.param]=this.layer.params[this.param]instanceof Array?a:a.join(this.delimiter),b},onLayerVisibilityChanged:function(){0===this.getItemsFromLayer().length&&this.layer.mergeNewParams(this.createParams(this.allItems));var a=this.layer.getVisibility();a&&-1!==this.getItemsFromLayer().indexOf(this.item)&&this.getUI().toggleCheck(!0),a||(this.layer.mergeNewParams(this.createParams([])),this.getUI().toggleCheck(!1))},onCheckChange:function(a,b){var c=this.layer,d=[],e=this.getItemsFromLayer();b===!0&&c.getVisibility()===!1&&e.length===this.allItems.length&&(e=[]),Ext.each(this.allItems,function(a){(a!==this.item&&-1!==e.indexOf(a)||b===!0&&a===this.item)&&d.push(a)},this);var f=d.length>0;f&&c.mergeNewParams(this.createParams(d)),f!==c.getVisibility()&&c.setVisibility(f),!f&&c.mergeNewParams(this.createParams([]))},destroy:function(){var a=this.layer;a instanceof OpenLayers.Layer&&a.events.un({visibilitychanged:this.onLayerVisibilityChanged,scope:this}),delete this.layer,this.un("checkchange",this.onCheckChange,this),GeoExt.tree.LayerParamNode.superclass.destroy.apply(this,arguments)}}),Ext.tree.TreePanel.nodeTypes.gx_layerparam=GeoExt.tree.LayerParamNode,Ext.namespace("GeoExt"),GeoExt.UrlLegend=Ext.extend(GeoExt.LayerLegend,{initComponent:function(){GeoExt.UrlLegend.superclass.initComponent.call(this),this.add(new GeoExt.LegendImage({url:this.layerRecord.get("legendURL")}))},update:function(){GeoExt.UrlLegend.superclass.update.apply(this,arguments),this.items.get(1).setUrl(this.layerRecord.get("legendURL"))}}),GeoExt.UrlLegend.supports=function(a){return null==a.get("legendURL")?0:10},GeoExt.LayerLegend.types.gx_urllegend=GeoExt.UrlLegend,Ext.reg("gx_urllegend",GeoExt.UrlLegend),Ext.namespace("GeoExt.state"),GeoExt.state.PermalinkProvider=function(a){GeoExt.state.PermalinkProvider.superclass.constructor.apply(this,arguments),a=a||{};var b=a.url;delete a.url,Ext.apply(this,a),this.state=this.readURL(b)},Ext.extend(GeoExt.state.PermalinkProvider,Ext.state.Provider,{encodeType:!0,readURL:function(a){var b,c,d,e={},f=OpenLayers.Util.getParameters(a);for(b in f)f.hasOwnProperty(b)&&(c=b.split("_"),c.length>1&&(d=c[0],e[d]=e[d]||{},e[d][c.slice(1).join("_")]=this.encodeType?this.decodeValue(f[b]):f[b]));return e},getLink:function(a){a=a||document.location.href;var b,c,d={},e=this.state;for(b in e)if(e.hasOwnProperty(b))for(c in e[b])d[b+"_"+c]=this.encodeType?unescape(this.encodeValue(e[b][c])):e[b][c];OpenLayers.Util.applyDefaults(d,OpenLayers.Util.getParameters(a));var f=OpenLayers.Util.getParameterString(d),g=a.indexOf("?");return g>0&&(a=a.substring(0,g)),Ext.urlAppend(a,f)}}),Ext.namespace("GeoExt"),GeoExt.LegendImage=Ext.extend(Ext.BoxComponent,{url:null,defaultImgSrc:null,imgCls:null,initComponent:function(){GeoExt.LegendImage.superclass.initComponent.call(this),null===this.defaultImgSrc&&(this.defaultImgSrc=Ext.BLANK_IMAGE_URL),this.autoEl={tag:"img","class":this.imgCls?this.imgCls:"",src:this.defaultImgSrc}},setUrl:function(a){this.url=a;var b=this.getEl();b&&(b.un("error",this.onImageLoadError,this),b.on("error",this.onImageLoadError,this,{single:!0}),b.dom.src=a)},onRender:function(a,b){GeoExt.LegendImage.superclass.onRender.call(this,a,b),this.url&&this.setUrl(this.url)},onDestroy:function(){var a=this.getEl();a&&a.un("error",this.onImageLoadError,this),GeoExt.LegendImage.superclass.onDestroy.apply(this,arguments)},onImageLoadError:function(){this.getEl().dom.src=this.defaultImgSrc}}),Ext.reg("gx_legendimage",GeoExt.LegendImage),Ext.namespace("GeoExt"),GeoExt.LayerOpacitySlider=Ext.extend(Ext.slider.SingleSlider,{layer:null,complementaryLayer:null,delay:5,changeVisibilityDelay:5,aggressive:!1,changeVisibility:!1,value:null,inverse:!1,constructor:function(a){a.layer&&(this.layer=this.getLayer(a.layer),this.bind(),this.complementaryLayer=this.getLayer(a.complementaryLayer),void 0!==a.inverse&&(this.inverse=a.inverse),a.value=void 0!==a.value?a.value:this.getOpacityValue(this.layer),delete a.layer,delete a.complementaryLayer),GeoExt.LayerOpacitySlider.superclass.constructor.call(this,a)},bind:function(){this.layer&&this.layer.map&&this.layer.map.events.on({changelayer:this.update,scope:this})},unbind:function(){this.layer&&this.layer.map&&this.layer.map.events&&this.layer.map.events.un({changelayer:this.update,scope:this})},update:function(a){"opacity"!==a.property||a.layer!=this.layer||this._settingOpacity||this.setValue(this.getOpacityValue(this.layer))},setLayer:function(a){this.unbind(),this.layer=this.getLayer(a),this.setValue(this.getOpacityValue(a)),this.bind()},getOpacityValue:function(a){var b;return b=a&&null!==a.opacity?parseInt(a.opacity*(this.maxValue-this.minValue)):this.maxValue,this.inverse===!0&&(b=this.maxValue-this.minValue-b),b},getLayer:function(a){return a instanceof OpenLayers.Layer?a:a instanceof GeoExt.data.LayerRecord?a.getLayer():void 0},initComponent:function(){GeoExt.LayerOpacitySlider.superclass.initComponent.call(this),this.changeVisibility&&this.layer&&(0==this.layer.opacity||this.inverse===!1&&this.value==this.minValue||this.inverse===!0&&this.value==this.maxValue)&&this.layer.setVisibility(!1),this.complementaryLayer&&(this.layer&&1==this.layer.opacity||this.inverse===!1&&this.value==this.maxValue||this.inverse===!0&&this.value==this.minValue)&&this.complementaryLayer.setVisibility(!1),this.aggressive===!0?this.on("change",this.changeLayerOpacity,this,{buffer:this.delay}):this.on("changecomplete",this.changeLayerOpacity,this),this.changeVisibility===!0&&this.on("change",this.changeLayerVisibility,this,{buffer:this.changeVisibilityDelay}),this.complementaryLayer&&this.on("change",this.changeComplementaryLayerVisibility,this,{buffer:this.changeVisibilityDelay}),this.on("beforedestroy",this.unbind,this)},changeLayerOpacity:function(a,b){this.layer&&(b/=this.maxValue-this.minValue,this.inverse===!0&&(b=1-b),this._settingOpacity=!0,this.layer.setOpacity(b),delete this._settingOpacity)},changeLayerVisibility:function(a,b){var c=this.layer.getVisibility();this.inverse===!1&&b==this.minValue||this.inverse===!0&&b==this.maxValue&&c===!0?this.layer.setVisibility(!1):(this.inverse===!1&&b>this.minValue||this.inverse===!0&&b<this.maxValue&&0==c)&&this.layer.setVisibility(!0)},changeComplementaryLayerVisibility:function(a,b){var c=this.complementaryLayer.getVisibility();this.inverse===!1&&b==this.maxValue||this.inverse===!0&&b==this.minValue&&c===!0?this.complementaryLayer.setVisibility(!1):(this.inverse===!1&&b<this.maxValue||this.inverse===!0&&b>this.minValue&&0==c)&&this.complementaryLayer.setVisibility(!0)},addToMapPanel:function(a){this.on({render:function(){var b=this.getEl();b.setStyle({position:"absolute",zIndex:a.map.Z_INDEX_BASE.Control}),b.on({mousedown:this.stopMouseEvents,click:this.stopMouseEvents})},scope:this})},removeFromMapPanel:function(){var a=this.getEl();a.un({mousedown:this.stopMouseEvents,click:this.stopMouseEvents,scope:this}),this.unbind()},stopMouseEvents:function(a){a.stopEvent()}}),Ext.reg("gx_opacityslider",GeoExt.LayerOpacitySlider),Ext.namespace("GeoExt.data"),GeoExt.data.AttributeReader=function(a,b){a=a||{},a.format||(a.format=new OpenLayers.Format.WFSDescribeFeatureType),GeoExt.data.AttributeReader.superclass.constructor.call(this,a,b||a.fields),a.feature&&this.recordType.prototype.fields.add(new Ext.data.Field("value"))},Ext.extend(GeoExt.data.AttributeReader,Ext.data.DataReader,{read:function(a){var b=a.responseXML;return b&&b.documentElement||(b=a.responseText),this.readRecords(b)},readRecords:function(a){var b;b=a instanceof Array?a:this.meta.format.read(a).featureTypes[0].properties;for(var c,d,e,f,g,h,i=this.meta.feature,j=this.recordType,k=j.prototype.fields,l=k.length,m=[],n=0,o=b.length;o>n;++n){f=!1,c=b[n],d={};for(var p=0;l>p;++p){if(h=k.items[p],e=h.name,g=h.convert(c[e]),this.ignoreAttribute(e,g)){f=!0;break}d[e]=g}i&&(g=i.attributes[d.name],void 0!==g&&(this.ignoreAttribute("value",g)?f=!0:d.value=g)),f||(m[m.length]=new j(d))}return{success:!0,records:m,totalRecords:m.length}},ignoreAttribute:function(a,b){var c=!1;if(this.meta.ignore&&this.meta.ignore[a]){var d=this.meta.ignore[a];"string"==typeof d?c=d===b:d instanceof Array?c=d.indexOf(b)>-1:d instanceof RegExp&&(c=d.test(b))}return c}}),Ext.namespace("GeoExt.grid"),GeoExt.grid.SymbolizerColumn=Ext.extend(Ext.grid.Column,{renderer:function(a,b){if(null!=a){var c=Ext.id();return window.setTimeout(function(){var b=Ext.get(c);b&&new GeoExt.FeatureRenderer({symbolizers:a instanceof Array?a:[a],renderTo:b})},0),b.css="gx-grid-symbolizercol",'<div id="'+c+'"></div>'}}}),Ext.grid.Column.types.gx_symbolizercolumn=GeoExt.grid.SymbolizerColumn,Ext.namespace("GeoExt.plugins"),GeoExt.plugins.TreeNodeComponent=Ext.extend(Ext.util.Observable,{constructor:function(a){Ext.apply(this.initialConfig,Ext.apply({},a)),Ext.apply(this,a),GeoExt.plugins.TreeNodeComponent.superclass.constructor.apply(this,arguments)},init:function(a){a.on({rendernode:this.onRenderNode,beforedestroy:this.onBeforeDestroy,scope:this})},onRenderNode:function(a){var b=a.rendered,c=a.attributes,d=c.component||this.component;if(!b&&d){var e=Ext.DomHelper.append(a.ui.elNode,[{tag:"div"}]);"function"==typeof d?d=d(a,e):"object"==typeof d&&"function"==typeof d.fn&&(d=d.fn.apply(d.scope,[a,e])),"object"==typeof d&&"string"==typeof d.xtype&&(d=Ext.ComponentMgr.create(d)),d instanceof Ext.Component&&(d.render(e),a.component=d)}},onBeforeDestroy:function(a){a.un("rendernode",this.onRenderNode,this),a.un("beforedestroy",this.onBeforeDestroy,this)}}),Ext.preg("gx_treenodecomponent",GeoExt.plugins.TreeNodeComponent),Ext.namespace("GeoExt"),GeoExt.ZoomSliderTip=Ext.extend(GeoExt.SliderTip,{template:"<div>Zoom Level: {zoom}</div><div>Resolution: {resolution}</div><div>Scale: 1 : {scale}</div>",compiledTemplate:null,init:function(a){this.compiledTemplate=new Ext.Template(this.template),GeoExt.ZoomSliderTip.superclass.init.call(this,a)},getText:function(a){var b={zoom:a.value,resolution:this.slider.getResolution(),scale:Math.round(this.slider.getScale())};return this.compiledTemplate.apply(b)}}),Ext.namespace("GeoExt.data"),GeoExt.data.PrintProvider=Ext.extend(Ext.util.Observable,{url:null,capabilities:null,method:"POST",encoding:document.charset||document.characterSet||"UTF-8",timeout:3e4,customParams:null,scales:null,dpis:null,layouts:null,dpi:null,layout:null,constructor:function(a){this.initialConfig=a,Ext.apply(this,a),this.customParams||(this.customParams={}),this.addEvents("loadcapabilities","layoutchange","dpichange","beforeprint","print","printexception","beforeencodelayer","encodelayer","beforedownload"),GeoExt.data.PrintProvider.superclass.constructor.apply(this,arguments),this.scales=new Ext.data.JsonStore({root:"scales",sortInfo:{field:"value",direction:"DESC"},fields:["name",{name:"value",type:"float"}]}),this.dpis=new Ext.data.JsonStore({root:"dpis",fields:["name",{name:"value",type:"float"}]}),this.layouts=new Ext.data.JsonStore({root:"layouts",fields:["name",{name:"size",mapping:"map"},{name:"rotation",type:"boolean"}]}),a.capabilities?this.loadStores():(this.url.split("/").pop()&&(this.url+="/"),this.initialConfig.autoLoad&&this.loadCapabilities())},setLayout:function(a){this.layout=a,this.fireEvent("layoutchange",this,a)},setDpi:function(a){this.dpi=a,this.fireEvent("dpichange",this,a)},print:function(a,b,c){if(a instanceof GeoExt.MapPanel&&(a=a.map),b=b instanceof Array?b:[b],c=c||{},this.fireEvent("beforeprint",this,a,b,c)!==!1){var d=Ext.apply({units:a.getUnits(),srs:a.baseLayer.projection.getCode(),layout:this.layout.get("name"),dpi:this.dpi.get("value")},this.customParams),e=b[0].feature.layer,f=[],g=a.layers.concat();g.remove(a.baseLayer),g.unshift(a.baseLayer),Ext.each(g,function(a){if(a!==e&&a.getVisibility()===!0){var b=this.encodeLayer(a);b&&f.push(b)}},this),d.layers=f;var h=[];if(Ext.each(b,function(a){h.push(Ext.apply({center:[a.center.lon,a.center.lat],scale:a.scale.get("value"),rotation:a.rotation},a.customParams))},this),d.pages=h,c.overview){var i=[];Ext.each(c.overview.layers,function(a){var b=this.encodeLayer(a);b&&i.push(b)},this),d.overviewLayers=i}if(c.legend){var j=c.legend,k=j.rendered;k||(j=j.cloneConfig({renderTo:document.body,hidden:!0}));var l=[];j.items&&j.items.each(function(a){if(!a.hidden){var b=this.encoders.legends[a.getXType()];l=l.concat(b.call(this,a,d.pages[0].scale))}},this),k||j.destroy(),d.legends=l}if("GET"===this.method){var m=Ext.urlAppend(this.capabilities.printURL,"spec="+encodeURIComponent(Ext.encode(d)));this.download(m)}else Ext.Ajax.request({url:this.capabilities.createURL,timeout:this.timeout,jsonData:d,headers:{"Content-Type":"application/json; charset="+this.encoding},success:function(a){var b=Ext.decode(a.responseText).getURL;this.download(b)},failure:function(a){this.fireEvent("printexception",this,a)},params:this.initialConfig.baseParams,scope:this})}},download:function(a){this.fireEvent("beforedownload",this,a)!==!1&&(Ext.isOpera?window.open(a):window.location.href=a),this.fireEvent("print",this,a)},loadCapabilities:function(){if(this.url){var a=this.url+"info.json";Ext.Ajax.request({url:a,method:"GET",disableCaching:!1,success:function(a){this.capabilities=Ext.decode(a.responseText),this.loadStores()},params:this.initialConfig.baseParams,scope:this})}},loadStores:function(){this.scales.loadData(this.capabilities),this.dpis.loadData(this.capabilities),this.layouts.loadData(this.capabilities),this.setLayout(this.layouts.getAt(0)),this.setDpi(this.dpis.getAt(0)),this.fireEvent("loadcapabilities",this,this.capabilities)},encodeLayer:function(a){var b;for(var c in this.encoders.layers)if(OpenLayers.Layer[c]&&a instanceof OpenLayers.Layer[c]){if(this.fireEvent("beforeencodelayer",this,a)===!1)return;b=this.encoders.layers[c].call(this,a),this.fireEvent("encodelayer",this,a,b);break}return b&&b.type?b:null},getAbsoluteUrl:function(a){var b;return Ext.isIE6||Ext.isIE7||Ext.isIE8?(b=document.createElement("<a href='"+a+"'/>"),b.style.display="none",document.body.appendChild(b),b.href=b.href,document.body.removeChild(b)):(b=document.createElement("a"),b.href=a),b.href},encoders:{layers:{Layer:function(a){var b={};return a.options&&a.options.maxScale&&(b.minScaleDenominator=a.options.maxScale),a.options&&a.options.minScale&&(b.maxScaleDenominator=a.options.minScale),b},WMS:function(a){var b=this.encoders.layers.HTTPRequest.call(this,a);Ext.apply(b,{type:"WMS",layers:[a.params.LAYERS].join(",").split(","),format:a.params.FORMAT,styles:[a.params.STYLES].join(",").split(",")});var c;for(var d in a.params)c=d.toLowerCase(),a.DEFAULT_PARAMS[c]||-1!="layers,styles,width,height,srs".indexOf(c)||(b.customParams||(b.customParams={}),b.customParams[d]=a.params[d]);return b},OSM:function(a){var b=this.encoders.layers.TileCache.call(this,a);return Ext.apply(b,{type:"OSM",baseURL:b.baseURL.substr(0,b.baseURL.indexOf("$")),extension:"png"})},TMS:function(a){var b=this.encoders.layers.TileCache.call(this,a);return Ext.apply(b,{type:"TMS",format:a.type})},TileCache:function(a){var b=this.encoders.layers.HTTPRequest.call(this,a);return Ext.apply(b,{type:"TileCache",layer:a.layername,maxExtent:a.maxExtent.toArray(),tileSize:[a.tileSize.w,a.tileSize.h],extension:a.extension,resolutions:a.serverResolutions||a.resolutions})},WMTS:function(a){var b=this.encoders.layers.HTTPRequest.call(this,a);return Ext.apply(b,{type:"WMTS",layer:a.layer,version:a.version,requestEncoding:a.requestEncoding,tileOrigin:[a.tileOrigin.lon,a.tileOrigin.lat],tileSize:[a.tileSize.w,a.tileSize.h],style:a.style,formatSuffix:a.formatSuffix,dimensions:a.dimensions,params:a.params,maxExtent:null!=a.tileFullExtent?a.tileFullExtent.toArray():a.maxExtent.toArray(),matrixSet:a.matrixSet,zoomOffset:a.zoomOffset,resolutions:a.serverResolutions||a.resolutions})},KaMapCache:function(a){var b=this.encoders.layers.KaMap.call(this,a);return Ext.apply(b,{type:"KaMapCache",group:a.params.g,metaTileWidth:a.params.metaTileSize.w,metaTileHeight:a.params.metaTileSize.h})},KaMap:function(a){var b=this.encoders.layers.HTTPRequest.call(this,a);return Ext.apply(b,{type:"KaMap",map:a.params.map,extension:a.params.i,group:a.params.g||"",maxExtent:a.maxExtent.toArray(),tileSize:[a.tileSize.w,a.tileSize.h],resolutions:a.serverResolutions||a.resolutions})},HTTPRequest:function(a){var b=this.encoders.layers.Layer.call(this,a);return Ext.apply(b,{baseURL:this.getAbsoluteUrl(a.url instanceof Array?a.url[0]:a.url),opacity:null!=a.opacity?a.opacity:1,singleTile:a.singleTile})},Image:function(a){var b=this.encoders.layers.Layer.call(this,a);return Ext.apply(b,{type:"Image",baseURL:this.getAbsoluteUrl(a.getURL(a.extent)),opacity:null!=a.opacity?a.opacity:1,extent:a.extent.toArray(),pixelSize:[a.size.w,a.size.h],name:a.name})},Vector:function(a){if(a.features.length){for(var b,c,d,e,f,g=[],h={},i=a.features,j=new OpenLayers.Format.GeoJSON,k=new OpenLayers.Format.JSON,l=1,m={},n=0,o=i.length;o>n;++n){b=i[n],c=b.style||a.style||a.styleMap.createSymbolizer(b,b.renderIntent),d=k.write(c),e=m[d],e?f=e:(m[d]=f=l++,h[f]=c.externalGraphic?Ext.applyIf({externalGraphic:this.getAbsoluteUrl(c.externalGraphic)},c):c);var p=j.extract.feature.call(j,b);p.properties=OpenLayers.Util.extend({_gx_style:f},p.properties),g.push(p)
}var q=this.encoders.layers.Layer.call(this,a);return Ext.apply(q,{type:"Vector",styles:h,styleProperty:"_gx_style",geoJson:{type:"FeatureCollection",features:g},name:a.name,opacity:null!=a.opacity?a.opacity:1})}},Markers:function(a){for(var b=[],c=0,d=a.markers.length;d>c;c++){var e=a.markers[c],f=new OpenLayers.Geometry.Point(e.lonlat.lon,e.lonlat.lat),g={externalGraphic:e.icon.url,graphicWidth:e.icon.size.w,graphicHeight:e.icon.size.h,graphicXOffset:e.icon.offset.x,graphicYOffset:e.icon.offset.y},h=new OpenLayers.Feature.Vector(f,{},g);b.push(h)}var i=new OpenLayers.Layer.Vector(a.name);i.addFeatures(b);var j=this.encoders.layers.Vector.call(this,i);return i.destroy(),j}},legends:{gx_wmslegend:function(a,b){for(var c=this.encoders.legends.base.call(this,a),d=[],e=1,f=a.items.getCount();f>e;++e){var g=a.items.get(e).url;if(a.useScaleParameter===!0&&-1!=g.toLowerCase().indexOf("request=getlegendgraphic")){var h=g.split("?"),i=Ext.urlDecode(h[1]);i.SCALE=b,g=h[0]+"?"+Ext.urlEncode(i)}d.push(this.getAbsoluteUrl(g))}return c[0].classes[0]={name:"",icons:d},c},gx_urllegend:function(a){var b=this.encoders.legends.base.call(this,a);return b[0].classes.push({name:"",icon:this.getAbsoluteUrl(a.items.get(1).url)}),b},base:function(a){return[{name:a.getLabel(),classes:[]}]}}}}),Ext.namespace("GeoExt"),GeoExt.MapPanel=Ext.extend(Ext.Panel,{map:null,layers:null,center:null,zoom:null,extent:null,prettyStateKeys:!1,stateEvents:["aftermapmove","afterlayervisibilitychange","afterlayeropacitychange","afterlayerorderchange","afterlayernamechange","afterlayeradd","afterlayerremove"],initComponent:function(){this.map instanceof OpenLayers.Map||(this.map=new OpenLayers.Map(Ext.applyIf(this.map||{},{allOverlays:!0})));var a=this.layers;(!a||a instanceof Array)&&(this.layers=new GeoExt.data.LayerStore({layers:a,map:this.map.layers.length>0?this.map:null})),"string"==typeof this.center?this.center=OpenLayers.LonLat.fromString(this.center):this.center instanceof Array&&(this.center=new OpenLayers.LonLat(this.center[0],this.center[1])),"string"==typeof this.extent?this.extent=OpenLayers.Bounds.fromString(this.extent):this.extent instanceof Array&&(this.extent=OpenLayers.Bounds.fromArray(this.extent)),GeoExt.MapPanel.superclass.initComponent.call(this),this.addEvents("aftermapmove","afterlayervisibilitychange","afterlayeropacitychange","afterlayerorderchange","afterlayernamechange","afterlayeradd","afterlayerremove"),this.map.events.on({moveend:this.onMoveend,changelayer:this.onChangelayer,addlayer:this.onAddlayer,removelayer:this.onRemovelayer,scope:this})},onMoveend:function(){this.fireEvent("aftermapmove")},onChangelayer:function(a){a.property&&("visibility"===a.property?this.fireEvent("afterlayervisibilitychange"):"order"===a.property?this.fireEvent("afterlayerorderchange"):"name"===a.property?this.fireEvent("afterlayernamechange"):"opacity"===a.property&&this.fireEvent("afterlayeropacitychange"))},onAddlayer:function(){this.fireEvent("afterlayeradd")},onRemovelayer:function(){this.fireEvent("afterlayerremove")},applyState:function(a){this.center=new OpenLayers.LonLat(a.x,a.y),this.zoom=a.zoom;var b,c,d,e,f,g,h=this.map.layers;for(b=0,c=h.length;c>b;b++)d=h[b],e=this.prettyStateKeys?d.name:d.id,f=a["visibility_"+e],void 0!==f&&(f=/^true$/i.test(f),d.isBaseLayer?f&&this.map.setBaseLayer(d):d.setVisibility(f)),g=a["opacity_"+e],void 0!==g&&d.setOpacity(g)},getState:function(){var a;if(this.map){var b=this.map.getCenter();a=b?{x:b.lon,y:b.lat,zoom:this.map.getZoom()}:{};var c,d,e,f,g=this.map.layers;for(c=0,d=g.length;d>c;c++)e=g[c],f=this.prettyStateKeys?e.name:e.id,a["visibility_"+f]=e.getVisibility(),a["opacity_"+f]=null==e.opacity?1:e.opacity;return a}},updateMapSize:function(){this.map&&this.map.updateSize()},renderMap:function(){var a=this.map;a.render(this.body.dom),this.layers.bind(a),a.layers.length>0?this.setInitialExtent():this.layers.on("add",this.setInitialExtent,this,{single:!0})},setInitialExtent:function(){var a=this.map;this.center||null!=this.zoom?a.setCenter(this.center,this.zoom):this.extent?a.zoomToExtent(this.extent):a.zoomToMaxExtent()},afterRender:function(){GeoExt.MapPanel.superclass.afterRender.apply(this,arguments),this.ownerCt?(this.ownerCt.on("move",this.updateMapSize,this),this.ownerCt.on({afterlayout:this.afterLayout,scope:this})):this.renderMap()},afterLayout:function(){var a=this.getInnerWidth()-this.body.getBorderWidth("lr"),b=this.getInnerHeight()-this.body.getBorderWidth("tb");a>0&&b>0&&(this.ownerCt.un("afterlayout",this.afterLayout,this),this.renderMap())},onResize:function(){GeoExt.MapPanel.superclass.onResize.apply(this,arguments),this.updateMapSize()},onBeforeAdd:function(a){"function"==typeof a.addToMapPanel&&a.addToMapPanel(this),GeoExt.MapPanel.superclass.onBeforeAdd.apply(this,arguments)},remove:function(a){"function"==typeof a.removeFromMapPanel&&a.removeFromMapPanel(this),GeoExt.MapPanel.superclass.remove.apply(this,arguments)},beforeDestroy:function(){this.ownerCt&&this.ownerCt.un("move",this.updateMapSize,this),this.map&&this.map.events&&this.map.events.un({moveend:this.onMoveend,changelayer:this.onChangelayer,addlayer:this.onAddlayer,removelayer:this.onRemovelayer,scope:this}),this.initialConfig.map&&this.initialConfig.map instanceof OpenLayers.Map||this.map&&this.map.destroy&&this.map.destroy(),delete this.map,GeoExt.MapPanel.superclass.beforeDestroy.apply(this,arguments)}}),GeoExt.MapPanel.guess=function(){return Ext.ComponentMgr.all.find(function(a){return a instanceof GeoExt.MapPanel})},Ext.reg("gx_mappanel",GeoExt.MapPanel),Ext.namespace("GeoExt"),GeoExt.PrintMapPanel=Ext.extend(GeoExt.MapPanel,{sourceMap:null,printProvider:null,printPage:null,previewScales:null,center:null,zoom:null,extent:null,currentZoom:null,initComponent:function(){this.sourceMap instanceof GeoExt.MapPanel&&(this.sourceMap=this.sourceMap.map),this.map||(this.map={}),Ext.applyIf(this.map,{projection:this.sourceMap.getProjection(),maxExtent:this.sourceMap.getMaxExtent(),maxResolution:this.sourceMap.getMaxResolution(),units:this.sourceMap.getUnits()}),this.printProvider instanceof GeoExt.data.PrintProvider||(this.printProvider=new GeoExt.data.PrintProvider(this.printProvider)),this.printPage=new GeoExt.data.PrintPage({printProvider:this.printProvider}),this.previewScales=new Ext.data.Store,this.previewScales.add(this.printProvider.scales.getRange()),this.layers=[];Ext.each(this.sourceMap.layers,function(a){a.getVisibility()===!0&&this.layers.push(a.clone())},this),this.extent=this.sourceMap.getExtent(),GeoExt.PrintMapPanel.superclass.initComponent.call(this)},bind:function(){this.printPage.on("change",this.fitZoom,this),this.printProvider.on("layoutchange",this.syncSize,this),this.map.events.register("moveend",this,this.updatePage),this.printPage.fit(this.sourceMap),this.initialConfig.limitScales===!0&&(this.on("resize",this.calculatePreviewScales,this),this.calculatePreviewScales())},afterRender:function(){GeoExt.PrintMapPanel.superclass.afterRender.apply(this,arguments),this.syncSize(),this.ownerCt?this.ownerCt.on({afterlayout:{fn:this.bind,scope:this,single:!0}}):this.bind()},adjustSize:function(a,b){var c=this.printProvider.layout.get("size"),d=c.width/c.height,e=this.ownerCt,f=e&&e.autoWidth?0:a||this.initialConfig.width,g=e&&e.autoHeight?0:b||this.initialConfig.height;return f?(b=f/d,g&&b>g?(b=g,a=b*d):a=f):g&&(a=g*d,b=g),{width:a,height:b}},fitZoom:function(){if(!this._updating&&this.printPage.scale){this._updating=!0;var a=this.printPage.getPrintExtent(this.map);this.currentZoom=this.map.getZoomForExtent(a),this.map.zoomToExtent(a),delete this._updating}},updatePage:function(){if(!this._updating){var a=this.map.getZoom();this._updating=!0,a===this.currentZoom?this.printPage.setCenter(this.map.getCenter()):this.printPage.fit(this.map),delete this._updating,this.currentZoom=a}},calculatePreviewScales:function(){this.previewScales.removeAll(),this.printPage.suspendEvents();var a=this.printPage.scale,b=this.map.getSize(),c={},d=[];this.printProvider.scales.each(function(a){this.printPage.setScale(a);var e=this.printPage.getPrintExtent(this.map),f=this.map.getZoomForExtent(e),g=Math.max(e.getWidth()/b.w,e.getHeight()/b.h),h=this.map.getResolutionForZoom(f),i=Math.abs(g-h);(!(f in c)||c[f].diff>i)&&(c[f]={rec:a,diff:i},-1==d.indexOf(f)&&d.push(f))},this);for(var e=0,f=d.length;f>e;++e)this.previewScales.add(c[d[e]].rec);if(a&&this.printPage.setScale(a),this.printPage.resumeEvents(),a&&this.previewScales.getCount()>0){var g=this.previewScales.getAt(0),h=this.previewScales.getAt(this.previewScales.getCount()-1);a.get("value")<h.get("value")?this.printPage.setScale(h):a.get("value")>g.get("value")&&this.printPage.setScale(g)}this.fitZoom()},print:function(a){this.printProvider.print(this.map,[this.printPage],a)},beforeDestroy:function(){this.map.events.unregister("moveend",this,this.updatePage),this.printPage.un("change",this.fitZoom,this),this.printProvider.un("layoutchange",this.syncSize,this),GeoExt.PrintMapPanel.superclass.beforeDestroy.apply(this,arguments)}}),Ext.reg("gx_printmappanel",GeoExt.PrintMapPanel),Ext.namespace("GeoExt.data"),GeoExt.data.ScaleStore=Ext.extend(Ext.data.Store,{map:null,constructor:function(a){var b=a.map instanceof GeoExt.MapPanel?a.map.map:a.map;delete a.map,a=Ext.applyIf(a,{reader:new Ext.data.JsonReader({},["level","resolution","scale"])}),GeoExt.data.ScaleStore.superclass.constructor.call(this,a),b&&this.bind(b)},bind:function(a){this.map=a instanceof GeoExt.MapPanel?a.map:a,this.map.events.register("changebaselayer",this,this.populateFromMap),this.map.baseLayer?this.populateFromMap():this.map.events.register("addlayer",this,this.populateOnAdd)},unbind:function(){this.map&&(this.map.events.unregister("addlayer",this,this.populateOnAdd),this.map.events.unregister("changebaselayer",this,this.populateFromMap),delete this.map)},populateOnAdd:function(a){a.layer.isBaseLayer&&(this.populateFromMap(),this.map.events.unregister("addlayer",this,this.populateOnAdd))},populateFromMap:function(){for(var a=[],b=this.map.baseLayer.resolutions,c=this.map.baseLayer.units,d=b.length-1;d>=0;d--){var e=b[d];a.push({level:d,resolution:e,scale:OpenLayers.Util.getScaleFromResolution(e,c)})}this.loadData(a)},destroy:function(){this.unbind(),GeoExt.data.ScaleStore.superclass.destroy.apply(this,arguments)}}),Ext.namespace("GeoExt.data"),GeoExt.data.FeatureStoreMixin=function(){return{layer:null,reader:null,featureFilter:null,constructor:function(a){a=a||{},a.reader=a.reader||new GeoExt.data.FeatureReader({},a.fields);var b=a.layer;delete a.layer,a.features&&(a.data=a.features),delete a.features;var c={initDir:a.initDir};delete a.initDir,arguments.callee.superclass.constructor.call(this,a),b&&this.bind(b,c)},bind:function(a,b){if(!this.layer){this.layer=a,b=b||{};var c=b.initDir;void 0==b.initDir&&(c=GeoExt.data.FeatureStore.LAYER_TO_STORE|GeoExt.data.FeatureStore.STORE_TO_LAYER);var d=a.features.slice(0);if(c&GeoExt.data.FeatureStore.STORE_TO_LAYER)for(var e=this.getRange(),f=e.length-1;f>=0;f--)this.layer.addFeatures([e[f].getFeature()]);c&GeoExt.data.FeatureStore.LAYER_TO_STORE&&this.loadData(d,!0),a.events.on({featuresadded:this.onFeaturesAdded,featuresremoved:this.onFeaturesRemoved,featuremodified:this.onFeatureModified,scope:this}),this.on({load:this.onLoad,clear:this.onClear,add:this.onAdd,remove:this.onRemove,update:this.onUpdate,scope:this})}},unbind:function(){this.layer&&(this.layer.events.un({featuresadded:this.onFeaturesAdded,featuresremoved:this.onFeaturesRemoved,featuremodified:this.onFeatureModified,scope:this}),this.un("load",this.onLoad,this),this.un("clear",this.onClear,this),this.un("add",this.onAdd,this),this.un("remove",this.onRemove,this),this.un("update",this.onUpdate,this),this.layer=null)},getRecordFromFeature:function(a){return this.getByFeature(a)||null},getByFeature:function(a){var b;if(a.state!==OpenLayers.State.INSERT)b=this.getById(a.id);else{var c=this.findBy(function(b){return b.getFeature()===a});c>-1&&(b=this.getAt(c))}return b},onFeaturesAdded:function(a){if(!this._adding){var b=a.features,c=b;if(this.featureFilter){c=[];for(var d,e,f,d=0,e=b.length;e>d;d++)f=b[d],this.featureFilter.evaluate(f)!==!1&&c.push(f)}this._adding=!0,this.loadData(c,!0),delete this._adding}},onFeaturesRemoved:function(a){if(!this._removing){var b,c,d,e=a.features;for(d=e.length-1;d>=0;d--)b=e[d],c=this.getByFeature(b),void 0!==c&&(this._removing=!0,this.remove(c),delete this._removing)}},onFeatureModified:function(a){if(!this._updating){var b=a.feature,c=this.getByFeature(b);if(void 0!==c){c.beginEdit();var d=b.attributes;if(d)for(var e=this.recordType.prototype.fields,f=0,g=e.length;g>f;f++){var h=e.items[f],i=h.mapping||h.name;i in d&&c.set(h.name,h.convert(d[i]))}c.set("state",b.state),c.set("fid",b.fid),c.setFeature(b),this._updating=!0,c.endEdit(),delete this._updating}}},addFeaturesToLayer:function(a){var b,c,d;for(d=new Array(c=a.length),b=0;c>b;b++)d[b]=a[b].getFeature();d.length>0&&(this._adding=!0,this.layer.addFeatures(d),delete this._adding)},onLoad:function(a,b,c){c&&c.add===!0||(this._removing=!0,this.layer.removeFeatures(this.layer.features),delete this._removing,this.addFeaturesToLayer(b))},onClear:function(){this._removing=!0,this.layer.removeFeatures(this.layer.features),delete this._removing},onAdd:function(a,b){this._adding||this.addFeaturesToLayer(b)},onRemove:function(a,b){if(!this._removing){var c=b.getFeature();null!=this.layer.getFeatureById(c.id)&&(this._removing=!0,this.layer.removeFeatures([b.getFeature()]),delete this._removing)}},onUpdate:function(a,b){if(!this._updating){var c=(new GeoExt.data.FeatureRecord).fields,d=b.getFeature();if(d.state!==OpenLayers.State.INSERT&&(d.state=OpenLayers.State.UPDATE),b.fields){var e=this.layer.events.triggerEvent("beforefeaturemodified",{feature:d});if(e!==!1){var f=d.attributes;b.fields.each(function(a){var d=a.mapping||a.name;c.containsKey(d)||(f[d]=b.get(a.name))}),this._updating=!0,this.layer.events.triggerEvent("featuremodified",{feature:d}),delete this._updating,null!=this.layer.getFeatureById(d.id)&&this.layer.drawFeature(d)}}}},destroy:function(){this.unbind(),GeoExt.data.FeatureStore.superclass.destroy.call(this)}}},GeoExt.data.FeatureStore=Ext.extend(Ext.data.Store,new GeoExt.data.FeatureStoreMixin),GeoExt.data.FeatureStore.LAYER_TO_STORE=1,GeoExt.data.FeatureStore.STORE_TO_LAYER=2,Ext.namespace("GeoExt.data"),GeoExt.data.WFSCapabilitiesStore=function(a){a=a||{},GeoExt.data.WFSCapabilitiesStore.superclass.constructor.call(this,Ext.apply(a,{proxy:a.proxy||(a.data?void 0:new Ext.data.HttpProxy({url:a.url,disableCaching:!1,method:"GET"})),reader:new GeoExt.data.WFSCapabilitiesReader(a,a.fields)}))},Ext.extend(GeoExt.data.WFSCapabilitiesStore,Ext.data.Store),Ext.namespace("GeoExt.plugins"),GeoExt.plugins.AttributeForm=function(a){Ext.apply(this,a)},GeoExt.plugins.AttributeForm.prototype={attributeStore:null,formPanel:null,init:function(a){this.formPanel=a,this.attributeStore instanceof Ext.data.Store&&(this.fillForm(),this.bind(this.attributeStore)),a.on("destroy",this.onFormDestroy,this)},bind:function(a){this.unbind(),a.on({load:this.onLoad,scope:this}),this.attributeStore=a},unbind:function(){this.attributeStore&&this.attributeStore.un("load",this.onLoad,this)},onLoad:function(){this.formPanel.items&&this.formPanel.removeAll(),this.fillForm()},fillForm:function(){this.attributeStore.each(function(a){if("gc2_"!==a.data.name.substring(0,4)){var b=GeoExt.form.recordToField(a,Ext.apply({checkboxLabelProperty:"fieldLabel"},this.recordToFieldOptions||{}));b&&this.formPanel.add(b)}},this),this.formPanel.doLayout()},onFormDestroy:function(){this.unbind()}},Ext.preg("gx_attributeform",GeoExt.plugins.AttributeForm),Ext.namespace("GeoExt","GeoExt.data"),GeoExt.data.ProtocolProxy=function(a){Ext.apply(this,a),GeoExt.data.ProtocolProxy.superclass.constructor.apply(this,arguments)},Ext.extend(GeoExt.data.ProtocolProxy,Ext.data.DataProxy,{protocol:null,abortPrevious:!0,setParamsAsOptions:!1,response:null,load:function(a,b,c,d,e){if(this.fireEvent("beforeload",this,a)!==!1){var f={params:a||{},request:{callback:c,scope:d,arg:e},reader:b},g=OpenLayers.Function.bind(this.loadResponse,this,f);this.abortPrevious&&this.abortRequest();var h={params:a,callback:g,scope:this};Ext.applyIf(h,e),this.setParamsAsOptions===!0&&(Ext.applyIf(h,h.params),delete h.params),this.response=this.protocol.read(h)}else c.call(d||this,null,e,!1)},abortRequest:function(){this.response&&(this.protocol.abort(this.response),this.response=null)},loadResponse:function(a,b){if(b.success()){var c=a.reader.read(b);this.fireEvent("load",this,a,a.request.arg),a.request.callback.call(a.request.scope,c,a.request.arg,!0)}else this.fireEvent("loadexception",this,a,b),a.request.callback.call(a.request.scope,null,a.request.arg,!1)}}),Ext.namespace("GeoExt"),GeoExt.Action=Ext.extend(Ext.Action,{control:null,activateOnEnable:!1,deactivateOnDisable:!1,map:null,uScope:null,uHandler:null,uToggleHandler:null,uCheckHandler:null,constructor:function(a){this.uScope=a.scope,this.uHandler=a.handler,this.uToggleHandler=a.toggleHandler,this.uCheckHandler=a.checkHandler,a.scope=this,a.handler=this.pHandler,a.toggleHandler=this.pToggleHandler,a.checkHandler=this.pCheckHandler;var b=this.control=a.control;delete a.control,this.activateOnEnable=!!a.activateOnEnable,delete a.activateOnEnable,this.deactivateOnDisable=!!a.deactivateOnDisable,delete a.deactivateOnDisable,b&&(a.map&&(a.map.addControl(b),delete a.map),(a.pressed||a.checked)&&b.map&&b.activate(),b.active&&(a.pressed=!0,a.checked=!0),b.events.on({activate:this.onCtrlActivate,deactivate:this.onCtrlDeactivate,scope:this})),arguments.callee.superclass.constructor.call(this,a)},pHandler:function(){var a=this.control;a&&a.type==OpenLayers.Control.TYPE_BUTTON&&a.trigger(),this.uHandler&&this.uHandler.apply(this.uScope,arguments)},pToggleHandler:function(a,b){this.changeControlState(b),this.uToggleHandler&&this.uToggleHandler.apply(this.uScope,arguments)},pCheckHandler:function(a,b){this.changeControlState(b),this.uCheckHandler&&this.uCheckHandler.apply(this.uScope,arguments)},changeControlState:function(a){a?this._activating||(this._activating=!0,this.control.activate(),this.initialConfig.pressed=!0,this.initialConfig.checked=!0,this._activating=!1):this._deactivating||(this._deactivating=!0,this.control.deactivate(),this.initialConfig.pressed=!1,this.initialConfig.checked=!1,this._deactivating=!1)},onCtrlActivate:function(){var a=this.control;a.type==OpenLayers.Control.TYPE_BUTTON?this.enable():(this.safeCallEach("toggle",[!0]),this.safeCallEach("setChecked",[!0]))},onCtrlDeactivate:function(){var a=this.control;a.type==OpenLayers.Control.TYPE_BUTTON?this.disable():(this.safeCallEach("toggle",[!1]),this.safeCallEach("setChecked",[!1]))},safeCallEach:function(a,b){for(var c=this.items,d=0,e=c.length;e>d;d++)c[d][a]&&(c[d].rendered?c[d][a].apply(c[d],b):c[d].on({render:c[d][a].createDelegate(c[d],b),single:!0}))},setDisabled:function(a){return!a&&this.activateOnEnable&&this.control&&!this.control.active&&this.control.activate(),a&&this.deactivateOnDisable&&this.control&&this.control.active&&this.control.deactivate(),GeoExt.Action.superclass.setDisabled.apply(this,arguments)}}),Ext.namespace("GeoExt.tree"),GeoExt.tree.TreeNodeUIEventMixin=function(){return{constructor:function(a){a.addEvents("rendernode","rawclicknode"),this.superclass=arguments.callee.superclass,this.superclass.constructor.apply(this,arguments)},render:function(){this.rendered||(this.superclass.render.apply(this,arguments),this.fireEvent("rendernode",this.node))},onClick:function(a){this.fireEvent("rawclicknode",this.node,a)!==!1&&this.superclass.onClick.apply(this,arguments)}}},Ext.namespace("GeoExt.grid"),GeoExt.grid.FeatureSelectionModelMixin=function(){return{autoActivateControl:!0,layerFromStore:!0,selectControl:null,bound:!1,superclass:null,selectedFeatures:[],autoPanMapOnSelection:!1,constructor:function(a){if(a=a||{},a.selectControl instanceof OpenLayers.Control.SelectFeature){if(!a.singleSelect){var b=a.selectControl;a.singleSelect=!(b.multiple||b.multipleKey)}}else a.layer instanceof OpenLayers.Layer.Vector&&(this.selectControl=this.createSelectControl(a.layer,a.selectControl),delete a.layer,delete a.selectControl);a.autoPanMapOnSelection&&(this.autoPanMapOnSelection=!0,delete a.autoPanMapOnSelection),this.superclass=arguments.callee.superclass,this.superclass.constructor.call(this,a)},initEvents:function(){if(this.superclass.initEvents.call(this),this.layerFromStore){var a=this.grid.getStore()&&this.grid.getStore().layer;!a||this.selectControl instanceof OpenLayers.Control.SelectFeature||(this.selectControl=this.createSelectControl(a,this.selectControl))}this.selectControl&&this.bind(this.selectControl)},createSelectControl:function(a,b){b=b||{};var c=void 0!==b.singleSelect?b.singleSelect:this.singleSelect;b=OpenLayers.Util.extend({toggle:!0,multipleKey:c?null:Ext.isMac?"metaKey":"ctrlKey"},b);var d=new OpenLayers.Control.SelectFeature(a,b);return a.map.addControl(d),d},bind:function(a,b){if(!this.bound){b=b||{},this.selectControl=a,a instanceof OpenLayers.Layer.Vector&&(this.selectControl=this.createSelectControl(a,b.controlConfig)),this.autoActivateControl&&this.selectControl.activate();for(var c=this.getLayers(),d=0,e=c.length;e>d;d++)c[d].events.on({featureselected:this.featureSelected,featureunselected:this.featureUnselected,scope:this});this.on("rowselect",this.rowSelected,this),this.on("rowdeselect",this.rowDeselected,this),this.bound=!0}return this.selectControl},unbind:function(){var a=this.selectControl;if(this.bound){for(var b=this.getLayers(),c=0,d=b.length;d>c;c++)b[c].events.un({featureselected:this.featureSelected,featureunselected:this.featureUnselected,scope:this});this.un("rowselect",this.rowSelected,this),this.un("rowdeselect",this.rowDeselected,this),this.autoActivateControl&&a.deactivate(),this.selectControl=null,this.bound=!1}return a},featureSelected:function(a){if(!this._selecting){var b=this.grid.store,c=b.findBy(function(b){return b.getFeature()==a.feature});-1==c||this.isSelected(c)||(this._selecting=!0,this.selectRow(c,!this.singleSelect),this._selecting=!1,this.grid.getView().focusRow(c))}},featureUnselected:function(a){if(!this._selecting){var b=this.grid.store,c=b.findBy(function(b){return b.getFeature()==a.feature});-1!=c&&this.isSelected(c)&&(this._selecting=!0,this.deselectRow(c),this._selecting=!1,this.grid.getView().focusRow(c))}},rowSelected:function(a,b,c){var d=c.getFeature();if(!this._selecting&&d){for(var e=this.getLayers(),f=0,g=e.length;g>f;f++)if(-1==e[f].selectedFeatures.indexOf(d)){this._selecting=!0,this.selectControl.select(d),this._selecting=!1,this.selectedFeatures.push(d);break}this.autoPanMapOnSelection&&this.recenterToSelectionExtent()}},rowDeselected:function(a,b,c){var d=c.getFeature();if(!this._selecting&&d){for(var e=this.getLayers(),f=0,g=e.length;g>f;f++)if(-1!=e[f].selectedFeatures.indexOf(d)){this._selecting=!0,this.selectControl.unselect(d),this._selecting=!1,OpenLayers.Util.removeItem(this.selectedFeatures,d);break}this.autoPanMapOnSelection&&this.selectedFeatures.length>0&&this.recenterToSelectionExtent()}},getLayers:function(){return this.selectControl.layers||[this.selectControl.layer]},recenterToSelectionExtent:function(){var a=this.selectControl.map,b=this.getSelectionExtent(),c=a.getZoomForExtent(b,!1);c>a.getZoom()?a.setCenter(b.getCenterLonLat()):a.zoomToExtent(b)},getSelectionExtent:function(){var a=null,b=this.selectedFeatures;if(b&&b.length>0)for(var c=null,d=0,e=b.length;e>d;d++)c=b[d].geometry,c&&(null===a&&(a=new OpenLayers.Bounds),a.extend(c.getBounds()));return a}}},GeoExt.grid.FeatureSelectionModel=Ext.extend(Ext.grid.RowSelectionModel,new GeoExt.grid.FeatureSelectionModelMixin),Ext.namespace("GeoExt.data"),GeoExt.data.WMSCapabilitiesStore=function(a){a=a||{},GeoExt.data.WMSCapabilitiesStore.superclass.constructor.call(this,Ext.apply(a,{proxy:a.proxy||(a.data?void 0:new Ext.data.HttpProxy({url:a.url,disableCaching:!1,method:"GET"})),reader:new GeoExt.data.WMSCapabilitiesReader(a,a.fields)}))},Ext.extend(GeoExt.data.WMSCapabilitiesStore,Ext.data.Store),Ext.namespace("GeoExt"),GeoExt.LayerOpacitySliderTip=Ext.extend(GeoExt.SliderTip,{template:"<div>{opacity}%</div>",compiledTemplate:null,init:function(a){this.compiledTemplate=new Ext.Template(this.template),GeoExt.LayerOpacitySliderTip.superclass.init.call(this,a)},getText:function(a){var b={opacity:a.value};return this.compiledTemplate.apply(b)}}),GeoExt.version="1.1";var popup,scriptSource=function(a){"use strict";a=document.getElementsByTagName("script");var b=a[a.length-1];return void 0!==b.getAttribute.length?b.src:b.getAttribute("src",-1)}();"undefined"==typeof mygeocloud_host&&(window.mygeocloud_host="/"===scriptSource.charAt(0)?"":scriptSource.split("/")[0]+"//"+scriptSource.split("/")[2]),"undefined"==typeof jQuery&&document.write("<script src='//ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js'></script>"),"undefined"==typeof OpenLayers&&document.write("<script src='"+mygeocloud_host+"/js/OpenLayers-2.12/OpenLayers.gc2.js'></script>"),"undefined"==typeof Ext&&(document.write("<script src='"+mygeocloud_host+"/js/ext/adapter/ext/ext-base.js'></script>"),document.write("<script src='"+mygeocloud_host+"/js/ext/ext-all.js'></script>"),document.write("<script src='"+mygeocloud_host+"/js/GeoExt/script/GeoExt.js'></script>"));var mygeocloud_ol=function(){"use strict";var a,b=mygeocloud_host,c=function(a,c){var d,e=this,f={sql:null,onLoad:function(){},styleMap:null,projection:"900913",strategies:null,visibility:!0,rendererOptions:{zIndexing:!0},lifetime:0,movedEnd:function(){},selectControl:{},clientEncoding:"UTF8",jsonp:!0,method:"GET"};if(c)for(d in c)f[d]=c[d];this.sql=f.sql,this.onLoad=f.onLoad,this.movedEnd=f.movedEnd,this.map=null,this.layer=new OpenLayers.Layer.Vector("Vector",{styleMap:f.styleMap,visibility:f.visibility,rendererOptions:f.rendererOptions}),this.hide=function(){this.layer.setVisibility(!1)},this.show=function(){this.layer.setVisibility(!0)},this.pointControl=new OpenLayers.Control.DrawFeature(this.layer,OpenLayers.Handler.Point),this.lineControl=new OpenLayers.Control.DrawFeature(this.layer,OpenLayers.Handler.Path),this.polygonControl=new OpenLayers.Control.DrawFeature(this.layer,OpenLayers.Handler.Polygon),this.selectControl=new OpenLayers.Control.SelectFeature(this.layer,f.selectControl),this.selectControl.handlers.feature.stopDown=!1,this.modifyControl=new OpenLayers.Control.ModifyFeature(this.layer,{}),this.geoJSON={},this.featureStore=null,this.load=function(c){var d=this.sql;try{var g=e.map;d=d.replace("{centerX}",g.getCenter().lat.toString()),d=d.replace("{centerY}",g.getCenter().lon.toString()),d=d.replace("{minX}",g.getExtent().left),d=d.replace("{maxX}",g.getExtent().right),d=d.replace("{minY}",g.getExtent().bottom),d=d.replace("{maxY}",g.getExtent().top),d=d.replace("{bbox}",g.getExtent().toString())}catch(h){}$.ajax({dataType:f.jsonp?"jsonp":"json",data:"q="+encodeURIComponent(d)+"&srs="+f.projection+"&lifetime="+f.lifetime+"&client_encoding="+f.clientEncoding,jsonp:f.jsonp?"jsonp_callback":!1,url:b+"/api/v1/sql/"+a,type:f.method,success:function(a){a.success===!1&&void 0===c&&alert(a.message),a.success===!0&&null!==a.features&&(e.geoJSON=a,e.layer.addFeatures((new OpenLayers.Format.GeoJSON).read(a)),e.featureStore=new GeoExt.data.FeatureStore({fields:a.forStore,layer:e.layer}))},complete:function(){e.onLoad()}})},this.reset=function(){this.layer.destroyFeatures()},this.getWKT=function(){return(new OpenLayers.Format.WKT).write(this.layer.features)}};a=function(a,c,d){var e,f,g={numZoomLevels:20,projection:"EPSG:900913",maxExtent:new OpenLayers.Bounds(-20037508.34,-20037508.34,20037508.34,20037508.34),restrictedExtent:null,controls:[new OpenLayers.Control.Attribution,new OpenLayers.Control.Zoom,new OpenLayers.Control.TouchNavigation({dragPanOptions:{enableKinetic:!0}})]};if(d)for(e in d)g[e]=d[e];f=this,this.bingApiKey=null,this.layerStr="",this.db=c,this.geoLocation={x:null,y:null,obj:{}},this.zoomToExtent=function(a,b){a?this.map.zoomToExtent(new OpenLayers.Bounds(a),b):this.map.zoomToExtent(this.map.maxExtent)},this.zoomToExtentOfgeoJsonStore=function(a){this.map.zoomToExtent(a.layer.getDataExtent())},this.getVisibleLayers=function(){for(var a=[],b=0;b<this.map.layers.length;b++)this.map.layers[b].isBaseLayer===!1&&this.map.layers[b].visibility===!0&&"OpenLayers.Layer.WMS"===this.map.layers[b].CLASS_NAME&&a.push(this.map.layers[b].params.LAYERS);return a.join(";")},this.getZoom=function(){return this.map.getZoom()},this.getPixelCoord=function(a,b){var c={};return c.x=this.map.getPixelFromLonLat(new OpenLayers.LonLat(a,b)).x,c.y=this.map.getPixelFromLonLat(new OpenLayers.LonLat(a,b)).y,c},this.zoomToPoint=function(a,b,c){this.map.setCenter(new OpenLayers.LonLat(a,b),c)},this.clickController=OpenLayers.Class(OpenLayers.Control,{defaultHandlerOptions:{single:!0,"double":!1,pixelTolerance:0,stopSingle:!1,stopDouble:!1},initialize:function(){this.handlerOptions=OpenLayers.Util.extend({},this.defaultHandlerOptions),OpenLayers.Control.prototype.initialize.apply(this,arguments),this.handler=new OpenLayers.Handler.Click(this,{click:this.trigger},this.handlerOptions)},trigger:function(a){var b=this.map.getLonLatFromViewPortPx(a.xy);try{popup.destroy()}catch(a){}var d=this.map.getExtent(),e=d.toArray(),g=e.join(","),i=this.map.getSize(),j='<div style="position:relative;"><div></div><div id="queryResult" style="display: table"></div><button onclick="popup.destroy()" style="position:absolute; top: -10px; right: 5px" type="button" class="close" aria-hidden="true">&times;</button></div>',k=new OpenLayers.LonLat(b.lon,b.lat);popup=new OpenLayers.Popup.Anchored("result",k,new OpenLayers.Size(100,150),j,null,!1,null),popup.panMapIfOutOfView=!0,$.ajax({dataType:"jsonp",data:"proj=25832&lon="+b.lon+"&lat="+b.lat+"&layers="+f.getVisibleLayers()+"&extent="+g+"&width="+i.w+"&height="+i.h,jsonp:"jsonp_callback",url:"//plandk2.mapcentia.com/apps/viewer/servers/query/"+c,success:function(a){if(a.html!==!1&&""!==a.html){f.map.addPopup(popup),$("#queryResult").html(a.html);var b=$("#queryResult").width()+35;popup.destroy(),popup=new OpenLayers.Popup.Anchored("result",k,new OpenLayers.Size(b,150),j,null,!1,null),f.map.addPopup(popup),$("#queryResult").html(a.html)}else $("#alert").fadeIn(400).delay(1e3).fadeOut(400),h.removeAllFeatures()}})}}),this.map=new OpenLayers.Map(a,{controls:g.controls,numZoomLevels:g.numZoomLevels,projection:g.projection,maxResolution:g.maxResolution,minResolution:g.minResolution,maxExtent:g.maxExtent,restrictedExtent:g.restrictedExtent});this.map;this.click=new this.clickController,this.map.addControl(this.click);var h=new OpenLayers.Layer.Vector("Mark",{displayInLayerSwitcher:!1});this.map.addLayers([h]),this.addMapQuestOSM=function(){return this.mapQuestOSM=new OpenLayers.Layer.OSM("MapQuest-OSM",["http://otile1.mqcdn.com/tiles/1.0.0/osm/${z}/${x}/${y}.jpg","http://otile2.mqcdn.com/tiles/1.0.0/osm/${z}/${x}/${y}.jpg","http://otile3.mqcdn.com/tiles/1.0.0/osm/${z}/${x}/${y}.jpg","http://otile4.mqcdn.com/tiles/1.0.0/osm/${z}/${x}/${y}.jpg"]),this.map.addLayer(this.mapQuestOSM),this.mapQuestOSM},this.addMapQuestAerial=function(){return this.mapQuestAerial=new OpenLayers.Layer.OSM("MapQuest Open Aerial Tiles",["http://oatile1.mqcdn.com/tiles/1.0.0/sat/${z}/${x}/${y}.jpg","http://oatile2.mqcdn.com/tiles/1.0.0/sat/${z}/${x}/${y}.jpg","http://oatile3.mqcdn.com/tiles/1.0.0/sat/${z}/${x}/${y}.jpg","http://oatile4.mqcdn.com/tiles/1.0.0/sat/${z}/${x}/${y}.jpg"]),this.mapQuestAerial.wrapDateLine=!0,this.map.addLayer(this.mapQuestAerial),this.mapQuestAerial},this.addOSM=function(){return this.osm=new OpenLayers.Layer.OSM("OSM"),this.osm.wrapDateLine=!0,this.map.addLayer(this.osm),this.osm},this.addGoogleStreets=function(){try{this.baseGNORMAL=new OpenLayers.Layer.Google("Google Streets",{type:G_NORMAL_MAP,sphericalMercator:!0,wrapDateLine:!0,numZoomLevels:20})}catch(a){}try{this.baseGNORMAL=new OpenLayers.Layer.Google("Google Streets",{wrapDateLine:!0,numZoomLevels:20})
}catch(a){}return this.map.addLayer(this.baseGNORMAL),this.baseGNORMAL},this.addGoogleHybrid=function(){try{this.baseGHYBRID=new OpenLayers.Layer.Google("Google Hybrid",{type:G_HYBRID_MAP,sphericalMercator:!0,wrapDateLine:!0,numZoomLevels:20})}catch(a){}try{this.baseGHYBRID=new OpenLayers.Layer.Google("Google Hybrid",{type:google.maps.MapTypeId.HYBRID,wrapDateLine:!0,numZoomLevels:20})}catch(a){alert(a.message)}return this.map.addLayer(this.baseGHYBRID),this.baseGHYBRID},this.addGoogleSatellite=function(){try{this.baseGSATELLITE=new OpenLayers.Layer.Google("Google Satellite",{type:google.maps.MapTypeId.SATELLITE,wrapDateLine:!0,numZoomLevels:20})}catch(a){alert(a.message)}return this.map.addLayer(this.baseGSATELLITE),this.baseGSATELLITE},this.addGoogleTerrain=function(){try{this.baseGTERRAIN=new OpenLayers.Layer.Google("Google Terrain",{type:google.maps.MapTypeId.TERRAIN,wrapDateLine:!0,numZoomLevels:20})}catch(a){alert(a.message)}return this.map.addLayer(this.baseGTERRAIN),this.baseGTERRAIN},this.addBing=function(a){var b,c;switch(a){case"Road":c="Bing Road";break;case"Aerial":c="Bing Aerial";break;case"AerialWithLabels":c="Bing Aerial With Labels"}return b=new OpenLayers.Layer.Bing({name:c,wrapDateLine:!0,key:this.bingApiKey,type:a}),this.map.addLayer(b),b.baseLayer=!0,b.id=c,b},this.addStamenToner=function(){return this.stamenToner=new OpenLayers.Layer.Stamen("toner"),this.stamenToner.name="Stamen Toner",this.stamenToner.wrapDateLine=!0,this.map.addLayer(this.stamenToner),this.stamenToner},this.addYandex=function(){},this.addDtkSkaermkort=function(a,b){var c,d="//eu1.mapcentia.com/wms/dk/tilecache";return c=new OpenLayers.Layer.WMS(a,d,{layers:b},{wrapDateLine:!0,attribution:"&copy; Geodatastyrelsen"}),this.map.addLayer(c),c.baseLayer=!0,c.id=a,c},this.addHere=function(a){var b,c,d;switch(a){case"hereNormalNightGrey":c="Here Night",d="normal.night.grey";break;case"hereNormalDayGrey":c="Here Day",d="normal.day.grey"}return b=new OpenLayers.Layer.XYZ(a,"//1.base.maps.cit.api.here.com/maptile/2.1/maptile/newest/"+d+"/${z}/${x}/${y}/256/png8?app_id="+window.gc2Options.hereApp.App_Id+"&app_code="+window.gc2Options.hereApp.App_Code,{attribution:"&copy; Nokia</span>&nbsp;<a href='http://maps.nokia.com/services/terms' target='_blank' title='Terms of Use' style='color:#333;text-decoration: underline;'>Terms of Use</a></div> <img src='//api.maps.nokia.com/2.2.4/assets/ovi/mapsapi/by_here.png' border='0'>"}),this.map.addLayer(b),b.setVisibility(!1),b.baseLayer=!0,b.name=c,b.id=a,b},this.addDigitalGlobe=function(a){var b,c,d=this.digitalGlobeKey;switch(a){case"DigitalGlobe:Imagery":c="DigitalGlobe:ImageryTileService"}return b=new OpenLayers.Layer.XYZ(a,"https://services.digitalglobe.com/earthservice/wmtsaccess?CONNECTID="+d+"&Service=WMTS&REQUEST=GetTile&Version=1.0.0&Format=image/png&Layer="+c+"&TileMatrixSet=EPSG:3857&TileMatrix=EPSG:3857:${z}&TileRow=${y}&TileCol=${x}"),this.map.addLayer(b),b.baseLayer=!0,b.id=a,b},this.setBaseLayer=function(a){this.map.setBaseLayer(a)},this.addBaseLayer=function(a,b,c,d){var e;switch(a){case"osm":e=this.addOSM();break;case"mapQuestOSM":e=this.addMapQuestOSM();break;case"mapBoxNaturalEarth":e=this.addMapBoxNaturalEarth();break;case"stamenToner":e=this.addStamenToner();break;case"googleStreets":e=this.addGoogleStreets();break;case"googleHybrid":e=this.addGoogleHybrid();break;case"googleSatellite":e=this.addGoogleSatellite();break;case"googleTerrain":e=this.addGoogleTerrain();break;case"bingRoad":e=this.addBing("Road");break;case"bingAerial":e=this.addBing("Aerial");break;case"bingAerialWithLabels":e=this.addBing("AerialWithLabels");break;case"yandex":e=this.addYandex();break;case"dtkSkaermkort":e=this.addDtkSkaermkort("dtkSkaermkort","dtk_skaermkort");break;case"dtkSkaermkortDaempet":e=this.addDtkSkaermkort("dtkSkaermkortDaempet","dtk_skaermkort_daempet");break;case"DigitalGlobe:Imagery":e=this.addDigitalGlobe("DigitalGlobe:Imagery");break;case"hereNormalDayGrey":e=this.addHere("hereNormalDayGrey");break;case"hereNormalNightGrey":e=this.addHere("hereNormalNightGrey");break;default:e=this.addTileLayers([a],{db:b,isBaseLayer:!0,visibility:!1,wrapDateLine:!1,displayInLayerSwitcher:!0,name:d,altId:c})[0]}return e},this.addTileLayers=function(a,b){var c={db:this.db,singleTile:!1,opacity:1,isBaseLayer:!1,visibility:!0,wrapDateLine:!0,tileCached:!0,displayInLayerSwitcher:!0,name:null,altId:null};if(b)for(e in b)c[e]=b[e];for(var d=[],f=0;f<a.length;f++){var g=this.createTileLayer(a[f],c);this.map.addLayer(g),d.push(g)}return d},this.createTileLayer=function(a,c){var d,e=a.split(".");d=c.tileCached?b+"/wms/"+c.db+"/tilecache?":b+"/wms/"+c.db+"/"+e[0]+"?";var f=new OpenLayers.Layer.WMS(c.name,d,{layers:a,transparent:!0},c);return f.id=c.altId||a,f},this.addTileLayerGroup=function(a,b){var c={singleTile:!1,opacity:1,isBaseLayer:!1,visibility:!0,name:null,schema:null};if(b)for(e in b)c[e]=b[e];this.map.addLayer(this.createTileLayerGroup(a,c))},this.createTileLayerGroup=function(a,c){var d=new OpenLayers.Layer.WMS(c.name,b+"/wms/"+this.db+"/"+c.schema+"/?",{layers:a,transparent:!0},c);return d},this.addWmtsLayer=function(a){var b=null;a.options.tileSize=new OpenLayers.Size(256,256),a.options.tileOrigin=new OpenLayers.LonLat(this.map.maxExtent.left,this.map.maxExtent.top),a.options.tileFullExtent=this.map.maxExtent.clone();for(var c in a.options)a[c]=a.options[c];for(var d in a.params)a[d]=a.params[d];return null!=a.matrixIds&&a.matrixIds.indexOf(",")>0&&(a.matrixIds=a.matrixIds.split(",")),b=new OpenLayers.Layer.WMTS(a),this.map.addLayer(b),b},this.removeTileLayerByName=function(a){var b=this.map.getLayersByName(a);this.map.removeLayer(b[0])},this.addGeoJsonStore=function(a){a.map=this.map,this.map.addLayers([a.layer]),this.map.addControl(a.pointControl),this.map.addControl(a.lineControl),this.map.addControl(a.polygonControl),this.map.addControl(a.selectControl),this.map.addControl(a.modifyControl),this.map.events.register("moveend",null,a.movedEnd)},this.addControl=function(a){this.map.addControl(a);try{a.handlers.feature.stopDown=!1}catch(b){}return a.activate(),a},this.removeGeoJsonStore=function(a){this.map.removeLayer(a.layer)},this.hideLayer=function(a){this.map.getLayersByName(a)[0].setVisibility(!1)},this.showLayer=function(a){this.map.getLayersByName(a)[0].setVisibility(!0)},this.getCenter=function(){var a=this.map.center;return{x:a.lon,y:a.lat}},this.getExtent=function(){var a=this.map.getExtent();return a.toArray()},this.getBbox=function(){return this.map.getExtent().toString()};var i=new OpenLayers.Layer.Vector("geolocation_layer",{displayInLayerSwitcher:!1}),j=!0,k={fillColor:"#000",fillOpacity:.1,strokeWidth:0};this.map.addLayers([i]);var l,m;this.locate=function(a){var b={firstCallBack:function(){},trackCallBack:function(){}};if(a)for(e in a)b[e]=a[e];l=b.firstCallBack,m=b.trackCallBack,i.removeAllFeatures(),n.deactivate(),n.watch=!0,j=!0,n.activate()},this.stopLocate=function(){n.deactivate()};var n=new OpenLayers.Control.Geolocate({bind:!1,geolocationOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:7e3}});this.map.addControl(n),n.events.register("locationupdated",n,function(a){i.removeAllFeatures();var b=new OpenLayers.Feature.Vector(OpenLayers.Geometry.Polygon.createRegularPolygon(new OpenLayers.Geometry.Point(a.point.x,a.point.y),a.position.coords.accuracy/2,40,0),{},k);i.addFeatures([new OpenLayers.Feature.Vector(a.point,{},{graphicName:"cross",strokeColor:"#f00",strokeWidth:1,fillOpacity:0,pointRadius:10}),b]),f.geoLocation={x:a.point.x,y:a.point.y,obj:a},j?(this.map.zoomToExtent(i.getDataExtent()),o(b),j=!1,this.bind=!0,l()):m()}),n.events.register("locationfailed",this,function(){alert("No location")});var o=function(a){var b=a.geometry.getCentroid(),c=a.geometry.getBounds(),d=Math.abs((c.right-c.left)/2),e=0,f="up",g=function(){e>16&&clearInterval(window.resizeInterval);var c=.03*d,g=c/d;switch(e){case 4:case 12:f="down";break;case 8:f="up"}"up"!==f&&(g=-Math.abs(g)),a.geometry.resize(1+g,b),i.drawFeature(a),e++};window.resizeInterval=window.setInterval(g,50,b,d)}};var d=function(a,b,c){var d,e={height:300,selectControl:{onSelect:function(){},onUnselect:function(){}},columns:b.geoJSON.forGrid};if(c)for(d in c)e[d]=c[d];this.grid=new Ext.grid.GridPanel({id:"gridpanel",viewConfig:{forceFit:!0},store:b.featureStore,sm:new GeoExt.grid.FeatureSelectionModel({singleSelect:!1,selectControl:e.selectControl}),cm:new Ext.grid.ColumnModel({defaults:{sortable:!0,editor:{xtype:"textfield"}},columns:e.columns}),listeners:e.listeners}),this.panel=new Ext.Panel({renderTo:a,split:!0,frame:!1,border:!1,layout:"fit",collapsible:!1,collapsed:!1,height:e.height,items:[this.grid]}),this.grid.getSelectionModel().bind().handlers.feature.stopDown=!1,this.selectionModel=this.grid.getSelectionModel().bind()};return{geoJsonStore:c,map:a,grid:d,urlVars:function(){{var a={};window.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi,function(b,c,d){a[c]=d})}return a}(),pathName:window.location.pathname.split("/")}}(),geocloud;geocloud=function(){"use strict";var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o=function(a){a=document.getElementsByTagName("script");var b=a[a.length-1];return void 0!==b.getAttribute.length?b.src:b.getAttribute("src",-1)}(),p="osm",q="mapQuestOSM",r="mapBoxNaturalEarth",s="stamenToner",t="stamenTonerLite",u="googleStreets",v="googleHybrid",w="googleSatellite",x="googleTerrain",y="bingRoad",z="bingAerial",A="bingAerialWithLabels",B="dtkSkaermkort",C="dtkSkaermkortDaempet",D="DigitalGlobe:Imagery",E="hereNormalDayGrey",F="hereNormalNightGrey",G=void 0===window.mapAttribution?"Powered by <a target='_blank' href='//www.mapcentia.com/en/geocloud/geocloud.htm'>MapCentia GC2</a> ":window.mapAttribution,H=[156543.033928,78271.516964,39135.758482,19567.879241,9783.9396205,4891.96981025,2445.98490513,1222.99245256,611.496226281,305.748113141,152.87405657,76.4370282852,38.2185141426,19.1092570713,9.55462853565,4.77731426782,2.38865713391,1.19432856696,.597164283478,.298582141739,.149291],I={},J={};"undefined"==typeof window.geocloud_host&&(window.geocloud_host=n="/"===o.charAt(0)?"":o.split("/")[0]+"//"+o.split("/")[2]),n=window.geocloud_host,"object"!=typeof ol&&"object"!=typeof L&&"object"!=typeof OpenLayers&&alert("You need to load neither OpenLayers.js, ol3,js or Leaflet.js"),"object"==typeof OpenLayers&&(m="ol2"),"object"==typeof ol&&(m="ol3"),"object"==typeof L&&(m="leaflet"),"loading"===document.readyState&&"undefined"==typeof jQuery&&document.write("<script src='//ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js'></script>"),c=function(a,b){a.prototype=new b};var K={styleMap:null,visibility:!0,lifetime:0,host:n,db:null,sql:null,q:null,name:"Vector",id:null,rendererOptions:{zIndexing:!0},projection:"leaflet"===m?"4326":"900913",pointToLayer:function(a,b){return L.circleMarker(b)},onEachFeature:function(){},onLoad:function(){},index:"",type:"",size:100,clientEncoding:"UTF8",async:!0,jsonp:!0,method:"GET",clickable:!0,error:function(){}};return b=function(){this.hide=function(){this.layer.setVisibility(!1)},this.show=function(){this.layer.setVisibility(!0)},this.map=null,this.init=function(){switch(this.onLoad=this.defaults.onLoad,m){case"ol2":this.layer=new OpenLayers.Layer.Vector(this.defaults.name,{styleMap:this.defaults.styleMap,visibility:this.defaults.visibility,renderers:["Canvas","SVG","VML"],rendererOptions:this.defaults.rendererOptions});break;case"ol3":this.layer=new ol.layer.Vector({source:new ol.source.GeoJSON,style:this.defaults.styleMap}),this.layer.id=this.defaults.name;break;case"leaflet":this.layer=L.geoJson(null,{style:this.defaults.styleMap,pointToLayer:this.defaults.pointToLayer,onEachFeature:this.defaults.onEachFeature,clickable:this.defaults.clickable}),this.layer.id=this.defaults.name}},this.geoJSON=null,this.featureStore=null,this.reset=function(){switch(m){case"ol2":this.layer.destroyFeatures();break;case"leaflet":this.layer.clearLayers()}},this.isEmpty=function(){switch(m){case"ol2":return 0===this.layer.features.length?!0:!1;case"leaflet":return 0===Object.keys(this.layer._layers).length?!0:!1}},this.getWKT=function(){return(new OpenLayers.Format.WKT).write(this.layer.features)}},d=e=function(a){var b,c,d,e=this;if(this.defaults=$.extend({},K),a)for(b in a)this.defaults[b]=a[b];this.init(),this.name=this.defaults.name,this.id=this.defaults.id,this.sql=this.defaults.sql,this.db=this.defaults.db,this.host=this.defaults.host.replace("cdn.",""),this.onLoad=this.defaults.onLoad,this.dataType=this.defaults.dataType,this.async=this.defaults.async,this.jsonp=this.defaults.jsonp,this.method=this.defaults.method,this.load=function(a){try{c=e.map,d=this.sql,d=d.replace("{centerX}",c.getCenter().lat.toString()),d=d.replace("{centerY}",c.getCenter().lon.toString()),d=d.replace("{minX}",c.getExtent().left),d=d.replace("{maxX}",c.getExtent().right),d=d.replace("{minY}",c.getExtent().bottom),d=d.replace("{maxY}",c.getExtent().top),d=d.replace("{bbox}",c.getExtent().toString())}catch(b){}return $.ajax({dataType:this.defaults.jsonp?"jsonp":"json",async:this.defaults.async,data:"q="+encodeURIComponent(d)+"&srs="+this.defaults.projection+"&lifetime="+this.defaults.lifetime+"&srs="+this.defaults.projection+"&client_encoding="+this.defaults.clientEncoding,jsonp:this.defaults.jsonp?"jsonp_callback":!1,url:this.host+"/api/v1/sql/"+this.db,type:this.defaults.method,success:function(b){if(b.success===!1&&void 0===a&&alert(b.message),b.success===!0)if(null!==b.features)switch(e.geoJSON=b,m){case"ol2":e.layer.addFeatures((new OpenLayers.Format.GeoJSON).read(b));break;case"ol3":e.layer.getSource().addFeatures(new ol.source.GeoJSON({object:b.features[0]}));break;case"leaflet":e.layer.addData(b)}else e.geoJSON=null},error:this.defaults.error,complete:function(){e.onLoad()}}),this.layer}},f=function(a){var b,c=this;if(this.defaults=$.extend({},K),a)for(b in a)this.defaults[b]=a[b];this.init(),this.load=function(a){var b=this.defaults.q;try{var d=c.map;b=b.replace(/\{minX\}/g,d.getExtent().left),b=b.replace(/\{maxX\}/g,d.getExtent().right),b=b.replace(/\{minY\}/g,d.getExtent().bottom),b=b.replace(/\{maxY\}/g,d.getExtent().top),b=b.replace(/\{bbox\}/g,d.getExtent().toString())}catch(e){}return $.ajax({dataType:"jsonp",data:"search="+encodeURIComponent(b),jsonp:"jsonp_callback",url:this.defaults.host+"/api/v1/twitter/"+this.db,success:function(b){if(b.success===!1&&void 0===a&&alert(b.message),b.success===!0&&null!==b.features)switch(c.geoJSON=b,m){case"ol2":c.layer.addFeatures((new OpenLayers.Format.GeoJSON).read(b));break;case"leaflet":c.layer.addData(b)}},complete:function(){c.onLoad()}}),this.layer}},g=function(a){var b,c=this;if(this.defaults=$.extend({},K),a)for(b in a)this.defaults[b]=a[b];this.init(),this.q=this.defaults.q,this.db=this.defaults.db,this.host=this.defaults.host.replace("cdn.",""),this.onLoad=this.defaults.onLoad,this.total=0,this.size=this.defaults.size,this.dataType=this.defaults.dataType,this.async=this.defaults.async,this.jsonp=this.defaults.jsonp,this.method=this.defaults.method,this.load=function(){var a=c.map,b=this.q;try{b=b.replace("{minX}",a.getExtent().left),b=b.replace("{maxX}",a.getExtent().right),b=b.replace("{minY}",a.getExtent().bottom),b=b.replace("{maxY}",a.getExtent().top),b=b.replace("{bbox}",a.getExtent().toString())}catch(d){}return $.ajax({method:this.method,dataType:this.jsonp?"jsonp":"json",async:this.async,jsonp:this.jsonp?"jsonp_callback":!1,data:"q="+encodeURIComponent(b)+"&size="+this.size,url:this.defaults.host+"/api/v1/elasticsearch/search/"+this.defaults.db+"/"+this.defaults.index+"/"+this.defaults.type,success:function(a){if("undefined"!=typeof a.error)return!1;var b=[],d={};if(c.total=a.hits.total,$.each(a.hits.hits,function(a,c){b.push(c._source)}),d.features=b,null!==a.features)switch(c.geoJSON=d,m){case"ol2":c.layer.addFeatures((new OpenLayers.Format.GeoJSON).read(d));break;case"leaflet":c.layer.addData(d)}},complete:function(a){c.onLoad(a)}}),this.layer}},c(e,b),c(f,b),c(g,b),h=function(a){var b,c={host:n,layer:null,db:null,singleTile:!1,opacity:1,wrapDateLine:!0,tileCached:!0,name:null,isBaseLayer:!1,resolutions:H};if(a)for(b in a)c[b]=a[b];return i(c.layer,c)},i=function(a,b){var c,d,e,f;if(c=a.split("."),b.tileCached){e=b.host+"/wms/"+b.db+"/tilecache";var g=e,h=e,i=e;f=[g.replace("cdn.","cdn1."),h.replace("cdn.","cdn2."),i.replace("cdn.","cdn3.")],e=e.replace("cdn.","{s}.")}else e=b.host+"/wms/"+b.db+"/"+c[0]+"?",f=[e];switch(m){case"ol2":d=new OpenLayers.Layer.WMS(b.name,f,{layers:a,transparent:!0},b),d.id=a;break;case"ol3":d=new ol.layer.Tile({source:new ol.source.TileWMS({url:e,params:{LAYERS:a}}),visible:b.visibility}),d.id=a;break;case"leaflet":d=new L.TileLayer.WMS(e,{layers:a,format:"image/png",transparent:!0,subdomains:["cdn1","cdn2","cdn3"],maxZoom:20}),d.id=a}return d},j=function(a,b){var c,d,e;d=b.host+"/wms/"+b.db+"/tilecache/";var f=d,g=d,h=d;switch(e=[f.replace("cdn.","cdn1."),g.replace("cdn.","cdn2."),h.replace("cdn.","cdn3.")],d=d.replace("cdn.","{s}."),m){case"ol2":c=new OpenLayers.Layer.TMS(b.name,e,{layername:a,type:"png",resolutions:b.resolutions,isBaseLayer:b.isBaseLayer}),c.id=a;break;case"ol3":break;case"leaflet":c=new L.TileLayer(d+"1.0.0/"+a+"/{z}/{x}/{y}.png",{tms:!0,maxZoom:20}),c.id=a}return c},a=function(a){var b,c,d=[],e={numZoomLevels:20,projection:"EPSG:900913",fadeAnimation:!0,zoomAnimation:!0,showLayerSwitcher:!1};if(a)for(b in a)e[b]=a[b];switch("leaflet"===m&&$("<link/>").attr({rel:"stylesheet",type:"text/css",href:n+"/js/leaflet/leaflet.css"}).appendTo("head"),this.bingApiKey=null,this.digitalGlobeKey=null,this.zoomToExtent=function(a,b){var c,d;switch(m){case"ol2":a?this.map.zoomToExtent(new OpenLayers.Bounds(a),b):this.map.zoomToExtent(this.map.maxExtent);break;case"ol3":a?this.map.zoomToExtent(new OpenLayers.Bounds(a),b):(this.map.getView().setCenter([0,0]),this.map.getView().setResolution(39136));break;case"leaflet":a?(c=l(a[0],a[1],"EPSG:900913","EPSG:4326"),d=l(a[2],a[3],"EPSG:900913","EPSG:4326"),this.map.fitBounds([[c.y,c.x],[d.y,d.x]])):this.map.fitWorld()}},this.zoomToExtentOfgeoJsonStore=function(a){switch(m){case"ol2":this.map.zoomToExtent(a.layer.getDataExtent());break;case"leaflet":this.map.fitBounds(a.layer.getBounds())}},this.getBaseLayers=function(a){var b=[];switch(m){case"ol2":for(var c=0;c<this.map.layers.length;c++)this.map.layers[c].isBaseLayer===!0&&(a&&(this.map.layers[c].map=null),b.push(this.map.layers[c]));break;case"leaflet":var d=this.map._layers;for(var e in d)d.hasOwnProperty(e)&&d[e].baseLayer===!0&&b.push(d)}return b},this.getActiveBaseLayer=function(){var a=c._layers;for(var b in a)if(a.hasOwnProperty(b)){var d=a[b];if(!d.overlay&&c._map.hasLayer(d.layer))return d}throw new Error("Control doesn't have any active base layer!")},this.getVisibleLayers=function(a){a=a===!0?!0:!1;var b,c=[];switch(m){case"ol2":for(b=0;b<this.map.layers.length;b++)this.map.layers[b].isBaseLayer!==a&&this.map.layers[b].isBaseLayer!==!1&&null!==this.map.layers[b].isBaseLayer||this.map.layers[b].visibility!==!0||"OpenLayers.Layer.WMS"!==this.map.layers[b].CLASS_NAME||c.push(this.map.layers[b].params.LAYERS);break;case"ol3":for(b=0;b<this.map.getLayers().getLength();b++)this.map.getLayers().a[b].e.visible===!0&&this.map.getLayers().a[b].baseLayer!==!0&&c.push(this.map.getLayers().a[b].id);break;case"leaflet":var d=this.map._layers;for(var e in d)d.hasOwnProperty(e)&&(d[e].baseLayer!==a&&d[e].baseLayer!==!1&&null!==d[e].baseLayer||"object"!=typeof d[e]._tiles||c.push(d[e].id))}return c.join(";")},this.getNamesOfVisibleLayers=function(){var a,b=[];switch(m){case"ol2":for(a=0;a<this.map.layers.length;a++)this.map.layers[a].isBaseLayer===!1&&this.map.layers[a].visibility===!0&&"OpenLayers.Layer.WMS"===this.map.layers[a].CLASS_NAME&&b.push(this.map.layers[a].name);break;case"ol3":for(a=0;a<this.map.getLayers().getLength();a++)this.map.getLayers().a[a].t.visible===!0&&this.map.getLayers().a[a].baseLayer!==!0&&b.push(this.map.getLayers().a[a].id);break;case"leaflet":var c=this.map._layers;for(var d in c)c.hasOwnProperty(d)&&c[d].baseLayer!==!0&&"object"==typeof c[d]._tiles&&b.push(c[d].id)}return b.length>0?b.join(","):!1},this.getBaseLayer=function(){return this.map.baseLayer},this.getBaseLayerName=function(){var a,b;switch(m){case"ol2":a=this.map.baseLayer.name;break;case"ol3":b=this.map.getLayers();for(var c=0;c<b.getLength();c++)b.a[c].t.visible===!0&&b.a[c].baseLayer===!0&&(a=this.map.getLayers().a[c].id);break;case"leaflet":b=this.map._layers;for(var d in b)b.hasOwnProperty(d)&&b[d].baseLayer===!0&&(a=b[d].id)}return a},this.getZoom=function(){var a;switch(m){case"ol2":a=this.map.getZoom();break;case"ol3":var b=this.getResolution();a=Math.round(Math.log(2*Math.PI*6378137/(256*b))/Math.LN2);break;case"leaflet":a=this.map.getZoom()}return a},this.getResolution=function(){return this.map.getView().getResolution()},this.getPixelCoord=function(a,b){var c={};return c.x=this.map.getPixelFromLonLat(new OpenLayers.LonLat(a,b)).x,c.y=this.map.getPixelFromLonLat(new OpenLayers.LonLat(a,b)).y,c},this.zoomToPoint=function(a,b,c){switch(m){case"ol2":this.map.setCenter(new OpenLayers.LonLat(a,b),c);break;case"ol3":this.map.getView().setCenter([a,b]);var d;d=2*Math.PI*6378137/(256*Math.pow(2,c)),this.map.getView().setResolution(d);break;case"leaflet":var e=l(a,b,"EPSG:900913","EPSG:4326");this.map.setView([e.y,e.x],c)}},this.setView=function(a,b){this.map.setView(a,b)},m){case"ol2":var f=[new OpenLayers.Control.Zoom,new OpenLayers.Control.Attribution,new OpenLayers.Control.TouchNavigation({dragPanOptions:{enableKinetic:!0}})];e.showLayerSwitcher&&f.push(new OpenLayers.Control.LayerSwitcher),this.map=new OpenLayers.Map(e.el,{controls:f,numZoomLevels:e.numZoomLevels,projection:e.projection,maxResolution:e.maxResolution,minResolution:e.minResolution,maxExtent:e.maxExtent,eventListeners:e.eventListeners});break;case"ol3":this.map=new ol.Map({target:e.el,view:new ol.View2D({})});break;case"leaflet":this.map=new L.map(e.el,e),c=L.control.layers([],[]),this.map.addControl(c),this.map.attributionControl.setPrefix(G)}this.map;this.addMapQuestOSM=function(){switch(m){case"ol2":this.mapQuestOSM=new OpenLayers.Layer.OSM("mapQuestOSM",["http://otile1.mqcdn.com/tiles/1.0.0/osm/${z}/${x}/${y}.jpg","http://otile2.mqcdn.com/tiles/1.0.0/osm/${z}/${x}/${y}.jpg","http://otile3.mqcdn.com/tiles/1.0.0/osm/${z}/${x}/${y}.jpg","http://otile4.mqcdn.com/tiles/1.0.0/osm/${z}/${x}/${y}.jpg"]),this.mapQuestOSM.wrapDateLine=!1,this.map.addLayer(this.mapQuestOSM),this.mapQuestOSM.setVisibility(!1);break;case"ol3":this.mapQuestOSM=new ol.layer.TileLayer({source:new ol.source.MapQuestOSM,visible:!1}),this.map.addLayer(this.mapQuestOSM);break;case"leaflet":this.mapQuestOSM=new L.tileLayer("http://otile1.mqcdn.com/tiles/1.0.0/osm/{z}/{x}/{y}.jpg",{attribution:"&copy; <a target='_blank' href='http://www.openstreetmap.org/copyright'>OpenStreetMap</a> contributors",maxZoom:20,maxNativeZoom:18}),c.addBaseLayer(this.mapQuestOSM,"MapQuest OSM")}return this.mapQuestOSM.baseLayer=!0,this.mapQuestOSM.id="mapQuestOSM",this.mapQuestOSM},this.addMapQuestAerial=function(){switch(m){case"ol2":this.mapQuestAerial=new OpenLayers.Layer.OSM("mapQuestAerial",["http://oatile1.mqcdn.com/tiles/1.0.0/sat/${z}/${x}/${y}.jpg","http://oatile2.mqcdn.com/tiles/1.0.0/sat/${z}/${x}/${y}.jpg","http://oatile3.mqcdn.com/tiles/1.0.0/sat/${z}/${x}/${y}.jpg","http://oatile4.mqcdn.com/tiles/1.0.0/sat/${z}/${x}/${y}.jpg"]),this.mapQuestAerial.wrapDateLine=!1,this.map.addLayer(this.mapQuestAerial),this.mapQuestAerial.setVisibility(!1);break;case"ol3":this.mapQuestAerial=new ol.layer.TileLayer({source:new ol.source.MapQuestOpenAerial,visible:!1}),this.map.addLayer(this.mapQuestAerial);break;case"leaflet":this.mapQuestAerial=new L.tileLayer("http://oatile1.mqcdn.com/tiles/1.0.0/sat/{z}/{x}/{y}.jpg",{maxZoom:20,maxNativeZoom:18}),c.addBaseLayer(this.mapQuestAerial,"Map Quest Aerial")}return this.mapQuestAerial.baseLayer=!0,this.mapQuestAerial.id="mapQuestAerial",this.mapQuestAerial},this.addOSM=function(){switch(m){case"ol2":this.osm=new OpenLayers.Layer.OSM("osm"),this.osm.wrapDateLine=!1,this.map.addLayer(this.osm),this.osm.setVisibility(!1);break;case"ol3":this.osm=new ol.layer.Tile({source:new ol.source.OSM,visible:!1}),this.map.addLayer(this.osm);break;case"leaflet":this.osm=new L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:"&copy; <a target='_blank' href='http://www.openstreetmap.org/copyright'>OpenStreetMap</a> contributors",maxZoom:20,maxNativeZoom:18}),c.addBaseLayer(this.osm,"OSM")}return this.osm.baseLayer=!0,this.osm.id="osm",this.osm},this.addStamen=function(a){var b,d;switch(a){case"toner":b="stamenToner",d="Stamen Toner";break;case"toner-lite":b="stamenTonerLite",d="Stamen Toner Lite"}switch(m){case"ol2":this.stamenToner=new OpenLayers.Layer.Stamen(a),this.stamenToner.name=b,this.map.addLayer(this.stamenToner),this.stamenToner.setVisibility(!1);break;case"ol3":this.stamenToner=new ol.layer.TileLayer({source:new ol.source.Stamen({layer:a}),visible:!1}),this.map.addLayer(this.stamenToner);break;case"leaflet":try{this.stamenToner=new L.StamenTileLayer(a),c.addBaseLayer(this.stamenToner,d)}catch(e){}}return this.stamenToner.baseLayer=!0,this.stamenToner.id=b,this.stamenToner},this.addMapBoxNaturalEarth=function(){switch(m){case"ol2":this.mapBoxNaturalEarth=new OpenLayers.Layer.XYZ("mapBoxNaturalEarth",["//a.tiles.mapbox.com/v3/mapbox.natural-earth-hypso-bathy/${z}/${x}/${y}.png","//b.tiles.mapbox.com/v3/mapbox.natural-earth-hypso-bathy/${z}/${x}/${y}.png","//c.tiles.mapbox.com/v3/mapbox.natural-earth-hypso-bathy/${z}/${x}/${y}.png","//d.tiles.mapbox.com/v3/mapbox.natural-earth-hypso-bathy/${z}/${x}/${y}.png"]),this.mapBoxNaturalEarth.wrapDateLine=!1,this.map.addLayer(this.mapBoxNaturalEarth),this.mapBoxNaturalEarth.setVisibility(!1);break;case"ol3":this.mapBoxNaturalEarth=new ol.layer.TileLayer({source:new ol.source.OSM,visible:!1}),this.map.addLayer(this.mapBoxNaturalEarth);break;case"leaflet":this.mapBoxNaturalEarth=new L.tileLayer("https://a.tiles.mapbox.com/v3/mapbox.natural-earth-hypso-bathy/{z}/{x}/{y}.png"),c.addBaseLayer(this.mapBoxNaturalEarth,"Mapbox Natural Earth")}return this.mapBoxNaturalEarth.baseLayer=!0,this.mapBoxNaturalEarth.id="mapBoxNaturalEarth",this.mapBoxNaturalEarth},this.addGoogle=function(a){var b,d,e,f=this;switch(a){case"ROADMAP":d="googleStreets",e="Google Streets";break;case"HYBRID":d="googleHybrid",e="Google Hybrid";break;case"SATELLITE":d="googleSatellite",e="Google Satellite";break;case"TERRAIN":d="googleTerrain",e="Google Terrain"}"undefined"!=typeof window.GoogleMapsDirty||"undefined"!=typeof google&&"undefined"!=typeof google.maps?"undefined"==typeof window.GoogleMapsDirty&&window.gc2SetLGoogle():(window.GoogleMapsDirty=!0,jQuery.getScript("https://maps.googleapis.com/maps/api/js?v=3.exp&sensor=false&callback=gc2SetLGoogle")),function g(){if("undefined"!=typeof google&&"undefined"!=typeof google.maps&&"undefined"!=typeof google.maps.Map){switch(m){case"ol2":b=new OpenLayers.Layer.Google(d,{type:google.maps.MapTypeId[a],wrapDateLine:!0,numZoomLevels:20,title:e}),f.map.addLayer(b),b.setVisibility(!1),b.baseLayer=!0,b.id=d;break;case"leaflet":b=new L.Google(a),b.baseLayer=!0,c.addBaseLayer(b,e),b.id=d}return I[d]=!0,b}setTimeout(g,50)}()},this.addBing=function(a){var b,d,e;switch(a){case"Road":d="bingRoad",e="Bing Road";break;case"Aerial":d="bingAerial",e="Bing Aerial";break;case"AerialWithLabels":d="bingAerialWithLabels",e="Bing Aerial w Labels"}switch(m){case"ol2":return b=new OpenLayers.Layer.Bing({name:d,wrapDateLine:!0,key:window.bingApiKey||this.bingApiKey,type:a}),this.map.addLayer(b),b.setVisibility(!1),b.baseLayer=!0,b.id=d,b;case"leaflet":return b=new L.BingLayer(this.bingApiKey||window.bingApiKey,{type:a,maxZoom:20,maxNativeZoom:18}),b.baseLayer=!0,c.addBaseLayer(b,e),b.id=d,b}},this.addDigitalGlobe=function(a){var b,d,e,f=this.digitalGlobeKey;switch(a){case"DigitalGlobe:Imagery":d="DigitalGlobe:ImageryTileService",e="Digital Globe"}switch(m){case"ol2":b=new OpenLayers.Layer.XYZ(a,"https://services.digitalglobe.com/earthservice/wmtsaccess?CONNECTID="+f+"&Service=WMTS&REQUEST=GetTile&Version=1.0.0&Format=image/png&Layer="+d+"&TileMatrixSet=EPSG:3857&TileMatrix=EPSG:3857:${z}&TileRow=${y}&TileCol=${x}",{resolutions:H}),this.map.addLayer(b),b.setVisibility(!1);break;case"leaflet":b=new L.TileLayer("https://services.digitalglobe.com/earthservice/wmtsaccess?CONNECTID="+f+"&Service=WMTS&REQUEST=GetTile&Version=1.0.0&Format=image/png&Layer="+d+"&TileMatrixSet=EPSG:3857&TileMatrix=EPSG:3857:{z}&TileRow={y}&TileCol={x}",{maxZoom:20}),c.addBaseLayer(b,e)}return b.baseLayer=!0,b.id=a,b},this.addHere=function(a){var b,d,e;switch(a){case"hereNormalNightGrey":d="normal.night.grey",e="HERE Normal Night Grey";break;case"hereNormalDayGrey":d="normal.day.grey",e="HERE Normal day Grey"}switch(m){case"ol2":b=new OpenLayers.Layer.XYZ(a,"https://1.base.maps.cit.api.here.com/maptile/2.1/maptile/newest/"+d+"/${z}/${x}/${y}/256/png8?app_id="+window.gc2Options.hereApp.App_Id+"&app_code="+window.gc2Options.hereApp.App_Code,{attribution:"&copy; Nokia</span>&nbsp;<a href='http://maps.nokia.com/services/terms' target='_blank' title='Terms of Use' style='color:#333;text-decoration: underline;'>Terms of Use</a></div> <img src='//api.maps.nokia.com/2.2.4/assets/ovi/mapsapi/by_here.png' border='0'>",resolutions:H}),this.map.addLayer(b),b.setVisibility(!1);break;case"leaflet":b=new L.TileLayer("https://{s}.base.maps.cit.api.here.com/maptile/2.1/maptile/newest/"+d+"/{z}/{x}/{y}/256/png8?app_id="+window.gc2Options.hereApp.App_Id+"&app_code="+window.gc2Options.hereApp.App_Code,{maxZoom:20,subdomains:["1","2","3","4"],attribution:"&copy; Nokia</span>&nbsp;<a href='http://maps.nokia.com/services/terms' target='_blank' title='Terms of Use' style='color:#333;text-decoration: underline;'>Terms of Use</a></div> <img src='https://api.maps.nokia.com/2.2.4/assets/ovi/mapsapi/by_here.png' border='0'>"}),c.addBaseLayer(b,e)}return b.baseLayer=!0,b.id=a,b},this.addDtkSkaermkort=function(a,b){var d,e="http://cdn.eu1.mapcentia.com/wms/dk/tilecache/";switch(m){case"ol2":d=new OpenLayers.Layer.TMS(a,e,{layername:b,type:"png",attribution:"&copy; Geodatastyrelsen",resolutions:H,wrapDateLine:!0}),this.map.addLayer(d),d.setVisibility(!1);break;case"leaflet":e=e.replace("cdn.","{s}."),d=new L.TileLayer(e+"1.0.0/"+b+"/{z}/{x}/{y}.png",{tms:!0,subdomains:["cdn1","cdn2","cdn3"],attribution:"&copy; Geodatastyrelsen",maxZoom:20}),c.addBaseLayer(d)}return d.baseLayer=!0,d.id=a,d},this.addYandex=function(a){var b,d;switch(a){case"map":b="yandexMap",d="Yandex Map";break;case"satellite":b="yandexSatellite",d="Yandex Satellite";break;case"hybrid":b="yandexHybrid",d="Yandex Hybrid";break;case"publicMap":b="yandexPublicMap",d="Yandex Public Map";break;case"publicMapHybrid":b="yandexPublicMapHybrid",d="Yandex Public Map Hybrid"}"undefined"!=typeof window.YandexMapsDirty||"undefined"!=typeof ymaps&&"undefined"!=typeof ymaps.Map||(window.YandexMapsDirty=!0,jQuery.getScript("https://api-maps.yandex.ru/2.0-stable/?load=package.standard&lang=ru-RU")),function e(){if("undefined"!=typeof ymaps&&"undefined"!=typeof ymaps.Map)switch(m){case"leaflet":return this.yandex=new L.Yandex(a),J[b]=!0,c.addBaseLayer(this.yandex,d),this.yandex.baseLayer=!0,this.yandex.id=b,this.yandex}else setTimeout(e,100)}()},this.setBaseLayer=function(a){var b,d=this;!function e(){if(a.search("google")>-1&&void 0!==I[a]||a.search("yandex")>-1&&void 0!==J[a]||-1===a.search("google")&&-1===a.search("yandex"))switch(m){case"ol2":d.showLayer(a),d.map.setBaseLayer(d.getLayersByName(a));break;case"ol3":b=d.map.getLayers();for(var f=0;f<b.getLength();f++)b.a[f].baseLayer===!0&&b.a[f].set("visible",!1);d.getLayersByName(a).set("visible",!0);break;case"leaflet":b=c._layers;for(var g in b)b.hasOwnProperty(g)&&(b[g].layer.baseLayer===!0&&d.map.hasLayer(b[g].layer)&&d.map.removeLayer(b[g].layer),b[g].layer.baseLayer===!0&&b[g].layer.id===a&&(-1===a.search("google")&&-1===a.search("yandex")&&b[g].layer.setZIndex(1),d.map.addLayer(b[g].layer,!1)))
}else setTimeout(e,200)}()},this.addBaseLayer=function(a,b){var c;switch(a){case"osm":c=this.addOSM();break;case"mapQuestOSM":c=this.addMapQuestOSM();break;case"addMapQuestAerial":c=this.addMapQuestAerial();break;case"mapBoxNaturalEarth":c=this.addMapBoxNaturalEarth();break;case"stamenToner":c=this.addStamen("toner");break;case"stamenTonerLite":c=this.addStamen("toner-lite");break;case"googleStreets":c=this.addGoogle("ROADMAP");break;case"googleHybrid":c=this.addGoogle("HYBRID");break;case"googleSatellite":c=this.addGoogle("SATELLITE");break;case"googleTerrain":c=this.addGoogle("TERRAIN");break;case"bingRoad":c=this.addBing("Road");break;case"bingAerial":c=this.addBing("Aerial");break;case"bingAerialWithLabels":c=this.addBing("AerialWithLabels");break;case"yandexMap":c=this.addYandex("map");break;case"yandexSatellite":c=this.addYandex("satellite");break;case"yandexHybrid":c=this.addYandex("hybrid");break;case"yandexPublicMap":c=this.addYandex("publicMap");break;case"yandexPublicMapHybrid":c=this.addYandex("publicMapHybrid");break;case"dtkSkaermkort":c=this.addDtkSkaermkort("dtkSkaermkort","dtk_skaermkort");break;case"dtkSkaermkortDaempet":c=this.addDtkSkaermkort("dtkSkaermkortDaempet","dtk_skaermkort_daempet");break;case"DigitalGlobe:Imagery":c=this.addDigitalGlobe("DigitalGlobe:Imagery");break;case"hereNormalDayGrey":c=this.addHere("hereNormalDayGrey");break;case"hereNormalNightGrey":c=this.addHere("hereNormalNightGrey");break;default:this.addTileLayers({layers:[a],db:b,isBaseLayer:!0,visibility:!1,wrapDateLine:!1,displayInLayerSwitcher:!0,name:a,type:"tms"})}return c},this.addTileLayers=function(a){var d={host:n,layers:[],db:null,singleTile:!1,opacity:1,isBaseLayer:!1,visibility:!0,wrapDateLine:!0,tileCached:!0,displayInLayerSwitcher:!0,name:null,names:[],resolutions:H,type:"wms"};if(a)for(b in a)d[b]=a[b];for(var e=d.layers,f=[],g=0;g<e.length;g++){var h;switch(d.type){case"wms":h=i(e[g],d);break;case"tms":h=j(e[g],d);break;default:h=i(e[g],d)}switch(h.baseLayer=d.isBaseLayer,m){case"ol2":this.map.addLayer(h);break;case"ol3":this.map.addLayer(h);break;case"leaflet":d.isBaseLayer===!0?c.addBaseLayer(h,d.name||d.names[g]):c.addOverlay(h,d.name||d.names[g]||e[g]),d.visibility===!0&&this.showLayer(e[g])}f.push(h)}return f},this.removeTileLayerByName=function(a){switch(m){case"ol2":var b=this.map.getLayersByName(a);this.map.removeLayer(b[0]);break;case"leaflet":this.map.removeLayer(this.getLayersByName(a)),c.removeLayer(this.getLayersByName(a))}},this.setZIndexOfLayer=function(a,b){switch(m){case"ol2":break;case"leaflet":a.setZIndex(b)}},this.addGeoJsonStore=function(a){switch(a.map=this,m){case"ol2":this.map.addLayers([a.layer]);break;case"ol3":this.map.addLayer(a.layer);break;case"leaflet":c.addOverlay(a.layer,a.name),this.showLayer(a.layer.id)}},this.addHeatMap=function(a,b,c,d){var e=[],f=a.geoJSON.features;b=b||1,c=c||1,d=d||{};for(var g in f)f.hasOwnProperty(g)&&(f[g].geometry.coordinates.reverse(),f[g].geometry.coordinates.push(f[g].properties[b]*c+""),e.push(f[g].geometry.coordinates));a.layer=L.heatLayer(e,d),this.addGeoJsonStore(a)},this.removeGeoJsonStore=function(a){switch(m){case"ol2":this.map.removeLayer(a.layer);break;case"leaflet":this.map.removeLayer(a.layer)}},this.hideLayer=function(a){switch(m){case"ol2":this.getLayersByName(a).setVisibility(!1);break;case"ol3":this.getLayersByName(a).set("visible",!1);break;case"leaflet":this.map.removeLayer(this.getLayersByName(a))}},this.showLayer=function(a){switch(m){case"ol2":this.getLayersByName(a).setVisibility(!0);break;case"ol3":this.getLayersByName(a).set("visible",!0);break;case"leaflet":this.getLayersByName(a).addTo(this.map)}},this.getLayerById=function(a){return this.map.getLayer(a)},this.getLayersByName=function(a){var b;switch(m){case"ol2":b=this.map.getLayersByName(a)[0];break;case"ol3":for(var d=0;d<this.map.getLayers().getLength();d++)this.map.getLayers().a[d].id===a&&(b=this.map.getLayers().a[d]);break;case"leaflet":var e=c._layers;for(var f in e)e.hasOwnProperty(f)&&e[f].layer.id===a&&(b=e[f].layer)}return b},this.hideAllTileLayers=function(){for(var a=0;a<this.map.layers.length;a++)this.map.layers[a].isBaseLayer===!1&&"OpenLayers.Layer.WMS"===this.map.layers[a].CLASS_NAME&&this.map.layers[a].setVisibility(!1)},this.getCenter=function(){var a;switch(m){case"ol2":return a=this.map.center,{x:a.lon,y:a.lat};case"ol3":return a=this.map.getView().getCenter(),{x:a[0],y:a[1]};case"leaflet":a=this.map.getCenter();var b=l(a.lng,a.lat,"EPSG:4326","EPSG:900913");return{x:b.x,y:b.y,lon:a.lng,lat:a.lat}}},this.getExtent=function(){var a,b;switch(m){case"ol2":a=this.map.getExtent(),b=a.toArray();break;case"ol3":break;case"leaflet":a=this.map.getBounds().toBBoxString().split(","),b={left:a[0],right:a[2],top:a[3],bottom:a[1]}}return b},this.getBbox=function(){return this.map.getExtent().toString()},this.locate=function(){this.map.locate({setView:!0})},this.addLayerFromWkt=function(a){switch(m){case"ol2":this.removeQueryLayers();for(var b,c,e,f=new OpenLayers.Format.WKT,g=0;g<a.length;g++)b=f.read(a[g]),d[g]=new OpenLayers.Layer.Vector(null,{displayInLayerSwitcher:!1,styleMap:new OpenLayers.StyleMap({"default":new OpenLayers.Style({strokeColor:"#000000",strokeWidth:3,fillOpacity:0,strokeOpacity:.8})})}),c=b.geometry.transform(new OpenLayers.Projection("EPSG:4326"),new OpenLayers.Projection("EPSG:900913")),e=new OpenLayers.Feature.Vector(c,{}),d[g].addFeatures([e]),this.map.addLayers([d[g]]);break;case"ol3":break;case"leaflet":this.removeQueryLayers();for(var f=new Wkt.Wkt,g=0;g<a.length;g++)f.read(a[g]),d[g]=f.toObject({color:"#000000",weight:3,opacity:.8,fillOpacity:0}).addTo(this.map)}},this.removeQueryLayers=function(){switch(m){case"ol2":try{for(var a=0;a<d.length;a++)this.map.removeLayer(d[a])}catch(b){}break;case"ol3":break;case"leaflet":try{for(var a=0;a<d.length;a++)this.map.removeLayer(d[a])}catch(b){}}},this.on=function(a,b){switch(m){case"ol2":if("click"===a){OpenLayers.Control.Click=OpenLayers.Class(OpenLayers.Control,{defaultHandlerOptions:{single:!0,"double":!1,pixelTolerance:0,stopSingle:!1,stopDouble:!1},initialize:function(){this.handlerOptions=OpenLayers.Util.extend({},this.defaultHandlerOptions),OpenLayers.Control.prototype.initialize.apply(this,arguments),this.handler=new OpenLayers.Handler.Click(this,{click:this.trigger},this.handlerOptions)},trigger:function(a){b(a)}});var c=new OpenLayers.Control.Click;this.map.addControl(c),c.activate()}"moveend"===a&&this.map.events.register("moveend",null,b);break;case"ol3":this.map.on(a,b);break;case"leaflet":this.map.on(a,b)}}},k=function(a,b){this.getCoordinate=function(){var c;switch(m){case"ol2":return c=b.map.getLonLatFromPixel(a.xy),{x:c.lon,y:c.lat};case"ol3":return c=a.coordinate,{x:c[0],y:c[1]};case"leaflet":c=a.latlng;var d=l(c.lng,c.lat,"EPSG:4326","EPSG:900913");return{x:d.x,y:d.y}}}},l=function(a,b,c,d){var e=[];if("object"==typeof Proj4js){var f=new Proj4js.Proj(c),g=new Proj4js.Proj(d);e=new Proj4js.Point(a,b),Proj4js.transform(f,g,e)}else e.x=null,e.y=null;return e},{geoJsonStore:d,sqlStore:e,tileLayer:h,elasticStore:g,tweetStore:f,map:a,MAPLIB:m,clickEvent:k,transformPoint:l,urlVars:function(){{var a={};window.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi,function(b,c,d){a[c]=d})}return a}(),pathName:window.location.pathname.split("/"),urlHash:window.location.hash,OSM:p,MAPQUESTOSM:q,MAPBOXNATURALEARTH:r,STAMENTONER:s,STAMENTONERLITE:t,GOOGLESTREETS:u,GOOGLEHYBRID:v,GOOGLESATELLITE:w,GOOGLETERRAIN:x,BINGROAD:y,BINGAERIAL:z,BINGAERIALWITHLABELS:A,DTKSKAERMKORT:B,DTKSKAERMKORTDAEMPET:C,DIGITALGLOBE:D,HERENORMALDAYGREY:E,HERENORMALNIGHTGREY:F}}(),function(a){"use strict";var b=" a. b. c. d.".split(" "),c=function(a,c,d,e){return{url:["https://stamen-tiles.a.ssl.fastly.net/",a,"/{Z}/{X}/{Y}.",c].join(""),type:c,subdomains:b.slice(),minZoom:d,maxZoom:e,attribution:['Map tiles by <a href="http://stamen.com">Stamen Design</a>, ','under <a href="http://creativecommons.org/licenses/by/3.0">CC BY 3.0</a>. ','Data by <a href="http://openstreetmap.org">OpenStreetMap</a>, ','under <a href="http://creativecommons.org/licenses/by-sa/3.0">CC BY SA</a>.'].join("")}},d={toner:c("toner","png",0,21),terrain:c("terrain","jpg",4,18),watercolor:c("watercolor","jpg",1,18)},e=function(a){if(a in d)return d[a];throw"No such provider ("+a+")"},f=function(a,b,f){for(var g=e(a),h=0;h<b.length;h++){var i=[a,b[h]].join("-");d[i]=c(i,f||g.type,g.minZoom,g.maxZoom)}};if(f("toner",["hybrid","labels","lines","background","lite"]),f("toner",["2010"]),f("toner",["2011","2011-lines","2011-labels","2011-lite"]),f("terrain",["background"]),f("terrain",["labels","lines"],"png"),a.stamen=a.stamen||{},a.stamen.tile=a.stamen.tile||{},a.stamen.tile.providers=d,a.stamen.tile.getProvider=e,"object"==typeof L&&(L.StamenTileLayer=L.TileLayer.extend({initialize:function(a){var b=e(a),c=b.url.replace(/({[A-Z]})/g,function(a){return a.toLowerCase()});L.TileLayer.prototype.initialize.call(this,c,{minZoom:b.minZoom,maxZoom:b.maxZoom,subdomains:b.subdomains,scheme:"xyz",attribution:b.attribution})}})),"object"==typeof OpenLayers){var g=function(a){return a.replace(/({.})/g,function(a){return"$"+a.toLowerCase()})};OpenLayers.Layer.Stamen=OpenLayers.Class(OpenLayers.Layer.OSM,{initialize:function(a,b){var c=e(a),d=c.url,f=c.subdomains,h=[];if(d.indexOf("{S}")>-1)for(var i=0;i<f.length;i++)h.push(g(d.replace("{S}",f[i])));else h.push(g(d));return b=OpenLayers.Util.extend({numZoomLevels:c.maxZoom,buffer:0,transitionEffect:"resize",tileOptions:{crossOriginKeyword:null}},b),OpenLayers.Layer.OSM.prototype.initialize.call(this,a,h,b)}})}}("undefined"==typeof exports?this:exports),"leaflet"===geocloud.MAPLIB&&(L.BingLayer=L.TileLayer.extend({options:{subdomains:[0,1,2,3],type:"Aerial",attribution:"Bing",culture:""},initialize:function(a,b){L.Util.setOptions(this,b),this._key=a,this._url=null,this.meta={},this.loadMetadata()},tile2quad:function(a,b,c){for(var d="",e=c;e>0;e--){var f=0,g=1<<e-1;0!=(a&g)&&(f+=1),0!=(b&g)&&(f+=2),d+=f}return d},getTileUrl:function(a,b){var b=this._getZoomForUrl(),c=this.options.subdomains,d=this.options.subdomains[Math.abs((a.x+a.y)%c.length)];return this._url.replace("{subdomain}",d).replace("http:","https:").replace("{quadkey}",this.tile2quad(a.x,a.y,b)).replace("{culture}",this.options.culture)},loadMetadata:function(){var a=this,b="_bing_metadata_"+L.Util.stamp(this);window[b]=function(c){a.meta=c,window[b]=void 0;var d=document.getElementById(b);return d.parentNode.removeChild(d),c.errorDetails?void alert("Got metadata"+c.errorDetails):void a.initMetadata()};var c="https://dev.virtualearth.net/REST/v1/Imagery/Metadata/"+this.options.type+"?include=ImageryProviders&jsonp="+b+"&key="+this._key,d=document.createElement("script");d.type="text/javascript",d.src=c,d.id=b,document.getElementsByTagName("head")[0].appendChild(d)},initMetadata:function(){var a=this.meta.resourceSets[0].resources[0];this.options.subdomains=a.imageUrlSubdomains,this._url=a.imageUrl,this._providers=[];for(var b=0;b<a.imageryProviders.length;b++)for(var c=a.imageryProviders[b],d=0;d<c.coverageAreas.length;d++){var e=c.coverageAreas[d],f={zoomMin:e.zoomMin,zoomMax:e.zoomMax,active:!1},g=new L.LatLngBounds(new L.LatLng(e.bbox[0]+.01,e.bbox[1]+.01),new L.LatLng(e.bbox[2]-.01,e.bbox[3]-.01));f.bounds=g,f.attrib=c.attribution,this._providers.push(f)}this._update()},_update:function(){null!=this._url&&this._map&&(this._update_attribution(),L.TileLayer.prototype._update.apply(this,[]))},_update_attribution:function(){for(var a=this._map.getBounds(),b=this._map.getZoom(),c=0;c<this._providers.length;c++){var d=this._providers[c];b<=d.zoomMax&&b>=d.zoomMin&&a.intersects(d.bounds)?(d.active||this._map.attributionControl.addAttribution(d.attrib),d.active=!0):(d.active&&this._map.attributionControl.removeAttribution(d.attrib),d.active=!1)}},onRemove:function(a){for(var b=0;b<this._providers.length;b++){var c=this._providers[b];c.active&&(this._map.attributionControl.removeAttribution(c.attrib),c.active=!1)}L.TileLayer.prototype.onRemove.apply(this,[a])}}),function(a,b){"use strict";L.AwesomeMarkers={},L.AwesomeMarkers.version="2.0.1",L.AwesomeMarkers.Icon=L.Icon.extend({options:{iconSize:[35,45],iconAnchor:[17,42],popupAnchor:[1,-32],shadowAnchor:[10,12],shadowSize:[36,16],className:"awesome-marker",prefix:"glyphicon",spinClass:"fa-spin",icon:"home",markerColor:"blue",iconColor:"white"},initialize:function(a){a=L.Util.setOptions(this,a)},createIcon:function(){var a=b.createElement("div"),c=this.options;return c.icon&&(a.innerHTML=this._createInner()),c.bgPos&&(a.style.backgroundPosition=-c.bgPos.x+"px "+-c.bgPos.y+"px"),this._setIconStyles(a,"icon-"+c.markerColor),a},_createInner:function(){var a,b="",c="",d="",e=this.options;return a=e.icon.slice(0,e.prefix.length+1)===e.prefix+"-"?e.icon:e.prefix+"-"+e.icon,e.spin&&"string"==typeof e.spinClass&&(b=e.spinClass),e.iconColor&&("white"===e.iconColor||"black"===e.iconColor?c="icon-"+e.iconColor:d="style='color: "+e.iconColor+"' "),"<i "+d+"class='"+e.prefix+" "+a+" "+b+" "+c+"'></i>"},_setIconStyles:function(a,b){var c,d=this.options,e=L.point(d["shadow"===b?"shadowSize":"iconSize"]);c=L.point("shadow"===b?d.shadowAnchor||d.iconAnchor:d.iconAnchor),!c&&e&&(c=e.divideBy(2,!0)),a.className="awesome-marker-"+b+" "+d.className,c&&(a.style.marginLeft=-c.x+"px",a.style.marginTop=-c.y+"px"),e&&(a.style.width=e.x+"px",a.style.height=e.y+"px")},createShadow:function(){var a=b.createElement("div");return this._setIconStyles(a,"shadow"),a}}),L.AwesomeMarkers.icon=function(a){return new L.AwesomeMarkers.Icon(a)}}(this,document));var gc2SetLGoogle=function(){"leaflet"===geocloud.MAPLIB&&(L.Google=L.Class.extend({includes:L.Mixin.Events,options:{minZoom:0,maxZoom:20,tileSize:256,subdomains:"abc",errorTileUrl:"",attribution:"",opacity:1,continuousWorld:!1,noWrap:!1,mapOptions:{backgroundColor:"#dddddd"}},initialize:function(a,b){L.Util.setOptions(this,b),this._ready=void 0!=google.maps.Map,this._ready||L.Google.asyncWait.push(this),this._type=a||"SATELLITE"},onAdd:function(a,b){this._map=a,this._insertAtTheBottom=b,this._initContainer(),this._initMapObject(),a.on("viewreset",this._resetCallback,this),this._limitedUpdate=L.Util.limitExecByInterval(this._update,150,this),a.on("move",this._update,this),a.on("zoomanim",this._handleZoomAnim,this),a._controlCorners.bottomright.style.marginBottom="20px",this._reset(),this._update()},onRemove:function(a){this._map._container.removeChild(this._container),this._map.off("viewreset",this._resetCallback,this),this._map.off("move",this._update,this),this._map.off("zoomanim",this._handleZoomAnim,this),a._controlCorners.bottomright.style.marginBottom="0em"},getAttribution:function(){return this.options.attribution},setOpacity:function(a){this.options.opacity=a,1>a&&L.DomUtil.setOpacity(this._container,a)},setElementSize:function(a,b){a.style.width=b.x+"px",a.style.height=b.y+"px"},_initContainer:function(){var a=this._map._container,b=a.firstChild;this._container||(this._container=L.DomUtil.create("div","leaflet-google-layer leaflet-top leaflet-left"),this._container.id="_GMapContainer_"+L.Util.stamp(this),this._container.style.zIndex="auto"),a.insertBefore(this._container,b),this.setOpacity(this.options.opacity),this.setElementSize(this._container,this._map.getSize())},_initMapObject:function(){if(this._ready){this._google_center=new google.maps.LatLng(0,0);var a=new google.maps.Map(this._container,{center:this._google_center,zoom:0,tilt:0,mapTypeId:google.maps.MapTypeId[this._type],disableDefaultUI:!0,keyboardShortcuts:!1,draggable:!1,disableDoubleClickZoom:!0,scrollwheel:!1,streetViewControl:!1,styles:this.options.mapOptions.styles,backgroundColor:this.options.mapOptions.backgroundColor}),b=this;this._reposition=google.maps.event.addListenerOnce(a,"center_changed",function(){b.onReposition()}),this._google=a,google.maps.event.addListenerOnce(a,"idle",function(){b._checkZoomLevels()})}},_checkZoomLevels:function(){this._google.getZoom()!==this._map.getZoom()&&this._map.setZoom(this._google.getZoom())},_resetCallback:function(a){this._reset(a.hard)},_reset:function(){this._initContainer()},_update:function(a){if(this._google){this._resize();var b=a&&a.latlng?a.latlng:this._map.getCenter(),c=new google.maps.LatLng(b.lat,b.lng);this._google.setCenter(c),this._google.setZoom(this._map.getZoom()),this._checkZoomLevels()}},_resize:function(){var a=this._map.getSize();(this._container.style.width!=a.x||this._container.style.height!=a.y)&&(this.setElementSize(this._container,a),this.onReposition())},_handleZoomAnim:function(a){var b=a.center,c=new google.maps.LatLng(b.lat,b.lng);this._google.setCenter(c),this._google.setZoom(a.zoom)},onReposition:function(){this._google&&google.maps.event.trigger(this._google,"resize")}}),L.Google.asyncWait=[],L.Google.asyncInitialize=function(){var a;for(a=0;a<L.Google.asyncWait.length;a++){var b=L.Google.asyncWait[a];b._ready=!0,b._container&&(b._initMapObject(),b._update())}L.Google.asyncWait=[]})};"leaflet"===geocloud.MAPLIB&&(L.Yandex=L.Class.extend({includes:L.Mixin.Events,options:{minZoom:0,maxZoom:18,attribution:"",opacity:1,traffic:!1},initialize:function(a,b){L.Util.setOptions(this,b),this._type="yandex#"+(a||"map")},onAdd:function(a,b){this._map=a,this._insertAtTheBottom=b,this._initContainer(),this._initMapObject(),a.on("viewreset",this._resetCallback,this),this._limitedUpdate=L.Util.limitExecByInterval(this._update,150,this),a.on("move",this._update,this),a._controlCorners.bottomright.style.marginBottom="3em",this._reset(),this._update(!0)},onRemove:function(a){this._map._container.removeChild(this._container),this._map.off("viewreset",this._resetCallback,this),this._map.off("move",this._update,this),a._controlCorners.bottomright.style.marginBottom="0em"},getAttribution:function(){return this.options.attribution},setOpacity:function(a){this.options.opacity=a,1>a&&L.DomUtil.setOpacity(this._container,a)},setElementSize:function(a,b){a.style.width=b.x+"px",a.style.height=b.y+"px"},_initContainer:function(){var a=this._map._container,b=a.firstChild;this._container||(this._container=L.DomUtil.create("div","leaflet-yandex-layer leaflet-top leaflet-left"),this._container.id="_YMapContainer_"+L.Util.stamp(this),this._container.style.zIndex="auto"),this.options.overlay&&(b=this._map._container.getElementsByClassName("leaflet-map-pane")[0],b=b.nextSibling,L.Browser.opera&&(this._container.className+=" leaflet-objects-pane")),a.insertBefore(this._container,b),this.setOpacity(this.options.opacity),this.setElementSize(this._container,this._map.getSize())},_initMapObject:function(){if(!this._yandex){if(void 0===ymaps.Map)return console&&console.debug("L.Yandex: Waiting on ymaps.load('package.map')"),ymaps.load(["package.map"],this._initMapObject,this);if(this.options.traffic&&(void 0===ymaps.control||void 0===ymaps.control.TrafficControl))return console&&console.debug("L.Yandex: loading traffic and controls"),ymaps.load(["package.traffic","package.controls"],this._initMapObject,this);var a=new ymaps.Map(this._container,{center:[0,0],zoom:0,behaviors:[]});this.options.traffic&&a.controls.add(new ymaps.control.TrafficControl({shown:!0})),"yandex#null"==this._type&&(this._type=new ymaps.MapType("null",[]),a.container.getElement().style.background="transparent"),a.setType(this._type),this._yandex=a,this._update(!0)}},_resetCallback:function(a){this._reset(a.hard)},_reset:function(){this._initContainer()},_update:function(a){if(this._yandex){this._resize(a);var b=this._map.getCenter(),c=[b.lat,b.lng],d=this._map.getZoom();(a||this._yandex.getZoom()!=d)&&this._yandex.setZoom(d),this._yandex.panTo(c,{duration:0,delay:0})}},_resize:function(a){var b=this._map.getSize(),c=this._container.style;if(c.width!=b.x+"px"||c.height!=b.y+"px"||1==a){this.setElementSize(this._container,b);{var d=this._map.getBounds();d.getSouthWest(),d.getNorthEast()}this._yandex.container.fitToViewport()}}})),OpenLayers.IMAGE_RELOAD_ATTEMPTS=3,Ext.BLANK_IMAGE_URL="/js/ext/resources/images/default/s.gif",Ext.QuickTips.init();var App=new Ext.App({}),cloud,gc2,layer,grid,store,map,wfsTools,viewport,drawControl,gridPanel,modifyControl,tree,viewerSettings,loadTree,reLoadTree,layerBeingEditing,layerBeingEditingGeomField,saveStrategy,getMetaData,searchWin,measureWin,placeMarkers,placePopup,measureControls,extentRestrictLayer,addedBaseLayers=[],currentId,mapTools;$(document).ready(function(){"use strict";function a(a){var b=(a.geometry,a.units),c=a.order,d=a.measure,e=document.getElementById("output"),f="";f+=1===c?__("Measure")+": "+d.toFixed(3)+" "+b:__("Measure")+": "+d.toFixed(3)+" "+b+"<sup>2</sup>",e.innerHTML=f}function b(a){measureWin||(measureWin=new Ext.Window({title:__("Measure"),layout:"fit",width:300,height:90,plain:!0,closeAction:"hide",html:'<div style="padding: 5px"><div id="output" style="height: 20px; margin-bottom: 10px"></div><div>'+__("Close this window to disable measure tool")+"</div></div>",x:250,y:35,listeners:{hide:{fn:function(){measureControls.polygon.deactivate(),measureControls.line.deactivate()}}}})),"object"==typeof a?measureWin.show(a):measureWin.show()}var c=null;cloud=new mygeocloud_ol.map(null,screenName,{controls:[new OpenLayers.Control.Navigation({}),new OpenLayers.Control.Zoom,new OpenLayers.Control.Attribution],restrictedExtent:subUser&&window.parent.settings.extentrestricts?window.parent.settings.extentrestricts[schema]:null}),map=cloud.map;var d,e=[],f=[],g=[],h=new geocloud.map({});h.map=map,getMetaData=function(){$.ajax({url:"/api/v1/meta/"+screenName+"/"+schema,async:!0,dataType:"json",type:"GET",success:function(a){d=a;for(var b=0;b<d.data.length;b++)e[d.data[b].f_table_name]=d.data[b],d.data[b].f_table_title||(d.data[b].f_table_title=d.data[b].f_table_name),f[d.data[b].f_table_title]=d.data[b]}})};var i;h.on("dblclick",function(){i=void 0});var j=[],k=new Ext.Window({title:"Query result",modal:!1,border:!1,layout:"fit",width:400,height:400,closeAction:"hide",x:100,y:100,plain:!0,listeners:{hide:{fn:function(){Ext.iterate(j,function(a){a.reset()})}}},items:[new Ext.TabPanel({activeTab:0,frame:!0,id:"queryTabs"})]});h.on("click",function(a){var b,c,d=0,f=!1,g=new geocloud.clickEvent(a,cloud),l=screenName;i?clearTimeout(i):i=setTimeout(function(){i=void 0;var a=g.getCoordinate();$.each(j,function(a,b){try{b.reset(),h.removeGeoJsonStore(b)}catch(c){}}),b=h.getVisibleLayers().split(";"),Ext.getCmp("queryTabs").removeAll(),$.each(b,function(b,g){var i=!0,m=e[g.split(".")[1]].srid,n=e[g.split(".")[1]].pkey,o=e[g.split(".")[1]].f_geometry_column,p=e[g.split(".")[1]].type,q=e[g.split(".")[1]].f_table_name,r=e[g.split(".")[1]].versioning;if("POLYGON"!==p&&"MULTIPOLYGON"!==p){var s=[156543.033928,78271.516964,39135.758482,19567.879241,9783.9396205,4891.96981025,2445.98490513,1222.99245256,611.496226281,305.748113141,152.87405657,76.4370282852,38.2185141426,19.1092570713,9.55462853565,4.77731426782,2.38865713391,1.19432856696,.597164283478,.298582141739,.149291];c=5*s[cloud.getZoom()]}j[b]=new geocloud.sqlStore({db:l,id:b,styleMap:new OpenLayers.StyleMap({"default":new OpenLayers.Style({fillColor:"#000000",fillOpacity:0,pointRadius:8,strokeColor:"#FF0000",strokeWidth:3,strokeOpacity:.7,graphicZIndex:3})}),onLoad:function(){var a,b=j[this.id],c=[],e={};if(i=b.isEmpty(),i||(k.show(),$.each(b.geoJSON.features,function(b,d){$.each(d.properties,function(a,b){c.push([a,0,a,b])}),c.sort(function(a,b){return a[1]-b[1]}),$.each(c,function(b,c){c[2]===n&&(a=c[3]),e[c[2]]=c[3]}),c=[]}),Ext.getCmp("queryTabs").add({title:q,layout:"fit",border:!1,items:[{xtype:"panel",layout:"fit",id:q,border:!1,tbar:[{text:"<i class='icon-pencil btn-gc'></i> Edit feature #"+a,handler:function(){if("GEOMETRY"===p||"RASTER"===p)return Ext.MessageBox.show({title:"No geometry type on layer",msg:"The layer has no geometry type or type is GEOMETRY. You can set geom type for the layer in 'Settings' to the right.",buttons:Ext.MessageBox.OK,width:400,height:300,icon:Ext.MessageBox.ERROR}),!1;var b=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.EQUAL_TO,property:'"'+n+'"',value:a});attributeForm.init(q,o),startWfsEdition(q,o,b,!0),Ext.iterate(j,function(a){a.reset()}),k.hide()}}],items:[new Ext.grid.PropertyGrid({autoHeight:!1,border:!1,startEditing:Ext.emptyFn,source:e})]}]}),f=!0),!f)try{k.hide()}catch(g){}d++,Ext.getCmp("queryTabs").activate(0)}}),h.addGeoJsonStore(j[b]);var t,u=e[g.split(".")[1]].f_geometry_column;"POLYGON"!==p&&"MULTIPOLYGON"!==p?(t="SELECT * FROM "+g+' WHERE round(ST_Distance(ST_Transform("'+u+"\",3857), ST_GeomFromText('POINT("+a.x+" "+a.y+")',3857))) < "+c,r&&(t+=" AND gc2_version_end_date IS NULL"),t=t+' ORDER BY round(ST_Distance(ST_Transform("'+u+"\",3857), ST_GeomFromText('POINT("+a.x+" "+a.y+")',3857)))"):(t="SELECT * FROM "+g+" WHERE ST_Intersects(ST_Transform(ST_geomfromtext('POINT("+a.x+" "+a.y+")',900913),"+m+'),"'+u+'")',r&&(t+=" AND gc2_version_end_date IS NULL")),t+=" LIMIT 1",j[b].sql=t,j[b].load()})},250)}),"object"!=typeof window.setBaseLayers&&(window.setBaseLayers=[{id:"mapQuestOSM",name:"MapQuset OSM"},{id:"osm",name:"OSM"}]),cloud.bingApiKey=window.bingApiKey,cloud.digitalGlobeKey=window.digitalGlobeKey,window.setBaseLayers=window.setBaseLayers.reverse();for(var l,m,n=0;n<window.setBaseLayers.length;n++)("undefined"==typeof window.setBaseLayers[n].restrictTo||window.setBaseLayers[n].restrictTo.indexOf(schema)>-1)&&("undefined"!=typeof window.setBaseLayers[n].db&&(l=window.setBaseLayers[n].id+window.setBaseLayers[n].name,m=window.setBaseLayers[n].name),c=cloud.addBaseLayer(window.setBaseLayers[n].id,window.setBaseLayers[n].db,l,m));null!==c&&cloud.setBaseLayer(c);var o=Ext.extend(GeoExt.tree.LayerNodeUI,new GeoExt.tree.TreeNodeUIEventMixin),p={};loadTree=function(){var a=[{id:"baselayers",nodeType:"gx_baselayercontainer"}];$.ajax({url:"/api/v1/meta/"+screenName+"/"+schema,dataType:"json",type:"GET",success:function(b){var c,d=[];if(void 0!==b.data){for(var e=0;e<b.data.length;++e)d[e]=b.data[e].layergroup,g[b.data[e]._key_]=b.data[e];for(var f=array_unique(d),h=0;h<b.data.length;++h){c=b.data[h].baselayer?!0:!1;try{cloud.removeTileLayerByName([[b.data[h].f_table_schema+"."+b.data[h].f_table_name]])}catch(i){}p[[b.data[h].f_table_schema+"."+b.data[h].f_table_name]]=cloud.addTileLayers([b.data[h].f_table_schema+"."+b.data[h].f_table_name],{singleTile:!1,visibility:!1,wrapDateLine:!1,tileCached:!0,displayInLayerSwitcher:!0,name:b.data[h].f_table_schema+"."+b.data[h].f_table_name})}for(e=0;e<f.length;++e){var j,k=[];for(h=0;h<b.data.length;++h)b.data[h].layergroup===f[e]&&(j=b.data[h].f_table_schema+"."+b.data[h].f_table_name+"."+b.data[h].f_geometry_column,k.push({text:(null===b.data[h].f_table_title||""===b.data[h].f_table_title?b.data[h].f_table_name:b.data[h].f_table_title)+" <span style='float:right' class='leaf-tools' id='"+j.split(".").join("-")+"'></span>",id:j,leaf:!0,checked:!1,geomField:b.data[h].f_geometry_column,geomType:b.data[h].type}));a.push({text:f[e],isLeaf:!1,expanded:!1,children:k.reverse()})}}a.push(a.shift()),tree=new Ext.tree.TreePanel({id:"tree",border:!1,region:"center",split:!0,autoScroll:!0,root:{text:"Ext JS",children:Ext.decode((new OpenLayers.Format.JSON).write(a.reverse(),!0)),id:"source"},loader:new Ext.tree.TreeLoader({applyLoader:!1,uiProviders:{layernodeui:o}}),listeners:{click:{fn:function(a){var b=a.id.split(".").join("-"),c=function(){a.leaf===!0&&"baselayers"!==a.parentNode.id&&window.parent.onEditWMSClasses(a.id)};try{stopEdit()}catch(d){}currentId!==a.id&&(window.parent.Ext.getCmp("layerStylePanel").collapsed?(window.parent.Ext.getCmp("layerStylePanel").expand(!1),c(),window.parent.Ext.getCmp("layerStylePanel").collapse(!1)):c()),a.leaf===!0&&"baselayers"!==a.parentNode.id?(Ext.getCmp("editlayerbutton").setDisabled(!1),Ext.getCmp("quickdrawbutton").setDisabled(!1),Ext.getCmp("stylebutton").setDisabled(!1)):(Ext.getCmp("editlayerbutton").setDisabled(!0),Ext.getCmp("quickdrawbutton").setDisabled(!0),Ext.getCmp("stylebutton").setDisabled(!0)),"undefined"!=typeof filter.win&&("undefined"!=typeof filter.win.hide&&filter.win.hide(),filter.win=!1),$(".leaf-tools").empty(),$("#"+b).html("<i class='icon-cog btn-gc' style='cursor:pointer' id='style-"+b+"'></i><i class='icon-fullscreen btn-gc' style='cursor:pointer' id='ext-"+b+"'></i>"),currentId=a.id,$("#style-"+b).on("click",function(){window.parent.Ext.getCmp("layerStylePanel").expand(!0)}),$("#ext-"+b).on("click",function(){return"RASTER"===g[a.id].type?(window.parent.App.setAlert(App.STATUS_NOTICE,__("You can only zoom to vector layers.")),!1):void Ext.Ajax.request({url:"/api/v1/extent/"+screenName+"/"+a.id+"/900913",method:"get",headers:{"Content-Type":"application/json; charset=utf-8"},success:function(a){var b=Ext.decode(a.responseText).extent;cloud.map.zoomToExtent([b.xmin,b.ymin,b.xmax,b.ymax])},failure:function(a){Ext.MessageBox.show({title:"Failure",msg:__(Ext.decode(a.responseText).message),buttons:Ext.MessageBox.OK,width:400,height:300,icon:Ext.MessageBox.ERROR})}})})}}},rootVisible:!1,lines:!1}),tree.on("checkchange",function(a,b){if(null===a.lastChild&&"baselayers"!==a.parentNode.id){var c=a.id.split(".")[0]+"."+a.id.split(".")[1];p[c][0].setVisibility(b?!0:!1)}}),"undefined"==typeof viewport?(viewport=new Ext.Viewport({layout:"border",items:[{region:"center",layout:"fit",border:!1,items:[new Ext.Panel({layout:"border",border:!1,items:[{region:"center",id:"mappanel",xtype:"gx_mappanel",map:map,zoom:5,split:!0,tbar:mapTools},{region:"south",id:"attrtable",title:"Attribute table",split:!0,frame:!1,layout:"fit",height:200,collapsible:!0,collapsed:!0,contentEl:"instructions"}]})]},new Ext.Panel({border:!0,region:"west",collapsible:!0,width:350,tbar:[{text:'<i class="icon-eye-open btn-gc"></i> '+__("Class wizard"),id:"stylebutton",disabled:!0,handler:function(){var a=tree.getSelectionModel().getSelectedNode();window.parent.styleWizardWin(a.id)}},"-",{text:'<i class="icon-plus btn-gc"></i> '+__("New layer"),disabled:subUser===schema||subUser===!1?!1:!0,handler:function(){window.parent.onAdd()}},"-",{text:"<i class='icon-edit btn-gc'></i> "+__("Start edit"),id:"editlayerbutton",disabled:!0,handler:function(){try{stopEdit()}catch(a){}var b=tree.getSelectionModel().getSelectedNode(),c=b.id.split("."),d=b.attributes.geomField,e=b.attributes.geomType;if(attributeForm.init(c[1],d),"GEOMETRY"===e||"RASTER"===e)Ext.MessageBox.show({title:"No geometry type on layer",msg:"The layer has no geometry type or type is GEOMETRY. You can set geom type for the layer in 'Settings' to the right.",buttons:Ext.MessageBox.OK,width:400,height:300,icon:Ext.MessageBox.ERROR});else{var f=function(){"object"==typeof filter.win?filter.win.show():setTimeout(f,10)};f()}}},"-",{text:"<i class='icon-refresh btn-gc'></i> "+__("Reload"),handler:function(){stopEdit(),reLoadTree()}}],items:[{xtype:"panel",border:!1,tbar:wfsTools,html:'<div class="layer-desc">Click on a layer title to access settings and to edit data. Check the box to see the layer in the map.</div>'},new Ext.Panel({border:!1,id:"treepanel",style:{height:Ext.getBody().getViewSize().height-120+"px",overflow:"auto"},collapsible:!1})]})]}),null!==window.parent.initExtent?cloud.map.zoomToExtent(window.parent.initExtent,!1):cloud.map.zoomToMaxExtent()):window.parent.App.setAlert(App.STATUS_NOTICE,__("Layer tree reloaded"));var l=Ext.getCmp("treepanel");l.remove(tree),l.add(tree),l.doLayout(),window.parent.writeFiles(),extentRestrictLayer=new OpenLayers.Layer.Vector("extentRestrictLayer",{styleMap:new OpenLayers.StyleMap({"default":new OpenLayers.Style({fillColor:"#000000",fillOpacity:0,pointRadius:5,strokeColor:"#ff0000",strokeWidth:2,strokeOpacity:.7,graphicZIndex:1})})}),window.parent.extentRestricted&&extentRestrictLayer.addFeatures(new OpenLayers.Feature.Vector(OpenLayers.Bounds.fromArray(window.parent.settings.extentrestricts[schema]).toGeometry())),map.addLayers([extentRestrictLayer])}})},wfsTools=[new GeoExt.Action({control:drawControl,text:"<i class='icon-pencil btn-gc'></i> "+__("Draw"),id:"editcreatebutton",disabled:!0,enableToggle:!0}),"-",{text:"<i class='icon-trash btn-gc'></i> "+__("Delete"),id:"editdeletebutton",disabled:!0,handler:function(){gridPanel.getSelectionModel().each(function(a){var b=a.get("feature");
modifyControl.unselectFeature(b),gridPanel.store.remove(a),b.state!==OpenLayers.State.INSERT&&(b.state=OpenLayers.State.DELETE,layer.addFeatures([b]))})}},"-",{text:"<i class='icon-ok btn-gc'></i> "+__("Save"),disabled:!0,id:"editsavebutton",handler:function(){modifyControl.feature&&modifyControl.selectControl.unselectAll(),store.commitChanges(),saveStrategy.save()}},"-",{text:"<i class='icon-stop btn-gc'></i> "+__("Stop editing"),disabled:!0,id:"editstopbutton",handler:stopEdit},"-",{text:"<i class='icon-edit btn-gc'></i> "+__("Quick draw"),id:"quickdrawbutton",disabled:!0,handler:function(){var a=tree.getSelectionModel().getSelectedNode(),b=a.id.split("."),c=a.attributes.geomField,d=a.attributes.geomType;if("GEOMETRY"===d||"RASTER"===d)return Ext.MessageBox.show({title:"No geometry type on layer",msg:"The layer has no geometry type or type is GEOMETRY. You can set geom type for the layer in 'Settings' to the right.",buttons:Ext.MessageBox.OK,width:400,height:300,icon:Ext.MessageBox.ERROR}),!1;var e=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.EQUAL_TO,property:'"dummy"',value:"-1"});attributeForm.init(b[1],c),startWfsEdition(b[1],c,e),wfsTools[0].control.activate(),Ext.getCmp("editcreatebutton").toggle(!0),Ext.iterate(j,function(a){a.reset()}),k.hide()}}],mapTools=[{text:"<i class='icon-resize-vertical btn-gc'></i> "+__("Measure"),menu:new Ext.menu.Menu({items:[{text:__("Distance"),handler:function(){b(),measureControls.polygon.deactivate(),measureControls.line.activate()}},{text:__("Area"),handler:function(){b(),measureControls.line.deactivate(),measureControls.polygon.activate()}}]})},{text:"<i class='icon-search btn-gc'></i> "+__("Search"),handler:function(a){searchWin||(searchWin=new Ext.Window({title:__("Find"),layout:"fit",width:300,height:70,plain:!0,closeAction:"hide",html:'<div style="padding: 5px" id="searchContent"><input style="width: 270px" type="text" id="gAddress" name="gAddress" value="" /></div>',x:250,y:35})),"object"==typeof a?searchWin.show(a):searchWin.show();var b=document.getElementById("gAddress"),c={},d=new google.maps.places.Autocomplete(b,c);google.maps.event.addListener(d,"place_changed",function(){var a=d.getPlace(),b=function(a,b,c,d){var e=[];if("object"==typeof Proj4js){var f=new Proj4js.Proj(c),g=new Proj4js.Proj(d);e=new Proj4js.Point(a,b),Proj4js.transform(f,g,e)}else e.x=null,e.y=null;return e},c=b(a.geometry.location.lng(),a.geometry.location.lat(),"EPSG:4326","EPSG:900913"),e=new OpenLayers.LonLat(c.x,c.y);map.setCenter(e,17);try{placeMarkers.destroy()}catch(f){}try{placePopup.destroy()}catch(f){}placeMarkers=new OpenLayers.Layer.Markers("Markers"),map.addLayer(placeMarkers);var g=new OpenLayers.Size(21,25),h=new OpenLayers.Pixel(-(g.w/2),-g.h),i=new OpenLayers.Icon("http://www.openlayers.org/dev/img/marker.png",g,h);placeMarkers.addMarker(new OpenLayers.Marker(e,i)),placePopup=new OpenLayers.Popup.FramedCloud("place",e,null,"<div id='placeResult' style='z-index:1000;width:200px;height:50px;overflow:auto'>"+a.formatted_address+"</div>",null,!0),map.addPopup(placePopup)})},tooltip:"Search with Google Places"},"-",{text:"<i class='icon-globe btn-gc'></i> "+__("Save extent"),id:"extentbutton",disabled:!1,handler:function(){Ext.Ajax.request({url:"/controllers/setting/extent/",method:"put",params:Ext.util.JSON.encode({data:{schema:schema,extent:cloud.getExtent(),zoom:cloud.getZoom(),center:[cloud.getCenter().x,cloud.getCenter().y]}}),headers:{"Content-Type":"application/json; charset=utf-8"},success:function(a){window.parent.App.setAlert(App.STATUS_NOTICE,__(Ext.decode(a.responseText).message))},failure:function(a){Ext.MessageBox.show({title:"Failure",msg:__(Ext.decode(a.responseText).message),buttons:Ext.MessageBox.OK,width:400,height:300,icon:Ext.MessageBox.ERROR})}})}},"-",{text:"<i class='icon-lock btn-gc'></i> "+__("Lock extent"),id:"extentlockbutton",enableToggle:!0,tooltip:__("Lock the map extent for sub-users in Admin and for all users in the public Viewer."),disabled:subUser?!0:!1,pressed:window.parent.extentRestricted?!0:!1,handler:function(){window.parent.extentRestricted=this.pressed,window.parent.extentRestricted?extentRestrictLayer.addFeatures(new OpenLayers.Feature.Vector(cloud.map.getExtent().toGeometry())):extentRestrictLayer.destroyFeatures(),Ext.Ajax.request({url:"/controllers/setting/extentrestrict/",method:"put",params:Ext.util.JSON.encode({data:{schema:schema,extent:window.parent.extentRestricted?cloud.getExtent():null,zoom:window.parent.extentRestricted?cloud.getZoom():null}}),headers:{"Content-Type":"application/json; charset=utf-8"},success:function(a){window.parent.App.setAlert(App.STATUS_NOTICE,__(Ext.decode(a.responseText).message))},failure:function(a){Ext.MessageBox.show({title:"Failure",msg:__(Ext.decode(a.responseText).message),buttons:Ext.MessageBox.OK,width:400,height:300,icon:Ext.MessageBox.ERROR})}})}},"-",{text:"<i class='icon-th-list btn-gc'></i> "+__("Attributes"),id:"infobutton",disabled:!0,handler:function(){attributeForm.win.show()}},"-",{text:"<i class='icon-screenshot btn-gc'></i> "+__("Locate me"),handler:function(){cloud.locate()}}],reLoadTree=function(){loadTree()};var q={Point:{pointRadius:4,graphicName:"square",fillColor:"white",fillOpacity:1,strokeWidth:1,strokeOpacity:1,strokeColor:"#333333"},Line:{strokeWidth:3,strokeOpacity:1,strokeColor:"#666666",strokeDashstyle:"dash"},Polygon:{strokeWidth:2,strokeOpacity:1,strokeColor:"#666666",fillColor:"white",fillOpacity:.3}},r=new OpenLayers.Style;r.addRules([new OpenLayers.Rule({symbolizer:q})]);var s=new OpenLayers.StyleMap({"default":r});measureControls={line:new OpenLayers.Control.Measure(OpenLayers.Handler.Path,{persist:!0,geodesic:!0,immediate:!0,handlerOptions:{layerOptions:{styleMap:s}}}),polygon:new OpenLayers.Control.Measure(OpenLayers.Handler.Polygon,{persist:!0,geodesic:!0,immediate:!0,handlerOptions:{layerOptions:{styleMap:s}}})},measureControls.line.events.on({measure:a,measurepartial:a}),map.addControl(measureControls.line),measureControls.polygon.events.on({measure:a,measurepartial:a}),map.addControl(measureControls.polygon),loadTree()}),saveStrategy=new OpenLayers.Strategy.Save({onCommit:function(a){var b,c,d;if(a.success()){saveStrategy.layer.refresh(),b=new OpenLayers.Format.XML,c=b.read(a.priv.responseText);try{var e=c.getElementsByTagName("wfs:totalInserted")[0].firstChild.data}catch(f){}try{var g=c.getElementsByTagName("wfs:totalDeleted")[0].firstChild.data}catch(f){}try{var h=c.getElementsByTagName("wfs:totalUpdated")[0].firstChild.data}catch(f){}try{var h=c.getElementsByTagName("wfs:Message")[0].firstChild.data}catch(f){}try{var e=c.getElementsByTagName("totalInserted")[0].firstChild.data}catch(f){}try{var g=c.getElementsByTagName("totalDeleted")[0].firstChild.data}catch(f){}try{var h=c.getElementsByTagName("totalUpdated")[0].firstChild.data}catch(f){}try{var h=c.getElementsByTagName("Message")[0].firstChild.data}catch(f){}var i="";e&&(i="<p>Inserted: "+e+"</p>",window.parent.App.setAlert(App.STATUS_OK,i)),h&&(i="<p>Updated: "+h+"</p>",window.parent.App.setAlert(App.STATUS_OK,i)),g&&(i="<p>Deleted: "+g+"</p>",window.parent.App.setAlert(App.STATUS_OK,i)),window.parent.writeFiles(!1,map);var j;j=window.map.getLayersByName(schema+"."+layerBeingEditing)[0],j.clearGrid();var k="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0,c="x"==a?b:3&b|8;return c.toString(16)});j.url=j.url.replace(j.url.split("?")[1],""),j.url=j.url+"token="+k,setTimeout(function(){j.redraw()},500)}else{b=new OpenLayers.Format.XML,c=b.read(a.priv.responseText);try{d=c.getElementsByTagName("ServiceException")[0].firstChild.data}catch(f){}try{d=c.getElementsByTagName("wfs:ServiceException")[0].firstChild.data}catch(f){}i="<p>Sorry, but something went wrong. The whole transaction is rolled back. Try to correct the problem and hit save again. You can look at the error below, maybe it will give you a hint about what's wrong</p><br/><textarea rows='5' cols='31'>"+d+"</textarea>",Ext.MessageBox.show({title:"Failure",msg:i,buttons:Ext.MessageBox.OK,width:400,height:300,icon:Ext.MessageBox.ERROR})}}}),Ext.namespace("attributeForm"),Ext.namespace("filter"),attributeForm.init=function(a,b){Ext.QuickTips.init(),attributeForm.attributeStore=new GeoExt.data.AttributeStore({url:"/wfs/"+screenName+"/"+schema+"?REQUEST=DescribeFeatureType&TYPENAME="+a,listeners:{load:{scope:this,fn:function(c){attributeForm.attributeStoreCopy=new Ext.data.ArrayStore,c.each(function(a){var b=/gml:((Multi)?(Point|Line|Polygon|Curve|Surface)).*/.exec(a.get("type"));if(!b){var c={name:a.get("name"),value:null},d=new attributeForm.attributeStore.recordType(c);attributeForm.attributeStoreCopy.add(d)}},this),filter.filterBuilder=new gxp.FilterBuilder({attributes:attributeForm.attributeStoreCopy,allowGroups:!1}),filter.queryPanel=new Ext.Panel({id:"uploadpanel",frame:!1,region:"center",bodyStyle:{background:"#ffffff",padding:"7px"},tbar:["->",{text:"<i class='icon-filter btn-gc'></i> "+__("Load"),disabled:!1,handler:function(){filter.queryPanel.query(),filter.win.close()}}],query:function(){var c,d=filter.filterBuilder.getFilter(),e=!0;if("object"==typeof d.filters&&$.each(d.filters,function(a,b){b===!1&&(e=!1)}),"undefined"!=typeof Ext.getCmp("timeSliceField").items.items[0].items.items[0].value&&filter.filterBuilder.timeSliceQuery===!0&&(c=Ext.getCmp("timeSliceField").items.items[0].items.items[0].value),e)if(layerBeingEditing&&!c){var f=store.proxy.protocol;f.defaultFilter=filter.filterBuilder.getFilter(),saveStrategy.layer.refresh()}else startWfsEdition(a,b,d,!1,c)},items:[filter.filterBuilder]}),filter.win=new Ext.Window({title:__("Load features"),modal:!1,layout:"fit",initCenter:!0,border:!1,width:400,height:400,closeAction:"hide",plain:!0,items:[new Ext.Panel({frame:!1,layout:"border",items:[filter.queryPanel]})]})}}}}),attributeForm.form=new Ext.form.FormPanel({autoScroll:!0,region:"center",viewConfig:{forceFit:!0},border:!1,labelWidth:150,bodyStyle:{background:"#ffffff",padding:"7px"},defaults:{maxLengthText:"too long",minLengthText:"too short",anchor:"100%"},plugins:[new GeoExt.plugins.AttributeForm({attributeStore:attributeForm.attributeStore})],buttons:[{text:"<i class='icon-ok btn-gc'></i> "+__("Update table"),handler:function(){if(attributeForm.form.form.isValid()){var a=grid.getSelectionModel().getSelected();attributeForm.form.getForm().updateRecord(a);var b=a.get("feature");b.state!==OpenLayers.State.INSERT&&(b.state=OpenLayers.State.UPDATE)}else{var c="";Ext.iterate(detailForm.form.form.getValues(),function(a,b){c+=String.format("{0} = {1}<br />",a,b)},this)}}}]}),attributeForm.attributeStore.load()},Ext.namespace("gxp.form"),gxp.form.FilterField=Ext.extend(Ext.form.CompositeField,{filter:null,attributes:null,attributesComboConfig:null,initComponent:function(){this.filter||(this.filter=this.createDefaultFilter()),this.attributes||(this.attributes=new GeoExt.data.AttributeStore);var a={xtype:"combo",store:this.attributes,editable:!1,triggerAction:"all",allowBlank:!1,displayField:"name",valueField:"name",mode:"local",value:this.filter.property,listeners:{select:function(a,b){this.filter.property=b.get("name"),this.fireEvent("change",this.filter)},scope:this},width:120};this.attributesComboConfig=this.attributesComboConfig||{},Ext.applyIf(this.attributesComboConfig,a),this.items=this.createFilterItems(),this.addEvents("change"),gxp.form.FilterField.superclass.initComponent.call(this)},createDefaultFilter:function(){return new OpenLayers.Filter.Comparison},createFilterItems:function(){return[this.attributesComboConfig,{xtype:"gx_comparisoncombo",value:this.filter.type,listeners:{select:function(a,b){this.filter.type=b.get("value"),this.fireEvent("change",this.filter)},scope:this}},{xtype:"textfield",value:this.filter.value,width:50,grow:!0,growMin:50,anchor:"100%",allowBlank:!1,listeners:{change:function(a,b){this.filter.value=b,this.fireEvent("change",this.filter)},scope:this}}]}}),Ext.reg("gx_filterfield",gxp.form.FilterField),Ext.namespace("gxp"),gxp.FilterBuilder=Ext.extend(Ext.Container,{builderTypeNames:["any","all","none","not all"],attributeQuery:!1,spatialQuery:!0,timeSliceQuery:!1,allowedBuilderTypes:null,preComboText:"Match",postComboText:"of the following:",cls:"gx-filterbuilder",builderType:null,childFilterContainer:null,customizeFilterOnInit:!0,allowGroups:!0,initComponent:function(){var a={defaultBuilderType:gxp.FilterBuilder.ANY_OF};Ext.applyIf(this,a),this.customizeFilterOnInit&&(this.filter=this.customizeFilter(this.filter)),this.builderType=this.getBuilderType(),this.items=[{xtype:"fieldset",title:__("Filter by location"),checkboxToggle:!0,anchor:"95%",html:"Only features within the map view will be loaded.",listeners:{collapse:function(){this.spatialQuery=!1},expand:function(){this.spatialQuery=!0},scope:this}},{xtype:"fieldset",title:__("Filter by attributes"),checkboxToggle:!0,collapsed:!this.attributeQuery,anchor:"95%",items:[{xtype:"container",layout:"form",defaults:{anchor:"100%"},hideLabels:!0,items:[{xtype:"compositefield",style:"padding-left: 2px",items:[{xtype:"label",style:"padding-top: 0.3em",text:this.preComboText},this.createBuilderTypeCombo(),{xtype:"label",style:"padding-top: 0.3em",text:this.postComboText}]},this.createChildFiltersPanel(),{xtype:"toolbar",items:this.createToolBar()}]}],listeners:{collapse:function(){this.attributeQuery=!1},expand:function(){this.attributeQuery=!0},scope:this}},{xtype:"fieldset",title:__("Time slicing (only versioned layers)"),id:"timeSliceField",checkboxToggle:!0,collapsed:!this.timeSliceQuery,anchor:"95%",html:__("Either select 'latest, 'all' or write a date/time in the form yyyy-mm-dd hh:mm:ss<br><br>If you are tracking changes on your table, you can either load the latest (current) versions or you can 'slice' at a given point in time. You can also load all versions.<br><br>Earlier features will be shown with a red dashed line."),items:[{xtype:"container",layout:"form",hideLabels:!0,items:[{xtype:"combo",hideLabels:!0,width:300,store:new Ext.data.ArrayStore({fields:["type","display"],data:[["latest","latest"],["all","all"]]}),displayField:"display",valueField:"type",editable:!0,triggerAction:"all",name:"timeslice",value:"latest",allowBlank:!0,mode:"local"}]}],listeners:{collapse:function(){this.timeSliceQuery=!1},expand:function(){this.timeSliceQuery=!0},scope:this}}],this.addEvents("change"),gxp.FilterBuilder.superclass.initComponent.call(this)},createToolBar:function(){var a=[{text:"<i class='icon-plus-sign btn-gc'></i> Add condition",handler:function(){this.addCondition()},scope:this}];return this.allowGroups&&a.push({text:"add group",iconCls:"silk-add",handler:function(){this.addCondition(!0)},scope:this}),a},getFilter:function(){var a,b=this.attributeQuery&&this.filter,c=this.spatialQuery&&new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.BBOX,value:map.getExtent()});return b&&c?(a=this.filter.clone(),a instanceof OpenLayers.Filter.Logical&&(b=this.cleanFilter(b),a=new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.AND,filters:[c,b]}))):(b=this.cleanFilter(b),a=b||c),a},cleanFilter:function(a){if(a instanceof OpenLayers.Filter.Logical){if(a.type!==OpenLayers.Filter.Logical.NOT&&1===a.filters.length)a=this.cleanFilter(a.filters[0]);else for(var b,c=0,d=a.filters.length;d>c;++c)if(b=a.filters[c],b instanceof OpenLayers.Filter.Logical){if(b=this.cleanFilter(b),!b){a=b;break}a.filters[c]=b}else if(!b||null===b.type||null===b.property||null===b.value){a=!1;break}}else a&&null!==a.type&&null!==a.property&&null!==a.value||(a=!1);return a},customizeFilter:function(a){if(a)switch(a=this.cleanFilter(a),a.type){case OpenLayers.Filter.Logical.AND:case OpenLayers.Filter.Logical.OR:if(a.filters&&0!==a.filters.length)for(var b,c=0,d=a.filters.length;d>c;++c)b=a.filters[c],b instanceof OpenLayers.Filter.Logical&&(a.filters[c]=this.customizeFilter(b));else a.filters=[this.createDefaultFilter()];a=new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.OR,filters:[a]});break;case OpenLayers.Filter.Logical.NOT:if(a.filters&&0!==a.filters.length){var b=a.filters[0];if(b instanceof OpenLayers.Filter.Logical)if(b.type!==OpenLayers.Filter.Logical.NOT)for(var e,c=0,d=b.filters.length;d>c;++c)e=b.filters[c],e instanceof OpenLayers.Filter.Logical&&(b.filters[c]=this.customizeFilter(e));else a=b.filters&&b.filters.length>0?this.customizeFilter(b.filters[0]):this.wrapFilter(this.createDefaultFilter());else{var f;f=this.defaultBuilderType===gxp.FilterBuilder.NOT_ALL_OF?OpenLayers.Filter.Logical.AND:OpenLayers.Filter.Logical.OR,a.filters=[new OpenLayers.Filter.Logical({type:f,filters:[b]})]}}else a.filters=[new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.OR,filters:[this.createDefaultFilter()]})];break;default:a=this.wrapFilter(a)}else a=this.wrapFilter(this.createDefaultFilter());return a},createDefaultFilter:function(){return new OpenLayers.Filter.Comparison},wrapFilter:function(a){var b;return b=this.defaultBuilderType===gxp.FilterBuilder.ALL_OF?OpenLayers.Filter.Logical.AND:OpenLayers.Filter.Logical.OR,new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.OR,filters:[new OpenLayers.Filter.Logical({type:b,filters:[a]})]})},addCondition:function(a){var b,c;a?(c="gx_filterbuilder",b=this.wrapFilter(this.createDefaultFilter())):(c="gx_filterfield",b=this.createDefaultFilter());var d=this.newRow({xtype:c,filter:b,columnWidth:1,attributes:this.attributes,customizeFilterOnInit:a&&!1,listeners:{change:function(){this.fireEvent("change",this)},scope:this}});this.childFilterContainer.add(d),this.filter.filters[0].filters.push(b),this.childFilterContainer.doLayout()},removeCondition:function(a,b){var c=this.filter.filters[0].filters;c.length>1&&(c.remove(b),this.childFilterContainer.remove(a,!0)),this.fireEvent("change",this)},createBuilderTypeCombo:function(){for(var a,b=this.allowedBuilderTypes||[gxp.FilterBuilder.ANY_OF,gxp.FilterBuilder.ALL_OF],c=b.length,d=new Array(c),e=0;c>e;++e)a=b[e],d[e]=[a,this.builderTypeNames[a]];return{xtype:"combo",store:new Ext.data.SimpleStore({data:d,fields:["value","name"]}),value:this.builderType,displayField:"name",valueField:"value",triggerAction:"all",mode:"local",listeners:{select:function(a,b){this.changeBuilderType(b.get("value")),this.fireEvent("change",this)},scope:this},width:60}},changeBuilderType:function(a){if(a!==this.builderType){this.builderType=a;var b=this.filter.filters[0];switch(a){case gxp.FilterBuilder.ANY_OF:this.filter.type=OpenLayers.Filter.Logical.OR,b.type=OpenLayers.Filter.Logical.OR;break;case gxp.FilterBuilder.ALL_OF:this.filter.type=OpenLayers.Filter.Logical.OR,b.type=OpenLayers.Filter.Logical.AND;break;case gxp.FilterBuilder.NONE_OF:this.filter.type=OpenLayers.Filter.Logical.NOT,b.type=OpenLayers.Filter.Logical.OR;break;case gxp.FilterBuilder.NOT_ALL_OF:this.filter.type=OpenLayers.Filter.Logical.NOT,b.type=OpenLayers.Filter.Logical.AND}}},createChildFiltersPanel:function(){this.childFilterContainer=new Ext.Container;for(var a,b=this.filter.filters[0].filters,c=0,d=b.length;d>c;++c){a=b[c];var e={xtype:"gx_filterfield",columnWidth:1,filter:a,attributes:this.attributes,listeners:{change:function(){this.fireEvent("change",this)},scope:this}},f=Ext.applyIf(a instanceof OpenLayers.Filter.Logical?{xtype:"gx_filterbuilder"}:{xtype:"container",layout:"form",hideLabels:!0,items:e},e);this.childFilterContainer.add(this.newRow(f))}return this.childFilterContainer},newRow:function(a){var b=new Ext.Container({layout:"column",items:[{xtype:"container",width:28,style:"padding-left: 2px",items:{xtype:"button",text:"<i class='icon-minus-sign btn-gc'></i>",tooltip:"remove condition",handler:function(){this.removeCondition(b,a.filter)},scope:this}},a]});return b},getBuilderType:function(){var a=this.defaultBuilderType;if(this.filter){var b=this.filter.filters[0];if(this.filter.type===OpenLayers.Filter.Logical.NOT)switch(b.type){case OpenLayers.Filter.Logical.OR:a=gxp.FilterBuilder.NONE_OF;break;case OpenLayers.Filter.Logical.AND:a=gxp.FilterBuilder.NOT_ALL_OF}else switch(b.type){case OpenLayers.Filter.Logical.OR:a=gxp.FilterBuilder.ANY_OF;break;case OpenLayers.Filter.Logical.AND:a=gxp.FilterBuilder.ALL_OF}}return a}}),gxp.FilterBuilder.ANY_OF=0,gxp.FilterBuilder.ALL_OF=1,gxp.FilterBuilder.NONE_OF=2,gxp.FilterBuilder.NOT_ALL_OF=3,Ext.reg("gx_filterbuilder",gxp.FilterBuilder),Ext.namespace("gxp.form"),gxp.form.ComarisonComboBox=Ext.extend(Ext.form.ComboBox,{allowedTypes:[[OpenLayers.Filter.Comparison.EQUAL_TO,"="],[OpenLayers.Filter.Comparison.NOT_EQUAL_TO,"<>"],[OpenLayers.Filter.Comparison.LESS_THAN,"<"],[OpenLayers.Filter.Comparison.GREATER_THAN,">"],[OpenLayers.Filter.Comparison.LESS_THAN_OR_EQUAL_TO,"<="],[OpenLayers.Filter.Comparison.GREATER_THAN_OR_EQUAL_TO,">="],[OpenLayers.Filter.Comparison.LIKE,"like"]],allowBlank:!1,mode:"local",triggerAction:"all",width:50,editable:!1,initComponent:function(){var a={displayField:"name",valueField:"value",store:new Ext.data.SimpleStore({data:this.allowedTypes,fields:["value","name"]}),value:void 0===this.value?this.allowedTypes[0][0]:this.value};Ext.applyIf(this,a),gxp.form.ComarisonComboBox.superclass.initComponent.call(this)}}),Ext.reg("gx_comparisoncombo",gxp.form.ComarisonComboBox),Proj4js={defaultDatum:"WGS84",transform:function(a,b,c){if(!a.readyToUse)return this.reportError("Proj4js initialization for:"+a.srsCode+" not yet complete"),c;if(!b.readyToUse)return this.reportError("Proj4js initialization for:"+b.srsCode+" not yet complete"),c;if("900913"==a.srsProjNumber&&"WGS84"!=b.datumCode&&!b.datum_params||"900913"==b.srsProjNumber&&"WGS84"!=a.datumCode&&!a.datum_params){var d=Proj4js.WGS84;this.transform(a,d,c),a=d}return"enu"!=a.axis&&this.adjust_axis(a,!1,c),"longlat"==a.projName?(c.x*=Proj4js.common.D2R,c.y*=Proj4js.common.D2R):(a.to_meter&&(c.x*=a.to_meter,c.y*=a.to_meter),a.inverse(c)),a.from_greenwich&&(c.x+=a.from_greenwich),c=this.datum_transform(a.datum,b.datum,c),b.from_greenwich&&(c.x-=b.from_greenwich),"longlat"==b.projName?(c.x*=Proj4js.common.R2D,c.y*=Proj4js.common.R2D):(b.forward(c),b.to_meter&&(c.x/=b.to_meter,c.y/=b.to_meter)),"enu"!=b.axis&&this.adjust_axis(b,!0,c),c},datum_transform:function(a,b,c){return a.compare_datums(b)?c:a.datum_type==Proj4js.common.PJD_NODATUM||b.datum_type==Proj4js.common.PJD_NODATUM?c:(a.datum_type==Proj4js.common.PJD_GRIDSHIFT&&alert("ERROR: Grid shift transformations are not implemented yet."),b.datum_type==Proj4js.common.PJD_GRIDSHIFT&&alert("ERROR: Grid shift transformations are not implemented yet."),(a.es!=b.es||a.a!=b.a||a.datum_type==Proj4js.common.PJD_3PARAM||a.datum_type==Proj4js.common.PJD_7PARAM||b.datum_type==Proj4js.common.PJD_3PARAM||b.datum_type==Proj4js.common.PJD_7PARAM)&&(a.geodetic_to_geocentric(c),(a.datum_type==Proj4js.common.PJD_3PARAM||a.datum_type==Proj4js.common.PJD_7PARAM)&&a.geocentric_to_wgs84(c),(b.datum_type==Proj4js.common.PJD_3PARAM||b.datum_type==Proj4js.common.PJD_7PARAM)&&b.geocentric_from_wgs84(c),b.geocentric_to_geodetic(c)),b.datum_type==Proj4js.common.PJD_GRIDSHIFT&&alert("ERROR: Grid shift transformations are not implemented yet."),c)},adjust_axis:function(a,b,c){for(var d,e,f=c.x,g=c.y,h=c.z||0,i=0;3>i;i++)if(!b||2!=i||void 0!==c.z)switch(0==i?(d=f,e="x"):1==i?(d=g,e="y"):(d=h,e="z"),a.axis[i]){case"e":c[e]=d;break;case"w":c[e]=-d;break;case"n":c[e]=d;break;case"s":c[e]=-d;break;case"u":void 0!==c[e]&&(c.z=d);break;case"d":void 0!==c[e]&&(c.z=-d);break;default:return alert("ERROR: unknow axis ("+a.axis[i]+") - check definition of "+src.projName),null}return c},reportError:function(){},extend:function(a,b){if(a=a||{},b)for(var c in b){var d=b[c];void 0!==d&&(a[c]=d)}return a},Class:function(){for(var a,b=function(){this.initialize.apply(this,arguments)},c={},d=0;d<arguments.length;++d)a="function"==typeof arguments[d]?arguments[d].prototype:arguments[d],Proj4js.extend(c,a);return b.prototype=c,b},bind:function(a,b){var c=Array.prototype.slice.apply(arguments,[2]);return function(){var d=c.concat(Array.prototype.slice.apply(arguments,[0]));return a.apply(b,d)}},scriptName:"proj4js-combined.js",defsLookupService:"http://spatialreference.org/ref",libPath:null,getScriptLocation:function(){if(this.libPath)return this.libPath;for(var a=this.scriptName,b=a.length,c=document.getElementsByTagName("script"),d=0;d<c.length;d++){var e=c[d].getAttribute("src");if(e){var f=e.lastIndexOf(a);if(f>-1&&f+b==e.length){this.libPath=e.slice(0,-b);break}}}return this.libPath||""},loadScript:function(a,b,c,d){var e=document.createElement("script");e.defer=!1,e.type="text/javascript",e.id=a,e.src=a,e.onload=b,e.onerror=c,e.loadCheck=d,/MSIE/.test(navigator.userAgent)&&(e.onreadystatechange=this.checkReadyState),document.getElementsByTagName("head")[0].appendChild(e)},checkReadyState:function(){"loaded"==this.readyState&&(this.loadCheck()?this.onload():this.onerror())}},Proj4js.Proj=Proj4js.Class({readyToUse:!1,title:null,projName:null,units:null,datum:null,x0:0,y0:0,localCS:!1,queue:null,initialize:function(a,b){if(this.srsCodeInput=a,this.queue=[],b&&this.queue.push(b),a.indexOf("GEOGCS")>=0||a.indexOf("GEOCCS")>=0||a.indexOf("PROJCS")>=0||a.indexOf("LOCAL_CS")>=0)return this.parseWKT(a),this.deriveConstants(),void this.loadProjCode(this.projName);if(0==a.indexOf("urn:")){var c=a.split(":");"ogc"!=c[1]&&"x-ogc"!=c[1]||"def"!=c[2]||"crs"!=c[3]||(a=c[4]+":"+c[c.length-1])}else if(0==a.indexOf("http://")){var d=a.split("#");d[0].match(/epsg.org/)?a="EPSG:"+d[1]:d[0].match(/RIG.xml/)&&(a="IGNF:"+d[1])}this.srsCode=a.toUpperCase(),0==this.srsCode.indexOf("EPSG")?(this.srsCode=this.srsCode,this.srsAuth="epsg",this.srsProjNumber=this.srsCode.substring(5)):0==this.srsCode.indexOf("IGNF")?(this.srsCode=this.srsCode,this.srsAuth="IGNF",this.srsProjNumber=this.srsCode.substring(5)):0==this.srsCode.indexOf("CRS")?(this.srsCode=this.srsCode,this.srsAuth="CRS",this.srsProjNumber=this.srsCode.substring(4)):(this.srsAuth="",this.srsProjNumber=this.srsCode),this.loadProjDefinition()},loadProjDefinition:function(){if(Proj4js.defs[this.srsCode])return void this.defsLoaded();var a=Proj4js.getScriptLocation()+"defs/"+this.srsAuth.toUpperCase()+this.srsProjNumber+".js";Proj4js.loadScript(a,Proj4js.bind(this.defsLoaded,this),Proj4js.bind(this.loadFromService,this),Proj4js.bind(this.checkDefsLoaded,this))},loadFromService:function(){var a=Proj4js.defsLookupService+"/"+this.srsAuth+"/"+this.srsProjNumber+"/proj4js/";Proj4js.loadScript(a,Proj4js.bind(this.defsLoaded,this),Proj4js.bind(this.defsFailed,this),Proj4js.bind(this.checkDefsLoaded,this))},defsLoaded:function(){this.parseDefs(),this.loadProjCode(this.projName)},checkDefsLoaded:function(){return Proj4js.defs[this.srsCode]?!0:!1},defsFailed:function(){Proj4js.reportError("failed to load projection definition for: "+this.srsCode),Proj4js.defs[this.srsCode]=Proj4js.defs.WGS84,this.defsLoaded()},loadProjCode:function(a){if(Proj4js.Proj[a])return void this.initTransforms();var b=Proj4js.getScriptLocation()+"projCode/"+a+".js";Proj4js.loadScript(b,Proj4js.bind(this.loadProjCodeSuccess,this,a),Proj4js.bind(this.loadProjCodeFailure,this,a),Proj4js.bind(this.checkCodeLoaded,this,a))},loadProjCodeSuccess:function(a){Proj4js.Proj[a].dependsOn?this.loadProjCode(Proj4js.Proj[a].dependsOn):this.initTransforms()},loadProjCodeFailure:function(a){Proj4js.reportError("failed to find projection file for: "+a)},checkCodeLoaded:function(a){return Proj4js.Proj[a]?!0:!1},initTransforms:function(){if(Proj4js.extend(this,Proj4js.Proj[this.projName]),this.init(),this.readyToUse=!0,this.queue)for(var a;a=this.queue.shift();)a.call(this,this)},wktRE:/^(\w+)\[(.*)\]$/,parseWKT:function(a){var b=a.match(this.wktRE);if(b){var c,d=b[1],e=b[2],f=e.split(",");c="TOWGS84"==d.toUpperCase()?d:f.shift(),c=c.replace(/^\"/,""),c=c.replace(/\"$/,"");for(var g=new Array,h=0,i="",j=0;j<f.length;++j){for(var k=f[j],l=0;l<k.length;++l)"["==k.charAt(l)&&++h,"]"==k.charAt(l)&&--h;i+=k,0===h?(g.push(i),i=""):i+=","}switch(d){case"LOCAL_CS":this.projName="identity",this.localCS=!0,this.srsCode=c;break;case"GEOGCS":this.projName="longlat",this.geocsCode=c,this.srsCode||(this.srsCode=c);break;case"PROJCS":this.srsCode=c;break;case"GEOCCS":break;case"PROJECTION":this.projName=Proj4js.wktProjections[c];break;case"DATUM":this.datumName=c;break;case"LOCAL_DATUM":this.datumCode="none";break;case"SPHEROID":this.ellps=c,this.a=parseFloat(g.shift()),this.rf=parseFloat(g.shift());break;case"PRIMEM":this.from_greenwich=parseFloat(g.shift());break;case"UNIT":this.units=c,this.unitsPerMeter=parseFloat(g.shift());break;case"PARAMETER":var m=c.toLowerCase(),n=parseFloat(g.shift());switch(m){case"false_easting":this.x0=n;break;case"false_northing":this.y0=n;break;case"scale_factor":this.k0=n;break;case"central_meridian":this.long0=n*Proj4js.common.D2R;break;case"latitude_of_origin":this.lat0=n*Proj4js.common.D2R;break;case"more_here":}break;case"TOWGS84":this.datum_params=g;break;case"AXIS":var m=c.toLowerCase(),n=g.shift();switch(n){case"EAST":n="e";break;case"WEST":n="w";break;case"NORTH":n="n";break;case"SOUTH":n="s";break;case"UP":n="u";break;case"DOWN":n="d";break;case"OTHER":default:n=" "}switch(this.axis||(this.axis="enu"),m){case"X":this.axis=n+this.axis.substr(1,2);break;case"Y":this.axis=this.axis.substr(0,1)+n+this.axis.substr(2,1);break;case"Z":this.axis=this.axis.substr(0,2)+n}case"MORE_HERE":}for(var j=0;j<g.length;++j)this.parseWKT(g[j])}},parseDefs:function(){this.defData=Proj4js.defs[this.srsCode];var a,b;if(this.defData){for(var c=this.defData.split("+"),d=0;d<c.length;d++){var e=c[d].split("=");switch(a=e[0].toLowerCase(),b=e[1],a.replace(/\s/gi,"")){case"":break;case"title":this.title=b;break;case"proj":this.projName=b.replace(/\s/gi,"");break;case"units":this.units=b.replace(/\s/gi,"");break;case"datum":this.datumCode=b.replace(/\s/gi,"");break;case"nadgrids":this.nagrids=b.replace(/\s/gi,"");break;case"ellps":this.ellps=b.replace(/\s/gi,"");break;case"a":this.a=parseFloat(b);break;case"b":this.b=parseFloat(b);break;case"rf":this.rf=parseFloat(b);break;case"lat_0":this.lat0=b*Proj4js.common.D2R;break;case"lat_1":this.lat1=b*Proj4js.common.D2R;break;case"lat_2":this.lat2=b*Proj4js.common.D2R;break;case"lat_ts":this.lat_ts=b*Proj4js.common.D2R;break;case"lon_0":this.long0=b*Proj4js.common.D2R;break;case"alpha":this.alpha=parseFloat(b)*Proj4js.common.D2R;break;case"lonc":this.longc=b*Proj4js.common.D2R;break;case"x_0":this.x0=parseFloat(b);break;case"y_0":this.y0=parseFloat(b);break;case"k_0":this.k0=parseFloat(b);break;case"k":this.k0=parseFloat(b);break;case"r_a":this.R_A=!0;break;case"zone":this.zone=parseInt(b);break;case"south":this.utmSouth=!0;break;case"towgs84":this.datum_params=b.split(",");break;case"to_meter":this.to_meter=parseFloat(b);break;case"from_greenwich":this.from_greenwich=b*Proj4js.common.D2R;break;case"pm":b=b.replace(/\s/gi,""),this.from_greenwich=Proj4js.PrimeMeridian[b]?Proj4js.PrimeMeridian[b]:parseFloat(b),this.from_greenwich*=Proj4js.common.D2R;break;case"axis":b=b.replace(/\s/gi,"");var f="ewnsud";3==b.length&&-1!=f.indexOf(b.substr(0,1))&&-1!=f.indexOf(b.substr(1,1))&&-1!=f.indexOf(b.substr(2,1))&&(this.axis=b);break;case"no_defs":}}this.deriveConstants()}},deriveConstants:function(){if("@null"==this.nagrids&&(this.datumCode="none"),this.datumCode&&"none"!=this.datumCode){var a=Proj4js.Datum[this.datumCode];a&&(this.datum_params=a.towgs84?a.towgs84.split(","):null,this.ellps=a.ellipse,this.datumName=a.datumName?a.datumName:this.datumCode)}if(!this.a){var b=Proj4js.Ellipsoid[this.ellps]?Proj4js.Ellipsoid[this.ellps]:Proj4js.Ellipsoid.WGS84;Proj4js.extend(this,b)}this.rf&&!this.b&&(this.b=(1-1/this.rf)*this.a),Math.abs(this.a-this.b)<Proj4js.common.EPSLN&&(this.sphere=!0,this.b=this.a),this.a2=this.a*this.a,this.b2=this.b*this.b,this.es=(this.a2-this.b2)/this.a2,this.e=Math.sqrt(this.es),this.R_A&&(this.a*=1-this.es*(Proj4js.common.SIXTH+this.es*(Proj4js.common.RA4+this.es*Proj4js.common.RA6)),this.a2=this.a*this.a,this.b2=this.b*this.b,this.es=0),this.ep2=(this.a2-this.b2)/this.b2,this.k0||(this.k0=1),this.axis||(this.axis="enu"),this.datum=new Proj4js.datum(this)
}}),Proj4js.Proj.longlat={init:function(){},forward:function(a){return a},inverse:function(a){return a}},Proj4js.Proj.identity=Proj4js.Proj.longlat,Proj4js.defs={WGS84:"+title=long/lat:WGS84 +proj=longlat +ellps=WGS84 +datum=WGS84 +units=degrees","EPSG:4326":"+title=long/lat:WGS84 +proj=longlat +a=6378137.0 +b=6356752.31424518 +ellps=WGS84 +datum=WGS84 +units=degrees","EPSG:4269":"+title=long/lat:NAD83 +proj=longlat +a=6378137.0 +b=6356752.31414036 +ellps=GRS80 +datum=NAD83 +units=degrees","EPSG:3785":"+title= Google Mercator +proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs"},Proj4js.defs.GOOGLE=Proj4js.defs["EPSG:3785"],Proj4js.defs["EPSG:900913"]=Proj4js.defs["EPSG:3785"],Proj4js.defs["EPSG:102113"]=Proj4js.defs["EPSG:3785"],Proj4js.common={PI:3.141592653589793,HALF_PI:1.5707963267948966,TWO_PI:6.283185307179586,FORTPI:.7853981633974483,R2D:57.29577951308232,D2R:.017453292519943295,SEC_TO_RAD:484813681109536e-20,EPSLN:1e-10,MAX_ITER:20,COS_67P5:.3826834323650898,AD_C:1.0026,PJD_UNKNOWN:0,PJD_3PARAM:1,PJD_7PARAM:2,PJD_GRIDSHIFT:3,PJD_WGS84:4,PJD_NODATUM:5,SRS_WGS84_SEMIMAJOR:6378137,SIXTH:.16666666666666666,RA4:.04722222222222222,RA6:.022156084656084655,RV4:.06944444444444445,RV6:.04243827160493827,msfnz:function(a,b,c){var d=a*b;return c/Math.sqrt(1-d*d)},tsfnz:function(a,b,c){var d=a*c,e=.5*a;return d=Math.pow((1-d)/(1+d),e),Math.tan(.5*(this.HALF_PI-b))/d},phi2z:function(a,b){for(var c,d,e=.5*a,f=this.HALF_PI-2*Math.atan(b),g=0;15>=g;g++)if(c=a*Math.sin(f),d=this.HALF_PI-2*Math.atan(b*Math.pow((1-c)/(1+c),e))-f,f+=d,Math.abs(d)<=1e-10)return f;return alert("phi2z has NoConvergence"),-9999},qsfnz:function(a,b){var c;return a>1e-7?(c=a*b,(1-a*a)*(b/(1-c*c)-.5/a*Math.log((1-c)/(1+c)))):2*b},asinz:function(a){return Math.abs(a)>1&&(a=a>1?1:-1),Math.asin(a)},e0fn:function(a){return 1-.25*a*(1+a/16*(3+1.25*a))},e1fn:function(a){return.375*a*(1+.25*a*(1+.46875*a))},e2fn:function(a){return.05859375*a*a*(1+.75*a)},e3fn:function(a){return a*a*a*(35/3072)},mlfn:function(a,b,c,d,e){return a*e-b*Math.sin(2*e)+c*Math.sin(4*e)-d*Math.sin(6*e)},srat:function(a,b){return Math.pow((1-a)/(1+a),b)},sign:function(a){return 0>a?-1:1},adjust_lon:function(a){return a=Math.abs(a)<this.PI?a:a-this.sign(a)*this.TWO_PI},adjust_lat:function(a){return a=Math.abs(a)<this.HALF_PI?a:a-this.sign(a)*this.PI},latiso:function(a,b,c){if(Math.abs(b)>this.HALF_PI)return+Number.NaN;if(b==this.HALF_PI)return Number.POSITIVE_INFINITY;if(b==-1*this.HALF_PI)return-1*Number.POSITIVE_INFINITY;var d=a*c;return Math.log(Math.tan((this.HALF_PI+b)/2))+a*Math.log((1-d)/(1+d))/2},fL:function(a,b){return 2*Math.atan(a*Math.exp(b))-this.HALF_PI},invlatiso:function(a,b){var c=this.fL(1,b),d=0,e=0;do d=c,e=a*Math.sin(d),c=this.fL(Math.exp(a*Math.log((1+e)/(1-e))/2),b);while(Math.abs(c-d)>1e-12);return c},sinh:function(a){var b=Math.exp(a);return b=(b-1/b)/2},cosh:function(a){var b=Math.exp(a);return b=(b+1/b)/2},tanh:function(a){var b=Math.exp(a);return b=(b-1/b)/(b+1/b)},asinh:function(a){var b=a>=0?1:-1;return b*Math.log(Math.abs(a)+Math.sqrt(a*a+1))},acosh:function(a){return 2*Math.log(Math.sqrt((a+1)/2)+Math.sqrt((a-1)/2))},atanh:function(a){return Math.log((a-1)/(a+1))/2},gN:function(a,b,c){var d=b*c;return a/Math.sqrt(1-d*d)}},Proj4js.datum=Proj4js.Class({initialize:function(a){if(this.datum_type=Proj4js.common.PJD_WGS84,a.datumCode&&"none"==a.datumCode&&(this.datum_type=Proj4js.common.PJD_NODATUM),a&&a.datum_params){for(var b=0;b<a.datum_params.length;b++)a.datum_params[b]=parseFloat(a.datum_params[b]);(0!=a.datum_params[0]||0!=a.datum_params[1]||0!=a.datum_params[2])&&(this.datum_type=Proj4js.common.PJD_3PARAM),a.datum_params.length>3&&(0!=a.datum_params[3]||0!=a.datum_params[4]||0!=a.datum_params[5]||0!=a.datum_params[6])&&(this.datum_type=Proj4js.common.PJD_7PARAM,a.datum_params[3]*=Proj4js.common.SEC_TO_RAD,a.datum_params[4]*=Proj4js.common.SEC_TO_RAD,a.datum_params[5]*=Proj4js.common.SEC_TO_RAD,a.datum_params[6]=a.datum_params[6]/1e6+1)}a&&(this.a=a.a,this.b=a.b,this.es=a.es,this.ep2=a.ep2,this.datum_params=a.datum_params)},compare_datums:function(a){return this.datum_type!=a.datum_type?!1:this.a!=a.a||Math.abs(this.es-a.es)>5e-11?!1:this.datum_type==Proj4js.common.PJD_3PARAM?this.datum_params[0]==a.datum_params[0]&&this.datum_params[1]==a.datum_params[1]&&this.datum_params[2]==a.datum_params[2]:this.datum_type==Proj4js.common.PJD_7PARAM?this.datum_params[0]==a.datum_params[0]&&this.datum_params[1]==a.datum_params[1]&&this.datum_params[2]==a.datum_params[2]&&this.datum_params[3]==a.datum_params[3]&&this.datum_params[4]==a.datum_params[4]&&this.datum_params[5]==a.datum_params[5]&&this.datum_params[6]==a.datum_params[6]:this.datum_type==Proj4js.common.PJD_GRIDSHIFT?0==strcmp(pj_param(this.params,"snadgrids").s,pj_param(a.params,"snadgrids").s):!0},geodetic_to_geocentric:function(a){var b,c,d,e,f,g,h,i=a.x,j=a.y,k=a.z?a.z:0,l=0;if(j<-Proj4js.common.HALF_PI&&j>-1.001*Proj4js.common.HALF_PI)j=-Proj4js.common.HALF_PI;else if(j>Proj4js.common.HALF_PI&&j<1.001*Proj4js.common.HALF_PI)j=Proj4js.common.HALF_PI;else if(j<-Proj4js.common.HALF_PI||j>Proj4js.common.HALF_PI)return Proj4js.reportError("geocent:lat out of range:"+j),null;return i>Proj4js.common.PI&&(i-=2*Proj4js.common.PI),f=Math.sin(j),h=Math.cos(j),g=f*f,e=this.a/Math.sqrt(1-this.es*g),b=(e+k)*h*Math.cos(i),c=(e+k)*h*Math.sin(i),d=(e*(1-this.es)+k)*f,a.x=b,a.y=c,a.z=d,l},geocentric_to_geodetic:function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s=1e-12,t=s*s,u=30,v=a.x,w=a.y,x=a.z?a.z:0;if(n=!1,b=Math.sqrt(v*v+w*w),c=Math.sqrt(v*v+w*w+x*x),b/this.a<s){if(n=!0,p=0,c/this.a<s)return q=Proj4js.common.HALF_PI,void(r=-this.b)}else p=Math.atan2(w,v);d=x/c,e=b/c,f=1/Math.sqrt(1-this.es*(2-this.es)*e*e),i=e*(1-this.es)*f,j=d*f,o=0;do o++,h=this.a/Math.sqrt(1-this.es*j*j),r=b*i+x*j-h*(1-this.es*j*j),g=this.es*h/(h+r),f=1/Math.sqrt(1-g*(2-g)*e*e),k=e*(1-g)*f,l=d*f,m=l*i-k*j,i=k,j=l;while(m*m>t&&u>o);return q=Math.atan(l/Math.abs(k)),a.x=p,a.y=q,a.z=r,a},geocentric_to_geodetic_noniter:function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s=a.x,t=a.y,u=a.z?a.z:0;if(s=parseFloat(s),t=parseFloat(t),u=parseFloat(u),r=!1,0!=s)b=Math.atan2(t,s);else if(t>0)b=Proj4js.common.HALF_PI;else if(0>t)b=-Proj4js.common.HALF_PI;else if(r=!0,b=0,u>0)c=Proj4js.common.HALF_PI;else{if(!(0>u))return c=Proj4js.common.HALF_PI,void(d=-this.b);c=-Proj4js.common.HALF_PI}return f=s*s+t*t,e=Math.sqrt(f),g=u*Proj4js.common.AD_C,i=Math.sqrt(g*g+f),k=g/i,m=e/i,l=k*k*k,h=u+this.b*this.ep2*l,q=e-this.a*this.es*m*m*m,j=Math.sqrt(h*h+q*q),n=h/j,o=q/j,p=this.a/Math.sqrt(1-this.es*n*n),d=o>=Proj4js.common.COS_67P5?e/o-p:o<=-Proj4js.common.COS_67P5?e/-o-p:u/n+p*(this.es-1),0==r&&(c=Math.atan(n/o)),a.x=b,a.y=c,a.z=d,a},geocentric_to_wgs84:function(a){if(this.datum_type==Proj4js.common.PJD_3PARAM)a.x+=this.datum_params[0],a.y+=this.datum_params[1],a.z+=this.datum_params[2];else if(this.datum_type==Proj4js.common.PJD_7PARAM){var b=this.datum_params[0],c=this.datum_params[1],d=this.datum_params[2],e=this.datum_params[3],f=this.datum_params[4],g=this.datum_params[5],h=this.datum_params[6],i=h*(a.x-g*a.y+f*a.z)+b,j=h*(g*a.x+a.y-e*a.z)+c,k=h*(-f*a.x+e*a.y+a.z)+d;a.x=i,a.y=j,a.z=k}},geocentric_from_wgs84:function(a){if(this.datum_type==Proj4js.common.PJD_3PARAM)a.x-=this.datum_params[0],a.y-=this.datum_params[1],a.z-=this.datum_params[2];else if(this.datum_type==Proj4js.common.PJD_7PARAM){var b=this.datum_params[0],c=this.datum_params[1],d=this.datum_params[2],e=this.datum_params[3],f=this.datum_params[4],g=this.datum_params[5],h=this.datum_params[6],i=(a.x-b)/h,j=(a.y-c)/h,k=(a.z-d)/h;a.x=i+g*j-f*k,a.y=-g*i+j+e*k,a.z=f*i-e*j+k}}}),Proj4js.Point=Proj4js.Class({initialize:function(a,b,c){if("object"==typeof a)this.x=a[0],this.y=a[1],this.z=a[2]||0;else if("string"==typeof a&&"undefined"==typeof b){var d=a.split(",");this.x=parseFloat(d[0]),this.y=parseFloat(d[1]),this.z=parseFloat(d[2])||0}else this.x=a,this.y=b,this.z=c||0},clone:function(){return new Proj4js.Point(this.x,this.y,this.z)},toString:function(){return"x="+this.x+",y="+this.y},toShortString:function(){return this.x+", "+this.y}}),Proj4js.PrimeMeridian={greenwich:0,lisbon:-9.131906111111,paris:2.337229166667,bogota:-74.080916666667,madrid:-3.687938888889,rome:12.452333333333,bern:7.439583333333,jakarta:106.807719444444,ferro:-17.666666666667,brussels:4.367975,stockholm:18.058277777778,athens:23.7163375,oslo:10.722916666667},Proj4js.Ellipsoid={MERIT:{a:6378137,rf:298.257,ellipseName:"MERIT 1983"},SGS85:{a:6378136,rf:298.257,ellipseName:"Soviet Geodetic System 85"},GRS80:{a:6378137,rf:298.257222101,ellipseName:"GRS 1980(IUGG, 1980)"},IAU76:{a:6378140,rf:298.257,ellipseName:"IAU 1976"},airy:{a:6377563.396,b:6356256.91,ellipseName:"Airy 1830"},"APL4.":{a:6378137,rf:298.25,ellipseName:"Appl. Physics. 1965"},NWL9D:{a:6378145,rf:298.25,ellipseName:"Naval Weapons Lab., 1965"},mod_airy:{a:6377340.189,b:6356034.446,ellipseName:"Modified Airy"},andrae:{a:6377104.43,rf:300,ellipseName:"Andrae 1876 (Den., Iclnd.)"},aust_SA:{a:6378160,rf:298.25,ellipseName:"Australian Natl & S. Amer. 1969"},GRS67:{a:6378160,rf:298.247167427,ellipseName:"GRS 67(IUGG 1967)"},bessel:{a:6377397.155,rf:299.1528128,ellipseName:"Bessel 1841"},bess_nam:{a:6377483.865,rf:299.1528128,ellipseName:"Bessel 1841 (Namibia)"},clrk66:{a:6378206.4,b:6356583.8,ellipseName:"Clarke 1866"},clrk80:{a:6378249.145,rf:293.4663,ellipseName:"Clarke 1880 mod."},CPM:{a:6375738.7,rf:334.29,ellipseName:"Comm. des Poids et Mesures 1799"},delmbr:{a:6376428,rf:311.5,ellipseName:"Delambre 1810 (Belgium)"},engelis:{a:6378136.05,rf:298.2566,ellipseName:"Engelis 1985"},evrst30:{a:6377276.345,rf:300.8017,ellipseName:"Everest 1830"},evrst48:{a:6377304.063,rf:300.8017,ellipseName:"Everest 1948"},evrst56:{a:6377301.243,rf:300.8017,ellipseName:"Everest 1956"},evrst69:{a:6377295.664,rf:300.8017,ellipseName:"Everest 1969"},evrstSS:{a:6377298.556,rf:300.8017,ellipseName:"Everest (Sabah & Sarawak)"},fschr60:{a:6378166,rf:298.3,ellipseName:"Fischer (Mercury Datum) 1960"},fschr60m:{a:6378155,rf:298.3,ellipseName:"Fischer 1960"},fschr68:{a:6378150,rf:298.3,ellipseName:"Fischer 1968"},helmert:{a:6378200,rf:298.3,ellipseName:"Helmert 1906"},hough:{a:6378270,rf:297,ellipseName:"Hough"},intl:{a:6378388,rf:297,ellipseName:"International 1909 (Hayford)"},kaula:{a:6378163,rf:298.24,ellipseName:"Kaula 1961"},lerch:{a:6378139,rf:298.257,ellipseName:"Lerch 1979"},mprts:{a:6397300,rf:191,ellipseName:"Maupertius 1738"},new_intl:{a:6378157.5,b:6356772.2,ellipseName:"New International 1967"},plessis:{a:6376523,rf:6355863,ellipseName:"Plessis 1817 (France)"},krass:{a:6378245,rf:298.3,ellipseName:"Krassovsky, 1942"},SEasia:{a:6378155,b:6356773.3205,ellipseName:"Southeast Asia"},walbeck:{a:6376896,b:6355834.8467,ellipseName:"Walbeck"},WGS60:{a:6378165,rf:298.3,ellipseName:"WGS 60"},WGS66:{a:6378145,rf:298.25,ellipseName:"WGS 66"},WGS72:{a:6378135,rf:298.26,ellipseName:"WGS 72"},WGS84:{a:6378137,rf:298.257223563,ellipseName:"WGS 84"},sphere:{a:6370997,b:6370997,ellipseName:"Normal Sphere (r=6370997)"}},Proj4js.Datum={WGS84:{towgs84:"0,0,0",ellipse:"WGS84",datumName:"WGS84"},GGRS87:{towgs84:"-199.87,74.79,246.62",ellipse:"GRS80",datumName:"Greek_Geodetic_Reference_System_1987"},NAD83:{towgs84:"0,0,0",ellipse:"GRS80",datumName:"North_American_Datum_1983"},NAD27:{nadgrids:"@conus,@alaska,@ntv2_0.gsb,@ntv1_can.dat",ellipse:"clrk66",datumName:"North_American_Datum_1927"},potsdam:{towgs84:"606.0,23.0,413.0",ellipse:"bessel",datumName:"Potsdam Rauenberg 1950 DHDN"},carthage:{towgs84:"-263.0,6.0,431.0",ellipse:"clark80",datumName:"Carthage 1934 Tunisia"},hermannskogel:{towgs84:"653.0,-212.0,449.0",ellipse:"bessel",datumName:"Hermannskogel"},ire65:{towgs84:"482.530,-130.596,564.557,-1.042,-0.214,-0.631,8.15",ellipse:"mod_airy",datumName:"Ireland 1965"},nzgd49:{towgs84:"59.47,-5.04,187.44,0.47,-0.1,1.024,-4.5993",ellipse:"intl",datumName:"New Zealand Geodetic Datum 1949"},OSGB36:{towgs84:"446.448,-125.157,542.060,0.1502,0.2470,0.8421,-20.4894",ellipse:"airy",datumName:"Airy 1830"}},Proj4js.WGS84=new Proj4js.Proj("WGS84"),Proj4js.Datum.OSB36=Proj4js.Datum.OSGB36,Proj4js.wktProjections={"Lambert Tangential Conformal Conic Projection":"lcc",Mercator:"merc","Popular Visualisation Pseudo Mercator":"merc",Transverse_Mercator:"tmerc","Transverse Mercator":"tmerc","Lambert Azimuthal Equal Area":"laea","Universal Transverse Mercator System":"utm"},Proj4js.Proj.aea={init:function(){return Math.abs(this.lat1+this.lat2)<Proj4js.common.EPSLN?void Proj4js.reportError("aeaInitEqualLatitudes"):(this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e3=Math.sqrt(this.es),this.sin_po=Math.sin(this.lat1),this.cos_po=Math.cos(this.lat1),this.t1=this.sin_po,this.con=this.sin_po,this.ms1=Proj4js.common.msfnz(this.e3,this.sin_po,this.cos_po),this.qs1=Proj4js.common.qsfnz(this.e3,this.sin_po,this.cos_po),this.sin_po=Math.sin(this.lat2),this.cos_po=Math.cos(this.lat2),this.t2=this.sin_po,this.ms2=Proj4js.common.msfnz(this.e3,this.sin_po,this.cos_po),this.qs2=Proj4js.common.qsfnz(this.e3,this.sin_po,this.cos_po),this.sin_po=Math.sin(this.lat0),this.cos_po=Math.cos(this.lat0),this.t3=this.sin_po,this.qs0=Proj4js.common.qsfnz(this.e3,this.sin_po,this.cos_po),this.ns0=Math.abs(this.lat1-this.lat2)>Proj4js.common.EPSLN?(this.ms1*this.ms1-this.ms2*this.ms2)/(this.qs2-this.qs1):this.con,this.c=this.ms1*this.ms1+this.ns0*this.qs1,void(this.rh=this.a*Math.sqrt(this.c-this.ns0*this.qs0)/this.ns0))},forward:function(a){var b=a.x,c=a.y;this.sin_phi=Math.sin(c),this.cos_phi=Math.cos(c);var d=Proj4js.common.qsfnz(this.e3,this.sin_phi,this.cos_phi),e=this.a*Math.sqrt(this.c-this.ns0*d)/this.ns0,f=this.ns0*Proj4js.common.adjust_lon(b-this.long0),g=e*Math.sin(f)+this.x0,h=this.rh-e*Math.cos(f)+this.y0;return a.x=g,a.y=h,a},inverse:function(a){var b,c,d,e,f,g;return a.x-=this.x0,a.y=this.rh-a.y+this.y0,this.ns0>=0?(b=Math.sqrt(a.x*a.x+a.y*a.y),d=1):(b=-Math.sqrt(a.x*a.x+a.y*a.y),d=-1),e=0,0!=b&&(e=Math.atan2(d*a.x,d*a.y)),d=b*this.ns0/this.a,c=(this.c-d*d)/this.ns0,this.e3>=1e-10?(d=1-.5*(1-this.es)*Math.log((1-this.e3)/(1+this.e3))/this.e3,g=Math.abs(Math.abs(d)-Math.abs(c))>1e-10?this.phi1z(this.e3,c):c>=0?.5*PI:-.5*PI):g=this.phi1z(e3,c),f=Proj4js.common.adjust_lon(e/this.ns0+this.long0),a.x=f,a.y=g,a},phi1z:function(a,b){var c,d,e,f=Proj4js.common.asinz(.5*b);if(a<Proj4js.common.EPSLN)return f;for(var g=a*a,h=1;25>=h;h++)if(sinphi=Math.sin(f),cosphi=Math.cos(f),c=a*sinphi,d=1-c*c,e=.5*d*d/cosphi*(b/(1-g)-sinphi/d+.5/a*Math.log((1-c)/(1+c))),f+=e,Math.abs(e)<=1e-7)return f;return Proj4js.reportError("aea:phi1z:Convergence error"),null}},Proj4js.Proj.sterea={dependsOn:"gauss",init:function(){return Proj4js.Proj.gauss.init.apply(this),this.rc?(this.sinc0=Math.sin(this.phic0),this.cosc0=Math.cos(this.phic0),this.R2=2*this.rc,void(this.title||(this.title="Oblique Stereographic Alternative"))):void Proj4js.reportError("sterea:init:E_ERROR_0")},forward:function(a){return a.x=Proj4js.common.adjust_lon(a.x-this.long0),Proj4js.Proj.gauss.forward.apply(this,[a]),sinc=Math.sin(a.y),cosc=Math.cos(a.y),cosl=Math.cos(a.x),k=this.k0*this.R2/(1+this.sinc0*sinc+this.cosc0*cosc*cosl),a.x=k*cosc*Math.sin(a.x),a.y=k*(this.cosc0*sinc-this.sinc0*cosc*cosl),a.x=this.a*a.x+this.x0,a.y=this.a*a.y+this.y0,a},inverse:function(a){var b,d;return a.x=(a.x-this.x0)/this.a,a.y=(a.y-this.y0)/this.a,a.x/=this.k0,a.y/=this.k0,(rho=Math.sqrt(a.x*a.x+a.y*a.y))?(c=2*Math.atan2(rho,this.R2),sinc=Math.sin(c),cosc=Math.cos(c),d=Math.asin(cosc*this.sinc0+a.y*sinc*this.cosc0/rho),b=Math.atan2(a.x*sinc,rho*this.cosc0*cosc-a.y*this.sinc0*sinc)):(d=this.phic0,b=0),a.x=b,a.y=d,Proj4js.Proj.gauss.inverse.apply(this,[a]),a.x=Proj4js.common.adjust_lon(a.x+this.long0),a}},Proj4js.Proj.poly={init:function(){(this.lat0=0)&&(this.lat0=90),this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e=Math.sqrt(this.es),this.e0=Proj4js.common.e0fn(this.es),this.e1=Proj4js.common.e1fn(this.es),this.e2=Proj4js.common.e2fn(this.es),this.e3=Proj4js.common.e3fn(this.es),this.ml0=Proj4js.common.mlfn(this.e0,this.e1,this.e2,this.e3,this.lat0)},forward:function(a){var b,c,d,e,f,g,h,i=a.x,j=a.y;return d=Proj4js.common.adjust_lon(i-this.long0),Math.abs(j)<=1e-7?(g=this.x0+this.a*d,h=this.y0-this.a*this.ml0):(b=Math.sin(j),c=Math.cos(j),e=Proj4js.common.mlfn(this.e0,this.e1,this.e2,this.e3,j),f=Proj4js.common.msfnz(this.e,b,c),d=b,g=this.x0+this.a*f*Math.sin(d)/b,h=this.y0+this.a*(e-this.ml0+f*(1-Math.cos(d))/b)),a.x=g,a.y=h,a},inverse:function(a){var b,c,d,e,f,g;if(a.x-=this.x0,a.y-=this.y0,b=this.ml0+a.y/this.a,e=0,Math.abs(b)<=1e-7)f=a.x/this.a+this.long0,g=0;else{if(c=b*b+a.x/this.a*(a.x/this.a),e=phi4z(this.es,this.e0,this.e1,this.e2,this.e3,this.al,c,d,g),1!=e)return e;f=Proj4js.common.adjust_lon(Proj4js.common.asinz(a.x*d/this.a)/Math.sin(g)+this.long0)}return a.x=f,a.y=g,a}},Proj4js.Proj.equi={init:function(){this.x0||(this.x0=0),this.y0||(this.y0=0),this.lat0||(this.lat0=0),this.long0||(this.long0=0)},forward:function(a){var b=a.x,c=a.y,d=Proj4js.common.adjust_lon(b-this.long0),e=this.x0+this.a*d*Math.cos(this.lat0),f=this.y0+this.a*c;return this.t1=e,this.t2=Math.cos(this.lat0),a.x=e,a.y=f,a},inverse:function(a){a.x-=this.x0,a.y-=this.y0;var b=a.y/this.a;Math.abs(b)>Proj4js.common.HALF_PI&&Proj4js.reportError("equi:Inv:DataError");var c=Proj4js.common.adjust_lon(this.long0+a.x/(this.a*Math.cos(this.lat0)));a.x=c,a.y=b}},Proj4js.Proj.merc={init:function(){this.lat_ts&&(this.k0=this.sphere?Math.cos(this.lat_ts):Proj4js.common.msfnz(this.es,Math.sin(this.lat_ts),Math.cos(this.lat_ts)))},forward:function(a){var b=a.x,c=a.y;if(c*Proj4js.common.R2D>90&&c*Proj4js.common.R2D<-90&&b*Proj4js.common.R2D>180&&b*Proj4js.common.R2D<-180)return Proj4js.reportError("merc:forward: llInputOutOfRange: "+b+" : "+c),null;var d,e;if(Math.abs(Math.abs(c)-Proj4js.common.HALF_PI)<=Proj4js.common.EPSLN)return Proj4js.reportError("merc:forward: ll2mAtPoles"),null;if(this.sphere)d=this.x0+this.a*this.k0*Proj4js.common.adjust_lon(b-this.long0),e=this.y0+this.a*this.k0*Math.log(Math.tan(Proj4js.common.FORTPI+.5*c));else{var f=Math.sin(c),g=Proj4js.common.tsfnz(this.e,c,f);d=this.x0+this.a*this.k0*Proj4js.common.adjust_lon(b-this.long0),e=this.y0-this.a*this.k0*Math.log(g)}return a.x=d,a.y=e,a},inverse:function(a){var b,c,d=a.x-this.x0,e=a.y-this.y0;if(this.sphere)c=Proj4js.common.HALF_PI-2*Math.atan(Math.exp(-e/this.a*this.k0));else{var f=Math.exp(-e/(this.a*this.k0));if(c=Proj4js.common.phi2z(this.e,f),-9999==c)return Proj4js.reportError("merc:inverse: lat = -9999"),null}return b=Proj4js.common.adjust_lon(this.long0+d/(this.a*this.k0)),a.x=b,a.y=c,a}},Proj4js.Proj.utm={dependsOn:"tmerc",init:function(){return this.zone?(this.lat0=0,this.long0=(6*Math.abs(this.zone)-183)*Proj4js.common.D2R,this.x0=5e5,this.y0=this.utmSouth?1e7:0,this.k0=.9996,Proj4js.Proj.tmerc.init.apply(this),this.forward=Proj4js.Proj.tmerc.forward,void(this.inverse=Proj4js.Proj.tmerc.inverse)):void Proj4js.reportError("utm:init: zone must be specified for UTM")}},Proj4js.Proj.eqdc={init:function(){this.mode||(this.mode=0),this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e=Math.sqrt(this.es),this.e0=Proj4js.common.e0fn(this.es),this.e1=Proj4js.common.e1fn(this.es),this.e2=Proj4js.common.e2fn(this.es),this.e3=Proj4js.common.e3fn(this.es),this.sinphi=Math.sin(this.lat1),this.cosphi=Math.cos(this.lat1),this.ms1=Proj4js.common.msfnz(this.e,this.sinphi,this.cosphi),this.ml1=Proj4js.common.mlfn(this.e0,this.e1,this.e2,this.e3,this.lat1),0!=this.mode?(Math.abs(this.lat1+this.lat2)<Proj4js.common.EPSLN&&Proj4js.reportError("eqdc:Init:EqualLatitudes"),this.sinphi=Math.sin(this.lat2),this.cosphi=Math.cos(this.lat2),this.ms2=Proj4js.common.msfnz(this.e,this.sinphi,this.cosphi),this.ml2=Proj4js.common.mlfn(this.e0,this.e1,this.e2,this.e3,this.lat2),this.ns=Math.abs(this.lat1-this.lat2)>=Proj4js.common.EPSLN?(this.ms1-this.ms2)/(this.ml2-this.ml1):this.sinphi):this.ns=this.sinphi,this.g=this.ml1+this.ms1/this.ns,this.ml0=Proj4js.common.mlfn(this.e0,this.e1,this.e2,this.e3,this.lat0),this.rh=this.a*(this.g-this.ml0)},forward:function(a){var b=a.x,c=a.y,d=Proj4js.common.mlfn(this.e0,this.e1,this.e2,this.e3,c),e=this.a*(this.g-d),f=this.ns*Proj4js.common.adjust_lon(b-this.long0),g=this.x0+e*Math.sin(f),h=this.y0+this.rh-e*Math.cos(f);return a.x=g,a.y=h,a},inverse:function(a){a.x-=this.x0,a.y=this.rh-a.y+this.y0;var b,c;if(this.ns>=0)var c=Math.sqrt(a.x*a.x+a.y*a.y),b=1;else c=-Math.sqrt(a.x*a.x+a.y*a.y),b=-1;var d=0;0!=c&&(d=Math.atan2(b*a.x,b*a.y));var e=this.g-c/this.a,f=this.phi3z(e,this.e0,this.e1,this.e2,this.e3),g=Proj4js.common.adjust_lon(this.long0+d/this.ns);return a.x=g,a.y=f,a},phi3z:function(a,b,c,d,e){var f,g;f=a;for(var h=0;15>h;h++)if(g=(a+c*Math.sin(2*f)-d*Math.sin(4*f)+e*Math.sin(6*f))/b-f,f+=g,Math.abs(g)<=1e-10)return f;return Proj4js.reportError("PHI3Z-CONV:Latitude failed to converge after 15 iterations"),null}},Proj4js.Proj.tmerc={init:function(){this.e0=Proj4js.common.e0fn(this.es),this.e1=Proj4js.common.e1fn(this.es),this.e2=Proj4js.common.e2fn(this.es),this.e3=Proj4js.common.e3fn(this.es),this.ml0=this.a*Proj4js.common.mlfn(this.e0,this.e1,this.e2,this.e3,this.lat0)},forward:function(a){var b,c,d,e=a.x,f=a.y,g=Proj4js.common.adjust_lon(e-this.long0),h=Math.sin(f),i=Math.cos(f);if(this.sphere){var j=i*Math.sin(g);if(Math.abs(Math.abs(j)-1)<1e-10)return Proj4js.reportError("tmerc:forward: Point projects into infinity"),93;c=.5*this.a*this.k0*Math.log((1+j)/(1-j)),b=Math.acos(i*Math.cos(g)/Math.sqrt(1-j*j)),0>f&&(b=-b),d=this.a*this.k0*(b-this.lat0)}else{var k=i*g,l=Math.pow(k,2),m=this.ep2*Math.pow(i,2),n=Math.tan(f),o=Math.pow(n,2);b=1-this.es*Math.pow(h,2);var p=this.a/Math.sqrt(b),q=this.a*Proj4js.common.mlfn(this.e0,this.e1,this.e2,this.e3,f);c=this.k0*p*k*(1+l/6*(1-o+m+l/20*(5-18*o+Math.pow(o,2)+72*m-58*this.ep2)))+this.x0,d=this.k0*(q-this.ml0+p*n*l*(.5+l/24*(5-o+9*m+4*Math.pow(m,2)+l/30*(61-58*o+Math.pow(o,2)+600*m-330*this.ep2))))+this.y0}return a.x=c,a.y=d,a},inverse:function(a){var b,c,d,e,f,g,h=6;if(this.sphere){var i=Math.exp(a.x/(this.a*this.k0)),j=.5*(i-1/i),k=this.lat0+a.y/(this.a*this.k0),l=Math.cos(k);b=Math.sqrt((1-l*l)/(1+j*j)),f=Proj4js.common.asinz(b),0>k&&(f=-f),g=0==j&&0==l?this.long0:Proj4js.common.adjust_lon(Math.atan2(j,l)+this.long0)}else{var m=a.x-this.x0,n=a.y-this.y0;for(b=(this.ml0+n/this.k0)/this.a,c=b,e=0;!0&&(d=(b+this.e1*Math.sin(2*c)-this.e2*Math.sin(4*c)+this.e3*Math.sin(6*c))/this.e0-c,c+=d,!(Math.abs(d)<=Proj4js.common.EPSLN));e++)if(e>=h)return Proj4js.reportError("tmerc:inverse: Latitude failed to converge"),95;if(Math.abs(c)<Proj4js.common.HALF_PI){var o=Math.sin(c),p=Math.cos(c),q=Math.tan(c),r=this.ep2*Math.pow(p,2),s=Math.pow(r,2),t=Math.pow(q,2),u=Math.pow(t,2);b=1-this.es*Math.pow(o,2);var v=this.a/Math.sqrt(b),w=v*(1-this.es)/b,x=m/(v*this.k0),y=Math.pow(x,2);f=c-v*q*y/w*(.5-y/24*(5+3*t+10*r-4*s-9*this.ep2-y/30*(61+90*t+298*r+45*u-252*this.ep2-3*s))),g=Proj4js.common.adjust_lon(this.long0+x*(1-y/6*(1+2*t+r-y/20*(5-2*r+28*t-3*s+8*this.ep2+24*u)))/p)}else f=Proj4js.common.HALF_PI*Proj4js.common.sign(n),g=this.long0}return a.x=g,a.y=f,a}},Proj4js.defs.GOOGLE="+proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs",Proj4js.defs["EPSG:900913"]=Proj4js.defs.GOOGLE,Proj4js.Proj.gstmerc={init:function(){var a=this.b/this.a;this.e=Math.sqrt(1-a*a),this.lc=this.long0,this.rs=Math.sqrt(1+this.e*this.e*Math.pow(Math.cos(this.lat0),4)/(1-this.e*this.e));var b=Math.sin(this.lat0),c=Math.asin(b/this.rs),d=Math.sin(c);this.cp=Proj4js.common.latiso(0,c,d)-this.rs*Proj4js.common.latiso(this.e,this.lat0,b),this.n2=this.k0*this.a*Math.sqrt(1-this.e*this.e)/(1-this.e*this.e*b*b),this.xs=this.x0,this.ys=this.y0-this.n2*c,this.title||(this.title="Gauss Schreiber transverse mercator")},forward:function(a){var b=a.x,c=a.y,d=this.rs*(b-this.lc),e=this.cp+this.rs*Proj4js.common.latiso(this.e,c,Math.sin(c)),f=Math.asin(Math.sin(d)/Proj4js.common.cosh(e)),g=Proj4js.common.latiso(0,f,Math.sin(f));return a.x=this.xs+this.n2*g,a.y=this.ys+this.n2*Math.atan(Proj4js.common.sinh(e)/Math.cos(d)),a},inverse:function(a){var b=a.x,c=a.y,d=Math.atan(Proj4js.common.sinh((b-this.xs)/this.n2)/Math.cos((c-this.ys)/this.n2)),e=Math.asin(Math.sin((c-this.ys)/this.n2)/Proj4js.common.cosh((b-this.xs)/this.n2)),f=Proj4js.common.latiso(0,e,Math.sin(e));return a.x=this.lc+d/this.rs,a.y=Proj4js.common.invlatiso(this.e,(f-this.cp)/this.rs),a}},Proj4js.Proj.ortho={init:function(){this.sin_p14=Math.sin(this.lat0),this.cos_p14=Math.cos(this.lat0)},forward:function(a){var b,c,d,e,f,g,h=a.x,i=a.y;if(d=Proj4js.common.adjust_lon(h-this.long0),b=Math.sin(i),c=Math.cos(i),e=Math.cos(d),g=this.sin_p14*b+this.cos_p14*c*e,f=1,g>0||Math.abs(g)<=Proj4js.common.EPSLN)var j=this.a*f*c*Math.sin(d),k=this.y0+this.a*f*(this.cos_p14*b-this.sin_p14*c*e);else Proj4js.reportError("orthoFwdPointError");return a.x=j,a.y=k,a},inverse:function(a){var b,c,d,e,f,g,h;return a.x-=this.x0,a.y-=this.y0,b=Math.sqrt(a.x*a.x+a.y*a.y),b>this.a+1e-7&&Proj4js.reportError("orthoInvDataError"),c=Proj4js.common.asinz(b/this.a),d=Math.sin(c),e=Math.cos(c),g=this.long0,Math.abs(b)<=Proj4js.common.EPSLN&&(h=this.lat0),h=Proj4js.common.asinz(e*this.sin_p14+a.y*d*this.cos_p14/b),f=Math.abs(this.lat0)-Proj4js.common.HALF_PI,Math.abs(f)<=Proj4js.common.EPSLN&&(g=Proj4js.common.adjust_lon(this.lat0>=0?this.long0+Math.atan2(a.x,-a.y):this.long0-Math.atan2(-a.x,a.y))),f=e-this.sin_p14*Math.sin(h),a.x=g,a.y=h,a}},Proj4js.Proj.somerc={init:function(){var a=this.lat0;this.lambda0=this.long0;var b=Math.sin(a),c=this.a,d=this.rf,e=1/d,f=2*e-Math.pow(e,2),g=this.e=Math.sqrt(f);this.R=this.k0*c*Math.sqrt(1-f)/(1-f*Math.pow(b,2)),this.alpha=Math.sqrt(1+f/(1-f)*Math.pow(Math.cos(a),4)),this.b0=Math.asin(b/this.alpha),this.K=Math.log(Math.tan(Math.PI/4+this.b0/2))-this.alpha*Math.log(Math.tan(Math.PI/4+a/2))+this.alpha*g/2*Math.log((1+g*b)/(1-g*b))},forward:function(a){var b=Math.log(Math.tan(Math.PI/4-a.y/2)),c=this.e/2*Math.log((1+this.e*Math.sin(a.y))/(1-this.e*Math.sin(a.y))),d=-this.alpha*(b+c)+this.K,e=2*(Math.atan(Math.exp(d))-Math.PI/4),f=this.alpha*(a.x-this.lambda0),g=Math.atan(Math.sin(f)/(Math.sin(this.b0)*Math.tan(e)+Math.cos(this.b0)*Math.cos(f))),h=Math.asin(Math.cos(this.b0)*Math.sin(e)-Math.sin(this.b0)*Math.cos(e)*Math.cos(f));return a.y=this.R/2*Math.log((1+Math.sin(h))/(1-Math.sin(h)))+this.y0,a.x=this.R*g+this.x0,a},inverse:function(a){for(var b=a.x-this.x0,c=a.y-this.y0,d=b/this.R,e=2*(Math.atan(Math.exp(c/this.R))-Math.PI/4),f=Math.asin(Math.cos(this.b0)*Math.sin(e)+Math.sin(this.b0)*Math.cos(e)*Math.cos(d)),g=Math.atan(Math.sin(d)/(Math.cos(this.b0)*Math.cos(d)-Math.sin(this.b0)*Math.tan(e))),h=this.lambda0+g/this.alpha,i=0,j=f,k=-1e3,l=0;Math.abs(j-k)>1e-7;){if(++l>20)return void Proj4js.reportError("omercFwdInfinity");i=1/this.alpha*(Math.log(Math.tan(Math.PI/4+f/2))-this.K)+this.e*Math.log(Math.tan(Math.PI/4+Math.asin(this.e*Math.sin(j))/2)),k=j,j=2*Math.atan(Math.exp(i))-Math.PI/2}return a.x=h,a.y=j,a}},Proj4js.Proj.stere={ssfn_:function(a,b,c){return b*=c,Math.tan(.5*(Proj4js.common.HALF_PI+a))*Math.pow((1-b)/(1+b),.5*c)},TOL:1e-8,NITER:8,CONV:1e-10,S_POLE:0,N_POLE:1,OBLIQ:2,EQUIT:3,init:function(){this.phits=this.lat_ts?this.lat_ts:Proj4js.common.HALF_PI;var a=Math.abs(this.lat0);if(this.mode=Math.abs(a)-Proj4js.common.HALF_PI<Proj4js.common.EPSLN?this.lat0<0?this.S_POLE:this.N_POLE:a>Proj4js.common.EPSLN?this.OBLIQ:this.EQUIT,this.phits=Math.abs(this.phits),this.es){var b;switch(this.mode){case this.N_POLE:case this.S_POLE:Math.abs(this.phits-Proj4js.common.HALF_PI)<Proj4js.common.EPSLN?this.akm1=2*this.k0/Math.sqrt(Math.pow(1+this.e,1+this.e)*Math.pow(1-this.e,1-this.e)):(a=Math.sin(this.phits),this.akm1=Math.cos(this.phits)/Proj4js.common.tsfnz(this.e,this.phits,a),a*=this.e,this.akm1/=Math.sqrt(1-a*a));break;case this.EQUIT:this.akm1=2*this.k0;break;case this.OBLIQ:a=Math.sin(this.lat0),b=2*Math.atan(this.ssfn_(this.lat0,a,this.e))-Proj4js.common.HALF_PI,a*=this.e,this.akm1=2*this.k0*Math.cos(this.lat0)/Math.sqrt(1-a*a),this.sinX1=Math.sin(b),this.cosX1=Math.cos(b)}}else switch(this.mode){case this.OBLIQ:this.sinph0=Math.sin(this.lat0),this.cosph0=Math.cos(this.lat0);case this.EQUIT:this.akm1=2*this.k0;break;case this.S_POLE:case this.N_POLE:this.akm1=Math.abs(this.phits-Proj4js.common.HALF_PI)>=Proj4js.common.EPSLN?Math.cos(this.phits)/Math.tan(Proj4js.common.FORTPI-.5*this.phits):2*this.k0}},forward:function(a){var b=a.x;b=Proj4js.common.adjust_lon(b-this.long0);var c,d,e=a.y;if(this.sphere){var f,g,h,i;switch(f=Math.sin(e),g=Math.cos(e),h=Math.cos(b),i=Math.sin(b),this.mode){case this.EQUIT:d=1+g*h,d<=Proj4js.common.EPSLN,d=this.akm1/d,c=d*g*i,d*=f;break;case this.OBLIQ:d=1+this.sinph0*f+this.cosph0*g*h,d<=Proj4js.common.EPSLN,d=this.akm1/d,c=d*g*i,d*=this.cosph0*f-this.sinph0*g*h;break;case this.N_POLE:h=-h,e=-e;case this.S_POLE:Math.abs(e-Proj4js.common.HALF_PI)<this.TOL,d=this.akm1*Math.tan(Proj4js.common.FORTPI+.5*e),c=i*d,d*=h}}else{switch(h=Math.cos(b),i=Math.sin(b),f=Math.sin(e),(this.mode==this.OBLIQ||this.mode==this.EQUIT)&&(X=2*Math.atan(this.ssfn_(e,f,this.e)),sinX=Math.sin(X-Proj4js.common.HALF_PI),cosX=Math.cos(X)),this.mode){case this.OBLIQ:A=this.akm1/(this.cosX1*(1+this.sinX1*sinX+this.cosX1*cosX*h)),d=A*(this.cosX1*sinX-this.sinX1*cosX*h),c=A*cosX;break;case this.EQUIT:A=2*this.akm1/(1+cosX*h),d=A*sinX,c=A*cosX;break;case this.S_POLE:e=-e,h=-h,f=-f;case this.N_POLE:c=this.akm1*Proj4js.common.tsfnz(this.e,e,f),d=-c*h}c*=i}return a.x=c*this.a+this.x0,a.y=d*this.a+this.y0,a},inverse:function(a){var b,c,d,e,f,g,h=(a.x-this.x0)/this.a,i=(a.y-this.y0)/this.a,j=0,k=0,l=0,m=0;if(this.sphere){var n,o,p,q;switch(o=Math.sqrt(h*h+i*i),n=2*Math.atan(o/this.akm1),p=Math.sin(n),q=Math.cos(n),b=0,this.mode){case this.EQUIT:c=Math.abs(o)<=Proj4js.common.EPSLN?0:Math.asin(i*p/o),(0!=q||0!=h)&&(b=Math.atan2(h*p,q*o));break;case this.OBLIQ:c=Math.abs(o)<=Proj4js.common.EPSLN?this.phi0:Math.asin(q*sinph0+i*p*cosph0/o),n=q-sinph0*Math.sin(c),(0!=n||0!=h)&&(b=Math.atan2(h*p*cosph0,n*o));break;case this.N_POLE:i=-i;case this.S_POLE:c=Math.abs(o)<=Proj4js.common.EPSLN?this.phi0:Math.asin(this.mode==this.S_POLE?-q:q),b=0==h&&0==i?0:Math.atan2(h,i)}a.x=Proj4js.common.adjust_lon(b+this.long0),a.y=c}else{switch(f=Math.sqrt(h*h+i*i),this.mode){case this.OBLIQ:case this.EQUIT:j=2*Math.atan2(f*this.cosX1,this.akm1),d=Math.cos(j),e=Math.sin(j),k=Math.asin(0==f?d*this.sinX1:d*this.sinX1+i*e*this.cosX1/f),j=Math.tan(.5*(Proj4js.common.HALF_PI+k)),h*=e,i=f*this.cosX1*d-i*this.sinX1*e,m=Proj4js.common.HALF_PI,l=.5*this.e;break;case this.N_POLE:i=-i;case this.S_POLE:j=-f/this.akm1,k=Proj4js.common.HALF_PI-2*Math.atan(j),m=-Proj4js.common.HALF_PI,l=-.5*this.e}for(g=this.NITER;g--;k=c)if(e=this.e*Math.sin(k),c=2*Math.atan(j*Math.pow((1+e)/(1-e),l))-m,Math.abs(k-c)<this.CONV)return this.mode==this.S_POLE&&(c=-c),b=0==h&&0==i?0:Math.atan2(h,i),a.x=Proj4js.common.adjust_lon(b+this.long0),a.y=c,a}}},Proj4js.Proj.nzmg={iterations:1,init:function(){this.A=new Array,this.A[1]=.6399175073,this.A[2]=-.1358797613,this.A[3]=.063294409,this.A[4]=-.02526853,this.A[5]=.0117879,this.A[6]=-.0055161,this.A[7]=.0026906,this.A[8]=-.001333,this.A[9]=67e-5,this.A[10]=-34e-5,this.B_re=new Array,this.B_im=new Array,this.B_re[1]=.7557853228,this.B_im[1]=0,this.B_re[2]=.249204646,this.B_im[2]=.003371507,this.B_re[3]=-.001541739,this.B_im[3]=.04105856,this.B_re[4]=-.10162907,this.B_im[4]=.01727609,this.B_re[5]=-.26623489,this.B_im[5]=-.36249218,this.B_re[6]=-.6870983,this.B_im[6]=-1.1651967,this.C_re=new Array,this.C_im=new Array,this.C_re[1]=1.3231270439,this.C_im[1]=0,this.C_re[2]=-.577245789,this.C_im[2]=-.007809598,this.C_re[3]=.508307513,this.C_im[3]=-.112208952,this.C_re[4]=-.15094762,this.C_im[4]=.18200602,this.C_re[5]=1.01418179,this.C_im[5]=1.64497696,this.C_re[6]=1.9660549,this.C_im[6]=2.5127645,this.D=new Array,this.D[1]=1.5627014243,this.D[2]=.5185406398,this.D[3]=-.03333098,this.D[4]=-.1052906,this.D[5]=-.0368594,this.D[6]=.007317,this.D[7]=.0122,this.D[8]=.00394,this.D[9]=-.0013
},forward:function(a){var b=a.x,c=a.y,d=c-this.lat0,e=b-this.long0,f=d/Proj4js.common.SEC_TO_RAD*1e-5,g=e,h=1,i=0;for(n=1;10>=n;n++)h*=f,i+=this.A[n]*h;var j,k,l=i,m=g,o=1,p=0,q=0,r=0;for(n=1;6>=n;n++)j=o*l-p*m,k=p*l+o*m,o=j,p=k,q=q+this.B_re[n]*o-this.B_im[n]*p,r=r+this.B_im[n]*o+this.B_re[n]*p;return x=r*this.a+this.x0,y=q*this.a+this.y0,a.x=x,a.y=y,a},inverse:function(a){var b,c,d=a.x,e=a.y,f=d-this.x0,g=e-this.y0,h=g/this.a,j=f/this.a,k=1,l=0,m=0,o=0;for(n=1;6>=n;n++)b=k*h-l*j,c=l*h+k*j,k=b,l=c,m=m+this.C_re[n]*k-this.C_im[n]*l,o=o+this.C_im[n]*k+this.C_re[n]*l;for(i=0;i<this.iterations;i++){var p,q,r=m,s=o,t=h,u=j;for(n=2;6>=n;n++)p=r*m-s*o,q=s*m+r*o,r=p,s=q,t+=(n-1)*(this.B_re[n]*r-this.B_im[n]*s),u+=(n-1)*(this.B_im[n]*r+this.B_re[n]*s);r=1,s=0;var v=this.B_re[1],w=this.B_im[1];for(n=2;6>=n;n++)p=r*m-s*o,q=s*m+r*o,r=p,s=q,v+=n*(this.B_re[n]*r-this.B_im[n]*s),w+=n*(this.B_im[n]*r+this.B_re[n]*s);var x=v*v+w*w;m=(t*v+u*w)/x,o=(u*v-t*w)/x}var y=m,z=o,A=1,B=0;for(n=1;9>=n;n++)A*=y,B+=this.D[n]*A;var C=this.lat0+B*Proj4js.common.SEC_TO_RAD*1e5,D=this.long0+z;return a.x=D,a.y=C,a}},Proj4js.Proj.mill={init:function(){},forward:function(a){var b=a.x,c=a.y,d=Proj4js.common.adjust_lon(b-this.long0),e=this.x0+this.a*d,f=this.y0+this.a*Math.log(Math.tan(Proj4js.common.PI/4+c/2.5))*1.25;return a.x=e,a.y=f,a},inverse:function(a){a.x-=this.x0,a.y-=this.y0;var b=Proj4js.common.adjust_lon(this.long0+a.x/this.a),c=2.5*(Math.atan(Math.exp(.8*a.y/this.a))-Proj4js.common.PI/4);return a.x=b,a.y=c,a}},Proj4js.Proj.gnom={init:function(){this.sin_p14=Math.sin(this.lat0),this.cos_p14=Math.cos(this.lat0),this.infinity_dist=1e3*this.a,this.rc=1},forward:function(a){var b,c,d,e,f,g,h=a.x,i=a.y;return d=Proj4js.common.adjust_lon(h-this.long0),b=Math.sin(i),c=Math.cos(i),e=Math.cos(d),g=this.sin_p14*b+this.cos_p14*c*e,f=1,g>0||Math.abs(g)<=Proj4js.common.EPSLN?(x=this.x0+this.a*f*c*Math.sin(d)/g,y=this.y0+this.a*f*(this.cos_p14*b-this.sin_p14*c*e)/g):(Proj4js.reportError("orthoFwdPointError"),x=this.x0+this.infinity_dist*c*Math.sin(d),y=this.y0+this.infinity_dist*(this.cos_p14*b-this.sin_p14*c*e)),a.x=x,a.y=y,a},inverse:function(a){var b,c,d,e,f,g;return a.x=(a.x-this.x0)/this.a,a.y=(a.y-this.y0)/this.a,a.x/=this.k0,a.y/=this.k0,(b=Math.sqrt(a.x*a.x+a.y*a.y))?(e=Math.atan2(b,this.rc),c=Math.sin(e),d=Math.cos(e),g=Proj4js.common.asinz(d*this.sin_p14+a.y*c*this.cos_p14/b),f=Math.atan2(a.x*c,b*this.cos_p14*d-a.y*this.sin_p14*c),f=Proj4js.common.adjust_lon(this.long0+f)):(g=this.phic0,f=0),a.x=f,a.y=g,a}},Proj4js.Proj.sinu={init:function(){this.R=6370997},forward:function(a){var b,c,d,e=a.x,f=a.y;return d=Proj4js.common.adjust_lon(e-this.long0),b=this.R*d*Math.cos(f)+this.x0,c=this.R*f+this.y0,a.x=b,a.y=c,a},inverse:function(a){var b,c,d;return a.x-=this.x0,a.y-=this.y0,b=a.y/this.R,Math.abs(b)>Proj4js.common.HALF_PI&&Proj4js.reportError("sinu:Inv:DataError"),c=Math.abs(b)-Proj4js.common.HALF_PI,Math.abs(c)>Proj4js.common.EPSLN?(c=this.long0+a.x/(this.R*Math.cos(b)),d=Proj4js.common.adjust_lon(c)):d=this.long0,a.x=d,a.y=b,a}},Proj4js.Proj.vandg={init:function(){this.R=6370997},forward:function(a){var b,c,d=a.x,e=a.y,f=Proj4js.common.adjust_lon(d-this.long0);Math.abs(e)<=Proj4js.common.EPSLN&&(b=this.x0+this.R*f,c=this.y0);var g=Proj4js.common.asinz(2*Math.abs(e/Proj4js.common.PI));(Math.abs(f)<=Proj4js.common.EPSLN||Math.abs(Math.abs(e)-Proj4js.common.HALF_PI)<=Proj4js.common.EPSLN)&&(b=this.x0,c=e>=0?this.y0+Proj4js.common.PI*this.R*Math.tan(.5*g):this.y0+Proj4js.common.PI*this.R*-Math.tan(.5*g));var h=.5*Math.abs(Proj4js.common.PI/f-f/Proj4js.common.PI),i=h*h,j=Math.sin(g),k=Math.cos(g),l=k/(j+k-1),m=l*l,n=l*(2/j-1),o=n*n,p=Proj4js.common.PI*this.R*(h*(l-o)+Math.sqrt(i*(l-o)*(l-o)-(o+i)*(m-o)))/(o+i);return 0>f&&(p=-p),b=this.x0+p,p=Math.abs(p/(Proj4js.common.PI*this.R)),c=e>=0?this.y0+Proj4js.common.PI*this.R*Math.sqrt(1-p*p-2*h*p):this.y0-Proj4js.common.PI*this.R*Math.sqrt(1-p*p-2*h*p),a.x=b,a.y=c,a},inverse:function(a){var b,c,d,e,f,g,h,i,j,k,l;return a.x-=this.x0,a.y-=this.y0,j=Proj4js.common.PI*this.R,b=a.x/j,c=a.y/j,d=b*b+c*c,e=-Math.abs(c)*(1+d),f=e-2*c*c+b*b,g=-2*e+1+2*c*c+d*d,l=c*c/g+(2*f*f*f/g/g/g-9*e*f/g/g)/27,h=(e-f*f/3/g)/g,i=2*Math.sqrt(-h/3),j=3*l/h/i,Math.abs(j)>1&&(j=j>=0?1:-1),k=Math.acos(j)/3,lat=a.y>=0?(-i*Math.cos(k+Proj4js.common.PI/3)-f/3/g)*Proj4js.common.PI:-(-i*Math.cos(k+Proj4js.common.PI/3)-f/3/g)*Proj4js.common.PI,Math.abs(b)<Proj4js.common.EPSLN&&(lon=this.long0),lon=Proj4js.common.adjust_lon(this.long0+Proj4js.common.PI*(d-1+Math.sqrt(1+2*(b*b-c*c)+d*d))/2/b),a.x=lon,a.y=lat,a}},Proj4js.Proj.cea={init:function(){},forward:function(a){var b=a.x,c=a.y;dlon=Proj4js.common.adjust_lon(b-this.long0);var d=this.x0+this.a*dlon*Math.cos(this.lat_ts),e=this.y0+this.a*Math.sin(c)/Math.cos(this.lat_ts);return a.x=d,a.y=e,a},inverse:function(a){a.x-=this.x0,a.y-=this.y0;var b=Proj4js.common.adjust_lon(this.long0+a.x/this.a/Math.cos(this.lat_ts)),c=Math.asin(a.y/this.a*Math.cos(this.lat_ts));return a.x=b,a.y=c,a}},Proj4js.Proj.eqc={init:function(){this.x0||(this.x0=0),this.y0||(this.y0=0),this.lat0||(this.lat0=0),this.long0||(this.long0=0),this.lat_ts||(this.lat_ts=0),this.title||(this.title="Equidistant Cylindrical (Plate Carre)"),this.rc=Math.cos(this.lat_ts)},forward:function(a){var b=a.x,c=a.y,d=Proj4js.common.adjust_lon(b-this.long0),e=Proj4js.common.adjust_lat(c-this.lat0);return a.x=this.x0+this.a*d*this.rc,a.y=this.y0+this.a*e,a},inverse:function(a){var b=a.x,c=a.y;return a.x=Proj4js.common.adjust_lon(this.long0+(b-this.x0)/(this.a*this.rc)),a.y=Proj4js.common.adjust_lat(this.lat0+(c-this.y0)/this.a),a}},Proj4js.Proj.cass={init:function(){this.sphere||(this.en=this.pj_enfn(this.es),this.m0=this.pj_mlfn(this.lat0,Math.sin(this.lat0),Math.cos(this.lat0),this.en))},C1:.16666666666666666,C2:.008333333333333333,C3:.041666666666666664,C4:.3333333333333333,C5:.06666666666666667,forward:function(a){var b,c,d=a.x,e=a.y;return d=Proj4js.common.adjust_lon(d-this.long0),this.sphere?(b=Math.asin(Math.cos(e)*Math.sin(d)),c=Math.atan2(Math.tan(e),Math.cos(d))-this.phi0):(this.n=Math.sin(e),this.c=Math.cos(e),c=this.pj_mlfn(e,this.n,this.c,this.en),this.n=1/Math.sqrt(1-this.es*this.n*this.n),this.tn=Math.tan(e),this.t=this.tn*this.tn,this.a1=d*this.c,this.c*=this.es*this.c/(1-this.es),this.a2=this.a1*this.a1,b=this.n*this.a1*(1-this.a2*this.t*(this.C1-(8-this.t+8*this.c)*this.a2*this.C2)),c-=this.m0-this.n*this.tn*this.a2*(.5+(5-this.t+6*this.c)*this.a2*this.C3)),a.x=this.a*b+this.x0,a.y=this.a*c+this.y0,a},inverse:function(a){a.x-=this.x0,a.y-=this.y0;var b=a.x/this.a,c=a.y/this.a;return this.sphere?(this.dd=c+this.lat0,phi=Math.asin(Math.sin(this.dd)*Math.cos(b)),lam=Math.atan2(Math.tan(b),Math.cos(this.dd))):(ph1=this.pj_inv_mlfn(this.m0+c,this.es,this.en),this.tn=Math.tan(ph1),this.t=this.tn*this.tn,this.n=Math.sin(ph1),this.r=1/(1-this.es*this.n*this.n),this.n=Math.sqrt(this.r),this.r*=(1-this.es)*this.n,this.dd=b/this.n,this.d2=this.dd*this.dd,phi=ph1-this.n*this.tn/this.r*this.d2*(.5-(1+3*this.t)*this.d2*this.C3),lam=this.dd*(1+this.t*this.d2*(-this.C4+(1+3*this.t)*this.d2*this.C5))/Math.cos(ph1)),a.x=Proj4js.common.adjust_lon(this.long0+lam),a.y=phi,a},pj_enfn:function(a){en=new Array,en[0]=this.C00-a*(this.C02+a*(this.C04+a*(this.C06+a*this.C08))),en[1]=a*(this.C22-a*(this.C04+a*(this.C06+a*this.C08)));var b=a*a;return en[2]=b*(this.C44-a*(this.C46+a*this.C48)),b*=a,en[3]=b*(this.C66-a*this.C68),en[4]=b*a*this.C88,en},pj_mlfn:function(a,b,c,d){return c*=b,b*=b,d[0]*a-c*(d[1]+b*(d[2]+b*(d[3]+b*d[4])))},pj_inv_mlfn:function(a,b,c){for(k=1/(1-b),phi=a,i=Proj4js.common.MAX_ITER;i;--i)if(s=Math.sin(phi),t=1-b*s*s,t=(this.pj_mlfn(phi,s,Math.cos(phi),c)-a)*t*Math.sqrt(t)*k,phi-=t,Math.abs(t)<Proj4js.common.EPSLN)return phi;return Proj4js.reportError("cass:pj_inv_mlfn: Convergence error"),phi},C00:1,C02:.25,C04:.046875,C06:.01953125,C08:.01068115234375,C22:.75,C44:.46875,C46:.013020833333333334,C48:.007120768229166667,C66:.3645833333333333,C68:.005696614583333333,C88:.3076171875},Proj4js.Proj.gauss={init:function(){sphi=Math.sin(this.lat0),cphi=Math.cos(this.lat0),cphi*=cphi,this.rc=Math.sqrt(1-this.es)/(1-this.es*sphi*sphi),this.C=Math.sqrt(1+this.es*cphi*cphi/(1-this.es)),this.phic0=Math.asin(sphi/this.C),this.ratexp=.5*this.C*this.e,this.K=Math.tan(.5*this.phic0+Proj4js.common.FORTPI)/(Math.pow(Math.tan(.5*this.lat0+Proj4js.common.FORTPI),this.C)*Proj4js.common.srat(this.e*sphi,this.ratexp))},forward:function(a){var b=a.x,c=a.y;return a.y=2*Math.atan(this.K*Math.pow(Math.tan(.5*c+Proj4js.common.FORTPI),this.C)*Proj4js.common.srat(this.e*Math.sin(c),this.ratexp))-Proj4js.common.HALF_PI,a.x=this.C*b,a},inverse:function(a){var b=1e-14,c=a.x/this.C,d=a.y;num=Math.pow(Math.tan(.5*d+Proj4js.common.FORTPI)/this.K,1/this.C);for(var e=Proj4js.common.MAX_ITER;e>0&&(d=2*Math.atan(num*Proj4js.common.srat(this.e*Math.sin(a.y),-.5*this.e))-Proj4js.common.HALF_PI,!(Math.abs(d-a.y)<b));--e)a.y=d;return e?(a.x=c,a.y=d,a):(Proj4js.reportError("gauss:inverse:convergence failed"),null)}},Proj4js.Proj.omerc={init:function(){this.mode||(this.mode=0),this.lon1||(this.lon1=0,this.mode=1),this.lon2||(this.lon2=0),this.lat2||(this.lat2=0);{var a=this.b/this.a,b=1-Math.pow(a,2);Math.sqrt(b)}this.sin_p20=Math.sin(this.lat0),this.cos_p20=Math.cos(this.lat0),this.con=1-this.es*this.sin_p20*this.sin_p20,this.com=Math.sqrt(1-b),this.bl=Math.sqrt(1+this.es*Math.pow(this.cos_p20,4)/(1-b)),this.al=this.a*this.bl*this.k0*this.com/this.con,Math.abs(this.lat0)<Proj4js.common.EPSLN?(this.ts=1,this.d=1,this.el=1):(this.ts=Proj4js.common.tsfnz(this.e,this.lat0,this.sin_p20),this.con=Math.sqrt(this.con),this.d=this.bl*this.com/(this.cos_p20*this.con),this.f=this.d*this.d-1>0?this.lat0>=0?this.d+Math.sqrt(this.d*this.d-1):this.d-Math.sqrt(this.d*this.d-1):this.d,this.el=this.f*Math.pow(this.ts,this.bl)),0!=this.mode?(this.g=.5*(this.f-1/this.f),this.gama=Proj4js.common.asinz(Math.sin(this.alpha)/this.d),this.longc=this.longc-Proj4js.common.asinz(this.g*Math.tan(this.gama))/this.bl,this.con=Math.abs(this.lat0),this.con>Proj4js.common.EPSLN&&Math.abs(this.con-Proj4js.common.HALF_PI)>Proj4js.common.EPSLN?(this.singam=Math.sin(this.gama),this.cosgam=Math.cos(this.gama),this.sinaz=Math.sin(this.alpha),this.cosaz=Math.cos(this.alpha),this.u=this.lat0>=0?this.al/this.bl*Math.atan(Math.sqrt(this.d*this.d-1)/this.cosaz):-(this.al/this.bl)*Math.atan(Math.sqrt(this.d*this.d-1)/this.cosaz)):Proj4js.reportError("omerc:Init:DataError")):(this.sinphi=Math.sin(this.at1),this.ts1=Proj4js.common.tsfnz(this.e,this.lat1,this.sinphi),this.sinphi=Math.sin(this.lat2),this.ts2=Proj4js.common.tsfnz(this.e,this.lat2,this.sinphi),this.h=Math.pow(this.ts1,this.bl),this.l=Math.pow(this.ts2,this.bl),this.f=this.el/this.h,this.g=.5*(this.f-1/this.f),this.j=(this.el*this.el-this.l*this.h)/(this.el*this.el+this.l*this.h),this.p=(this.l-this.h)/(this.l+this.h),this.dlon=this.lon1-this.lon2,this.dlon<-Proj4js.common.PI&&(this.lon2=this.lon2-2*Proj4js.common.PI),this.dlon>Proj4js.common.PI&&(this.lon2=this.lon2+2*Proj4js.common.PI),this.dlon=this.lon1-this.lon2,this.longc=.5*(this.lon1+this.lon2)-Math.atan(this.j*Math.tan(.5*this.bl*this.dlon)/this.p)/this.bl,this.dlon=Proj4js.common.adjust_lon(this.lon1-this.longc),this.gama=Math.atan(Math.sin(this.bl*this.dlon)/this.g),this.alpha=Proj4js.common.asinz(this.d*Math.sin(this.gama)),Math.abs(this.lat1-this.lat2)<=Proj4js.common.EPSLN?Proj4js.reportError("omercInitDataError"):this.con=Math.abs(this.lat1),this.con<=Proj4js.common.EPSLN||Math.abs(this.con-HALF_PI)<=Proj4js.common.EPSLN?Proj4js.reportError("omercInitDataError"):Math.abs(Math.abs(this.lat0)-Proj4js.common.HALF_PI)<=Proj4js.common.EPSLN&&Proj4js.reportError("omercInitDataError"),this.singam=Math.sin(this.gam),this.cosgam=Math.cos(this.gam),this.sinaz=Math.sin(this.alpha),this.cosaz=Math.cos(this.alpha),this.u=this.lat0>=0?this.al/this.bl*Math.atan(Math.sqrt(this.d*this.d-1)/this.cosaz):-(this.al/this.bl)*Math.atan(Math.sqrt(this.d*this.d-1)/this.cosaz))},forward:function(a){var b,c,d,e,f,g,h,i,j,k,l,m=a.x,n=a.y;b=Math.sin(n),k=Proj4js.common.adjust_lon(m-this.longc),g=Math.sin(this.bl*k),Math.abs(Math.abs(n)-Proj4js.common.HALF_PI)>Proj4js.common.EPSLN?(l=Proj4js.common.tsfnz(this.e,n,b),e=this.el/Math.pow(l,this.bl),j=.5*(e-1/e),c=.5*(e+1/e),h=(j*this.singam-g*this.cosgam)/c,d=Math.cos(this.bl*k),Math.abs(d)<1e-7?f=this.al*this.bl*k:(f=this.al*Math.atan((j*this.cosgam+g*this.singam)/d)/this.bl,0>d&&(f+=Proj4js.common.PI*this.al/this.bl))):(h=n>=0?this.singam:-this.singam,f=this.al*n/this.bl),Math.abs(Math.abs(h)-1)<=Proj4js.common.EPSLN&&Proj4js.reportError("omercFwdInfinity"),i=.5*this.al*Math.log((1-h)/(1+h))/this.bl,f-=this.u;var o=this.x0+i*this.cosaz+f*this.sinaz,p=this.y0+f*this.cosaz-i*this.sinaz;return a.x=o,a.y=p,a},inverse:function(a){var b,c,d,e,f,g,h,i,j,k,l;return a.x-=this.x0,a.y-=this.y0,l=0,e=a.x*this.cosaz-a.y*this.sinaz,f=a.y*this.cosaz+a.x*this.sinaz,f+=this.u,g=Math.exp(-this.bl*e/this.al),h=.5*(g-1/g),c=.5*(g+1/g),j=Math.sin(this.bl*f/this.al),k=(j*this.cosgam+h*this.singam)/c,Math.abs(Math.abs(k)-1)<=Proj4js.common.EPSLN?(lon=this.longc,lat=k>=0?Proj4js.common.HALF_PI:-Proj4js.common.HALF_PI):(d=1/this.bl,i=Math.pow(this.el/Math.sqrt((1+k)/(1-k)),d),lat=Proj4js.common.phi2z(this.e,i),b=this.longc-Math.atan2(h*this.cosgam-j*this.singam,d)/this.bl,lon=Proj4js.common.adjust_lon(b)),a.x=lon,a.y=lat,a}},Proj4js.Proj.lcc={init:function(){if(this.lat2||(this.lat2=this.lat0),this.k0||(this.k0=1),Math.abs(this.lat1+this.lat2)<Proj4js.common.EPSLN)return void Proj4js.reportError("lcc:init: Equal Latitudes");var a=this.b/this.a;this.e=Math.sqrt(1-a*a);var b=Math.sin(this.lat1),c=Math.cos(this.lat1),d=Proj4js.common.msfnz(this.e,b,c),e=Proj4js.common.tsfnz(this.e,this.lat1,b),f=Math.sin(this.lat2),g=Math.cos(this.lat2),h=Proj4js.common.msfnz(this.e,f,g),i=Proj4js.common.tsfnz(this.e,this.lat2,f),j=Proj4js.common.tsfnz(this.e,this.lat0,Math.sin(this.lat0));this.ns=Math.abs(this.lat1-this.lat2)>Proj4js.common.EPSLN?Math.log(d/h)/Math.log(e/i):b,this.f0=d/(this.ns*Math.pow(e,this.ns)),this.rh=this.a*this.f0*Math.pow(j,this.ns),this.title||(this.title="Lambert Conformal Conic")},forward:function(a){var b=a.x,c=a.y;if(!(90>=c&&c>=-90&&180>=b&&b>=-180))return Proj4js.reportError("lcc:forward: llInputOutOfRange: "+b+" : "+c),null;var d,e,f=Math.abs(Math.abs(c)-Proj4js.common.HALF_PI);if(f>Proj4js.common.EPSLN)d=Proj4js.common.tsfnz(this.e,c,Math.sin(c)),e=this.a*this.f0*Math.pow(d,this.ns);else{if(f=c*this.ns,0>=f)return Proj4js.reportError("lcc:forward: No Projection"),null;e=0}var g=this.ns*Proj4js.common.adjust_lon(b-this.long0);return a.x=this.k0*e*Math.sin(g)+this.x0,a.y=this.k0*(this.rh-e*Math.cos(g))+this.y0,a},inverse:function(a){var b,c,d,e,f,g=(a.x-this.x0)/this.k0,h=this.rh-(a.y-this.y0)/this.k0;this.ns>0?(b=Math.sqrt(g*g+h*h),c=1):(b=-Math.sqrt(g*g+h*h),c=-1);var i=0;if(0!=b&&(i=Math.atan2(c*g,c*h)),0!=b||this.ns>0){if(c=1/this.ns,d=Math.pow(b/(this.a*this.f0),c),e=Proj4js.common.phi2z(this.e,d),-9999==e)return null}else e=-Proj4js.common.HALF_PI;return f=Proj4js.common.adjust_lon(i/this.ns+this.long0),a.x=f,a.y=e,a}},Proj4js.Proj.laea={S_POLE:1,N_POLE:2,EQUIT:3,OBLIQ:4,init:function(){var a=Math.abs(this.lat0);if(this.mode=Math.abs(a-Proj4js.common.HALF_PI)<Proj4js.common.EPSLN?this.lat0<0?this.S_POLE:this.N_POLE:Math.abs(a)<Proj4js.common.EPSLN?this.EQUIT:this.OBLIQ,this.es>0){var b;switch(this.qp=Proj4js.common.qsfnz(this.e,1),this.mmf=.5/(1-this.es),this.apa=this.authset(this.es),this.mode){case this.N_POLE:case this.S_POLE:this.dd=1;break;case this.EQUIT:this.rq=Math.sqrt(.5*this.qp),this.dd=1/this.rq,this.xmf=1,this.ymf=.5*this.qp;break;case this.OBLIQ:this.rq=Math.sqrt(.5*this.qp),b=Math.sin(this.lat0),this.sinb1=Proj4js.common.qsfnz(this.e,b)/this.qp,this.cosb1=Math.sqrt(1-this.sinb1*this.sinb1),this.dd=Math.cos(this.lat0)/(Math.sqrt(1-this.es*b*b)*this.rq*this.cosb1),this.ymf=(this.xmf=this.rq)/this.dd,this.xmf*=this.dd}}else this.mode==this.OBLIQ&&(this.sinph0=Math.sin(this.lat0),this.cosph0=Math.cos(this.lat0))},forward:function(a){var b,c,d=a.x,e=a.y;if(d=Proj4js.common.adjust_lon(d-this.long0),this.sphere){var f,g,h;switch(h=Math.sin(e),g=Math.cos(e),f=Math.cos(d),this.mode){case this.OBLIQ:case this.EQUIT:if(c=this.mode==this.EQUIT?1+g*f:1+this.sinph0*h+this.cosph0*g*f,c<=Proj4js.common.EPSLN)return Proj4js.reportError("laea:fwd:y less than eps"),null;c=Math.sqrt(2/c),b=c*g*Math.sin(d),c*=this.mode==this.EQUIT?h:this.cosph0*h-this.sinph0*g*f;break;case this.N_POLE:f=-f;case this.S_POLE:if(Math.abs(e+this.phi0)<Proj4js.common.EPSLN)return Proj4js.reportError("laea:fwd:phi < eps"),null;c=Proj4js.common.FORTPI-.5*e,c=2*(this.mode==this.S_POLE?Math.cos(c):Math.sin(c)),b=c*Math.sin(d),c*=f}}else{var f,i,h,j,k=0,l=0,m=0;switch(f=Math.cos(d),i=Math.sin(d),h=Math.sin(e),j=Proj4js.common.qsfnz(this.e,h),(this.mode==this.OBLIQ||this.mode==this.EQUIT)&&(k=j/this.qp,l=Math.sqrt(1-k*k)),this.mode){case this.OBLIQ:m=1+this.sinb1*k+this.cosb1*l*f;break;case this.EQUIT:m=1+l*f;break;case this.N_POLE:m=Proj4js.common.HALF_PI+e,j=this.qp-j;break;case this.S_POLE:m=e-Proj4js.common.HALF_PI,j=this.qp+j}if(Math.abs(m)<Proj4js.common.EPSLN)return Proj4js.reportError("laea:fwd:b < eps"),null;switch(this.mode){case this.OBLIQ:case this.EQUIT:m=Math.sqrt(2/m),c=this.mode==this.OBLIQ?this.ymf*m*(this.cosb1*k-this.sinb1*l*f):(m=Math.sqrt(2/(1+l*f)))*k*this.ymf,b=this.xmf*m*l*i;break;case this.N_POLE:case this.S_POLE:j>=0?(b=(m=Math.sqrt(j))*i,c=f*(this.mode==this.S_POLE?m:-m)):b=c=0}}return a.x=this.a*b+this.x0,a.y=this.a*c+this.y0,a},inverse:function(a){a.x-=this.x0,a.y-=this.y0;var b=a.x/this.a,c=a.y/this.a;if(this.sphere){var d,e=0,f=0;d=Math.sqrt(b*b+c*c);var g=.5*d;if(g>1)return Proj4js.reportError("laea:Inv:DataError"),null;switch(g=2*Math.asin(g),(this.mode==this.OBLIQ||this.mode==this.EQUIT)&&(f=Math.sin(g),e=Math.cos(g)),this.mode){case this.EQUIT:g=Math.abs(d)<=Proj4js.common.EPSLN?0:Math.asin(c*f/d),b*=f,c=e*d;break;case this.OBLIQ:g=Math.abs(d)<=Proj4js.common.EPSLN?this.phi0:Math.asin(e*sinph0+c*f*cosph0/d),b*=f*cosph0,c=(e-Math.sin(g)*sinph0)*d;break;case this.N_POLE:c=-c,g=Proj4js.common.HALF_PI-g;break;case this.S_POLE:g-=Proj4js.common.HALF_PI}lam=0!=c||this.mode!=this.EQUIT&&this.mode!=this.OBLIQ?Math.atan2(b,c):0}else{var h,i,j,k,l=0;switch(this.mode){case this.EQUIT:case this.OBLIQ:if(b/=this.dd,c*=this.dd,k=Math.sqrt(b*b+c*c),k<Proj4js.common.EPSLN)return a.x=0,a.y=this.phi0,a;i=2*Math.asin(.5*k/this.rq),h=Math.cos(i),b*=i=Math.sin(i),this.mode==this.OBLIQ?(l=h*this.sinb1+c*i*this.cosb1/k,j=this.qp*l,c=k*this.cosb1*h-c*this.sinb1*i):(l=c*i/k,j=this.qp*l,c=k*h);break;case this.N_POLE:c=-c;case this.S_POLE:if(j=b*b+c*c,!j)return a.x=0,a.y=this.phi0,a;l=1-j/this.qp,this.mode==this.S_POLE&&(l=-l)}lam=Math.atan2(b,c),g=this.authlat(Math.asin(l),this.apa)}return a.x=Proj4js.common.adjust_lon(this.long0+lam),a.y=g,a},P00:.3333333333333333,P01:.17222222222222222,P02:.10257936507936508,P10:.06388888888888888,P11:.0664021164021164,P20:.016415012942191543,authset:function(a){var b,c=new Array;return c[0]=a*this.P00,b=a*a,c[0]+=b*this.P01,c[1]=b*this.P10,b*=a,c[0]+=b*this.P02,c[1]+=b*this.P11,c[2]=b*this.P20,c},authlat:function(a,b){var c=a+a;return a+b[0]*Math.sin(c)+b[1]*Math.sin(c+c)+b[2]*Math.sin(c+c+c)}},Proj4js.Proj.aeqd={init:function(){this.sin_p12=Math.sin(this.lat0),this.cos_p12=Math.cos(this.lat0)},forward:function(a){var b,c=a.x,d=(a.y,Math.sin(a.y)),e=Math.cos(a.y),f=Proj4js.common.adjust_lon(c-this.long0),g=Math.cos(f),h=this.sin_p12*d+this.cos_p12*e*g;if(Math.abs(Math.abs(h)-1)<Proj4js.common.EPSLN){if(b=1,0>h)return void Proj4js.reportError("aeqd:Fwd:PointError")}else{var i=Math.acos(h);b=i/Math.sin(i)}return a.x=this.x0+this.a*b*e*Math.sin(f),a.y=this.y0+this.a*b*(this.cos_p12*d-this.sin_p12*e*g),a},inverse:function(a){a.x-=this.x0,a.y-=this.y0;var b=Math.sqrt(a.x*a.x+a.y*a.y);if(b>2*Proj4js.common.HALF_PI*this.a)return void Proj4js.reportError("aeqdInvDataError");var c,d=b/this.a,e=Math.sin(d),f=Math.cos(d),g=this.long0;if(Math.abs(b)<=Proj4js.common.EPSLN)c=this.lat0;else{c=Proj4js.common.asinz(f*this.sin_p12+a.y*e*this.cos_p12/b);var h=Math.abs(this.lat0)-Proj4js.common.HALF_PI;if(Math.abs(h)<=Proj4js.common.EPSLN)g=Proj4js.common.adjust_lon(lat0>=0?this.long0+Math.atan2(a.x,-a.y):this.long0-Math.atan2(-a.x,a.y));else if(h=f-this.sin_p12*Math.sin(c),Math.abs(h)<Proj4js.common.EPSLN&&Math.abs(a.x)<Proj4js.common.EPSLN);else{{Math.atan2(a.x*e*this.cos_p12,h*b)}g=Proj4js.common.adjust_lon(this.long0+Math.atan2(a.x*e*this.cos_p12,h*b))}}return a.x=g,a.y=c,a}},Proj4js.Proj.moll={init:function(){},forward:function(a){for(var b=a.x,c=a.y,d=Proj4js.common.adjust_lon(b-this.long0),e=c,f=Proj4js.common.PI*Math.sin(c),g=0;!0;g++){var h=-(e+Math.sin(e)-f)/(1+Math.cos(e));if(e+=h,Math.abs(h)<Proj4js.common.EPSLN)break;g>=50&&Proj4js.reportError("moll:Fwd:IterationError")}e/=2,Proj4js.common.PI/2-Math.abs(c)<Proj4js.common.EPSLN&&(d=0);var i=.900316316158*this.a*d*Math.cos(e)+this.x0,j=1.4142135623731*this.a*Math.sin(e)+this.y0;return a.x=i,a.y=j,a},inverse:function(a){var b,c;a.x-=this.x0;var c=a.y/(1.4142135623731*this.a);Math.abs(c)>.999999999999&&(c=.999999999999);var b=Math.asin(c),d=Proj4js.common.adjust_lon(this.long0+a.x/(.900316316158*this.a*Math.cos(b)));d<-Proj4js.common.PI&&(d=-Proj4js.common.PI),d>Proj4js.common.PI&&(d=Proj4js.common.PI),c=(2*b+Math.sin(2*b))/Proj4js.common.PI,Math.abs(c)>1&&(c=1);var e=Math.asin(c);return a.x=d,a.y=e,a}};